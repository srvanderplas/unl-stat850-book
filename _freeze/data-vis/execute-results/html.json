{
  "hash": "a6a41bfd4fbd230248eb50377978263e",
  "result": {
    "markdown": "# Data Visualization {#sec-data-vis}\n\n## Module Objectives  {- #module11-objectives}\n\n<!-- ::: column-margin -->\n<!-- ![Mouseover text: I would describe my personal alignment as \"lawful heterozygous silty liquid.\"](https://imgs.xkcd.com/comics/alignment_chart_alignment_chart.png) -->\n\n<!-- IMO, Randall missed the opportunity to put a pie chart as Neutral Evil.  -->\n<!-- ::: -->\n\n- Create charts designed to communicate specific aspects of the data\n- Describe charts using the grammar of graphics \n- Create layered graphics that highlight multiple aspects of the data\n- Evaluate existing charts and develop new versions that improve accessibility and readability\n\n\nThere are a lot of different types of charts, and equally many ways  to categorize and describe the different types of charts. I'm going to be opinionated on this one - while I will provide code for several different plotting programs, this chapter is organized based on the grammar of graphics specifically. \n\n\n::: column-margin\nVisualization and statistical graphics are also my research area, so I'm more passionate about this material, which means there's going to be more to read. Sorry about that in advance. I'll do my best to indicate which content is actually mission-critical and which content you can skip if you're not that interested.\n:::\n\nThis is going to be a fairly extensive chapter (in terms of content) because I want you to have a resource to access later, if you need it. That's why I'm showing you code for many different plotting libraries - I want you to be able to make charts in any program you may need to use for your research.\n\n\n::: {.callout-note collapse=true}\n### Guides and Resources\n\nGraph galleries contain sample code to create many different types of charts. Similar galaries are available in [R](https://r-graph-gallery.com/) and [Python](https://www.python-graph-gallery.com/).\n\nCheat Sheets:\n\n- [Python](https://www.python-graph-gallery.com/cheat-sheets/)\n- [Ggplot2](https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf)\n- [Base R](https://r-graph-gallery.com/134-general-plot-parameters-reminder.html)\n\n:::\n\n\n## Why do we create graphics?\n\n::: column-margin\n> The greatest possibilities of visual display lie in vividness and inescapability of the intended message. A visual display can stop your mental flow in its tracks and make you think. A visual display can force you to notice what you never expected to see. (\"Why, that scatter diagram has a hole in the middle!\") -- John W. Tukey [@tukeyDataBasedGraphicsVisual1990]\n:::\n\nCharts are easier to understand than raw data. \n\nWhen you think about it, data is a pretty artificial thing. We exist in a world of tangible objects, but data are an abstraction - even when the data record information about the tangible world, the measurements are a way of removing the physical and transforming the \"real world\" into a virtual thing. As a result, it can be hard to wrap our heads around what our data contain. The solution to this is to transform our data back into something that is \"tangible\" in some way -- if not physical and literally touch-able, at least something we can view and \"wrap our heads around\". \n\nConsider this thought experiment: You have a simple data set - 2 variables, 500 observations. You want to get a sense of how the variables relate to each other. You can do one of the following options:\n\n1. Print out the data set\n2. Create some summary statistics of each variable and perhaps the covariance between the two variables\n3. Draw a scatter plot of the two variables\n\nWhich one would you rather use? Why?\n\nOur brains are very good at processing large amounts of visual information quickly. In very basic evolutionary terms, it's important to be able to survey a field and pick out the tiger that might eat you. When we present information visually, in a format that can leverage our visual processing abilities, we offload some of the work of understanding the data to a chart that organizes it for us. You could argue that printing out the data is a visual presentation, but it requires that you read that data in as text, which we're not nearly as equipped to process quickly (and in parallel). \n\nIt's a lot easier to talk to non-experts about complicated statistics using visualizations. Moving the discussion from abstract concepts to concrete shapes and lines keeps people who are potentially already math or stat phobic from completely tuning out.\n\n## General approaches to creating graphics\n\nThere are two general approaches to generating statistical graphics computationally: \n  \n1. Manually specify the plot that you want, possibly doing the preprocessing and summarizing before you create the plot.    \nBase R, matplotlib, old-style SAS graphics\n\n2. Describe the relationship between the plot and the data, using sensible defaults that can be customized for common operations.    \nggplot2, plotnine, seaborn (sort of)\n\n\n::: column-margin\nThere is a difference between *low-level* plotting libraries (base R, matplotlib) and *high-level* plotting libraries (ggplot2, plotnine, seaborn). Grammar of graphics libraries are usually high level, but it is entirely possible to have a high level library that does not follow the grammar of graphics. In general, if you have to manually add a legend, it's probably a low level library.\n:::\n\nIn the introduction to The Grammar of Graphics [@wilkinsonGrammarGraphics1999], Leland Wilkinson suggests that the first approach is what we would call \"charts\" - pie charts, line charts, bar charts - objects that are \"instances of much more general objects\". His argument is that elegant graphical design means we have to think about an underlying theory of graphics, rather than how to create specific charts. The 2nd approach is called the \"grammar of graphics\". \n\n<!-- There are other graphics systems (namely, `lattice` in R, `seaborn` in Python, and some web-based rendering engines like `Observable` or `d3`) that you could explore, but it's far more important that you know how to functionally create plots in R and/or Python. I don't recommend you try to become proficient in all of them. **Pick one (two at most) and get familiar with those libraries, then google for the rest.** -->\n\nBefore we delve into the grammar of graphics, let's motivate the philosophy using a simple task. Suppose we want to create a pie chart using some data. Pie charts are terrible, and we've known it for 100 years[@croxtonBarChartsCircle1927a], so in the interests of showing that we know that pie charts are awful, we'll also create a stacked bar chart, which is the most commonly promoted alternative to a pie chart. We'll talk about what makes pie charts terrible at the end of this module in [Creating Good charts](@sec-creating-good-charts).\n\n::: {.callout-caution}\n### Example: Generations of Pokemon\n\n::: column-margin\n![](https://upload.wikimedia.org/wikipedia/commons/thumb/9/98/International_Pok%C3%A9mon_logo.svg/1280px-International_Pok%C3%A9mon_logo.svg.png){fig-alt=\"Pokemon logo\"}\n:::\n\nSuppose we want to explore Pokemon. There's not just the original 150 (gotta catch 'em all!) - now there are over 1000! \nLet's start out by looking at the proportion of Pokemon added in each of the 8 generations.\n\n::: panel-tabset\n\n#### R setup {-}\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(stringr)\n\n# Setup the data\npoke <- read_csv(\"data/pokemon_ascii.csv\", na = '.') %>%\n  mutate(generation = factor(generation))\n```\n:::\n\n\n#### Python setup {-}\n\n::: {.cell}\n\n```{.python .cell-code}\nimport pandas as pd\npoke = pd.read_csv(\"data/pokemon_ascii.csv\")\npoke['generation'] = pd.Categorical(poke.generation)\n```\n:::\n\n:::\n\nOnce the data is read in, we can start plotting:\n\n::: panel-tabset\n\n#### ggplot2 {-}\nIn ggplot2, we start by specifying which variables we want to be mapped to which features of the data. \n\nIn a pie or stacked bar chart, we don't care about the x coordinate - the whole chart is centered at (0,0) or is contained in a single \"stack\". So it's easiest to specify our x variable as a constant, \"\". We care about the fill of the slices, though - we want each generation to have a different fill color, so we specify generation as our fill variable. \n\nThen, we want to summarize our data by the number of objects in each category - this is basically a stacked bar chart. Any variables specified in the plot statement are used to implicitly calculate the statistical summary we want -- that is, to count the rows (so if we had multiple x variables, the summary would be computed for both the x and fill variables). ggplot is smart enough to know that when we use `geom_bar`, we generally want the y variable to be the count, so we can get away with leaving that part out. We just have to specify that we want the bars to be stacked on top of one another (instead of next to each other, \"dodge\").\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot(aes(x = \"\", fill = generation), data = poke) + \n  geom_bar(position = \"stack\") \n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/gg-bar-1.png){width=2100}\n:::\n:::\n\n\nIf we want a pie chart, we can get one very easily - we transform the coordinate plane from Cartesian coordinates to polar coordinates. We specify that we want angle to correspond to the \"y\" coordinate, and that we want to start at $\\theta = 0$. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(aes(x = \"\", fill = generation), data = poke) + \n  geom_bar(position = \"stack\") + \n  coord_polar(\"y\", start = 0)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/gg-pie-1.png){width=2100}\n:::\n:::\n\n\nNotice how the syntax and arguments to the functions didn't change much between the bar chart and the pie chart? That's because the `ggplot` package uses what's called the **grammar of graphics**, which is a way to describe plots based on the underlying mathematical relationships between data and plotted objects. In base R and in matplotlib in Python, different types of plots will have different syntax, arguments, etc., but in ggplot2, the arguments are consistently named, and for plots which require similar transformations and summary observations, it's very easy to switch between plot types by changing one word or adding one transformation.\n\n#### Base R {-}\n\nLet's start with what we want: for each generation, we want the total number of pokemon. \n\nTo get a pie chart, we want that information mapped to a circle, with each generation represented by an angle whose size is proportional to the number of pokemon in that generation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create summary of pokemon by type\ntmp <- poke %>%\n  group_by(generation) %>%\n  count() \n\npie(tmp$n, labels = tmp$generation)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/base-pie-1.png){width=2100}\n:::\n:::\n\n\nWe could alternately make a bar chart and stack the bars on top of each other. This also shows proportion (section vs. total) but does so in a linear fashion.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create summary of pokemon by type\ntmp <- poke %>%\n  group_by(generation) %>%\n  count() \n\n# Matrix is necessary for a stacked bar chart\nmatrix(tmp$n, nrow = 8, ncol = 1, dimnames = list(tmp$generation)) %>%\nbarplot(beside = F, legend.text = T, main = \"Generations of Pokemon\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/base-barplot-1.png){width=2100}\n:::\n:::\n\n\nThere's not a huge amount of similarity between the code for a pie chart and a bar plot, even though the underlying statistics required to create the two charts are very similar. The appearance of the two charts is also very different.\n\n\n#### Matplotlib {-}\n\nLet's start with what we want: for each generation, we want the total number of pokemon. \n\nTo get a pie chart, we want that information mapped to a circle, with each generation represented by an angle whose size is proportional to the number of Pokemon in that generation.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport matplotlib.pyplot as plt\nplt.cla() # clear out matplotlib buffer\n\n# Create summary of pokemon by type\nlabels = list(set(poke.generation)) # create labels by getting unique values\nsizes = poke.generation.value_counts(normalize=True)*100\n\n# Draw the plot\nfig1, ax1 = plt.subplots()\nax1.pie(sizes, labels = labels, autopct='%1.1f%%', startangle = 90)\n## ([<matplotlib.patches.Wedge object at 0x7f319b8b9ac0>, <matplotlib.patches.Wedge object at 0x7f319b8acb50>, <matplotlib.patches.Wedge object at 0x7f319b8ce820>, <matplotlib.patches.Wedge object at 0x7f319b8cef40>, <matplotlib.patches.Wedge object at 0x7f319b85c6a0>, <matplotlib.patches.Wedge object at 0x7f319b85cdc0>, <matplotlib.patches.Wedge object at 0x7f319b869520>, <matplotlib.patches.Wedge object at 0x7f319b869c40>], [Text(-0.6090293244431805, 0.916014891783034, '1'), Text(-1.091376662290067, -0.1374662904445805, '2'), Text(-0.447205636991834, -1.004991103563971, '3'), Text(0.4837518599092984, -0.9879190948829235, '4'), Text(1.004991103563971, -0.44720563699183413, '5'), Text(1.0756351166663767, 0.23023704261936323, '6'), Text(0.780190906881347, 0.7754367471429643, '7'), Text(0.2825357301945357, 1.06309621444319, '8')], [Text(-0.33219781333264387, 0.4996444864271094, '18.7%'), Text(-0.5952963612491273, -0.07498161296977117, '16.6%'), Text(-0.24393034745009126, -0.5481769655803478, '16.1%'), Text(0.2638646508596173, -0.538864960845231, '11.8%'), Text(0.5481769655803477, -0.2439303474500913, '10.4%'), Text(0.5867100636362054, 0.12558384142874357, '9.6%'), Text(0.42555867648073464, 0.42296549844161685, '8.6%'), Text(0.15411039828792855, 0.5798706624235581, '8.3%')])\nax1.axis('equal')\n## (-1.1150076843840162, 1.1060059449729593, -1.1113209244032165, 1.1005390916382485)\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/plt-pie-1.png){width=672}\n:::\n:::\n\n\n\nWe could alternately make a bar chart and stack the bars on top of each other. This also shows proportion (section vs. total) but does so in a linear fashion.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport matplotlib.pyplot as plt\nplt.cla() # clear out matplotlib buffer\n\n# Create summary of pokemon by type\nlabels = list(set(poke.generation)) # create labels by getting unique values\nsizes = poke.generation.value_counts()\nsizes = sizes.sort_index()\n\n# Find location of bottom of the bar for each bar\ncumulative_sizes = sizes.cumsum() - sizes\nwidth = 1\n\nfig, ax = plt.subplots()\n\nfor i in sizes.index:\n  ax.bar(\"Generation\", sizes[i], width, label=i, bottom = cumulative_sizes[i])\n## <BarContainer object of 1 artists>\n## <BarContainer object of 1 artists>\n## <BarContainer object of 1 artists>\n## <BarContainer object of 1 artists>\n## <BarContainer object of 1 artists>\n## <BarContainer object of 1 artists>\n## <BarContainer object of 1 artists>\n## <BarContainer object of 1 artists>\nax.set_ylabel('# Pokemon')\nax.set_title('Pokemon Distribution by Generation')\nax.legend()\n\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/plt-bar-3.png){width=672}\n:::\n:::\n\n\n#### Plotnine {-}\n\nAs of September 2022, pie charts are [still not supported in plotnine](https://github.com/has2k1/plotnine/issues/10). So this demo will fall a bit flat. \n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\nplt.cla() # clear out matplotlib buffer\n\nggplot(aes(x = \"1\", fill = \"generation\"), data = poke) + geom_bar(position = \"stack\")\n## <ggplot: (8740604260602)>\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/gg-bar-py-5.png){width=614}\n:::\n:::\n\n\n<!-- #### Seaborn {-} -->\n\n<!-- As with Plotnine, seaborn does not support pie charts due to the same underlying issue. The best option is to create a pie chart in matplotlib and use seaborn colors [@zachHowCreatePie2021].  -->\n\n<!-- ```{python seaborn-poke-pie} -->\n<!-- # Load the seaborn package -->\n<!-- # the alias \"sns\" stands for Samuel Norman Seaborn  -->\n<!-- # from \"The West Wing\" television show -->\n<!-- import seaborn as sns -->\n<!-- import matplotlib.pyplot as plt -->\n\n<!-- # Initialize seaborn styling; context -->\n<!-- sns.set_style('white') -->\n<!-- sns.set_context('notebook') -->\n\n<!-- plt.cla() # clear out matplotlib buffer -->\n\n<!-- # Create summary of pokemon by type -->\n<!-- labels = list(set(poke.generation)) # create labels by getting unique values -->\n<!-- sizes = poke.generation.value_counts(normalize=True)*100 -->\n\n<!-- #define Seaborn color palette to use -->\n<!-- colors = sns.color_palette('pastel')[0:5] -->\n\n<!-- # Draw the plot -->\n<!-- fig1, ax1 = plt.subplots() -->\n<!-- ax1.pie(sizes, labels = labels, colors = colors, autopct='%1.1f%%', startangle = 90) -->\n<!-- ax1.axis('equal') -->\n<!-- plt.show() -->\n<!-- ``` -->\n\n<!-- Seaborn doesn't have the `autopct` option that matplotlib uses, so we have to aggregate the data ourselves before creating a barchart. -->\n\n<!-- ```{python seaborn-poke-pie} -->\n<!-- poke['generation'] = pd.Categorical(poke['generation']) -->\n\n<!-- plt.cla() # clear out matplotlib buffer -->\n<!-- sns.countplot(data = poke, y = 'status') -->\n<!-- plt.show() -->\n<!-- ``` -->\n:::\n\n:::\n\nWe'll talk first about the general idea behind the grammar of graphics. For each concept, I'll provide you first with the ggplot grammar of graphics code, and then, where it is possible to replicate the chart easily in base R or Python graphics, I will provide code for that as well - so that you can compare the approaches, but also so that you get a sense for what is easy and what is possible in each plotting system. \n\n\n\n## The Grammar of Graphics\n\nIn the grammar of graphics, a plot consists of several mostly independent specifications:\n\n1. **aesthetics** - links between data variables and graphical features (position, color, shape, size)\n2. **layers** - geometric elements (points, lines, rectangles, text, ...) \n3. **transformations** - transformations specify a functional link between the data and the displayed information (identity, count, bins, density, regression). Transformations act on the variables. \n4. **scales** - scales map values in data space to values in the aesthetic space. Scales change the coordinate space of an aesthetic, but don't change the underlying value (so the change is at the visual level, not the mathematical level). \n5. **coordinate system** - e.g. polar or Cartesian\n6. **faceting** - facets allow you to split plots by other variables to produce many sub-plots.\n7. **theme** - formatting items, such as background color, fonts, margins...\n\nWe can contrast this with other plotting systems (e.g. Base R, matplotlib, seaborn), where transformations and scales must be handled manually (or are handled differently in each type of plot), there may be separate plotting systems for different coordinate systems, etc. \n\n::: callout-note\nWorking with a full data frame can sometimes be a pain, because you may end up with labels that are repeated many, many times. As with any system, you should ensure you're formatting your data in a way that is consistent and compatible with the underlying philosophy.\n:::\n\nFunctionally, the biggest difference between the two systems is that in the grammar of graphics system (as implemented in ggplot2), we work with a full tabular data set. As with the rest of the tidyverse, ggplot2 will allow you to reference bare column names as if they were variables, so long as you've passed in the data set to the `data =` argument.\n\n::: column-margin\n![Building a masterpiece, by Allison Horst](https://raw.githubusercontent.com/allisonhorst/stats-illustrations/main/rstats-artwork/ggplot2_masterpiece.png){fig-alt=\"A fuzzy monster in a beret and scarf, critiquing their own column graph on a canvas in front of them while other assistant monsters (also in berets) carry over boxes full of elements that can be used to customize a graph (like themes and geometric shapes). In the background is a wall with framed data visualizations. Stylized text reads “ggplot2: build a data masterpiece.”\"}\n:::\n\n::: panel-tabset\nWe'll use the [`palmerpenguins` package](https://allisonhorst.github.io/palmerpenguins/) in R to do this visualization demo [@palmerpenguins]. Palmerpenguins also exists as a python package which is installable using pip.\n\n### R data setup\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!\"palmerpenguins\" %in% installed.packages())\n  install.packages(\"palmerpenguins\")\ndata(penguins, package = \"palmerpenguins\")\nhead(penguins)\n## # A tibble: 6 × 8\n##   species island    bill_length_mm bill_depth_mm flipper_l…¹ body_…² sex    year\n##   <fct>   <fct>              <dbl>         <dbl>       <int>   <int> <fct> <int>\n## 1 Adelie  Torgersen           39.1          18.7         181    3750 male   2007\n## 2 Adelie  Torgersen           39.5          17.4         186    3800 fema…  2007\n## 3 Adelie  Torgersen           40.3          18           195    3250 fema…  2007\n## 4 Adelie  Torgersen           NA            NA            NA      NA <NA>   2007\n## 5 Adelie  Torgersen           36.7          19.3         193    3450 fema…  2007\n## 6 Adelie  Torgersen           39.3          20.6         190    3650 male   2007\n## # … with abbreviated variable names ¹​flipper_length_mm, ²​body_mass_g\n```\n:::\n\n\n### Python data setup\nRemember to run `pip3 install palmerpenguins` if you haven't already.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom palmerpenguins import load_penguins\npenguins = load_penguins()\npenguins.head\n## <bound method NDFrame.head of        species     island  bill_length_mm  ...  body_mass_g     sex  year\n## 0       Adelie  Torgersen            39.1  ...       3750.0    male  2007\n## 1       Adelie  Torgersen            39.5  ...       3800.0  female  2007\n## 2       Adelie  Torgersen            40.3  ...       3250.0  female  2007\n## 3       Adelie  Torgersen             NaN  ...          NaN     NaN  2007\n## 4       Adelie  Torgersen            36.7  ...       3450.0  female  2007\n## ..         ...        ...             ...  ...          ...     ...   ...\n## 339  Chinstrap      Dream            55.8  ...       4000.0    male  2009\n## 340  Chinstrap      Dream            43.5  ...       3400.0  female  2009\n## 341  Chinstrap      Dream            49.6  ...       3775.0    male  2009\n## 342  Chinstrap      Dream            50.8  ...       4100.0    male  2009\n## 343  Chinstrap      Dream            50.2  ...       3775.0  female  2009\n## \n## [344 rows x 8 columns]>\n```\n:::\n\n:::\n\n\n### Basic Plot Components - Axes and Points\n\nLet's start out with a basic scatterplot: we want to use x and y locations to show two variables, and we want to use points to indicate the space where the x location and y location meet in the Cartesian plane.\n\n::: panel-tabset\n\n#### ggplot2\n\nLet's start out with a basic scatterplot: we want to use x and y locations to show two variables, and we want to use points to indicate the space where the x location and y location meet in the Cartesian plane. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n# This defines a blank coordinate plane\nggplot(data = penguins) + \n  aes(x = bill_length_mm, y = body_mass_g)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-basic-gg-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n\n# This plot actually has points!\nggplot(data = penguins) + \n  aes(x = bill_length_mm, y = body_mass_g) + \n  geom_point() # add points\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-basic-gg-2.png){width=2100}\n:::\n:::\n\n\nThe `aes()` statement can also go inside of the `ggplot()` statement or inside of `geom_point(aes(...))`. It's useful to show it outside of the `ggplot()` statement to show you exactly how the plot is built up, but most people write the code as `ggplot(aes(x = ..., y = ...), data = ...) + geom_point()` by convention.\n\n#### plotnine\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\n# Define a blank coordinate plane\nggplot(data = penguins) + aes(x = \"bill_length_mm\", y = \"body_mass_g\")\n\n# Add a points layer\n## <ggplot: (8740604009975)>\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-basic-gg-py-1.png){width=614}\n:::\n\n```{.python .cell-code}\nggplot(data = penguins) + aes(x = \"bill_length_mm\", y = \"body_mass_g\") + geom_point()\n## <ggplot: (8740604001765)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/layer.py:401: PlotnineWarning: geom_point : Removed 2 rows containing missing values.\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-basic-gg-py-2.png){width=614}\n:::\n:::\n\n\n#### Base R\n\nIn base R, we have to use `df$var` notation to reference the variables. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x = penguins$bill_length_mm, y = penguins$body_mass_g)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-basic-baser-5.png){width=2100}\n:::\n\n```{.r .cell-code}\n\n# We can also use formula notation, which allows a data = ... argument\nplot(body_mass_g ~ bill_length_mm, data = penguins)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-basic-baser-6.png){width=2100}\n:::\n:::\n\n\n#### Matplotlib\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport numpy as np\nimport matplotlib.pyplot as plt\nplt.cla() # clear out matplotlib buffer\n\nplt.scatter(penguins.bill_length_mm, penguins.body_mass_g)\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-basic-plt-1.png){width=614}\n:::\n:::\n\n\n:::\n\n\n### Adding Labels and Titles\n\n\n::: panel-tabset\n\n#### ggplot2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n# This defines a blank coordinate plane\nggplot(data = penguins, aes(x = bill_length_mm, y = body_mass_g)) + \n  # add points\n  geom_point() + \n  ggtitle(\"Penguin Bill Length and Body Mass\") + \n  xlab(\"Bill Length (mm)\") + \n  ylab(\"Body Mass (g)\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-label-gg-3.png){width=2100}\n:::\n:::\n\n\nYou can even add labels that have math symbols if you are careful about how you do it (or if you use the [`latex2exp` package](https://www.stefanom.io/latex2exp/) [@latex2exp]).\n\n#### plotnine\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\n\n(ggplot(aes(x = \"bill_length_mm\", y = \"body_mass_g\"), data = penguins) + \n  geom_point() + \n  ggtitle(\"Penguin Bill Length and Body Mass\") + \n  xlab(\"Bill Length (mm)\") + \n  ylab(\"Body Mass (g)\")\n)\n## <ggplot: (8740604019929)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/layer.py:401: PlotnineWarning: geom_point : Removed 2 rows containing missing values.\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-label-gg-py-1.png){width=614}\n:::\n:::\n\n\n#### Base R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x = penguins$bill_length_mm, y = penguins$body_mass_g,\n     main = \"Penguin Bill Length and Body Mass\",\n     xlab = \"Bill Length (mm)\", ylab = \"Body Mass (g)\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-label-baser-3.png){width=2100}\n:::\n:::\n\n\n#### Matplotlib\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nplt.title(\"Penguin Bill Length and Body Mass\")\nplt.scatter(penguins.bill_length_mm, penguins.body_mass_g)\nplt.xlabel(\"Bill Length (mm)\")\nplt.ylabel(\"Body Mass (g)\")\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-label-plt-1.png){width=614}\n:::\n:::\n\n\n:::\n\n### Mapping vs. Constant Aesthetics\n\nWhen considering other aesthetics, such as the color or size of plotted objects, the shape of points, line types, and alpha blending, it is important to differentiate between mapping these quantities to **dataset variables** and setting **constant values**. \n\nMapping quantities to a variable in the dataset requires considerably more work under the hood, as we have to set up a scale from the original values that maps to the aesthetic values, we have to generate the corresponding aesthetic values for each data point, and we usually want to create a legend. \n\nWhen we set constant values, as in @sec-gog-constant-values, we just... set the value and we're done. Constant values are usually set to adhere to style guides, to enhance visual appeal, and sometimes to \"backwards-engineer\" a scale (but this is only necessary in limited circumstances).\n\n### Mapping Categorical Variables\n\n::: column-margin\nFor those of you used to British spellings, in ggplot2, all variations on both `colour` and `color` work for any parameter.\n:::\n\nIf the goal is to map an aesthetic to a variable in the dataset, then we need to ensure that each geometric object has an appropriately computed mapping (and each object is plotted with that mapping). This is more computationally complex than just setting a constant value for all objects plotted.\n\nIn grammar of graphics terminology, this is an **aesthetic mapping**, and in `ggplot2` and `plotnine`, aesthetic mappings go inside `aes()` statements. \n\nHere, I'll demonstrate mapping variables to color, shape, and size aesthetics, but the process is similar for other aesthetics, such as linetype, fill, etc.\n\n\n::: column-margin\nNote that `color` is the outside border of a shape, `fill` is the inside. So if you're working on a bar plot, you probably want to map things to fill instead of color. If you're working on a scatterplot, color is probably what you want instead of fill.\n:::\n\n::: panel-tabset\n\n#### ggplot2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n# This defines a blank coordinate plane\nggplot(data = penguins, aes(x = bill_length_mm, y = body_mass_g)) + \n  # add points\n  geom_point(aes(shape = species, color = species)) + \n  ggtitle(\"Penguin Bill Length and Body Mass\") + \n  xlab(\"Bill Length (mm)\") + \n  ylab(\"Body Mass (g)\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-mapping-gg-3.png){width=2100}\n:::\n:::\n\n\nNotice that we haven't had to specify any sort of categorical mapping here - ggplot picks the shapes and colors we're using based on the number of categories we have. If we want to customize these default mappings, we can use `scale_color_discrete`, `scale_color_manual`, `scale_shape_discrete`, and so on. Only if we want to override the default mapping do we have to specify that we're working with a discrete variable.\n\n#### plotnine\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\n\n(ggplot(aes(x = \"bill_length_mm\", y = \"body_mass_g\"), data = penguins) + \n  geom_point(aes(shape = \"species\", color = \"species\")) + \n  ggtitle(\"Penguin Bill Length and Body Mass\") + \n  xlab(\"Bill Length (mm)\") + \n  ylab(\"Body Mass (g)\")\n)\n## <ggplot: (8740649343955)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/layer.py:401: PlotnineWarning: geom_point : Removed 2 rows containing missing values.\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-mapping-gg-py-1.png){width=614}\n:::\n:::\n\n\n#### Base R\n\nI've used code from Jenny Bryan's Stat 545 at UBC website [@bryanPuttingColorsWork] and modified it, since I'm not an expert in base graphics. Regardless, the whole thing feels very clunky to me relative to the grammar-of-graphics approach in ggplot2/plotnine.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(RColorBrewer)\n# Create color and point mapping between data and plotted values\naes_mapping <- data.frame(\n  species = unique(penguins$species), \n  color = brewer.pal(nlevels(penguins$species), name = 'Dark2'),\n  shape = 1:3)\n\nplot(x = penguins$bill_length_mm, y = penguins$body_mass_g,\n     col = aes_mapping$color[match(penguins$species, aes_mapping$species)],\n     pch = aes_mapping$shape[match(penguins$species, aes_mapping$species)],\n     main = \"Penguin Bill Length and Body Mass\",\n     xlab = \"Bill Length (mm)\", ylab = \"Body Mass (g)\")\n# Manually create legend\nlegend(x = 'bottomright', \n       legend = as.character(aes_mapping$species),\n       col = aes_mapping$color, pch = aes_mapping$shape, bty = 'n', xjust = 1)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-mapping-baser-3.png){width=2100}\n:::\n:::\n\n\n#### Matplotlib\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport numpy as np\nimport matplotlib.pyplot as plt\nplt.cla() # clear out matplotlib buffer\n\npenguins['species'] = pd.Categorical(penguins.species)\n\n# Create categorical mapping to marker type\nmarker_types = {'Adelie':'o', 'Chinstrap':'*', 'Gentoo':'+'}\nmarker_color = {'Adelie':'orange', 'Chinstrap':'green', 'Gentoo':'purple'}\n\ngroups = penguins.groupby('species')\nfor name, group in groups:\n  plt.plot(group.bill_length_mm, group.body_mass_g, marker = marker_types[name], color = marker_color[name], linestyle = '', label = name)\n\nplt.xlabel(\"Bill Length (mm)\")\nplt.ylabel(\"Body Mass (g)\")\nplt.legend()\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-mapping-plt-1.png){width=614}\n:::\n:::\n\n\nPython's dict type helps a lot here: we can create the mapping between species and shape/color a bit more naturally. But it's still a lot of details to think about and customize, where ggplot2 tries very hard to give you sensible default color/shape mappings that you don't have to customize unless the defaults aren't what you want.\n\n:::\n\n### Mapping Continuous Variables\n\nAbove, we demonstrated mapping to categorical variables, where we had to select an appropriate color for each unique value in the variable. With continuous mappings, however, we have to instead specify a range of output values (e.g. color, size) and map those values to the values in the dataset. This is understandably more complicated: \n\n- We need some sort of one-to-one function from our variable's values to our color space, but it doesn't have to be linear (and in many cases, we may want to use a transformation).\n- We need a way to interpolate between a vector of color values to get a continuous color space. Color spaces are [complicated](https://en.wikipedia.org/wiki/Color_space) [@wiki-color-space].\n\n\n::: panel-tabset\n\n#### ggplot2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n# This defines a blank coordinate plane\nggplot(data = penguins, aes(x = bill_length_mm, y = body_mass_g)) + \n  # add points\n  geom_point(aes(color = bill_depth_mm)) + \n  ggtitle(\"Penguin Bill Length and Body Mass\") + \n  xlab(\"Bill Length (mm)\") + \n  ylab(\"Body Mass (g)\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-mapping2-gg-3.png){width=2100}\n:::\n:::\n\n\n\n#### plotnine\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\n\n(ggplot(aes(x = \"bill_length_mm\", y = \"body_mass_g\"), data = penguins) + \n  geom_point(aes(color = \"bill_depth_mm\")) + \n  ggtitle(\"Penguin Bill Length and Body Mass\") + \n  xlab(\"Bill Length (mm)\") + \n  ylab(\"Body Mass (g)\")\n)\n## <ggplot: (8740598287592)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/layer.py:401: PlotnineWarning: geom_point : Removed 2 rows containing missing values.\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-mapping2-gg-py-1.png){width=614}\n:::\n:::\n\n\n#### Base R\n\nI found one solution at [StackOverflow](https://stackoverflow.com/questions/18827214/one-colour-gradient-according-to-value-in-column-scatterplot-in-r), but gave up getting it to work in the interests of finishing the rest of this chapter. \n<!-- XXX TODO XXX -->\n\n\n\n\n\n#### Matplotlib\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport numpy as np\nimport matplotlib.pyplot as plt\nplt.cla() # clear out matplotlib buffer\n\nfig, ax = plt.subplots()\n\nscatter = ax.scatter(penguins.bill_length_mm, penguins.body_mass_g, c = penguins.bill_depth_mm, cmap = 'Greens')\n\n# Produce a legend for the ranking (colors).\nlegend1 = ax.legend(*scatter.legend_elements(num=8),\n                    loc=\"upper left\", title=\"Bill Depth\")\nax.add_artist(legend1)\n\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/aes-mapping2-plt-1.png){width=672}\n:::\n:::\n\n:::\n\n::: callout-tip\n#### Try it out\n\n::: panel-tabset\n\n##### Problem\n\nUse the Pokemon data to see if there is a relationship between a Pokemon's attack and special attack points (`attack` and `sp_attack`, respectively). Can you map a Pokemon's weight in kg to the point opacity (`alpha`) so that light Pokemon show up as semi-transparent?\n\n##### R solution\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\npoke <- read_csv(\"data/pokemon_ascii.csv\", na = '.') \nggplot(data = poke, aes(x = attack, y = sp_attack, alpha = weight_kg)) + geom_point()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/poke-tryitout-r-3.png){width=2100}\n:::\n:::\n\n\n##### Python solution\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\n\npoke = pd.read_csv(\"data/pokemon_ascii.csv\")\npoke['weight_kg'] = pd.to_numeric(poke.weight_kg, errors='coerce')\n\n# Get rid of NA points - they mess up the scales\npoke_sub = poke.dropna(axis = 0, subset=['weight_kg', 'attack', 'sp_attack'])\nggplot(data = poke_sub) + geom_point(aes(x = \"attack\", y = \"sp_attack\", alpha = \"weight_kg\"))\n## <ggplot: (8740649276058)>\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/poke-tryitout-py-1.png){width=614}\n:::\n:::\n\n:::\n:::\n\n### Customizing Appearance with Constant Values {#sec-gog-constant-values}\n\nHere I'm focusing on characteristics like color and alpha value, but you can customize all sorts of different parameters, depending on the plot type - line size and type, point size, and more.\n\nThese constant values are called **attributes** and they are different from aesthetics because aesthetics are mapped to variables (and thus are not constant).\n\n::: panel-tabset\n\n#### ggplot2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = bill_length_mm, y = body_mass_g)) +\n  geom_point(color = \"blue\", alpha = .5, size = 4, shape = 6)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/gg-adjust-aes-const-3.png){width=2100}\n:::\n:::\n\n\n#### plotnine\n\n\n::: {.cell}\n\n```{.python .cell-code}\n(\n  ggplot(penguins, aes(x = \"bill_length_mm\", y = \"body_mass_g\")) +\n  geom_point(color = \"blue\", alpha = .5, size = 4, shape = 6)\n)\n## <ggplot: (8740649236538)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/layer.py:401: PlotnineWarning: geom_point : Removed 2 rows containing missing values.\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/geoms/geom_point.py:61: UserWarning: You passed a edgecolor/edgecolors (['#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80', '#0000ff80']) for an unfilled marker (6).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/gg-adjust-aes-const-py-1.png){width=614}\n:::\n:::\n\n\n#### Base R\nBase R doesn't support alpha blending by default, so we have to load the `scales` package in order to get that functionality.\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(scales)\n# Using constant alpha:\nplot(body_mass_g ~ bill_length_mm, \n     col = alpha(\"blue\", .5),\n     pch = 6,\n     cex = 3,\n     data = penguins) \n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/base-adj-aes-const-3.png){width=2100}\n:::\n:::\n\n\n#### Matplotlib\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport numpy as np\nimport matplotlib.pyplot as plt\nplt.cla() # clear out matplotlib buffer\n\nplt.scatter(penguins.bill_length_mm, penguins.body_mass_g, c = 'blue', marker = '^', alpha = .5, s = 200)\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/plt-adj-aes-const-1.png){width=614}\n:::\n:::\n\n\n:::\n\n\n::: callout-tip\n### Try it out: Debugging plots\n\n::: panel-tabset\n\n#### Problem\n\nCan you fix the following plot so that it has blue points? \n\nWhat mistake was made, and why did the plot end up having pink points?\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\nggplot(aes(x = bill_length_mm, y = body_mass_g, color = \"blue\")) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/debugging-plots-3.png){width=2100}\n:::\n:::\n\n\n#### Solution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = penguins, aes(x = bill_length_mm, y = body_mass_g)) + geom_point(color = \"blue\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/debugging-plots-solution-1.png){width=2100}\n:::\n:::\n\n\nIn the original code, `color = \"blue\"` was inside the AES statement, which set the color aesthetic to a string \"blue\". ggplot2 maps this string to a default value (the reddish-pink color). If we move the `color = \"blue\"` statement into `geom_point()`, then this specifies that we want all points to be a constant blue color, instead of mapping color to a variable that has constant value \"blue\" (which isn't interpreted by ggplot2 to indicate a color).\n\n:::\n:::\n\n### Layers\n\n\nOne of the main advantages of ggplot2 is that the syntax is basically consistent across very different types of plots. In base R and matpotlib, this is not the case - you have to look up the available options for each different plot type. In ggplot2, I might have to look up what the aesthetic names are for a specific geom, but I can guess most of the time. So let's look a bit more into what ggplot2's approach to graph specification is and what it allows us to do.\n\nYou're fairly used to the syntax of the pipe by now; but ggplot works on a slightly different (but similar) concept that we've used implicitly up until this point. There is the initial plot statement, `ggplot()`, and successive layers are added using `+`. \n\nYou can specify a data set and aesthetic variables in the `ggplot()` statement (which is what we'll usually do), but you can also have a completely blank `ggplot()` statement and specify your aesthetic mappings and data sets for each layer separately. This approach is more useful when you start creating complex plots, because you may need to plot summary information and raw data, or e.g. separate tables with city information, geographic boundaries, and rivers, all of which need to be represented in the same map. Technically, you can even specify the `aes()` statement outside of the `ggplot()` statement or a `geom_...()` layer call... but this is not typically done because auto complete then doesn't work.\n\nIn this extended example, we'll examine the different features we need to make a map and how to add new layers to a map. We'll also look at some new geoms: `geom_polygon` and `geom_path`.\n\n#### Data Setup\n\nLet's use some data from the state of Nebraska to generate a state map with important geographic features: state parks, railroads, and counties.\n\n- [State parks](https://www.nebraskamap.gov/datasets/outdoornebraska::state-park-areas-1/explore?location=41.485819%2C-99.571578%2C7.17)  (I downloaded the GeoJSON file)\n- [Railroads](https://www.nebraskamap.gov/datasets/railroads/explore?location=41.929514%2C-102.243474%2C6.05) (I downloaded the GeoJSON file)\n- [County boundaries](https://www.nebraskamap.gov/datasets/county-boundaries/explore?location=41.369872%2C-99.634627%2C6.00)\n\n::: panel-tabset\n##### R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(!\"sf\" %in% installed.packages()) install.packages(\"sf\")\nlibrary(sf)\nlibrary(ggplot2)\n\nne <- map_data(\"state\", \"nebraska\") # state outline, built into R\nne_parks <- read_sf(\"data/State_Park_Areas.geojson\")\nne_railroads <- read_sf(\"data/Railroads.geojson\")\nne_counties <- read_sf(\"data/County_Boundaries.geojson\")\n```\n:::\n\n\n##### Python\n\n::: {.cell}\n\n```{.python .cell-code}\n# This installs the package in the current python environment\n# %pip install geopandas\n# (uncomment the line above to use)\nimport geopandas as gp\n\nne = r.ne # state outline (steal from R)\nne_parks = gp.read_file(\"data/State_Park_Areas.geojson\")\nne_railroads = gp.read_file(\"data/Railroads.geojson\")\nne_counties = gp.read_file(\"data/County_Boundaries.geojson\")\n```\n:::\n\n\n:::\n\n#### Data Exploration\n\nWe're working with GIS data (geographical information systems), which has a different format than most of the data we've worked with thus far. Geographic data tends to be nested, so that e.g. a railroad segment will contain a set of lat/long coordinates that define the segment, but there may be many different segments in a continuous track. \n\nLet's see how each of these data types are represented by doing a bit of EDA. \n\nFirst, let's look at the `ne` object, which contains the coordinates for the border of the state.\n\n::: panel-tabset\n\n##### R\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(ne)\n##        long      lat group order   region subregion\n## 1 -104.0606 43.00621     1     1 nebraska      <NA>\n## 2 -103.5106 42.99475     1     2 nebraska      <NA>\n## 3 -103.0063 42.99475     1     3 nebraska      <NA>\n## 4 -102.7944 42.99475     1     4 nebraska      <NA>\n## 5 -102.0782 42.99475     1     5 nebraska      <NA>\n## 6 -101.2302 42.99475     1     6 nebraska      <NA>\n```\n:::\n\n\n##### Python\n\n::: {.cell}\n\n```{.python .cell-code}\nne.describe\n## <bound method NDFrame.describe of            long        lat  group  order    region subregion\n## 0   -104.060593  43.006210    1.0      1  nebraska        NA\n## 1   -103.510551  42.994755    1.0      2  nebraska        NA\n## 2   -103.006348  42.994755    1.0      3  nebraska        NA\n## 3   -102.794357  42.994755    1.0      4  nebraska        NA\n## 4   -102.078163  42.994755    1.0      5  nebraska        NA\n## ..          ...        ...    ...    ...       ...       ...\n## 203 -104.060593  41.562355    1.0    204  nebraska        NA\n## 204 -104.060593  41.699867    1.0    205  nebraska        NA\n## 205 -104.054863  41.997807    1.0    206  nebraska        NA\n## 206 -104.060593  42.610874    1.0    207  nebraska        NA\n## 207 -104.060593  43.006210    1.0    208  nebraska        NA\n## \n## [208 rows x 6 columns]>\n```\n:::\n\n:::\n\nWe have a series of latitude and longitude values, with a group variable and an order. That is, `group` defines which piece of the state we're working with (this is especially important in the case of states with disjoint regions, such as Michigan or Hawaii), and `order` defines the order in which the points are to be connected. This is important - it matters which order we connect the points.\n\nThe `ne` object is a bit lower-level than the objects containing the spatial information about parks, railroads, and counties. We've used the `sf` and `geopandas` packages, which store all of the data from the geojson file in a table-like structure, but under the hood, these objects are a bit more complicated. We're going to completely ignore these complexities for the moment.\n\n::: {.panel-tabset}\n##### R\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(ne_parks)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 6 features and 22 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -102.1317 ymin: 40.23034 xmax: -95.87157 ymax: 42.42903\nGeodetic CRS:  WGS 84\n# A tibble: 6 × 23\n  OBJECTID AreaName   Acres Distr…¹ Latit…² Longi…³ Notes DB_GI…⁴ AreaT…⁵ Status\n     <int> <chr>      <dbl> <chr>     <dbl>   <dbl> <chr> <chr>   <chr>   <chr> \n1        1 Alexandri… 101   SE         40.2   -97.3 <NA>  1R      SRA     Active\n2        2 Arbor Lod…  73.8 SE         40.7   -95.9 <NA>  4H      SHP     Active\n3        3 Ash Hollo… 389   NW         41.3  -102.  Hunt… 8H      SHP     Active\n4        4 Ashfall S… 360   NE         42.4   -98.2 Mana… 279H    SHP     Active\n5        5 Blue Rive…  14   SE         40.7   -97.1 <NA>  25R     SRA     Active\n6        6 Bluestem … 441.  SE         40.6   -96.8 <NA>  27R     SRA     Active\n# … with 13 more variables: GISAcres <dbl>, County <chr>,\n#   OFWAtlasDisplay <chr>, Park_ID <chr>, NGPC_Manager_Code <chr>,\n#   Display2Public <chr>, MgtAgreementType <chr>, ManagedAs <chr>,\n#   HuntGuide <chr>, GlobalID <chr>, Shape__Area <dbl>, Shape__Length <dbl>,\n#   geometry <MULTIPOLYGON [°]>, and abbreviated variable names ¹​District,\n#   ²​Latitude, ³​Longitude, ⁴​DB_GISID, ⁵​AreaType\n```\n:::\n\n```{.r .cell-code}\nhead(ne_railroads)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 6 features and 7 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: -102.0517 ymin: 40.002 xmax: -96.97689 ymax: 40.66054\nGeodetic CRS:  WGS 84\n# A tibble: 6 × 8\n  OBJECTID   ID1 RR      RR_ID Oper_By Oper_…¹ Shape…²                  geometry\n     <int> <dbl> <chr>   <chr> <chr>   <chr>     <dbl>     <MULTILINESTRING [°]>\n1        1     1 Burlin… BNSF  \" \"     \" \"       0.881 ((-101.652 40.51432, -10…\n2        2     2 Burlin… BNSF  \" \"     \" \"       2.50  ((-102.0517 40.06478, -1…\n3        3     3 Burlin… BNSF  \" \"     \" \"       0.125 ((-98.43093 40.45798, -9…\n4        4     4 Burlin… BNSF  \" \"     \" \"       0.545 ((-98.4006 40.58327, -98…\n5        5     5 Burlin… BNSF  \" \"     \" \"       0.401 ((-98.42898 40.08312, -9…\n6        6     6 Burlin… BNSF  \" \"     \" \"       2.82  ((-96.97689 40.62462, -9…\n# … with abbreviated variable names ¹​Oper_By_ID, ²​Shape_Length\n```\n:::\n\n```{.r .cell-code}\nhead(ne_counties)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 6 features and 7 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -104.0535 ymin: 40.35027 xmax: -97.82985 ymax: 42.43772\nGeodetic CRS:  WGS 84\n# A tibble: 6 × 8\n  OBJECTID Cnty_Name Cnty_No CountyFIPS GlobalID                 Shape…¹ Shape…²\n     <int> <chr>       <int> <chr>      <chr>                      <dbl>   <dbl>\n1        1 Adams           1 001        {16352331-3262-4EBB-A78…    1.59   0.155\n2        2 Antelope        2 003        {FA9D8609-F002-4003-AF4…    1.98   0.242\n3        3 Arthur          3 005        {FF27D2CA-CA67-4D69-872…    1.85   0.201\n4        4 Banner          4 007        {85111E3B-7990-4C93-A22…    1.98   0.208\n5        5 Blaine          5 009        {AA433830-4A29-4E78-841…    1.85   0.201\n6        6 Boone           6 011        {7525569E-EDEB-4C3D-B8B…    1.80   0.193\n# … with 1 more variable: geometry <MULTIPOLYGON [°]>, and abbreviated variable\n#   names ¹​Shape_Length, ²​Shape_Area\n```\n:::\n:::\n\n\n##### Python\n\n::: {.cell}\n\n```{.python .cell-code}\nne_parks.describe\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<bound method NDFrame.describe of     OBJECTID  ...                                           geometry\n0          1  ...  POLYGON ((-97.32632 40.23043, -97.32647 40.230...\n1          2  ...  MULTIPOLYGON (((-95.87223 40.67319, -95.87230 ...\n2          3  ...  POLYGON ((-102.12684 41.30910, -102.12681 41.3...\n3          4  ...  POLYGON ((-98.16506 42.41817, -98.16504 42.418...\n4          5  ...  POLYGON ((-97.11678 40.70553, -97.11655 40.705...\n..       ...  ...                                                ...\n71        72  ...  MULTIPOLYGON (((-99.27091 41.86783, -99.27065 ...\n72        73  ...  POLYGON ((-103.06751 42.46677, -103.06744 42.4...\n73        74  ...  MULTIPOLYGON (((-101.07141 40.15372, -101.0714...\n74        75  ...  POLYGON ((-96.84584 40.75942, -96.84826 40.761...\n75        76  ...  MULTIPOLYGON (((-97.58016 42.82993, -97.58343 ...\n\n[76 rows x 23 columns]>\n```\n:::\n\n```{.python .cell-code}\nne_railroads.describe\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<bound method NDFrame.describe of     OBJECTID  ...                                           geometry\n0          1  ...  MULTILINESTRING ((-101.65200 40.51432, -101.64...\n1          2  ...  MULTILINESTRING ((-102.05175 40.06478, -102.04...\n2          3  ...  MULTILINESTRING ((-98.43093 40.45798, -98.4312...\n3          4  ...  MULTILINESTRING ((-98.40060 40.58327, -98.4017...\n4          5  ...  MULTILINESTRING ((-98.42898 40.08312, -98.4264...\n..       ...  ...                                                ...\n73        74  ...  MULTILINESTRING ((-97.58089 40.63769, -97.5803...\n74        75  ...  MULTILINESTRING ((-97.60241 40.63639, -97.6029...\n75        76  ...  MULTILINESTRING ((-95.92598 41.27184, -95.9258...\n76        77  ...  MULTILINESTRING ((-95.89146 41.27833, -95.8921...\n77        78  ...  MULTILINESTRING ((-99.06272 40.70339, -99.0633...\n\n[78 rows x 8 columns]>\n```\n:::\n\n```{.python .cell-code}\nne_counties.describe\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<bound method NDFrame.describe of     OBJECTID  ...                                           geometry\n0          1  ...  MULTIPOLYGON (((-98.27811 40.69829, -98.27816 ...\n1          2  ...  MULTIPOLYGON (((-97.83445 42.43772, -97.83448 ...\n2          3  ...  MULTIPOLYGON (((-101.98542 41.74226, -101.9711...\n3          4  ...  MULTIPOLYGON (((-104.05273 41.69795, -104.0443...\n4          5  ...  MULTIPOLYGON (((-99.68688 42.08620, -99.68702 ...\n..       ...  ...                                                ...\n88        89  ...  MULTIPOLYGON (((-96.12204 41.68268, -96.12134 ...\n89        90  ...  MULTIPOLYGON (((-97.01781 42.35137, -97.01779 ...\n90        91  ...  MULTIPOLYGON (((-98.27357 40.35036, -98.27354 ...\n91        92  ...  MULTIPOLYGON (((-98.29554 42.08890, -98.29548 ...\n92        93  ...  MULTIPOLYGON (((-97.36815 41.04696, -97.36815 ...\n\n[93 rows x 8 columns]>\n```\n:::\n:::\n\n:::\n\n#### Plotting Regions\n\nStates are a good example of polygons - they're a set of points which are connected and define the border of a region. Now, Nebraska is pretty boring, because we don't have any islands (ok, you could probably fill in a lot of things instead of islands in that sentence). But, in general, it's important to make sure that when dealing with generic polygons, we only connect points from the same polygon. \n\nIf you neglect point order and grouping, you may end up with a map like this:\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](data-vis_files/figure-html/fail-connected-polygons-r-1.png){fig-align='center' width=50%}\n:::\n:::\n\n\n\n::: panel-tabset\n##### R\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(mapproj)\n\nggplot() + \n  geom_polygon(data = ne, aes(x = long, y = lat, group = group), fill = \"white\", color = \"black\") + \n  coord_map() # This forces the right aspect ratio\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/polygon-r-state-1.png){width=50%}\n:::\n:::\n\n\n##### Python\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\n\nggplot() + geom_polygon(aes(x = \"long\", y = \"lat\", group = \"group\"), data = ne, fill = \"white\", color = \"black\")\n# coord_map isn't implemented in plotnine :(\n## <ggplot: (8740576856393)>\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/polygon-py-state-1.png){width=50%}\n:::\n:::\n\n:::\n\n#### Plotting counties\n\n::: panel-tabset\n##### R\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(mapproj)\n\nggplot() + \n  # geom_sf automatically uses lat/long and the type of data to choose the right geom\n  geom_sf(data = ne_counties) + \n  coord_sf() # This forces the right aspect ratio\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/polygon-r-county-3.png){width=2100}\n:::\n:::\n\n\nWe could even add annotations to the counties showing what the county names are, if we want to do so - this requires a call to `geom_sf_text`, and an additional aesthetic mapping to label (the value of the text we're printing). The geographic centroid operation is handled automatically behind the scenes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  # geom_sf automatically uses lat/long and the type of data to choose the right geom\n  geom_sf(data = ne_counties) + \n  geom_sf_text(data = ne_counties, aes(label = Cnty_Name), size = 2) + \n  coord_sf() # This forces the right aspect ratio\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/polygon-r-county2-1.png){width=2100}\n:::\n:::\n\n\n##### Python\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\nimport geopandas as gp\n\nggplot() + geom_map(data = ne_counties)\n## <ggplot: (8740576834467)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:46: ShapelyDeprecationWarning: Iteration over multi-part geometries is deprecated and will be removed in Shapely 2.0. Use the `geoms` property to access the constituent parts of a multi-part geometry.\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the '.coords' to a numpy array instead.\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/polygon-py-county-1.png){width=614}\n:::\n:::\n\n\nIn python, it requires a bit more work to handle county names - we have to define a function to give us the centroid of each region. \n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\nimport geopandas as gp\n\n# from plotnine docs: https://plotnine.readthedocs.io/en/stable/generated/plotnine.geoms.geom_map.html?highlight=coord_map\ndef calculate_center(df):\n  \"\"\"\n  Calculate the centre of a geometry\n\n  This method first converts to a planar crs, gets the centroid\n  then converts back to the original crs. This gives a more\n  accurate\n  \"\"\"\n  original_crs = df.crs\n  planar_crs = 'EPSG:3857'\n  return df['geometry'].to_crs(planar_crs).centroid.to_crs(original_crs)\n\nne_counties['center'] = calculate_center(ne_counties)\n\nggplot() + geom_map(data = ne_counties, fill = \"#f0f0f0\") +\\\ngeom_text(ne_counties, aes(\"center.x\", \"center.y\", label = 'Cnty_Name'), size = 5)\n## <ggplot: (8740576854227)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:46: ShapelyDeprecationWarning: Iteration over multi-part geometries is deprecated and will be removed in Shapely 2.0. Use the `geoms` property to access the constituent parts of a multi-part geometry.\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the '.coords' to a numpy array instead.\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/polygon-py-county2-3.png){width=614}\n:::\n:::\n\n:::\n\n\n#### Adding Polygons\n\nNext, let's add some park information to our map. \n\n::: panel-tabset\n##### R\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(mapproj)\n\nggplot() + \n  # geom_sf automatically uses lat/long and the type of data to choose the right geom\n  geom_sf(data = ne_counties) + \n  geom_sf(data = ne_parks, fill = \"green\", color = \"darkgreen\") + \n  coord_sf() # This forces the right aspect ratio\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/polygon-r-park-5.png){width=2100}\n:::\n:::\n\n\n\n##### Python\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\nimport geopandas as gp\n\nggplot() +\\\ngeom_map(data = ne_counties, fill = \"#fafafa\") +\\\ngeom_map(data = ne_parks, color = \"darkgreen\", fill = \"green\")\n## <ggplot: (8740576740217)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:46: ShapelyDeprecationWarning: Iteration over multi-part geometries is deprecated and will be removed in Shapely 2.0. Use the `geoms` property to access the constituent parts of a multi-part geometry.\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the '.coords' to a numpy array instead.\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the '.coords' to a numpy array instead.\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:46: ShapelyDeprecationWarning: Iteration over multi-part geometries is deprecated and will be removed in Shapely 2.0. Use the `geoms` property to access the constituent parts of a multi-part geometry.\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/polygon-py-park-1.png){width=614}\n:::\n:::\n\n:::\n\n#### Adding Lines\n\nSo far, everything we've plotted on our map has been related to polygons. Not all geometric objects are polygons, though - railroads and rivers are (usually) lines, and points of interest may be actual points and not spatial regions. We can add this additional information by including extra layers on our plot.\n\n\n::: panel-tabset\n##### R\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(mapproj)\n\nggplot() + \n  # geom_sf automatically uses lat/long and the type of data to choose the right geom\n  geom_sf(data = ne_counties, fill = \"white\", color = \"grey80\") + \n  geom_sf(data = ne_parks, fill = \"green\", color = \"darkgreen\") + \n  geom_sf(data = ne_railroads, color = \"black\") + \n  coord_sf() # This forces the right aspect ratio\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/polygon-r-railroad-3.png){width=2100}\n:::\n:::\n\n\n\n##### Python\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\nimport geopandas as gp\n\nggplot() +\\\ngeom_map(data = ne_counties, fill = \"#ffffff\", color = \"#f0f0f0\") +\\\ngeom_map(data = ne_parks, color = \"darkgreen\", fill = \"green\") +\\\ngeom_map(data = ne_railroads, color = \"black\")\n## <ggplot: (8740649252858)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:46: ShapelyDeprecationWarning: Iteration over multi-part geometries is deprecated and will be removed in Shapely 2.0. Use the `geoms` property to access the constituent parts of a multi-part geometry.\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the '.coords' to a numpy array instead.\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the '.coords' to a numpy array instead.\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/descartes/patch.py:46: ShapelyDeprecationWarning: Iteration over multi-part geometries is deprecated and will be removed in Shapely 2.0. Use the `geoms` property to access the constituent parts of a multi-part geometry.\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/polygon-py-railroad-1.png){width=614}\n:::\n:::\n\n:::\n\n\n::: {.callout-tip collapse=true}\n### Try it out: Maps of Middle Earth\n\nDedicated fans have re-created middle earth in digital format using ArcGIS files. These map file formats, called shape files, can be read into R and plotted.\n\nYou may need to install a few spatial packages first ([Mac and Windows](http://www.nickeubank.com/wp-content/uploads/2015/10/RGIS1_SpatialDataTypes_part0_setup.html), [Linux](https://philmikejones.me/tutorials/2014-07-14-installing-rgdal-in-r-on-linux/))\n\nThe `sf` package in R contains a special geom, `geom_sf`, which will plot map objects with an appropriate geom, whether they are points, lines, or polygons. In complicated maps with many layers, this is a really awesome feature. Similarly, if you have `geopandas` in python, `plotnine`'s `geom_map` function will work with geopandas tables. \n\nI've provided some code to get you started, but there are many other shapefiles in the dataset. Pick some layers which you think are interesting, and plot them with appropriate geoms to make a map of Middle Earth. \n\nUnfortunately, in this map there is not an underlying polygon (the coastline is a series of shorter segments). To resolve this, I have provided a theme statement that will have a white background, so that you can add useful layers without the grey grid background. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(ggthemes)\nlibrary(sf)\n\nif (!dir.exists(\"data\")) mkdir(\"data\")\n\nif (!file.exists(\"data/MiddleEarthMap.zip\")) {\n  download.file(\"https://github.com/jvangeld/ME-GIS/archive/master.zip\", \"data/MiddleEarthMap.zip\", mode = \"wb\")\n}\nif (!dir.exists(\"data/ME-GIS-main/\")) {\n  unzip(\"data/MiddleEarthMap.zip\", exdir = \"data/\")\n}\n\ncoastline <- read_sf(\"data/ME-GIS-main/Coastline2.shp\")\n## Error: Cannot open \"data/ME-GIS-main/Coastline2.shp\"; The file doesn't seem to exist.\ncities <- read_sf(\"data/ME-GIS-main/Cities.shp\")\n## Error: Cannot open \"data/ME-GIS-main/Cities.shp\"; The file doesn't seem to exist.\nforests <- read_sf(\"data/ME-GIS-main/Forests.shp\")\n## Error: Cannot open \"data/ME-GIS-main/Forests.shp\"; The file doesn't seem to exist.\nlakes <- read_sf(\"data/ME-GIS-main/Lakes.shp\")\n## Error: Cannot open \"data/ME-GIS-main/Lakes.shp\"; The file doesn't seem to exist.\nrivers <- read_sf(\"data/ME-GIS-main/Rivers.shp\")\n## Error: Cannot open \"data/ME-GIS-main/Rivers.shp\"; The file doesn't seem to exist.\nroads <- read_sf(\"data/ME-GIS-main/Roads.shp\")\n## Error: Cannot open \"data/ME-GIS-main/Roads.shp\"; The file doesn't seem to exist.\n\nggplot() + \n  geom_sf(data = coastline) + \n  geom_sf(data = forests, color = NA, fill = \"darkgreen\", alpha = .2) + \n  geom_sf(data = rivers, color = \"blue\", alpha = .1) + \n  geom_sf(data = lakes, fill = \"blue\", color = NA, alpha = .2) + \n  theme_map()\n## Error in fortify(data): object 'coastline' not found\n```\n:::\n\n\n:::\n\n\n\n### Statistics and Plot Types\n\nAt this point, we've primarily looked at charts which have two continuous variables - scatter plots and line plots. There are a number of situations where these types of charts are inadequate. For one thing, we might want to only look at the distribution of a single variable. Or, we might want to look at how a continuous response variable changes when the level of a categorical variable changes. In this section, we'll hit the most common types of plots, but there are almost infinite variations. Sites like [the Data Viz Catalogue](https://datavizcatalogue.com/search.html) can be useful if you're trying to accomplish a specific task and want to know what type of plot to use. \n\nIn all of the plots which we discuss in this section, there is a statistical function applied to the data before plotting. So while you may specify e.g. `x = var1`,  what is plotted is `f(var1)`, where `f()` might be the mean/median/quartiles, a binned count, or a computed kernel density. \n\nIn ggplot2, you can formally specify a statistic by using `stat_xxx` functions, but many geoms implicitly call these same functions. \n\n\n::: {.callout-note collapse=true}\n### Introducing Seaborn: higher level Python plotting\nIt's at this point in the chapter that I gave up trying to do everything in `matplotlib`. `Matplotlib` is the low-level plotting library, and when computing statistics and creating these types of plots, it's ... not ideal. I will instead demonstrate `plotnine`, which is grammar-of-graphics style, and [`seaborn`](https://seaborn.pydata.org/) [@waskomSeaborn2022], which is another plotting library in python that isn't strictly grammar-of-graphics but is at least somewhat higher level than `matplotlib`.\n\nWhile standard `seaborn` isn't a grammar-of-graphics interface, it appears that the next generation of the package will be much more grammar-of-graphics like. [@waskomNextgenerationSeabornInterface2022]\n\nInstall seaborn with `pip3 install seaborn` in your terminal.\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# Load the seaborn package\n# the alias \"sns\" stands for Samuel Norman Seaborn \n# from \"The West Wing\" television show\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\n# Initialize seaborn styling; context\nsns.set_style('white')\nsns.set_context('notebook')\n```\n:::\n\n:::\n\n\n### Visualizing Distributions\n\n#### Box plots\n\nA box plot can show some summary information about the distribution of a single continuous variable, and usually is used to show differences in the level of a response variable at different levels of a categorical variable. \n\n\nLet's look at the distribution of penguin weight by species and sex. \nWe'll return to this plot later when discussing how to create good charts.\n\n::: panel-tabset\n\n##### ggplot2\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(palmerpenguins)\nlibrary(dplyr)\n\npenguins %>%\n  filter(!is.na(sex)) %>% # Remove unknown sex penguins\n  ggplot(aes(x = species, y = body_mass_g, color = sex)) + \n  geom_boxplot(outlier.shape = NA) + \n  # We can add another layer overlaying the actual points, \n  # with some random noise added to reduce overplotting\n  geom_jitter(position = position_jitterdodge(), shape = 1) + \n  ylab(\"Body Mass (g)\") + xlab(\"Species\") + ggtitle(\"Penguin Weight by Species and Sex\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/boxplot-ggplot-r-1.png){width=2100}\n:::\n:::\n\n\n\n##### plotnine\n\n::: {.cell}\n\n```{.python .cell-code}\nimport pandas as pd\nfrom plotnine import *\nfrom palmerpenguins import load_penguins\npenguins = load_penguins()\n\n# Remove NAs\ntmp = penguins.dropna(axis = 0, subset = 'sex')\n\nggplot(aes(x = \"species\", y = \"body_mass_g\", color = \"sex\"), data = tmp) +\\\ngeom_boxplot(outlier_shape='') +\\\ngeom_jitter(position = position_jitterdodge(), shape = 'o') +\\\nggtitle(\"Penguin Weight by Species and Sex\") +\\\nylab(\"Body Mass (g)\") +\\\nxlab(\"Species\")\n## <ggplot: (8740576813954)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/geoms/geom_point.py:61: UserWarning: You passed a edgecolor/edgecolors (['#db5f57ff']) for an unfilled marker ('').  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/geoms/geom_point.py:61: UserWarning: You passed a edgecolor/edgecolors (['#57d3dbff']) for an unfilled marker ('').  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/boxplot-plotnine-py-1.png){width=614}\n:::\n:::\n\n\n##### Base R\n\nBecause base R doesn't have a default way to handle jittering or putting boxplots side-by-side, it's not easy to add points on top of these boxplots.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(body_mass_g ~ species + sex, data = penguins, \n        # Manually color boxplots\n        col = rep(c(\"red\", \"blue\"), times = 3))\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/boxplot-base-r-3.png){width=2100}\n:::\n:::\n\n\n##### Seaborn\n\n\n::: {.cell}\n\n```{.python .cell-code}\nplt.cla() # clear out matplotlib buffer\nsns.boxplot(data=penguins, x = 'species', y = 'body_mass_g', hue = 'sex')\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/boxplot-seaborn-1.png){width=614}\n:::\n:::\n\n\n:::\n\n#### Histograms and Density Plots\n\nBox plots aren't the only way to show distributions. If we want to, we can show distributions using histograms or density plots. A **histogram** is created by binning the variable, then counting the number of observations that fall within each specified range.\nUsually, these ranges have constant width (but not always). \n\nChanging the binwidth can radically change the appearance and usefulness of the histogram.\n\n\n::: panel-tabset\n##### ggplot2\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  ggplot(aes(x = body_mass_g)) + \n  geom_histogram(color = \"black\", fill = \"grey\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/gg-hist-r-3.png){width=2100}\n:::\n\n```{.r .cell-code}\n\npenguins %>%\n  ggplot(aes(x = body_mass_g)) + \n  geom_histogram(color = \"black\", fill = \"grey\", binwidth = 60)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/gg-hist-r-4.png){width=2100}\n:::\n\n```{.r .cell-code}\n\npenguins %>%\n  ggplot(aes(x = body_mass_g)) + \n  geom_histogram(color = \"black\", fill = \"grey\", binwidth = 300)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/gg-hist-r-5.png){width=2100}\n:::\n:::\n\n##### plotnine\n\n::: {.cell}\n\n```{.python .cell-code}\nggplot(penguins.dropna(axis = 0, subset='body_mass_g'), aes(x = \"body_mass_g\")) + geom_histogram(color = \"black\", fill = \"grey\")\n  \n## <ggplot: (8740576729085)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/stats/stat_bin.py:95: PlotnineWarning: 'stat_bin()' using 'bins = 11'. Pick better value with 'binwidth'.\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/plotnine-hist-py-1.png){width=614}\n:::\n\n```{.python .cell-code}\nggplot(penguins.dropna(axis = 0, subset='body_mass_g'), aes(x = \"body_mass_g\")) + geom_histogram(color = \"black\", fill = \"grey\", binwidth = 60)\n  \n## <ggplot: (8740649166451)>\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/plotnine-hist-py-2.png){width=614}\n:::\n\n```{.python .cell-code}\nggplot(penguins.dropna(axis = 0, subset='body_mass_g'), aes(x = \"body_mass_g\")) + geom_histogram(color = \"black\", fill = \"grey\", binwidth = 300)\n## <ggplot: (8740556973834)>\n## \n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/ggplot.py:365: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`).\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/plotnine-hist-py-3.png){width=614}\n:::\n:::\n\n##### Base R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(penguins$body_mass_g)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/base-hist-r-7.png){width=2100}\n:::\n\n```{.r .cell-code}\n\nhist(penguins$body_mass_g, breaks = 30) # number of bins\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/base-hist-r-8.png){width=2100}\n:::\n\n```{.r .cell-code}\n\nhist(penguins$body_mass_g, \n     seq(min(penguins$body_mass_g, na.rm = T), \n         max(penguins$body_mass_g, na.rm = T), \n         by = 60)) # specific bin width\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/base-hist-r-9.png){width=2100}\n:::\n:::\n\n\n##### Seaborn\n\n::: {.cell}\n\n```{.python .cell-code}\nplt.cla() # clear out matplotlib buffer\nsns.histplot(data = penguins, x = \"body_mass_g\")\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/seaborn-hist-py-1.png){width=614}\n:::\n\n```{.python .cell-code}\nplt.cla() # clear out matplotlib buffer\nsns.histplot(data = penguins, x = \"body_mass_g\", binwidth = 60)\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/seaborn-hist-py-2.png){width=614}\n:::\n\n```{.python .cell-code}\nplt.cla() # clear out matplotlib buffer\nsns.histplot(data = penguins, x = \"body_mass_g\", binwidth = 300)\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/seaborn-hist-py-3.png){width=614}\n:::\n:::\n\n:::\n\n#### Violin Plots\n\nOne interesting hybrid between a boxplot and a histogram is a **violin plot**, which shows the full density of the data, reflected (usually in y) to form an object which could potentially look like a violin for e.g. bimodal data.\n\n::: column-margin\n![](https://imgs.xkcd.com/comics/violin_plots.png){fig-alt=\"XKCD comic showing a chart of suggestiveness of visualization types (from not very suggestive to suggestive). Violin charts are shown for pie charts (not very suggestive), line graphs (slightly more sugestive), Georgia O'Keeffe paintings (very suggestive) and violin plots (even more suggestive)\"}\n[Source](https://xkcd.com/1967/)\n:::\n\nSeaborn has options to split the violin plots by sex - this is  a bit trickier in ggplot2 but it [can be done](https://stackoverflow.com/questions/35717353/split-violin-plot-with-ggplot2) with the help of the `introdataviz` package available on GitHub.\n\n::: panel-tabset\n\n##### ggplot2\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(palmerpenguins)\nlibrary(dplyr)\n\npenguins %>%\n  filter(!is.na(sex)) %>% # Remove unknown sex penguins\n  ggplot(aes(x = species, y = body_mass_g, color = sex)) + \n  geom_violin(outlier.shape = NA) + \n  # We can add another layer overlaying the actual points, \n  # with some random noise added to reduce overplotting\n  geom_jitter(position = position_jitterdodge(), shape = 1) + \n  ylab(\"Body Mass (g)\") + xlab(\"Species\") + ggtitle(\"Penguin Weight by Species and Sex\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/violinplot-ggplot-r-7.png){width=2100}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# devtools::install_github(\"psyteachr/introdataviz\")\nlibrary(introdataviz)\n\npenguins %>%\n  filter(!is.na(sex)) %>% # Remove unknown sex penguins\n  ggplot(aes(x = species, y = body_mass_g, color = sex)) + \n  geom_split_violin() + \n  # We can add another layer overlaying the actual points, \n  # with some random noise added to reduce overplotting\n  geom_jitter(position = position_jitterdodge(), shape = 1) + \n  ylab(\"Body Mass (g)\") + xlab(\"Species\") + ggtitle(\"Penguin Weight by Species and Sex\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/violinplot-ggplot-r-split-1.png){width=2100}\n:::\n:::\n\n\n##### Seaborn\n\n\n::: {.cell}\n\n```{.python .cell-code}\nplt.cla() # clear out matplotlib buffer\nsns.violinplot(data = penguins, x = 'species', y = 'body_mass_g', hue = 'sex', split = True)\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/violinplot-seaborn-1.png){width=614}\n:::\n:::\n\n\n\n\n:::\n\n\n#### Bar Charts\n\nA bar chart is a plot with a categorical variable on one axis and a summary statistic on the other (usually, this is a count).\nNote that a bar chart is NOT the same as a histogram (a histogram looks very similar, but has a binned numeric variable on one axis and counts on the other). Geometrically, bar charts are rectangles; typically each rectangle will have equal width and variable height.\n\n::: panel-tabset\n##### ggplot2\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  ggplot(aes(x = species, fill = species)) + \n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/gg-bar-r-3.png){width=50%}\n:::\n\n```{.r .cell-code}\npenguins %>%\n  ggplot(aes(x = species, fill = sex)) + \n  geom_bar(position = \"dodge\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/gg-bar-r-4.png){width=50%}\n:::\n\n```{.r .cell-code}\npenguins %>%\n  ggplot(aes(x = species, fill = sex)) + \n  geom_bar(position = \"stack\")\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/gg-bar-r-5.png){width=50%}\n:::\n:::\n\n##### plotnine\n\n\n::: {.cell}\n\n```{.python .cell-code}\nggplot(penguins.dropna(axis = 0, subset='species'), aes(x = \"species\", fill = \"species\")) + geom_bar()\n## <ggplot: (8740554096978)>\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/plotnine-bar-py-1.png){width=50%}\n:::\n\n```{.python .cell-code}\nggplot(penguins.dropna(axis = 0, subset=['species', 'sex']), aes(x = \"species\", fill = \"sex\")) + geom_bar()\n## <ggplot: (8740551978900)>\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/plotnine-bar-py-2.png){width=50%}\n:::\n\n```{.python .cell-code}\nggplot(penguins.dropna(axis = 0, subset=['species', 'sex']), aes(x = \"species\", fill = \"sex\")) + geom_bar(position = \"dodge\")\n## <ggplot: (8740551959676)>\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/plotnine-bar-py-3.png){width=50%}\n:::\n:::\n\n##### Base R\n\n::: {.cell}\n\n```{.r .cell-code}\ncount_species <- table(penguins$species)\nbarplot(count_species)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/base-bar-r-7.png){width=50%}\n:::\n\n```{.r .cell-code}\ncount_species2 <- table(penguins$sex, penguins$species, useNA = 'ifany')\nbarplot(count_species2, beside = T)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/base-bar-r-8.png){width=50%}\n:::\n:::\n\n\n##### Seaborn\n\n`countplot` is a canonical barchart in seaborn. `barplot` shows the aggregated value of a y variable, with a confidence interval, which is not what is typically meant by a bar plot.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nplt.cla() # clear out matplotlib buffer\nsns.countplot(data = penguins, x = \"species\")\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/seaborn-bar-py-1.png){width=50%}\n:::\n\n```{.python .cell-code}\nplt.cla() # clear out matplotlib buffer\nsns.countplot(data = penguins, x = \"species\", hue = 'sex')\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/seaborn-bar-py-2.png){width=50%}\n:::\n:::\n\n:::\n\n\n### Beyond Points: Lines, Rectangles, and Other Geoms\n\nThere are many situations where points aren't the best way to display data. If we have several series of data connected over e.g. time, then we might want to join our individual observations with lines that suggest continuity. Or, we may want to display a range of values over each time point, at which point we might be better off with a ribbon-like area enclosing the maximum and minimum values over time. \n\nIn the grammar of graphics, we need to select a geometric object and then provide variable mappings for each required spatial dimension. When working with non-grammar approaches, however, these different plots sometimes use very different syntax. \n\n#### Lines\n\nLet's consider the [lego set data](data/lego_sets.csv) and examine the number of sets over time.\n\n::: panel-tabset\n##### R data setup\n\n::: {.cell}\n\n```{.r .cell-code}\nlegos_time <- readr::read_csv(\"data/lego_sets.csv\") %>%\n  group_by(year) %>%\n  count()\n```\n:::\n\n\n##### Python data setup\n\n::: {.cell}\n\n```{.python .cell-code}\nlegos_time = pd.read_csv(\"data/lego_sets.csv\").\\\n  groupby(\"year\")[[\"theme_id\"]].\\\n  agg(\"count\").\\\n  reset_index().\\\n  rename(columns = {\"theme_id\": \"count\"})\n```\n:::\n\n:::\n\n::: panel-tabset\n##### ggplot2\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(legos_time, aes(x = year, y = n)) + geom_line()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/ggplot2-line-1.png){width=2100}\n:::\n:::\n\n##### plotnine\n\n::: {.cell}\n\n```{.python .cell-code}\nggplot(legos_time, aes(x = \"year\", y = \"count\")) + geom_line()\n## <ggplot: (8740543579883)>\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/plotnine-line-1.png){width=614}\n:::\n:::\n\n##### Base R\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(legos_time$year, legos_time$n, type = 'l')\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/base-line-3.png){width=2100}\n:::\n:::\n\n\n##### Seaborn\n\n\n::: {.cell}\n\n```{.python .cell-code}\nplt.cla()\nsns.lineplot(data = legos_time, x = \"year\", y = \"count\")\nplt.show()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/seaborn-line-1.png){width=614}\n:::\n:::\n\n\n:::\n\n#### Statistics and the Grammar of Graphics\n\nLet's explore the different ways we can represent data using the grammar of graphics and statistics. This section will be written in R, but of course, you can also do much the same thing in plotnine.\n\nLet's consider the case where we want to understand the joint distribution between penguin flipper length and bill depth: \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = penguins, aes(x = flipper_length_mm, y = bill_depth_mm)) + geom_point()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/penguin-joint-scatter-3.png){fig-align='center' width=50%}\n:::\n:::\n\n\nWe're already getting some overplotting in this data (points on top of each other), which interferes with our ability to actually see how many points there are. We could instead create a grid for the data and fill in the grid based on how many points are in each cell. \nWe would be using fill/color/hue as a third \"dimension\", if we wanted to go that route. We lose some numerical accuracy, as we can't map points directly to colors as accurately as we do location, but we might have a better intuitive feeling for the data distribution than we get from seeing the points (and this approach scales to data sets that are bigger than the penguins data).\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = penguins, aes(x = flipper_length_mm, y = bill_depth_mm)) + geom_bin2d()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/penguin-joint-grid-1.png){fig-align='center' width=50%}\n:::\n:::\n\n\nWhile the points (or counts of points) are great, we might want to add some sort of density statistic to the mix. We can use `geom_density2d` to do this calculation. Note that we have to tell ggplot to wait until after the statistic is computed to calculate the fill (and what statistic to use). \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = penguins, aes(x = flipper_length_mm, y = bill_depth_mm)) + \n  stat_density2d(aes(fill = after_stat(density)), \n                 geom = \"tile\", \n                 contour = F)\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/penguin-joint-2d-dens-fill-1.png){width=2100}\n:::\n:::\n\n\nIf you want to preserve some numerical precision, we could instead work on contour lines -- like elevation maps, contour plots show lines connecting densities of the same numerical value.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = penguins, aes(x = flipper_length_mm, y = bill_depth_mm)) + \n  geom_density2d()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/penguin-joint-2d-dens-lines-1.png){width=2100}\n:::\n:::\n\n\nWe can also combine fill and contour lines and plot filled polygons:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = penguins, aes(x = flipper_length_mm, y = bill_depth_mm)) + \n  stat_density2d_filled()\n```\n\n::: {.cell-output-display}\n![](data-vis_files/figure-html/penguin-joint-2d-dens-polygon-1.png){width=2100}\n:::\n:::\n\n\nObviously, there's a lot of ways to generate 3D-like charts in R, but can we actually generate 3D charts? Of course! We'll use the `rayshader` package [@rayshader]. \n\n::: column-margin\n![The rayshader package lets you create 3d maps and graphs (image by Allison Horst)](https://github.com/allisonhorst/stats-illustrations/raw/main/rstats-artwork/rayshader.png)\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rayshader)\n\nmy_penguin_plot <- penguins %>% \n  ggplot(aes(x = flipper_length_mm, y = bill_depth_mm)) + \n  stat_density2d(aes(fill = after_stat(density)), \n                 geom = \"tile\", \n                 contour = F)\n\nplot_gg(my_penguin_plot) # Running this is very memory intensive\n```\n:::\n\n\nIf you happen to want to get a 3D printed version of your plot, you can do that too using `rayshader`'s `save_3dprint()` function.\n\n## Creating Good Charts {#sec-creating-good-charts}\n\nA chart is *good* if it allows the user to draw useful conclusions that are supported by data. Obviously, this definition depends on the purpose of the chart - a simple EDA chart is going to have a different purpose than a chart showing e.g. the predicted path of a hurricane, which people will use to make decisions about whether or not to evacuate. \n\nUnfortunately, while our visual system is *amazing*, it is not always as accurate as the computers we use to render graphics. We have physical limits in the number of colors we can perceive, our short term memory, attention, and our ability to accurately read information off of charts in different forms. \n\n::: column-margin\nI'm going to provide a broad overview of considerations in this section, but if you have more questions, please contact me. This is my research area, and I love to talk about it.\n:::\n\n::: {.callout-note collapse=true}\n### How do we know a chart is good?\n\nWe do experiments on people! (*evil cackle*) \n\n- A review of graphical testing in statistics  [@vanderplasTestingStatisticalCharts2020]\n- A really cool paper about testing competing graphical designs to figure out polar coordinates suck [@hofmannGraphicalTestsPower2012a]\n\nIf you're still curious after reading those, set up an appointment and let's talk!\n:::\n\n### General guidelines for accuracy\n\nThere are certain tasks which are easier for us relative to other, similar tasks. \nWhen making a judgement corresponding to numerical quantities, there is an order of tasks from easiest (1) to hardest (6), with equivalent tasks at the same level. @clevelandGraphicalPerceptionTheory1984 is the major source of this ranking; other follow-up studies have been integrated, but the essential order is largely unchanged. \n\n::: column-margin\n\n::: {.cell}\n::: {.cell-output-display}\n![Which of the lines is the longest? Shortest? It is much easier to determine the relative length of the line when the ends are aligned. In fact, the line lengths are the same in both panels.](data-vis_files/figure-html/accuracy-guidelines-08-1.png){width=1200}\n:::\n:::\n\n:::\n\n1. Position (common scale)\n2. Position (non-aligned scale)\n3. Length, Direction, Angle, Slope\n4. Area\n5. Volume, Density, Curvature\n6. Shading, Color Saturation, Color Hue\n\nIf we compare a pie chart and a stacked bar chart, the bar chart asks readers to assess position on a non-aligned scale, while a pie chart asks readers to assess angle. This is one reason why pie charts are not recommended -- they make it harder on the reader to accurately read information off of the charts \n\nWhen creating a chart, it is helpful to consider which variables you want to show, and how accurate reader perception needs to be to get useful information from the chart. In many cases, less is more - you can easily overload someone, which may keep them from engaging with your chart at all. Variables which require the reader to notice small changes should be shown on position scales (x, y) rather than using color, alpha blending, etc.\n\nThere is also a general increase in dimensionality from 1-3 to 4 (2d) to 5 (3d). In general, showing information in 3 dimensions when 2 will suffice is misleading - the addition of that extra dimension causes an increase in chart area allocated to the item that is disproportionate to the actual area. \n\n::: callout-caution\n#### Example: Misleading Charts\n\n\n\n\n\n![Here, the area and height both encode the same variable, leading to a far disproportionate number of pixels allocated to \"Stocks\" than \"Cash Investments\" [@fungWhenPieChart2020]. In the first chart, stocks make up 60% of the portfolio, but have 67.5% of the pixels; Cash makes up 5% of the portfolio but those investments represent 2.3% of the pixels.](images/graphics/3d_graphs_suck.jpg){fig-alt=\"A three-dimensional pie chart cylinder, where both height and angle are mapped to portfolio percent. As a result, the visual region of the chart dedicated to each category is inconsistent with the data.\"}\n\n@hickey27WorstCharts2013 has some more great examples of misleading charts.\n\n:::\n\n::: column-margin\nHere's a great Ted Ed talk about spotting misleading charts:\n\n<iframe width=\"100%\" height=\"auto\" src=\"https://www.youtube.com/embed/E91bGT9BjYk\" title=\"How to spot a misleading graph - Lea Gaslowitz\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n:::\n\n\nExtra dimensions and other annotations are sometimes called \"chartjunk\" and should only be used if they contribute to the overall numerical accuracy of the chart (e.g. they should not just be for decoration). \n\n### Perceptual and Cognitive Factors\n\n#### Short Term Memory\n\nWe have a limited amount of memory that we can instantaneously utilize. This mental space, called **short-term memory**, holds information for active use, but only for a limited amount of time. Without rehearsing information, short term memory lasts a few seconds. \n\n::: {.callout-tip}\n##### Try it out\n\n<details><summary>\nClick here, read the information, and then click to hide \n</summary>\n1 4 2 2 3 9 8 0 7 8</details>\n\n<details><summary>Wait a few seconds, then expand this section</summary>\nWhat was the third number?\n</details>\n:::\n\nWithout rehearsing the information (repeating it over and over to yourself), the try it out task may have been challenging. Short term memory has a capacity of between 3 and 9 \"bits\" of information. \n\nIn charts and graphs, short term memory is important because we need to be able to associate information from e.g. a key, legend, or caption with information plotted on the graph. As a result, if you try to plot more than ~6 categories of information, your reader will have to shift between the legend and the graph repeatedly, increasing the amount of cognitive labor required to digest the information in the chart.\n\nWhere possible, try to keep your legends to 6 or 7 characteristics. \n\n\n::: callout-warning\n##### Important Takeaways\n\n- Limit the number of categories in your legends to minimize the short term memory demands on your reader.\n    - When using continuous color schemes, you may want to use a log scale to better show differences in value across orders of magnitude. \n    \n- Use colors and symbols which have implicit meaning to minimize the need to refer to the legend.\n\n- Add annotations on the plot, where possible, to reduce the need to re-read captions.\n:::\n\n\n#### Color\nOur eyes are optimized for perceiving the yellow/green region of the color spectrum. Why? Well, our sun produces yellow light, and plants tend to be green. We evolved to be able to distinguish different shades of green because it impacts our ability to find food. There aren't that many purple or blue predators, so there is less selection pressure to improve perception of that part of the visual spectrum.    \n\n::: column-margin\n![Sensitivity of the human eye to different wavelengths of visual light (Image from Wikimedia commons)](https://upload.wikimedia.org/wikipedia/commons/c/c0/Eyesensitivity.svg)\n:::\n\nNot everyone perceives color in the same way. Some individuals are [colorblind or color deficient](https://en.wikipedia.org/wiki/Color_blindness) [@ColorBlindness2022]. We have 3 cones used for color detection, as well as cells called rods which detect light intensity (brightness/darkness). In about 5% of the population (10% of XY individuals, <1% of XX individuals), one or more of the cones may be missing or malformed, leading to color blindness - a reduced ability to perceive different shades. The rods, however, function normally in almost all of the population, which means that light/dark contrasts are extremely safe, while contrasts based on the hue of the color are problematic in some instances. \n\n\n::: margin-column\n::: {.callout-note collapse=true}\n##### Colorblindness Test & Info\nYou can take a test designed to screen for colorblindness [here](https://www.eyeque.com/color-blind-test/test/)\n\nYour monitor may affect how you score on these tests - I am colorblind, but on some monitors, I can pass the test, and on some, I perform worse than normal. \n\nA different test is available [here](https://www.color-blindness.com/farnsworth-munsell-100-hue-color-vision-test/). \n\n<!-- ![My results on one monitor](images/graphics/08_colorblindness_monitorLG.png) -->\n<!-- ![My results on a monitor that has a different tech and supposedly higher color fidelity](images/graphics/08_colorblindness_monitorDell.png) -->\n\n<!-- ![The Munsell colorblindness test](images/graphics/08_colorblind_munsell.png) -->\n<!-- In reality, I know that I have issues with perceiving some shades of red, green, and brown. I have particular trouble with very dark or very light colors, especially when they are close to grey or brown.  -->\n\n:::\n:::\n\n::: {.callout-note collapse=true}\n##### Simulating Color Deficiency\nColor \"blindness\" can arise from either a mutation in one of the three cones (causing the cone to function less optimally), or when the gene for a cone is deleted or mutated to the point where it is not functional. We can simulate what these conditions look like when a rainbow color scheme is used:\n\n<table width=\"100%\"><tr><td rowspan = 2 width=\"34%\">\n![Original image using a rainbow color scale](images/graphics/RainbowScaleOrig.jpg)</td><td width=\"22%\">![Red deficient](images/graphics/RainbowScaleOrig-protanomaly.jpg)</td><td width=\"22%\">![Green deficient](images/graphics/RainbowScaleOrig-deuteranomaly.jpg)</td><td width=\"22%\">![Blue deficient](images/graphics/RainbowScaleOrig-tritanomaly.jpg)</td></tr><tr><td width=\"22%\">![Red absent](images/graphics/RainbowScaleOrig-protanopia.jpg)</td><td width=\"22%\">![Green absent](images/graphics/RainbowScaleOrig-deuteranopia.jpg)</td><td width=\"22%\">![Blue absent](images/graphics/RainbowScaleOrig-tritanopia.jpg)</td></tr></table>\n:::\n\nIn addition to colorblindness, there are other factors than the actual color value which are important in how we experience color, such as context. \n\n::: {#fig-color-constancy layout-ncol=2}\n\n![](images/graphics/CheckerShadow.png){fig-alt=\"A checkered 5x5 square with a green cylinder casting a shadow on the checkered surface. A point outside the shadowed region on the dark square is labeled 'A', and a point inside the shadowed region on a light square is labeled 'B'. The two squares appear to be very different colors.\"}\n\n![](images/graphics/CheckerShadow2.png){fig-alt=\"In this figure, the checkered surface is removed and only the labeled squares and the cylinder remain. Without the contextual information about the checkered surface and the cylinder's shadow, the two squares labeled 'A' and 'B' appear the same color.\"}\n\nThe color constancy illusion. The squares marked A and B are actually the same color\n:::\n\nOur brains are extremely dependent on context and make excellent use of the large amounts of experience we have with the real world. As a result, we implicitly \"remove\" the effect of things like shadows as we make sense of the input to the visual system. This can result in odd things, like the checkerboard and shadow shown above - because we're correcting for the shadow, B looks lighter than A even though when the context is removed they are clearly the same shade. \n\n::: callout-warning\n##### Important Takeaways\n\n- **Do not use rainbow color gradient schemes**\n    - Because of the unequal perception of different wavelengths, these schemes are _misleading_ - the color distance does not match the perceptual distance. \n    - Palettes such as [Viridis](https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html) and those on [colorcet.com](https://colorcet.com/) are better alternatives because they are perceptually uniform [@nunezOptimizingColormapsConsideration2018,@kovesiGoodColourMaps2015,@kovesiCETPerceptuallyUniform2021].\n\n- Avoid **green-yellow-red signaling**    \nWhile these schemes are intuitive (go, caution, stop), they are very difficult for those with common types of colorblindness to read.\n\n- Be conscious of **implied meaning**    \nThis can be used to your advantage, but you also want to avoid adding context that isn't supported by the data.\n    - Common associations can make it easier for viewers    \n    (but may be culturally specific)\n        - blue for cold, orange/red for hot is a natural scale, \n        - red = Republican and blue = Democrat in the US\n        - white -> blue gradients for rainfall totals\n    - Some colors can can provoke emotional responses that may not be desirable (red = blood, black = death, yellow = happy).\n    - Some color schemes have social baggage:\n        - the pink/blue color scheme often used to denote gender can be unnecessarily polarizing\n        - Instead, consider using a dark color (blue or purple) for men and a light color (yellow, orange, lighter green) for women [@rostWhatConsiderWhen2018]. \n\n::: column-margin\nWhen the COVID-19 outbreak started, many maps were using white-to-red gradients to show case counts and/or deaths. The emotional association between red and blood, danger, and death may have caused people to become more frightened than what was reasonable given the available information. [@fieldMappingCoronavirusResponsibly2020] \n:::\n:::\n\n::: {.callout-note collapse=true}\n##### Color Palette Options\n\n- Packages such as `RColorBrewer` and `dichromat` have color palettes which are aesthetically pleasing, and, in many cases, colorblind friendly (`dichromat` is better for that than `RColorBrewer`). \n\n- Other fun color palette generation methods [@muthYourFriendlyGuide2016,@taylorHavingTroublePicking2021] may also be useful. \n  - Artistic sources:\n      - Taylor Swift album colors [@taylorswift]\n      - Wes Anderson and Studio Ghibli films [@wesanderson,@ghibli]\n      - famous paintings and other images [@paletter] \n  - Natural palettes: \n      - The `earthtones` package generates palettes for elevation maps based on the actual location you're showing. [@earthtones]\n:::\n\n::: {.callout-note collapse=true}\n##### Colorblind Friendly Graphics\n- If you can print your chart out in black and white and still read it, it will be safe for colorblind users. This is the only foolproof way to do it!\n\n- **double encoding** - where you use color, use another aesthetic (line type, shape) as well to help your colorblind readers out. This also makes your plot more readable [@vanderplasClustersBeatTrend2017] and helps your mapping stand out more.\n\n- If you are using a color gradient, use a **monochromatic** color scheme where possible. This is perceived as light -> dark by colorblind people, so it will be correctly perceived no matter what color you use. \n\n- If you have a bidirectional scale (e.g. showing positive and negative values), the safest scheme to use is **purple - white - orange**.    \nIn any color scale that is multi-hue, it is important to transition through white, instead of from one color to another directly.\n\n:::\n\n\n#### Grouping and Sense-making: Imposing order on visual chaos\nTake a look at each of the examples in the panels below.\n\n::: panel-tabset\n\n##### Ambiguous Image\n\n![Is it a rabbit, or a duck?](images/graphics/DuckRabbitIllusion.jpg){fig-alt=\"An ambiguous image that could be either a duck or a rabbit head.\"}\n\nWhen faced with ambiguity, our brains use available context and past experience to try to tip the balance between alternate interpretations of an image. When there is still some ambiguity, many times the brain will just decide to interpret an image as one of the possible options. \n\n##### Illusory Contours\n\n![Consider this image - what do you see?](images/graphics/IllusoryContour.png){fig-alt=\"An image which appears to consist of three layers, listed from the bottom to the top: three circles (top left, top right, bottom middle), a triangle pointing up between the three circles with a black border, and a white triangle (no border) of the same size which overlays both of the previous layers. As a result, there are three pac-man shapes and three angles visible, but the viewer has no trouble perceiving the three layers even though they do not directly exist.\"\nwidth=\"40%\"}\n\nDid you see something like \"3 circles, a triangle with a black outline, and a white triangle on top of that\"? In reality, there are 3 angles and 3 pac-man shapes. But, it's much more likely that we're seeing layers of information, where some of the information is obscured (like the \"mouth\" of the pac-man circles, or the middle segment of each side of the triangle). This explanation is simpler, and more consistent with our experience. \n\n##### Figure-background\n\nNow, look at the logo for the Pittsburgh Zoo. \n\n![What do you see?](https://upload.wikimedia.org/wikipedia/en/5/5b/Pittsburgh_Zoo_%26_PPG_Aquarium_logo.svg){width=\"60%\"\nfig-alt=\"The logo for the Pittsburgh Zoo & Aquarium, which features a tree and birds; the negative space around the tree shows a gorilla and a lionness.\"}\n\nDo you see the gorilla and lionness? Or do you see a tree? Here, we're not entirely sure which part of the image is the figure and which is the background. \n\n:::\n\nThe ambiguous figures shown above demonstrate that our brains are actively imposing order upon the visual stimuli we encounter. There are some heuristics for how this order is applied which impact our perception of statistical graphs. \n\nThe catchphrase of Gestalt psychology is \n\n> The whole is greater than the sum of the parts\n\nThat is, what we perceive and the meaning we derive from the visual scene is more than the individual components of that visual scene. \n\n![The Gestalt Heuristics help us to impose order on ambiguous visual stimuli](images/graphics/gestalt.jpg){fig-alt=\"A conceptual rendering of the word GESTALT, where G shows the principle of closure (a white bar over the G occludes part of the letter, but it is still perceived as a single unit), E shows proximity (A set of gridded squares colored black and gray are seen as a whole E), S shows continuation (a bar through the S occludes part of the letter but we perceive both the bar and the S as continuous), T shows similarity (both T's are shown in the same striped pattern), A and L show figure/ground (there is a tree within the stylized A).\"}\n\nYou can read about the gestalt rules in more depth if you want to, but they are also demonstrated in the figure above [@PrinciplesGrouping2022].\n\nIn graphics, we can leverage the gestalt principles of grouping to create order and meaning. If we color points by another variable, we are creating groups of similar points which assist with the perception of groups instead of individual observations. If we add a trend line, we create the perception that the points are moving \"with\" the line (in most cases), or occasionally, that the line is dividing up two groups of points. Depending on what features of the data you wish to emphasize, you might choose different aesthetics mappings, facet variables, and factor orders. \n\n::: {.callout-caution collapse=true}\n##### Example: Grouping in Graphics\n\n\n::: {.cell layout-ncol=\"3\"}\n::: {.cell-output-display}\n![A bar chart](data-vis_files/figure-html/chart-emphasis-bar-08-1.png){width=1200}\n:::\n\n::: {.cell-output-display}\n![A line chart](data-vis_files/figure-html/chart-emphasis-bar-08-2.png){width=1200}\n:::\n\n::: {.cell-output-display}\n![A box plot](data-vis_files/figure-html/chart-emphasis-bar-08-3.png){width=1200}\n:::\n\nWhich chart best demonstrates that in every state and region, the murder rate decreased?\n:::\n\n\nThe line segment plot connects related observations (from the same state) but allows you to assess similarity between the lines (e.g. almost all states have negative slope). The same information goes into the creation of the other two plots, but the bar chart is extremely cluttered, and the boxplot doesn't allow you to connect single state observations over time. So while you can see an aggregate relationship (overall, the average number of murders in each state per 100k residents decreased) you can't see the individual relationships. \n\n:::\n\n::: callout-warning\n##### Important Takeaways\nThe aesthetic mappings and choices you make when creating plots have a huge impact on the conclusions that you (and others) come to when examining those plots [@vanderplasClustersBeatTrend2017].\n:::\n\n## Useful Tricks\n\n### Saving figures\n\n::: panel-tabset\n#### ggplot2\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = penguins,\n       aes(x = bill_length_mm, y = body_mass_g, color = species)) + \n  geom_point()\nggsave(filename = \"images/graphics/test-penguin-ggplot2.png\", \n       width = 8, height = 6, dpi = 300)\n```\n:::\n\n\n#### Base R\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"images/graphics/test-penguin-baseR.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(penguins$bill_length_mm, penguins$body_mass_g) \ndev.off()\n```\n:::\n\n\nThere are other functions available, such as `pdf`, `cairo_pdf` (which may have better unicode support), and `jpeg`. Some other R packages, such as `ragg`, provide additional ways to save R plots to files.\n\n#### Plotnine\nIn plotnine, we store the plot as an object and then use the `.save()` method, which has the same arguments as `ggsave()`.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom plotnine import *\n\nmyplot = ggplot(penguins, aes(x = \"bill_length_mm\", y = \"body_mass_g\", color = \"species\")) + geom_point()\nmyplot.save(\"images/graphics/test-penguin-plotnine.png\", width = 8, height = 6, dpi = 300, units = \"in\")\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/ggplot.py:719: PlotnineWarning: Saving 8 x 6 in image.\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/ggplot.py:722: PlotnineWarning: Filename: images/graphics/test-penguin-plotnine.png\n## /home/susan/Projects/Class/unl-stat850/stat850-textbook/renv/python/virtualenvs/renv-python-3.8/lib/python3.8/site-packages/plotnine/layer.py:401: PlotnineWarning: geom_point : Removed 2 rows containing missing values.\n```\n:::\n\n\n#### Matplotlib\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport matplotlib as plt\n\nplt.cla() # clear out matplotlib buffer\n## Error in py_call_impl(callable, dots$args, dots$keywords): AttributeError: module 'matplotlib' has no attribute 'cla'\nplt.figure(figsize=[8,6], dpi = 300) # set figure size\n## Error in py_call_impl(callable, dots$args, dots$keywords): TypeError: 'module' object is not callable\nplt.scatter(penguins.bill_length_mm, penguins.body_mass_g)\n## Error in py_call_impl(callable, dots$args, dots$keywords): AttributeError: module 'matplotlib' has no attribute 'scatter'\nplt.savefig(\"images/graphics/test-penguin-matplotlib.png\")\n## Error in py_call_impl(callable, dots$args, dots$keywords): AttributeError: module 'matplotlib' has no attribute 'savefig'\n```\n:::\n\n\n#### Seaborn\n\nSeaborn is built on top of matplotlib, so it works the same way.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport matplotlib as plt\nimport seaborn as sns\n\nplt.cla() # clear out matplotlib buffer\n## Error in py_call_impl(callable, dots$args, dots$keywords): AttributeError: module 'matplotlib' has no attribute 'cla'\nplt.figure(figsize=[8,6], dpi = 300) # set figure size\n## Error in py_call_impl(callable, dots$args, dots$keywords): TypeError: 'module' object is not callable\nsns.scatterplot(data = penguins, x = \"bill_length_mm\", y = \"body_mass_g\", hue = \"species\")\nplt.savefig(\"images/graphics/test-penguin-seaborn.png\")\n## Error in py_call_impl(callable, dots$args, dots$keywords): AttributeError: module 'matplotlib' has no attribute 'savefig'\n```\n:::\n\n\n:::\n\n### Combining Figures\n\nWe often want to combine multiple figures (or pieces of figures) together. While this topic is outside the scope of this book, I do want to at least point you in the right direction.\n\n::: column-margin\n![The patchwork package is a great way to combine figures](https://github.com/allisonhorst/stats-illustrations/raw/main/rstats-artwork/patchwork_1.jpg)\n:::\n\n::: panel-tabset\n#### R\n\n- [patchwork](https://patchwork.data-imaginist.com/) [@patchwork]\n- [cowplot](https://wilkelab.org/cowplot/index.html) [@cowplot]\n\n#### Python\n\n- [patchwork](https://github.com/ponnhide/patchworklib) (works with matplotlib, plotnine, and seaborn) [@moriPatchworklib2022]\n- the `subplot_mosaic` function in `matplotlib`\n:::\n\n### Interactive Plots\n\nWe'll get to interactive plots later, but for now, check out \n\n- [plotly](https://plotly.com/) ([R](https://plotly.com/r/) and [python](https://plotly.com/python/))\n- [animint2](https://github.com/tdhock/animint2) (Takes ggplot2 graphics and creates interactive d3 charts)\n- [Shiny](https://shiny.rstudio.com/) (R originally, and as of July 2022, for [python](https://shiny.rstudio.com/py/) too!)\n\n\n## References\n",
    "supporting": [
      "data-vis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}