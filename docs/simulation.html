<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 9 Simulation and Reproducibility | Stat 850: Computing Tools for Statisticians</title>
  <meta name="description" content="Introductions to statistical computing packages and document preparation software. Topics include: graphical techniques, data management, Monte Carlo simulation, dynamic document preparation, presentation software." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 9 Simulation and Reproducibility | Stat 850: Computing Tools for Statisticians" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Introductions to statistical computing packages and document preparation software. Topics include: graphical techniques, data management, Monte Carlo simulation, dynamic document preparation, presentation software." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 9 Simulation and Reproducibility | Stat 850: Computing Tools for Statisticians" />
  
  <meta name="twitter:description" content="Introductions to statistical computing packages and document preparation software. Topics include: graphical techniques, data management, Monte Carlo simulation, dynamic document preparation, presentation software." />
  

<meta name="author" content="Susan Vanderplas" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-vis-intro.html"/>
<link rel="next" href="docs-reports.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script>

(function() {
  var codes = document.querySelectorAll('pre:not([class])');
  var code, i, d, s, p;
  for (i = 0; i < codes.length; i++) {
    code = codes[i];
    p = code.parentNode;
    d = document.createElement('details');
    s = document.createElement('summary');
    s.innerText = 'Answers';
    // <details><summary>Answers</summary></details>
      d.appendChild(s);
    // move the code into <details>
      p.replaceChild(d, code);
    d.appendChild(code);
  }
})();
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to Statistical Computing</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#forward"><i class="fa fa-check"></i>Forward</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-description"><i class="fa fa-check"></i>Course Description</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-goals"><i class="fa fa-check"></i>Course Goals</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-objectives"><i class="fa fa-check"></i>Course Objectives</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="tools.html"><a href="tools.html"><i class="fa fa-check"></i><b>1</b> Tools for Statistical Computing</a>
<ul>
<li class="chapter" data-level="" data-path="tools.html"><a href="tools.html#module-1-objectives"><i class="fa fa-check"></i>Tools: Module Objectives</a></li>
<li class="chapter" data-level="1.1" data-path="tools.html"><a href="tools.html#r-and-rstudio"><i class="fa fa-check"></i><b>1.1</b> R and RStudio</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="tools.html"><a href="tools.html#getting-set-up-r"><i class="fa fa-check"></i><b>1.1.1</b> Getting Set up: R</a></li>
<li class="chapter" data-level="1.1.2" data-path="tools.html"><a href="tools.html#getting-set-up-rstudio"><i class="fa fa-check"></i><b>1.1.2</b> Getting Set up: RStudio</a></li>
<li class="chapter" data-level="1.1.3" data-path="tools.html"><a href="tools.html#exploring-rstudio"><i class="fa fa-check"></i><b>1.1.3</b> Exploring RStudio</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="tools.html"><a href="tools.html#sas"><i class="fa fa-check"></i><b>1.2</b> SAS</a>
<ul>
<li class="chapter" data-level="" data-path="tools.html"><a href="tools.html#note"><i class="fa fa-check"></i>Note</a></li>
<li class="chapter" data-level="1.2.1" data-path="tools.html"><a href="tools.html#sas-windowspanes"><i class="fa fa-check"></i><b>1.2.1</b> SAS Windows/Panes</a></li>
<li class="chapter" data-level="1.2.2" data-path="tools.html"><a href="tools.html#sas-modules"><i class="fa fa-check"></i><b>1.2.2</b> SAS Modules</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="tools.html"><a href="tools.html#version-control-with-git"><i class="fa fa-check"></i><b>1.3</b> Version Control with Git</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="tools.html"><a href="tools.html#getting-set-up-github"><i class="fa fa-check"></i><b>1.3.1</b> Getting set up: GitHub</a></li>
<li class="chapter" data-level="1.3.2" data-path="tools.html"><a href="tools.html#getting-set-up-git"><i class="fa fa-check"></i><b>1.3.2</b> Getting set up: git</a></li>
<li class="chapter" data-level="1.3.3" data-path="tools.html"><a href="tools.html#introduce-yourself-to-git"><i class="fa fa-check"></i><b>1.3.3</b> Introduce yourself to git</a></li>
<li class="chapter" data-level="1.3.4" data-path="tools.html"><a href="tools.html#optional-install-a-git-client"><i class="fa fa-check"></i><b>1.3.4</b> Optional: Install a git client</a></li>
<li class="chapter" data-level="1.3.5" data-path="tools.html"><a href="tools.html#git-and-github"><i class="fa fa-check"></i><b>1.3.5</b> Git and Github</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="tools.html"><a href="tools.html#latex"><i class="fa fa-check"></i><b>1.4</b> LaTeX</a></li>
<li class="chapter" data-level="1.5" data-path="tools.html"><a href="tools.html#easy-extra-setup-script"><i class="fa fa-check"></i><b>1.5</b> Easy Extra Setup Script</a></li>
<li class="chapter" data-level="1.6" data-path="tools.html"><a href="tools.html#topic-sequencing"><i class="fa fa-check"></i><b>1.6</b> Topic Sequencing</a></li>
<li class="chapter" data-level="1.7" data-path="tools.html"><a href="tools.html#using-version-control"><i class="fa fa-check"></i><b>1.7</b> Using Version Control</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="tools.html"><a href="tools.html#create-a-repository"><i class="fa fa-check"></i><b>1.7.1</b> Create a Repository</a></li>
<li class="chapter" data-level="1.7.2" data-path="tools.html"><a href="tools.html#adding-files"><i class="fa fa-check"></i><b>1.7.2</b> Adding files</a></li>
<li class="chapter" data-level="1.7.3" data-path="tools.html"><a href="tools.html#staging-your-changes"><i class="fa fa-check"></i><b>1.7.3</b> Staging your changes</a></li>
<li class="chapter" data-level="1.7.4" data-path="tools.html"><a href="tools.html#committing-your-changes"><i class="fa fa-check"></i><b>1.7.4</b> Committing your changes</a></li>
<li class="chapter" data-level="1.7.5" data-path="tools.html"><a href="tools.html#pushing-and-pulling"><i class="fa fa-check"></i><b>1.7.5</b> Pushing and Pulling</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="tools.html"><a href="tools.html#references"><i class="fa fa-check"></i><b>1.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro-prog.html"><a href="intro-prog.html"><i class="fa fa-check"></i><b>2</b> Introduction to Statistical Programming</a>
<ul>
<li class="chapter" data-level="" data-path="intro-prog.html"><a href="intro-prog.html#a-quick-note-on-rmarkdown"><i class="fa fa-check"></i>A quick note on Rmarkdown</a></li>
<li class="chapter" data-level="" data-path="intro-prog.html"><a href="intro-prog.html#module-2-objectives"><i class="fa fa-check"></i>Intro to Programming: Module Objectives</a></li>
<li class="chapter" data-level="" data-path="intro-prog.html"><a href="intro-prog.html#definitions"><i class="fa fa-check"></i>Definitions</a></li>
<li class="chapter" data-level="" data-path="intro-prog.html"><a href="intro-prog.html#statistical-programming-languages"><i class="fa fa-check"></i>Statistical Programming Languages</a></li>
<li class="chapter" data-level="2.1" data-path="intro-prog.html"><a href="intro-prog.html#variable-types"><i class="fa fa-check"></i><b>2.1</b> Variable types</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="intro-prog.html"><a href="intro-prog.html#r"><i class="fa fa-check"></i><b>2.1.1</b> R</a></li>
<li class="chapter" data-level="2.1.2" data-path="intro-prog.html"><a href="intro-prog.html#sas-1"><i class="fa fa-check"></i><b>2.1.2</b> SAS</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro-prog.html"><a href="intro-prog.html#data-structures"><i class="fa fa-check"></i><b>2.2</b> Data structures</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="intro-prog.html"><a href="intro-prog.html#homogeneous-data-structures-r-and-sas"><i class="fa fa-check"></i><b>2.2.1</b> Homogeneous data structures (R and SAS)</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro-prog.html"><a href="intro-prog.html#heterogeneous-data-structures"><i class="fa fa-check"></i><b>2.2.2</b> Heterogeneous data structures</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro-prog.html"><a href="intro-prog.html#indexing"><i class="fa fa-check"></i><b>2.2.3</b> Indexing</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro-prog.html"><a href="intro-prog.html#control-structures"><i class="fa fa-check"></i><b>2.3</b> Control structures</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="intro-prog.html"><a href="intro-prog.html#if-statements"><i class="fa fa-check"></i><b>2.3.1</b> If statements</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro-prog.html"><a href="intro-prog.html#loops"><i class="fa fa-check"></i><b>2.3.2</b> Loops</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro-prog.html"><a href="intro-prog.html#overgrown-calculators"><i class="fa fa-check"></i><b>2.4</b> Overgrown Calculators</a></li>
<li class="chapter" data-level="" data-path="intro-prog.html"><a href="intro-prog.html#references-and-links"><i class="fa fa-check"></i>References and Links</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="intro-prog.html"><a href="intro-prog.html#cheat-sheets-and-reference-cards"><i class="fa fa-check"></i><b>2.4.1</b> Cheat Sheets and Reference Cards</a></li>
<li class="chapter" data-level="2.4.2" data-path="intro-prog.html"><a href="intro-prog.html#sas-as-taught-in-other-places"><i class="fa fa-check"></i><b>2.4.2</b> SAS (as taught in other places)</a></li>
<li class="chapter" data-level="2.4.3" data-path="intro-prog.html"><a href="intro-prog.html#r-courses-as-taught-elsewhere-and-textbooks"><i class="fa fa-check"></i><b>2.4.3</b> R courses (as taught elsewhere) and Textbooks</a></li>
<li class="chapter" data-level="2.4.4" data-path="intro-prog.html"><a href="intro-prog.html#combination-of-r-and-sas-courses"><i class="fa fa-check"></i><b>2.4.4</b> Combination of R and SAS courses</a></li>
<li class="chapter" data-level="2.4.5" data-path="intro-prog.html"><a href="intro-prog.html#non-exhaustive-list-of-sources-used-to-aggregate-core-programming-concepts"><i class="fa fa-check"></i><b>2.4.5</b> Non-Exhaustive List of Sources used to aggregate “core programming concepts”:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="organization.html"><a href="organization.html"><i class="fa fa-check"></i><b>3</b> Organization: Packages, Functions, Scripts, and Documents</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#module-3-objectives"><i class="fa fa-check"></i>Organization: Module Objectives</a></li>
<li class="chapter" data-level="3.1" data-path="organization.html"><a href="organization.html#reproducibility"><i class="fa fa-check"></i><b>3.1</b> Reproducibility</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#reproducibility-references-and-reading"><i class="fa fa-check"></i>Reproducibility References and Reading</a></li>
<li class="chapter" data-level="3.1.1" data-path="organization.html"><a href="organization.html#rmarkdown"><i class="fa fa-check"></i><b>3.1.1</b> Markdown and R</a></li>
<li class="chapter" data-level="3.1.2" data-path="organization.html"><a href="organization.html#rmarkdown-with-sas"><i class="fa fa-check"></i><b>3.1.2</b> Rmarkdown with… SAS?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="organization.html"><a href="organization.html#functions-and-modules"><i class="fa fa-check"></i><b>3.2</b> Functions and Modules</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#try-it-out-7"><i class="fa fa-check"></i>Try it out</a></li>
<li class="chapter" data-level="3.2.1" data-path="organization.html"><a href="organization.html#scope"><i class="fa fa-check"></i><b>3.2.1</b> Scope</a></li>
<li class="chapter" data-level="3.2.2" data-path="organization.html"><a href="organization.html#the-pipe"><i class="fa fa-check"></i><b>3.2.2</b> The Pipe</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="organization.html"><a href="organization.html#procs-and-data-steps"><i class="fa fa-check"></i><b>3.3</b> Procs and Data steps</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#try-it-out-9"><i class="fa fa-check"></i>Try It Out</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="organization.html"><a href="organization.html#scripts"><i class="fa fa-check"></i><b>3.4</b> Scripts</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#try-it-out-10"><i class="fa fa-check"></i>Try it out</a></li>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#try-it-out-sas"><i class="fa fa-check"></i>Try it out (SAS)</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="organization.html"><a href="organization.html#packages"><i class="fa fa-check"></i><b>3.5</b> Packages</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#try-it-out-11"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#references-and-links-1"><i class="fa fa-check"></i>References and Links</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reading-data.html"><a href="reading-data.html"><i class="fa fa-check"></i><b>4</b> External Data</a>
<ul>
<li class="chapter" data-level="" data-path="reading-data.html"><a href="reading-data.html#reading-data-module-objectives"><i class="fa fa-check"></i>Reading Data: Module Objectives</a></li>
<li class="chapter" data-level="4.1" data-path="reading-data.html"><a href="reading-data.html#external-data-formats"><i class="fa fa-check"></i><b>4.1</b> External Data Formats</a></li>
<li class="chapter" data-level="4.2" data-path="reading-data.html"><a href="reading-data.html#text-files"><i class="fa fa-check"></i><b>4.2</b> Text Files</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="reading-data.html"><a href="reading-data.html#fixed-width-files"><i class="fa fa-check"></i><b>4.2.1</b> Fixed-width files</a></li>
<li class="chapter" data-level="4.2.2" data-path="reading-data.html"><a href="reading-data.html#delimited-text-files"><i class="fa fa-check"></i><b>4.2.2</b> Delimited Text Files</a></li>
<li class="chapter" data-level="" data-path="reading-data.html"><a href="reading-data.html#try-it-out-12"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="reading-data.html"><a href="reading-data.html#spreadsheets"><i class="fa fa-check"></i><b>4.3</b> Spreadsheets</a>
<ul>
<li class="chapter" data-level="" data-path="reading-data.html"><a href="reading-data.html#try-it-out-13"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="reading-data.html"><a href="reading-data.html#binary-files"><i class="fa fa-check"></i><b>4.4</b> Binary Files</a>
<ul>
<li class="chapter" data-level="" data-path="reading-data.html"><a href="reading-data.html#try-it-out-14"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="reading-data.html"><a href="reading-data.html#databases"><i class="fa fa-check"></i><b>4.5</b> Databases</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="reading-data.html"><a href="reading-data.html#microsoft-access"><i class="fa fa-check"></i><b>4.5.1</b> Microsoft Access</a></li>
<li class="chapter" data-level="4.5.2" data-path="reading-data.html"><a href="reading-data.html#sqlite"><i class="fa fa-check"></i><b>4.5.2</b> SQLite</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="reading-data.html"><a href="reading-data.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>4.6</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="reading-data.html"><a href="reading-data.html#sas-2"><i class="fa fa-check"></i><b>4.6.1</b> SAS</a></li>
<li class="chapter" data-level="4.6.2" data-path="reading-data.html"><a href="reading-data.html#r-1"><i class="fa fa-check"></i><b>4.6.2</b> R</a></li>
<li class="chapter" data-level="4.6.3" data-path="reading-data.html"><a href="reading-data.html#comparison"><i class="fa fa-check"></i><b>4.6.3</b> Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reading-data.html"><a href="reading-data.html#references-and-links-2"><i class="fa fa-check"></i>References and Links</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="manipulating-data.html"><a href="manipulating-data.html"><i class="fa fa-check"></i><b>5</b> Manipulating Data</a>
<ul>
<li class="chapter" data-level="" data-path="manipulating-data.html"><a href="manipulating-data.html#manipulating-data-module-objectives"><i class="fa fa-check"></i>Manipulating Data: Module Objectives</a></li>
<li class="chapter" data-level="5.1" data-path="manipulating-data.html"><a href="manipulating-data.html#tidy-data"><i class="fa fa-check"></i><b>5.1</b> Tidy Data</a></li>
<li class="chapter" data-level="5.2" data-path="manipulating-data.html"><a href="manipulating-data.html#filter-pick-cases-rows-based-on-their-values"><i class="fa fa-check"></i><b>5.2</b> Filter: Pick cases (rows) based on their values</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="manipulating-data.html"><a href="manipulating-data.html#common-filter-tasks"><i class="fa fa-check"></i><b>5.2.1</b> Common Filter() Tasks</a></li>
<li class="chapter" data-level="" data-path="manipulating-data.html"><a href="manipulating-data.html#try-it-out-15"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="manipulating-data.html"><a href="manipulating-data.html#select-pick-columns"><i class="fa fa-check"></i><b>5.3</b> Select: Pick columns</a></li>
<li class="chapter" data-level="5.4" data-path="manipulating-data.html"><a href="manipulating-data.html#mutate-add-and-transform-variables"><i class="fa fa-check"></i><b>5.4</b> Mutate: Add and transform variables</a></li>
<li class="chapter" data-level="5.5" data-path="manipulating-data.html"><a href="manipulating-data.html#summarize"><i class="fa fa-check"></i><b>5.5</b> Summarize</a></li>
<li class="chapter" data-level="5.6" data-path="manipulating-data.html"><a href="manipulating-data.html#group-by-power"><i class="fa fa-check"></i><b>5.6</b> Group By + (?) = Power!</a></li>
<li class="chapter" data-level="5.7" data-path="manipulating-data.html"><a href="manipulating-data.html#other-dplyr-functions-across-relocate"><i class="fa fa-check"></i><b>5.7</b> Other <code>dplyr</code> functions: across, relocate</a></li>
<li class="chapter" data-level="" data-path="manipulating-data.html"><a href="manipulating-data.html#try-it-out-16"><i class="fa fa-check"></i>Try it out</a></li>
<li class="chapter" data-level="" data-path="manipulating-data.html"><a href="manipulating-data.html#references-1"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="transforming-data.html"><a href="transforming-data.html"><i class="fa fa-check"></i><b>6</b> Transforming Data</a>
<ul>
<li class="chapter" data-level="" data-path="transforming-data.html"><a href="transforming-data.html#transforming-data-module-objectives"><i class="fa fa-check"></i>Transforming Data: Module Objectives</a></li>
<li class="chapter" data-level="6.1" data-path="transforming-data.html"><a href="transforming-data.html#identifying-the-problem-messy-data"><i class="fa fa-check"></i><b>6.1</b> Identifying the problem: Messy data</a>
<ul>
<li class="chapter" data-level="" data-path="transforming-data.html"><a href="transforming-data.html#try-it-out-17"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="transforming-data.html"><a href="transforming-data.html#string-operations-creating-new-variables-and-separating-multi-variable-columns"><i class="fa fa-check"></i><b>6.2</b> String operations: Creating new variables and separating multi-variable columns</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="transforming-data.html"><a href="transforming-data.html#basic-string-operations"><i class="fa fa-check"></i><b>6.2.1</b> Basic String Operations</a></li>
<li class="chapter" data-level="6.2.2" data-path="transforming-data.html"><a href="transforming-data.html#regular-expressions"><i class="fa fa-check"></i><b>6.2.2</b> Regular Expressions</a></li>
<li class="chapter" data-level="6.2.3" data-path="transforming-data.html"><a href="transforming-data.html#joining-and-splitting-variables"><i class="fa fa-check"></i><b>6.2.3</b> Joining and Splitting Variables</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="transforming-data.html"><a href="transforming-data.html#pivot-operations"><i class="fa fa-check"></i><b>6.3</b> Pivot operations</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="transforming-data.html"><a href="transforming-data.html#longer"><i class="fa fa-check"></i><b>6.3.1</b> Longer</a></li>
<li class="chapter" data-level="6.3.2" data-path="transforming-data.html"><a href="transforming-data.html#wider"><i class="fa fa-check"></i><b>6.3.2</b> Wider</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="transforming-data.html"><a href="transforming-data.html#relational-data-and-joining-tables"><i class="fa fa-check"></i><b>6.4</b> Relational Data and Joining Tables</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="transforming-data.html"><a href="transforming-data.html#demonstration-dataset-setup"><i class="fa fa-check"></i><b>6.4.1</b> Demonstration dataset setup</a></li>
<li class="chapter" data-level="6.4.2" data-path="transforming-data.html"><a href="transforming-data.html#mutating-joins"><i class="fa fa-check"></i><b>6.4.2</b> Mutating joins</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="transforming-data.html"><a href="transforming-data.html#example-gas-prices-data"><i class="fa fa-check"></i><b>6.5</b> Example: Gas Prices Data</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="transforming-data.html"><a href="transforming-data.html#option-1-manual-formatting-in-excel"><i class="fa fa-check"></i><b>6.5.1</b> Option 1: Manual formatting in Excel</a></li>
<li class="chapter" data-level="6.5.2" data-path="transforming-data.html"><a href="transforming-data.html#option-2-r"><i class="fa fa-check"></i><b>6.5.2</b> Option 2: R</a></li>
<li class="chapter" data-level="6.5.3" data-path="transforming-data.html"><a href="transforming-data.html#option-3-sas"><i class="fa fa-check"></i><b>6.5.3</b> Option 3: SAS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="transforming-data.html"><a href="transforming-data.html#references-2"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>7</b> Principles of Debugging</a>
<ul>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#debugging-module-objectives"><i class="fa fa-check"></i>Debugging: Module Objectives</a></li>
<li class="chapter" data-level="7.1" data-path="debugging.html"><a href="debugging.html#step-1-check-your-spelling."><i class="fa fa-check"></i><b>7.1</b> Step 1: Check your spelling.</a></li>
<li class="chapter" data-level="7.2" data-path="debugging.html"><a href="debugging.html#defensive-programming"><i class="fa fa-check"></i><b>7.2</b> Defensive Programming</a></li>
<li class="chapter" data-level="7.3" data-path="debugging.html"><a href="debugging.html#general-debugging-strategies"><i class="fa fa-check"></i><b>7.3</b> General Debugging Strategies</a></li>
<li class="chapter" data-level="7.4" data-path="debugging.html"><a href="debugging.html#debugging-tools-in-r"><i class="fa fa-check"></i><b>7.4</b> Debugging Tools in R</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="debugging.html"><a href="debugging.html#low-tech-debugging-with-print-and-other-tools"><i class="fa fa-check"></i><b>7.4.1</b> Low tech debugging with print() and other tools</a></li>
<li class="chapter" data-level="7.4.2" data-path="debugging.html"><a href="debugging.html#after-an-error-has-occurred---traceback"><i class="fa fa-check"></i><b>7.4.2</b> After an error has occurred - <code>traceback()</code></a></li>
<li class="chapter" data-level="7.4.3" data-path="debugging.html"><a href="debugging.html#browser---debugging-your-own-code-interactively"><i class="fa fa-check"></i><b>7.4.3</b> <code>browser()</code> - debugging your own code, interactively</a></li>
<li class="chapter" data-level="7.4.4" data-path="debugging.html"><a href="debugging.html#debug---the-general-debugging-workhorse"><i class="fa fa-check"></i><b>7.4.4</b> <code>debug()</code> - the general debugging workhorse</a></li>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#try-it-out-23"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="debugging.html"><a href="debugging.html#debugging-tools-in-sas"><i class="fa fa-check"></i><b>7.5</b> Debugging Tools in SAS</a></li>
<li class="chapter" data-level="7.6" data-path="debugging.html"><a href="debugging.html#minimal-working-examples"><i class="fa fa-check"></i><b>7.6</b> Minimal Working Examples</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="debugging.html"><a href="debugging.html#example-mwes"><i class="fa fa-check"></i><b>7.6.1</b> Example: MWEs</a></li>
<li class="chapter" data-level="7.6.2" data-path="debugging.html"><a href="debugging.html#try-it-out-24"><i class="fa fa-check"></i><b>7.6.2</b> Try It Out</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#references-3"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-vis-intro.html"><a href="data-vis-intro.html"><i class="fa fa-check"></i><b>8</b> Introduction to Data Visualization</a>
<ul>
<li class="chapter" data-level="" data-path="data-vis-intro.html"><a href="data-vis-intro.html#visualization-module-objectives"><i class="fa fa-check"></i>Visualization: Module Objectives</a></li>
<li class="chapter" data-level="8.1" data-path="data-vis-intro.html"><a href="data-vis-intro.html#why-do-we-create-graphics"><i class="fa fa-check"></i><b>8.1</b> Why do we create graphics?</a></li>
<li class="chapter" data-level="8.2" data-path="data-vis-intro.html"><a href="data-vis-intro.html#general-approaches-to-creating-graphics"><i class="fa fa-check"></i><b>8.2</b> General approaches to creating graphics</a></li>
<li class="chapter" data-level="8.3" data-path="data-vis-intro.html"><a href="data-vis-intro.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>8.3</b> The Grammar of Graphics</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-vis-intro.html"><a href="data-vis-intro.html#demonstration-aesthetic-mappings-and-basic-plots"><i class="fa fa-check"></i><b>8.3.1</b> Demonstration: Aesthetic Mappings and Basic Plots</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-vis-intro.html"><a href="data-vis-intro.html#syntax-and-general-structure-layers"><i class="fa fa-check"></i><b>8.3.2</b> Syntax and General Structure: Layers</a></li>
<li class="chapter" data-level="8.3.3" data-path="data-vis-intro.html"><a href="data-vis-intro.html#statistics-and-different-types-of-plots"><i class="fa fa-check"></i><b>8.3.3</b> Statistics and Different Types of Plots</a></li>
<li class="chapter" data-level="8.3.4" data-path="data-vis-intro.html"><a href="data-vis-intro.html#small-multiples"><i class="fa fa-check"></i><b>8.3.4</b> Small Multiples</a></li>
<li class="chapter" data-level="" data-path="data-vis-intro.html"><a href="data-vis-intro.html#try-it-out-28"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-vis-intro.html"><a href="data-vis-intro.html#good-charts"><i class="fa fa-check"></i><b>8.4</b> Good charts</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="data-vis-intro.html"><a href="data-vis-intro.html#perceptual-and-cognitive-factors"><i class="fa fa-check"></i><b>8.4.1</b> Perceptual and Cognitive Factors</a></li>
<li class="chapter" data-level="8.4.2" data-path="data-vis-intro.html"><a href="data-vis-intro.html#general-guidelines-for-accuracy"><i class="fa fa-check"></i><b>8.4.2</b> General guidelines for accuracy</a></li>
<li class="chapter" data-level="8.4.3" data-path="data-vis-intro.html"><a href="data-vis-intro.html#how-do-we-know"><i class="fa fa-check"></i><b>8.4.3</b> How do we know?</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-vis-intro.html"><a href="data-vis-intro.html#other-things-worth-exploring-and-future-expansions-for-this-chapter"><i class="fa fa-check"></i><b>8.5</b> Other things worth exploring (and future expansions for this chapter)</a></li>
<li class="chapter" data-level="" data-path="data-vis-intro.html"><a href="data-vis-intro.html#references-4"><i class="fa fa-check"></i>References</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="data-vis-intro.html"><a href="data-vis-intro.html#motivation"><i class="fa fa-check"></i><b>8.5.1</b> Motivation</a></li>
<li class="chapter" data-level="8.5.2" data-path="data-vis-intro.html"><a href="data-vis-intro.html#r-graphics"><i class="fa fa-check"></i><b>8.5.2</b> R graphics</a></li>
<li class="chapter" data-level="8.5.3" data-path="data-vis-intro.html"><a href="data-vis-intro.html#sas-graphics"><i class="fa fa-check"></i><b>8.5.3</b> SAS graphics</a></li>
<li class="chapter" data-level="8.5.4" data-path="data-vis-intro.html"><a href="data-vis-intro.html#types-of-charts-and-chart-styling"><i class="fa fa-check"></i><b>8.5.4</b> Types of Charts and Chart Styling</a></li>
<li class="chapter" data-level="8.5.5" data-path="data-vis-intro.html"><a href="data-vis-intro.html#other-graphics-packages"><i class="fa fa-check"></i><b>8.5.5</b> Other Graphics packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>9</b> Simulation and Reproducibility</a>
<ul>
<li class="chapter" data-level="" data-path="simulation.html"><a href="simulation.html#simulation-module-objectives"><i class="fa fa-check"></i>Simulation: Module Objectives</a></li>
<li class="chapter" data-level="9.1" data-path="simulation.html"><a href="simulation.html#pseudorandom-number-generation"><i class="fa fa-check"></i><b>9.1</b> Pseudorandom Number Generation</a></li>
<li class="chapter" data-level="9.2" data-path="simulation.html"><a href="simulation.html#built-in-simulations-from-distributions"><i class="fa fa-check"></i><b>9.2</b> Built-in simulations from distributions</a>
<ul>
<li class="chapter" data-level="" data-path="simulation.html"><a href="simulation.html#try-it-out-30"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="simulation.html"><a href="simulation.html#simulation-to-test-model-assumptions"><i class="fa fa-check"></i><b>9.3</b> Simulation to test model assumptions</a>
<ul>
<li class="chapter" data-level="" data-path="simulation.html"><a href="simulation.html#try-it-out-31"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="simulation.html"><a href="simulation.html#monte-carlo-methods"><i class="fa fa-check"></i><b>9.4</b> Monte Carlo methods</a>
<ul>
<li class="chapter" data-level="" data-path="simulation.html"><a href="simulation.html#try-it-out-32"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="simulation.html"><a href="simulation.html#references-5"><i class="fa fa-check"></i><b>9.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="docs-reports.html"><a href="docs-reports.html"><i class="fa fa-check"></i><b>10</b> Documents and Reports</a>
<ul>
<li class="chapter" data-level="" data-path="docs-reports.html"><a href="docs-reports.html#documents-and-reports-module-objectives"><i class="fa fa-check"></i>Documents and Reports: Module Objectives</a></li>
<li class="chapter" data-level="10.1" data-path="docs-reports.html"><a href="docs-reports.html#literate-programming-knitr-and-rmarkdown"><i class="fa fa-check"></i><b>10.1</b> Literate Programming, <code>knitr</code>, and <code>rmarkdown</code></a></li>
<li class="chapter" data-level="10.2" data-path="docs-reports.html"><a href="docs-reports.html#a-very-brief-introduction-to-latex"><i class="fa fa-check"></i><b>10.2</b> A Very Brief Introduction to LaTeX</a>
<ul>
<li class="chapter" data-level="" data-path="docs-reports.html"><a href="docs-reports.html#try-it-out-33"><i class="fa fa-check"></i>Try it out</a></li>
<li class="chapter" data-level="10.2.1" data-path="docs-reports.html"><a href="docs-reports.html#knitr"><i class="fa fa-check"></i><b>10.2.1</b> Knitr</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="docs-reports.html"><a href="docs-reports.html#slides"><i class="fa fa-check"></i><b>10.3</b> Slides</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="docs-reports.html"><a href="docs-reports.html#beamer-latex-and-knitr"><i class="fa fa-check"></i><b>10.3.1</b> Beamer (LaTeX) and knitr</a></li>
<li class="chapter" data-level="10.3.2" data-path="docs-reports.html"><a href="docs-reports.html#html-slides"><i class="fa fa-check"></i><b>10.3.2</b> HTML slides</a></li>
<li class="chapter" data-level="" data-path="docs-reports.html"><a href="docs-reports.html#try-it-out-35"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="docs-reports.html"><a href="docs-reports.html#posters"><i class="fa fa-check"></i><b>10.4</b> Posters</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="docs-reports.html"><a href="docs-reports.html#latex-1"><i class="fa fa-check"></i><b>10.4.1</b> LaTeX</a></li>
<li class="chapter" data-level="10.4.2" data-path="docs-reports.html"><a href="docs-reports.html#posterdown"><i class="fa fa-check"></i><b>10.4.2</b> Posterdown</a></li>
<li class="chapter" data-level="10.4.3" data-path="docs-reports.html"><a href="docs-reports.html#pagedown"><i class="fa fa-check"></i><b>10.4.3</b> Pagedown</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="docs-reports.html"><a href="docs-reports.html#resumecv"><i class="fa fa-check"></i><b>10.5</b> Resume/CV</a></li>
<li class="chapter" data-level="10.6" data-path="docs-reports.html"><a href="docs-reports.html#using-github-pages"><i class="fa fa-check"></i><b>10.6</b> Using Github Pages</a></li>
<li class="chapter" data-level="10.7" data-path="docs-reports.html"><a href="docs-reports.html#references-6"><i class="fa fa-check"></i><b>10.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html"><i class="fa fa-check"></i><b>11</b> Animated and Interactive Graphics</a>
<ul>
<li class="chapter" data-level="" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#animated-and-interactive-graphics-module-objectives"><i class="fa fa-check"></i>Animated and Interactive Graphics: Module Objectives</a></li>
<li class="chapter" data-level="11.1" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#plotly"><i class="fa fa-check"></i><b>11.1</b> Plotly</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#ggplotly-ggplot2-to-plotly-conversions"><i class="fa fa-check"></i><b>11.1.1</b> <code>ggplotly</code>: ggplot2 to plotly conversions</a></li>
<li class="chapter" data-level="11.1.2" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#plot_ly-like-base-plotting-but-interactive"><i class="fa fa-check"></i><b>11.1.2</b> <code>plot_ly</code>: Like base plotting, but interactive!</a></li>
<li class="chapter" data-level="11.1.3" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#animation"><i class="fa fa-check"></i><b>11.1.3</b> Animation</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#leaflet-maps"><i class="fa fa-check"></i><b>11.2</b> Leaflet maps</a>
<ul>
<li class="chapter" data-level="" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#try-it-out-39"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#shiny"><i class="fa fa-check"></i><b>11.3</b> Shiny</a></li>
<li class="chapter" data-level="11.4" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#general-references"><i class="fa fa-check"></i><b>11.4</b> General References</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#other-interactive-tools"><i class="fa fa-check"></i><b>11.4.1</b> Other interactive tools</a></li>
<li class="chapter" data-level="11.4.2" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#debugging-1"><i class="fa fa-check"></i><b>11.4.2</b> Debugging</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html"><i class="fa fa-check"></i><b>12</b> Lists, Nested Lists, and Functional Programming</a>
<ul>
<li class="chapter" data-level="12.1" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#review-lists-and-vectors"><i class="fa fa-check"></i><b>12.1</b> Review: Lists and Vectors</a></li>
<li class="chapter" data-level="12.2" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#introduction-to-map"><i class="fa fa-check"></i><b>12.2</b> Introduction to <code>map</code></a></li>
<li class="chapter" data-level="12.3" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#creating-and-using-list-columns"><i class="fa fa-check"></i><b>12.3</b> Creating (and Using) List-columns</a></li>
<li class="chapter" data-level="12.4" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#ways-to-use-map"><i class="fa fa-check"></i><b>12.4</b> Ways to use <code>map</code></a>
<ul>
<li class="chapter" data-level="" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#try-it-out-40"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#beyond-map-functions-with-multiple-inputs"><i class="fa fa-check"></i><b>12.5</b> Beyond <code>map</code>: Functions with multiple inputs</a>
<ul>
<li class="chapter" data-level="" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#try-it-out-41"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#purrr-references"><i class="fa fa-check"></i>Purrr References</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="high-performance-computing.html"><a href="high-performance-computing.html"><i class="fa fa-check"></i><b>13</b> High Performance Computing</a>
<ul>
<li class="chapter" data-level="" data-path="high-performance-computing.html"><a href="high-performance-computing.html#hpc-references"><i class="fa fa-check"></i>HPC References</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="tidy-models.html"><a href="tidy-models.html"><i class="fa fa-check"></i><b>14</b> Tidy Models</a></li>
<li class="chapter" data-level="15" data-path="spatial-packages.html"><a href="spatial-packages.html"><i class="fa fa-check"></i><b>15</b> Spatial packages</a>
<ul>
<li class="chapter" data-level="" data-path="spatial-packages.html"><a href="spatial-packages.html#references-7"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="common-problems-and-general-computing-topics.html"><a href="common-problems-and-general-computing-topics.html"><i class="fa fa-check"></i><b>16</b> Common Problems and General Computing Topics</a>
<ul>
<li class="chapter" data-level="16.1" data-path="common-problems-and-general-computing-topics.html"><a href="common-problems-and-general-computing-topics.html#file-paths-working-directories-and-reproducibility"><i class="fa fa-check"></i><b>16.1</b> File Paths, Working Directories, and Reproducibility</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="common-problems-and-general-computing-topics.html"><a href="common-problems-and-general-computing-topics.html#file-paths"><i class="fa fa-check"></i><b>16.1.1</b> File paths</a></li>
<li class="chapter" data-level="16.1.2" data-path="common-problems-and-general-computing-topics.html"><a href="common-problems-and-general-computing-topics.html#working-directory"><i class="fa fa-check"></i><b>16.1.2</b> Working Directory</a></li>
<li class="chapter" data-level="16.1.3" data-path="common-problems-and-general-computing-topics.html"><a href="common-problems-and-general-computing-topics.html#reproducibility-1"><i class="fa fa-check"></i><b>16.1.3</b> Reproducibility</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="other-resources-articles-and-food-for-thought.html"><a href="other-resources-articles-and-food-for-thought.html"><i class="fa fa-check"></i><b>17</b> Other Resources, Articles, and Food for Thought</a>
<ul>
<li class="chapter" data-level="17.1" data-path="other-resources-articles-and-food-for-thought.html"><a href="other-resources-articles-and-food-for-thought.html#comparing-languages"><i class="fa fa-check"></i><b>17.1</b> Comparing Languages</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-8.html"><a href="references-8.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stat 850: Computing Tools for Statisticians</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simulation" class="section level1" number="9">
<h1><span class="header-section-number">Module 9</span> Simulation and Reproducibility</h1>
<div id="simulation-module-objectives" class="section level2 unnumbered">
<h2>Simulation: Module Objectives</h2>
<ul>
<li>Understand how pseudorandom number generation works and necessary conditions for reproducibility</li>
<li>Be able to implement a simulation for a specific task, process, or model</li>
</ul>
<p>Simulation is an extremely important part of computational statistics. Bayesian statistics, in particular, relies on Markov Chain Monte Carlo (MCMC) to get results from even the most basic of models. In this module, we’re going to touch on a few foundational pieces of simulation in computing, and you will get more exposure to simulation-based methods in other courses down the line.</p>
</div>
<div id="pseudorandom-number-generation" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Pseudorandom Number Generation</h2>
<p>Computers are almost entirely deterministic, which makes it very difficult to come up with “random” numbers. In addition to the deterministic nature of computing, it’s also somewhat important to be able to run the same code and get the same results every time, which isn’t possible if you rely on truly random numbers.</p>
<p>Historically, <strong>pseudorandom</strong> numbers were generated using <a href="https://en.wikipedia.org/wiki/Linear_congruential_generator">linear congruential generators</a> (LCGs). These algorithms aren’t typically used anymore, but they provide a good demonstration of how one might go about generating numbers that seem “random” but are actually deterministic. LCGs use modular arithmetic: <span class="math inline">\(X_{n+1} = (aX_n + c) \mod m\)</span> where <span class="math inline">\(X_0\)</span> is the start value (the seed), <span class="math inline">\(a\)</span> is the multiplier, <span class="math inline">\(c\)</span> is the increment, and <span class="math inline">\(m\)</span> is the modulus. When using a LCG, the user generally specifies only the seed.</p>
<div class="figure">
<img src="https://upload.wikimedia.org/wikipedia/commons/a/a3/Lcg_3d.gif" alt="" />
<p class="caption">LCGs generate numbers which at first appear random, but once sufficiently many numbers have been generated, it is clear that there is some structure in the data. (Image from Wikimedia)</p>
</div>
<p>The important thing to note here is that if you specify the same generator values (a, c, m, and <span class="math inline">\(X_0\)</span>), you will always get the same series of numbers. Since a, c, m are usually specified by the implementation, as a user, you should expect that if you specify the same seed, you will get the same results, every time.</p>
<details>
<summary>
It is critically important to set your seed if you want the results to be reproducible and you are using an algorithm that depends on randomness.<a href="#fn35" class="footnote-ref" id="fnref35"><sup>35</sup></a>
</summary>
<p>Once you set your seed, the remaining results will only be reproducible if you generate the same set of random numbers every time.</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="simulation.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">342512</span>)</span>
<span id="cb470-2"><a href="simulation.html#cb470-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-3"><a href="simulation.html#cb470-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get 10 numbers after the seed is set</span></span>
<span id="cb470-4"><a href="simulation.html#cb470-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">10</span>)</span>
<span id="cb470-5"><a href="simulation.html#cb470-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="dv">65</span> <span class="dv">51</span> <span class="dv">64</span> <span class="dv">21</span> <span class="dv">45</span> <span class="dv">53</span>  <span class="dv">3</span>  <span class="dv">6</span> <span class="dv">43</span>  <span class="dv">8</span></span>
<span id="cb470-6"><a href="simulation.html#cb470-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-7"><a href="simulation.html#cb470-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute something else that depends on randomness</span></span>
<span id="cb470-8"><a href="simulation.html#cb470-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">rnorm</span>(<span class="dv">50</span>))</span>
<span id="cb470-9"><a href="simulation.html#cb470-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">0.1095366</span></span>
<span id="cb470-10"><a href="simulation.html#cb470-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-11"><a href="simulation.html#cb470-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Get 10 more numbers</span></span>
<span id="cb470-12"><a href="simulation.html#cb470-12" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">10</span>)</span>
<span id="cb470-13"><a href="simulation.html#cb470-13" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>]  <span class="dv">4</span> <span class="dv">57</span> <span class="dv">69</span> <span class="dv">10</span> <span class="dv">76</span> <span class="dv">15</span> <span class="dv">67</span>  <span class="dv">1</span>  <span class="dv">3</span> <span class="dv">91</span></span></code></pre></div>
<p>Compare the results above to these results:</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="simulation.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">342512</span>)</span>
<span id="cb471-2"><a href="simulation.html#cb471-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-3"><a href="simulation.html#cb471-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get 10 numbers after the seed is set</span></span>
<span id="cb471-4"><a href="simulation.html#cb471-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">10</span>)</span>
<span id="cb471-5"><a href="simulation.html#cb471-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="dv">65</span> <span class="dv">51</span> <span class="dv">64</span> <span class="dv">21</span> <span class="dv">45</span> <span class="dv">53</span>  <span class="dv">3</span>  <span class="dv">6</span> <span class="dv">43</span>  <span class="dv">8</span></span>
<span id="cb471-6"><a href="simulation.html#cb471-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-7"><a href="simulation.html#cb471-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute something else that depends on randomness</span></span>
<span id="cb471-8"><a href="simulation.html#cb471-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">rnorm</span>(<span class="dv">30</span>))</span>
<span id="cb471-9"><a href="simulation.html#cb471-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">0.1936645</span></span>
<span id="cb471-10"><a href="simulation.html#cb471-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-11"><a href="simulation.html#cb471-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Get 10 more numbers</span></span>
<span id="cb471-12"><a href="simulation.html#cb471-12" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">10</span>)</span>
<span id="cb471-13"><a href="simulation.html#cb471-13" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>]  <span class="dv">49</span>  <span class="dv">37</span>   <span class="dv">6</span>  <span class="dv">34</span>   <span class="dv">9</span>   <span class="dv">3</span> <span class="dv">100</span>  <span class="dv">43</span>   <span class="dv">7</span>  <span class="dv">29</span></span></code></pre></div>
Notice how the results have changed? To make my documents more reproducible, I will sometimes set a new seed at the start of an important chunk, even if I’ve already set the seed earlier. This introduces certain “fixed points” where results won’t change immediately after I’ve re-set the seed. This is particularly important when I’m generating bootstrap estimates, fitting models, or simulating data for graphics experiments.
</details>
<p>Pick your seed in any way you want. I tend to just randomly wiggle my fingers over the number keys, but I have also heard of people using the date in yyyymmdd format, favorite people’s birthdays, the current time in hhmmss format… basically, you can use anything.</p>
</div>
<div id="built-in-simulations-from-distributions" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Built-in simulations from distributions</h2>
Often, we can get away with just simulating data from a known distribution. As both R and SAS are meant for statistical computing, this is extremely easy by design.
<details>
<summary>
In R
</summary>
<p>You can see the various distribution options using <code>?Distributions</code>. In general, <code>dxxx</code> is the PDF/PMF, <code>pxxx</code> is the CDF, <code>qxxx</code> is the quantile function, and <code>rxxx</code> gives you random nubmers generated from the distribution. (<code>xxx</code>, obviously, is whatever distribution you’re looking to use.)</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="simulation.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb472-2"><a href="simulation.html#cb472-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb472-3"><a href="simulation.html#cb472-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb472-4"><a href="simulation.html#cb472-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb472-5"><a href="simulation.html#cb472-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">109025879</span>)</span>
<span id="cb472-6"><a href="simulation.html#cb472-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-7"><a href="simulation.html#cb472-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb472-8"><a href="simulation.html#cb472-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">norm =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>),</span>
<span id="cb472-9"><a href="simulation.html#cb472-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="fu">rgamma</span>(<span class="dv">500</span>, <span class="at">shape =</span> <span class="dv">3</span>, <span class="at">scale =</span> <span class="dv">1</span>),</span>
<span id="cb472-10"><a href="simulation.html#cb472-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp =</span> <span class="fu">rexp</span>(<span class="dv">500</span>, <span class="at">rate =</span> <span class="dv">1</span>), <span class="co"># R uses a exp(-ax) </span></span>
<span id="cb472-11"><a href="simulation.html#cb472-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">t =</span> <span class="fu">rt</span>(<span class="dv">500</span>, <span class="at">df =</span> <span class="dv">5</span>),</span>
<span id="cb472-12"><a href="simulation.html#cb472-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chisq =</span> <span class="fu">rchisq</span>(<span class="dv">500</span>, <span class="dv">5</span>)</span>
<span id="cb472-13"><a href="simulation.html#cb472-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb472-14"><a href="simulation.html#cb472-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">names_to =</span> <span class="st">&quot;dist&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb472-15"><a href="simulation.html#cb472-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>dist, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<img src="image/unnamed-chunk-18-1.png" width="2100" />
</details>
<details>
<summary>
In SAS
</summary>
<p>You can see the <a href="https://documentation.sas.com/?docsetId=lefunctionsref&amp;docsetTarget=p0fpeei0opypg8n1b06qe4r040lv.htm&amp;docsetVersion=9.4&amp;locale=en">various distribution options</a> in the RAND documentation.</p>
<pre class="sashtml"><code>6          %let N=500; /* size of sample */
7          


8          DATA sample;
9          call streaminit(12532);
10         DO i = 1 to &amp;N; /* &amp;N is the value of the macro variable defined
10       !  above */
11           id = i;
12           norm = rand(&quot;Normal&quot;, 0, 1);
13           gamma = rand(&quot;Gamma&quot;, 3, 1);
14           exp = rand(&quot;Exponential&quot;, 1); /* SAS uses 1/a exp(-x/a) */
15           t = rand(&quot;T&quot;, 5);
16           chisq = rand(&quot;Chisq&quot;, 5);
17           OUTPUT;
18         END;
19         RUN;

NOTE: The data set WORK.SAMPLE has 0 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

20         
21         PROC TRANSPOSE data=sample out=longsample
22           (rename=(COL1 = value)) /* rename output variable
22       ! (&#39;values_to&#39;) */
23           NAME = dist /* where the column names go (&#39;names_to&#39;) */
24         ;
25           BY id;
26           VAR norm gamma exp t chisq;
27         RUN;

WARNING: The variable COL1 in the DROP, KEEP, or RENAME list has never 
         been referenced.
NOTE: There were 0 observations read from the data set WORK.SAMPLE.
NOTE: The data set WORK.LONGSAMPLE has 5 observations and 2 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

28         
29         PROC SGPANEL data=longsample;
30         PANELBY dist / COLUMNS = 5 UNISCALE = ROW NOVARNAME;
31           DENSITY value / TYPE = KERNEL;
ERROR: Variable VALUE not found.
32         RUN;

NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SGPANEL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 4,5,7,11,12,13,16,17,18,19,24,25,27,28,29,
                               30,33,34,35,36,37,38,42.</code></pre>
</details>
<div id="try-it-out-30" class="section level3 unnumbered tryitout">
<h3>Try it out</h3>
<p>Generate variables x and y, where x is a sequence from -10 to 10 and y is equal to <span class="math inline">\(x + \epsilon\)</span>, <span class="math inline">\(\epsilon \sim N(0, 1)\)</span>. Fit a linear regression to your simulated data (in R, <code>lm</code>, in SAS, <code>PROC REG</code>).</p>
<details>
<summary>
In R
</summary>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="simulation.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20572983</span>)</span>
<span id="cb474-2"><a href="simulation.html#cb474-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>, .<span class="dv">1</span>), </span>
<span id="cb474-3"><a href="simulation.html#cb474-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x)))</span>
<span id="cb474-4"><a href="simulation.html#cb474-4" aria-hidden="true" tabindex="-1"></a>regression <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb474-5"><a href="simulation.html#cb474-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regression)</span>
<span id="cb474-6"><a href="simulation.html#cb474-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-7"><a href="simulation.html#cb474-7" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb474-8"><a href="simulation.html#cb474-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb474-9"><a href="simulation.html#cb474-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-10"><a href="simulation.html#cb474-10" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb474-11"><a href="simulation.html#cb474-11" aria-hidden="true" tabindex="-1"></a>     Min       1Q   Median       3Q      Max </span>
<span id="cb474-12"><a href="simulation.html#cb474-12" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">3.14575</span> <span class="sc">-</span><span class="fl">0.70986</span>  <span class="fl">0.03186</span>  <span class="fl">0.65429</span>  <span class="fl">2.40305</span> </span>
<span id="cb474-13"><a href="simulation.html#cb474-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-14"><a href="simulation.html#cb474-14" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb474-15"><a href="simulation.html#cb474-15" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb474-16"><a href="simulation.html#cb474-16" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="sc">-</span><span class="fl">0.01876</span>    <span class="fl">0.06869</span>  <span class="sc">-</span><span class="fl">0.273</span>    <span class="fl">0.785</span>    </span>
<span id="cb474-17"><a href="simulation.html#cb474-17" aria-hidden="true" tabindex="-1"></a>x            <span class="fl">0.99230</span>    <span class="fl">0.01184</span>  <span class="fl">83.823</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb474-18"><a href="simulation.html#cb474-18" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb474-19"><a href="simulation.html#cb474-19" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb474-20"><a href="simulation.html#cb474-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-21"><a href="simulation.html#cb474-21" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.9738</span> on <span class="dv">199</span> degrees of freedom</span>
<span id="cb474-22"><a href="simulation.html#cb474-22" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.9725</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.9723</span> </span>
<span id="cb474-23"><a href="simulation.html#cb474-23" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span>  <span class="dv">7026</span> on <span class="dv">1</span> and <span class="dv">199</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
</details>
<details>
<summary>
In SAS
</summary>
<pre class="sashtml"><code>

6          DATA tmp;
7          call streaminit(20572983);
8          DO i = -10 to 10 by .1;
9            x = i;
10           y = x + rand(&quot;Normal&quot;);
11           OUTPUT;
12         END;
13         RUN;

NOTE: The data set WORK.TMP has 0 observations and 3 variables.
WARNING: Data set WORK.TMP was not replaced because this step was stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

14         
15         PROC REG data = tmp;
16         MODEL y = x;
ERROR: Variable Y not found.
17         RUN;

WARNING: RUN statement ignored due to previous errors. Submit QUIT; to 
         terminate the procedure.
NOTE: PROCEDURE REG used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
NOTE: The SAS System stopped processing this step because of errors.

ERROR: Errors printed on pages 4,5,7,11,12,13,16,17,18,19,24,25,27,28,29,
                               30,33,34,35,36,37,38,43.</code></pre>
</details>
</div>
</div>
<div id="simulation-to-test-model-assumptions" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Simulation to test model assumptions</h2>
<p>One of the more powerful ways to use simulation in practice is to use it to test the assumptions of your model. Suppose, for instance, that your data are highly skewed, but you want to use a method that assumes normally distributed errors. How bad will your results be? Where can you trust the results, and where should you be cautious?</p>
<details>
<summary>
Example: Confidence Interval coverage rates
</summary>
<p>Suppose, for instance, that we have a lognormal distribution (highly skewed) and we want to compute a 95% confidence interval for the mean of our data.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="simulation.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">40295023</span>)</span>
<span id="cb476-2"><a href="simulation.html#cb476-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-3"><a href="simulation.html#cb476-3" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb476-4"><a href="simulation.html#cb476-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">each =</span> <span class="dv">25</span>), <span class="co"># generate 100 samples of 25 points each</span></span>
<span id="cb476-5"><a href="simulation.html#cb476-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ln_x =</span> <span class="fu">rnorm</span>(<span class="dv">25</span><span class="sc">*</span><span class="dv">100</span>), <span class="co"># generate the normal deviates</span></span>
<span id="cb476-6"><a href="simulation.html#cb476-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">exp</span>(ln_x), <span class="co"># transform into lognormal deviates</span></span>
<span id="cb476-7"><a href="simulation.html#cb476-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb476-8"><a href="simulation.html#cb476-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this creates a 100-row data frame, with one row for each id. </span></span>
<span id="cb476-9"><a href="simulation.html#cb476-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the columns x, ln_x are stored in the data list-column as a tibble.</span></span>
<span id="cb476-10"><a href="simulation.html#cb476-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(x, ln_x))</span>
<span id="cb476-11"><a href="simulation.html#cb476-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb476-12"><a href="simulation.html#cb476-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sim)</span>
<span id="cb476-13"><a href="simulation.html#cb476-13" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 2</span></span>
<span id="cb476-14"><a href="simulation.html#cb476-14" aria-hidden="true" tabindex="-1"></a>     id data                 </span>
<span id="cb476-15"><a href="simulation.html#cb476-15" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>list<span class="sc">&gt;</span>               </span>
<span id="cb476-16"><a href="simulation.html#cb476-16" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="dv">1</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">25</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb476-17"><a href="simulation.html#cb476-17" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="dv">2</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">25</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb476-18"><a href="simulation.html#cb476-18" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     <span class="dv">3</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">25</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb476-19"><a href="simulation.html#cb476-19" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     <span class="dv">4</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">25</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb476-20"><a href="simulation.html#cb476-20" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     <span class="dv">5</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">25</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb476-21"><a href="simulation.html#cb476-21" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="dv">6</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">25</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb476-22"><a href="simulation.html#cb476-22" aria-hidden="true" tabindex="-1"></a>sim<span class="sc">$</span>data[[<span class="dv">1</span>]]</span>
<span id="cb476-23"><a href="simulation.html#cb476-23" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 25 x 2</span></span>
<span id="cb476-24"><a href="simulation.html#cb476-24" aria-hidden="true" tabindex="-1"></a>       x    ln_x</span>
<span id="cb476-25"><a href="simulation.html#cb476-25" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb476-26"><a href="simulation.html#cb476-26" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> <span class="fl">0.310</span> <span class="sc">-</span><span class="fl">1.17</span>  </span>
<span id="cb476-27"><a href="simulation.html#cb476-27" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> <span class="fl">0.622</span> <span class="sc">-</span><span class="fl">0.475</span> </span>
<span id="cb476-28"><a href="simulation.html#cb476-28" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> <span class="fl">0.303</span> <span class="sc">-</span><span class="fl">1.19</span>  </span>
<span id="cb476-29"><a href="simulation.html#cb476-29" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> <span class="fl">1.05</span>   <span class="fl">0.0525</span></span>
<span id="cb476-30"><a href="simulation.html#cb476-30" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> <span class="fl">0.529</span> <span class="sc">-</span><span class="fl">0.636</span> </span>
<span id="cb476-31"><a href="simulation.html#cb476-31" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> <span class="fl">1.09</span>   <span class="fl">0.0891</span></span>
<span id="cb476-32"><a href="simulation.html#cb476-32" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> <span class="fl">1.97</span>   <span class="fl">0.676</span> </span>
<span id="cb476-33"><a href="simulation.html#cb476-33" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> <span class="fl">8.94</span>   <span class="fl">2.19</span>  </span>
<span id="cb476-34"><a href="simulation.html#cb476-34" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> <span class="fl">0.598</span> <span class="sc">-</span><span class="fl">0.514</span> </span>
<span id="cb476-35"><a href="simulation.html#cb476-35" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> <span class="fl">0.183</span> <span class="sc">-</span><span class="fl">1.70</span>  </span>
<span id="cb476-36"><a href="simulation.html#cb476-36" aria-hidden="true" tabindex="-1"></a><span class="co"># … with 15 more rows</span></span></code></pre></div>
<p>You want to assess the coverage probability of a confidence interval computed under two different modeling scenarios:</p>
<ol style="list-style-type: decimal">
<li>Working with the log-transformed values, ln(x), and then transform the computed interval back</li>
<li>Working with the raw values, x, compute an interval assuming the data are symmetric, essentially treating the lognormal distribution as if it were normal.</li>
</ol>
<p>Under scenario 1, our theoretical interval should be exp((-1.96/5, 1.96/5)) (because <span class="math inline">\(\mu\)</span> is 0, and <span class="math inline">\(\sigma\)</span> is 1, so <span class="math inline">\(SE(\overline x) = 1/\sqrt{25} = 1/5\)</span>). <span class="math inline">\((0.6757041,1.4799377)\)</span></p>
<p>Under scenario 2, the expected value of the lognormal distribution is <span class="math inline">\(\exp(1/2) = 1.6487213\)</span>, the variance is <span class="math inline">\((\exp(1) - 1)(\exp(1)) = 4.6707743\)</span> and our theoretical interval should be <span class="math inline">\((0.8015319, 2.4959107)\)</span>. This interval contains 0, which is implausible for lognormally distributed data.</p>
<p>Our expected values are different under scenario 1 and scenario 2: in scenario 1 we are computing an interval for <span class="math inline">\(\mu\)</span>, in scenario 2, we are computing an interval for the population mean, which is <span class="math inline">\(\exp(\mu + .5\sigma^2)\)</span>. Both are valid quantities we might be interested in, but they do not mean the same thing.</p>
<div class="note">
<p>The <code>purrr::map</code> notation specifies that we’re using the <code>map</code> function from the <code>purrr</code> package. When functions are named generically, and there may be more than one package with a function name, it is often more readable to specify the package name along with the function.</p>
<p><code>purrr::map</code> takes an argument and for each “group” calls the compute_interval function, storing the results in <code>res</code>. So each row in <code>res</code> is a 1x2 tibble with columns lb and ub.</p>
<p>This pattern is very useful in all sorts of applications. I wish we had time to cover purrr explicitly, but I at least want to expose you to how clean it makes your code.</p>
</div>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="simulation.html#cb477-1" aria-hidden="true" tabindex="-1"></a>compute_interval <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb477-2"><a href="simulation.html#cb477-2" aria-hidden="true" tabindex="-1"></a>  s1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">mean</span>(<span class="fu">log</span>(x)) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> <span class="fu">sd</span>(<span class="fu">log</span>(x))<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(x)))</span>
<span id="cb477-3"><a href="simulation.html#cb477-3" aria-hidden="true" tabindex="-1"></a>  s2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(x) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> <span class="fu">sd</span>(x)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(x))</span>
<span id="cb477-4"><a href="simulation.html#cb477-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">scenario =</span> <span class="fu">c</span>(<span class="st">&quot;scenario_1&quot;</span>, <span class="st">&quot;scenario_2&quot;</span>),</span>
<span id="cb477-5"><a href="simulation.html#cb477-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">exp</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)),</span>
<span id="cb477-6"><a href="simulation.html#cb477-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">lb =</span> <span class="fu">c</span>(s1[<span class="dv">1</span>], s2[<span class="dv">1</span>]), <span class="at">ub =</span> <span class="fu">c</span>(s1[<span class="dv">2</span>], s2[<span class="dv">2</span>]),</span>
<span id="cb477-7"><a href="simulation.html#cb477-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">in_interval =</span> (lb <span class="sc">&lt;</span> mean) <span class="sc">&amp;</span> (ub <span class="sc">&gt;</span> mean))</span>
<span id="cb477-8"><a href="simulation.html#cb477-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb477-9"><a href="simulation.html#cb477-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-10"><a href="simulation.html#cb477-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-11"><a href="simulation.html#cb477-11" aria-hidden="true" tabindex="-1"></a>sim_long <span class="ot">&lt;-</span> sim <span class="sc">%&gt;%</span></span>
<span id="cb477-12"><a href="simulation.html#cb477-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This line takes each data entry and computes an interval for x.</span></span>
<span id="cb477-13"><a href="simulation.html#cb477-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># .$x is code for take the argument you passed in to map and get the x column</span></span>
<span id="cb477-14"><a href="simulation.html#cb477-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">compute_interval</span>(.<span class="sc">$</span>x))) <span class="sc">%&gt;%</span></span>
<span id="cb477-15"><a href="simulation.html#cb477-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this &quot;frees&quot; res and we end up with two columns: lb and ub, for each scenario</span></span>
<span id="cb477-16"><a href="simulation.html#cb477-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(res)</span>
<span id="cb477-17"><a href="simulation.html#cb477-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb477-18"><a href="simulation.html#cb477-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-19"><a href="simulation.html#cb477-19" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">scenario =</span> <span class="fu">c</span>(<span class="st">&quot;scenario_1&quot;</span>, <span class="st">&quot;scenario_2&quot;</span>),</span>
<span id="cb477-20"><a href="simulation.html#cb477-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">exp</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)),</span>
<span id="cb477-21"><a href="simulation.html#cb477-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">lb =</span> <span class="fu">c</span>(<span class="fu">exp</span>(<span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="dv">5</span>), <span class="fu">exp</span>(.<span class="dv">5</span>) <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>((<span class="fu">exp</span>(<span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="dv">1</span>))<span class="sc">/</span><span class="dv">5</span>),</span>
<span id="cb477-22"><a href="simulation.html#cb477-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">ub =</span> <span class="fu">c</span>(<span class="fu">exp</span>(<span class="fl">1.96</span><span class="sc">/</span><span class="dv">5</span>), <span class="fu">exp</span>(.<span class="dv">5</span>) <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>((<span class="fu">exp</span>(<span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="dv">1</span>))<span class="sc">/</span><span class="dv">5</span>))</span>
<span id="cb477-23"><a href="simulation.html#cb477-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-24"><a href="simulation.html#cb477-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-25"><a href="simulation.html#cb477-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb477-26"><a href="simulation.html#cb477-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lb, <span class="at">xmax =</span> ub, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>), </span>
<span id="cb477-27"><a href="simulation.html#cb477-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> ci_df,</span>
<span id="cb477-28"><a href="simulation.html#cb477-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb477-29"><a href="simulation.html#cb477-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> mu), <span class="at">data =</span> ci_df) <span class="sc">+</span> </span>
<span id="cb477-30"><a href="simulation.html#cb477-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> lb, <span class="at">xend =</span> ub, <span class="at">y =</span> id, <span class="at">yend =</span> id, <span class="at">color =</span> in_interval),</span>
<span id="cb477-31"><a href="simulation.html#cb477-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> sim_long) <span class="sc">+</span> </span>
<span id="cb477-32"><a href="simulation.html#cb477-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb477-33"><a href="simulation.html#cb477-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb477-34"><a href="simulation.html#cb477-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>scenario)</span></code></pre></div>
<p><img src="image/unnamed-chunk-22-1.png" width="2100" /></p>
From this, we can see that working with the log-transformed, normally distributed results has better coverage probability than working with the raw data and computing the population mean: the estimates in the latter procedure have lower coverage probability, and many of the intervals are much wider than necessary; in some cases, the interval actually lies outside of the domain.
</details>
<details>
<summary>
Example: Regression and high-leverage points
</summary>
<p>What happens if we have one high-leverage point (e.g. a point which is an outlier in both x and y)? How pathological do our regression coefficient estimates get?</p>
<p>The challenging part here is to design a data generating mechanism.</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="simulation.html#cb478-1" aria-hidden="true" tabindex="-1"></a>gen_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">30</span>, <span class="at">o =</span> <span class="dv">1</span>, <span class="at">error_sd =</span> <span class="dv">2</span>) {</span>
<span id="cb478-2"><a href="simulation.html#cb478-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the main part of the regression data</span></span>
<span id="cb478-3"><a href="simulation.html#cb478-3" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n <span class="sc">-</span> o, <span class="at">mean =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="at">length.out =</span> n <span class="sc">-</span> o), <span class="at">sd =</span> .<span class="dv">1</span>),</span>
<span id="cb478-4"><a href="simulation.html#cb478-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> error_sd))</span>
<span id="cb478-5"><a href="simulation.html#cb478-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the outlier - make it at ~(-10, 5)</span></span>
<span id="cb478-6"><a href="simulation.html#cb478-6" aria-hidden="true" tabindex="-1"></a>  outdata <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(o, <span class="sc">-</span><span class="dv">10</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(o, <span class="dv">5</span>, error_sd))</span>
<span id="cb478-7"><a href="simulation.html#cb478-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(data, outdata)</span>
<span id="cb478-8"><a href="simulation.html#cb478-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb478-9"><a href="simulation.html#cb478-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-10"><a href="simulation.html#cb478-10" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb478-11"><a href="simulation.html#cb478-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">300</span>,</span>
<span id="cb478-12"><a href="simulation.html#cb478-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">o =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="dv">100</span>),</span>
<span id="cb478-13"><a href="simulation.html#cb478-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># call gen_data for each row in sim_data, but don&#39;t really use id as a parameter.</span></span>
<span id="cb478-14"><a href="simulation.html#cb478-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> purrr<span class="sc">::</span><span class="fu">map</span>(o, <span class="sc">~</span><span class="fu">gen_data</span>(<span class="at">o =</span> .)) </span>
<span id="cb478-15"><a href="simulation.html#cb478-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb478-16"><a href="simulation.html#cb478-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-17"><a href="simulation.html#cb478-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sim_data)</span>
<span id="cb478-18"><a href="simulation.html#cb478-18" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 3</span></span>
<span id="cb478-19"><a href="simulation.html#cb478-19" aria-hidden="true" tabindex="-1"></a>     id     o data                 </span>
<span id="cb478-20"><a href="simulation.html#cb478-20" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>list<span class="sc">&gt;</span>               </span>
<span id="cb478-21"><a href="simulation.html#cb478-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">0</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">30</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb478-22"><a href="simulation.html#cb478-22" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="dv">2</span>     <span class="dv">0</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">30</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb478-23"><a href="simulation.html#cb478-23" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     <span class="dv">3</span>     <span class="dv">0</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">30</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb478-24"><a href="simulation.html#cb478-24" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     <span class="dv">4</span>     <span class="dv">0</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">30</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb478-25"><a href="simulation.html#cb478-25" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     <span class="dv">5</span>     <span class="dv">0</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">30</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb478-26"><a href="simulation.html#cb478-26" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="dv">6</span>     <span class="dv">0</span> <span class="sc">&lt;</span>tibble[,<span class="dv">2</span>] [<span class="dv">30</span> × <span class="dv">2</span>]<span class="sc">&gt;</span></span>
<span id="cb478-27"><a href="simulation.html#cb478-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-28"><a href="simulation.html#cb478-28" aria-hidden="true" tabindex="-1"></a><span class="co"># plot a few datasets just to check they look like we expect:</span></span>
<span id="cb478-29"><a href="simulation.html#cb478-29" aria-hidden="true" tabindex="-1"></a>sim_data <span class="sc">%&gt;%</span></span>
<span id="cb478-30"><a href="simulation.html#cb478-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb478-31"><a href="simulation.html#cb478-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb478-32"><a href="simulation.html#cb478-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb478-33"><a href="simulation.html#cb478-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb478-34"><a href="simulation.html#cb478-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(id <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">~</span> o )</span></code></pre></div>
<p><img src="image/unnamed-chunk-23-1.png" width="2100" /></p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="simulation.html#cb479-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-2"><a href="simulation.html#cb479-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-3"><a href="simulation.html#cb479-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom) <span class="co"># the broom package cleans up model objects to tidy form</span></span>
<span id="cb479-4"><a href="simulation.html#cb479-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-5"><a href="simulation.html#cb479-5" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> sim_data <span class="sc">%&gt;%</span></span>
<span id="cb479-6"><a href="simulation.html#cb479-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit linear regression</span></span>
<span id="cb479-7"><a href="simulation.html#cb479-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> .)))  <span class="sc">%&gt;%</span></span>
<span id="cb479-8"><a href="simulation.html#cb479-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tidy_model =</span> purrr<span class="sc">::</span><span class="fu">map</span>(model, tidy))</span>
<span id="cb479-9"><a href="simulation.html#cb479-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-10"><a href="simulation.html#cb479-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the coefficients out</span></span>
<span id="cb479-11"><a href="simulation.html#cb479-11" aria-hidden="true" tabindex="-1"></a>tidy_coefs <span class="ot">&lt;-</span> <span class="fu">select</span>(sim_data, id, o, tidy_model) <span class="sc">%&gt;%</span></span>
<span id="cb479-12"><a href="simulation.html#cb479-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(tidy_model) <span class="sc">%&gt;%</span></span>
<span id="cb479-13"><a href="simulation.html#cb479-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(o <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;No HLPs&quot;</span>,</span>
<span id="cb479-14"><a href="simulation.html#cb479-14" aria-hidden="true" tabindex="-1"></a>                           o <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;1 HLP&quot;</span>,</span>
<span id="cb479-15"><a href="simulation.html#cb479-15" aria-hidden="true" tabindex="-1"></a>                           o <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;2 HLPs&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb479-16"><a href="simulation.html#cb479-16" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;No HLPs&quot;</span>, <span class="st">&quot;1 HLP&quot;</span>, <span class="st">&quot;2 HLPs&quot;</span>)))</span>
<span id="cb479-17"><a href="simulation.html#cb479-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-18"><a href="simulation.html#cb479-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tidy_coefs, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">color =</span> group)) <span class="sc">+</span> </span>
<span id="cb479-19"><a href="simulation.html#cb479-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(term <span class="sc">~</span> .) <span class="sc">+</span> </span>
<span id="cb479-20"><a href="simulation.html#cb479-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="image/unnamed-chunk-23-2.png" width="2100" /></p>
Obviously, you should experiment with different methods of generating a high-leverage point (maybe use a different distribution?) but this generating mechanism is simple enough for our purposes and shows that the addition of high leverage points biases the true values (slope = 1, intercept = 0).
<details>
<p><a href="https://blogs.sas.com/content/iml/2016/09/08/coverage-probability-confidence-intervals.html">Here is a similar example worked through in SAS with IML</a>. Note the use of BY-group processing to analyze each group at once - this is very similar to the use of <code>purrr::map()</code> in the R code.</p>
<div id="try-it-out-31" class="section level3 unnumbered tryitout">
<h3>Try it out</h3>
<p>Let’s explore what happens to estimates when certain observations are censored. Suppose we have a poorly-designed digital thermometer which cannot detect temperatures above 102<span class="math inline">\(^\circ F\)</span>; for these temperatures, the thermometer will record a value of 102.0.</p>
<p>It is estimated that normal body temperature for dogs and cats is 101 to 102.5 degrees Fahrenheit, and values above 104 degrees F are indicative of illness. Given that you have this poorly calibrated thermometer, design a simulation which estimates the average temperature your thermometer would record for a sample of 100 dogs or cats, and determine the magnitude of the effect of the thermometer’s censoring.</p>
<details>
<summary>
Hint
</summary>
If most pets have a normal body temperature between 101 and 102.5 degrees, can you use these bounds to determine appropriate parameters for a normal distribution? What if you assume that 101 and 102.5 are the 2SD bounds?
</details>
<details>
<summary>
Solution
</summary>
<p>If 101 and 102.5 are the anchor points we have, let’s assume that 95% of normal pet temperatures fall in that range. So our average temperature would be 101.75, and our standard deviation would be .75/2 = 0.375.</p>
<p>We can simulate 1000 observations from <span class="math inline">\(N(101.75, 0.375)\)</span>, create a new variable which truncates them at 102, and compute the mean of both variables to determine just how biased our results are.</p>
<pre class="sashtml"><code>

6          DATA dogtemp;
7            call streaminit(20572983);
8            DO i = 1 to 1000;
9              actual = rand(&quot;Normal&quot;, 101.75, 0.375);
10             IF actual &gt; 102 THEN read = 102;
11             IF actual &lt;= 102 THEN read = actual;
12           OUTPUT;
13         END;
14         RUN;

NOTE: The data set WORK.DOGTEMP has 0 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

15         
16         PROC MEANS DATA = dogtemp;
17           VAR actual read;
18         RUN;

NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE MEANS used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 4,5,7,11,12,13,16,17,18,19,24,25,27,28,29,
                               30,33,34,35,36,37,38,43.</code></pre>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="simulation.html#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">204209527</span>)</span>
<span id="cb481-2"><a href="simulation.html#cb481-2" aria-hidden="true" tabindex="-1"></a>dogtemp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb481-3"><a href="simulation.html#cb481-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">actual =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="fl">101.75</span>, <span class="fl">0.375</span>),</span>
<span id="cb481-4"><a href="simulation.html#cb481-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">read =</span> <span class="fu">pmin</span>(actual, <span class="dv">102</span>)</span>
<span id="cb481-5"><a href="simulation.html#cb481-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb481-6"><a href="simulation.html#cb481-6" aria-hidden="true" tabindex="-1"></a>dogtemp <span class="sc">%&gt;%</span></span>
<span id="cb481-7"><a href="simulation.html#cb481-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_all</span>(mean)</span>
<span id="cb481-8"><a href="simulation.html#cb481-8" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 x 2</span></span>
<span id="cb481-9"><a href="simulation.html#cb481-9" aria-hidden="true" tabindex="-1"></a>  actual  read</span>
<span id="cb481-10"><a href="simulation.html#cb481-10" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb481-11"><a href="simulation.html#cb481-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="fl">102.</span>  <span class="fl">102.</span></span></code></pre></div>
The effect of the thermometer’s censoring in both cases is around 0.06 degrees F.
</details>
</div>
</div>
<div id="monte-carlo-methods" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Monte Carlo methods</h2>
<p><a href="https://en.wikipedia.org/wiki/Monte_Carlo_method">Monte carlo methods</a> are methods which rely on repeated random sampling in order to solve numerical problems. Often, the types of problems approached with MC methods are extremely difficult or impossible to solve analytically.</p>
<p>In general, a MC problem involves these steps:</p>
<ol style="list-style-type: decimal">
<li>Define the input domain</li>
<li>Generate inputs randomly from an appropriate probability distribution</li>
<li>Perform a computation using those inputs</li>
<li>Aggregate the results.</li>
</ol>
<details>
<summary>
Let’s try it out by using MC simulation to estimate the number of uniform (0,1) random variables needed for the sum to exceed 1.
</summary>
<p>More precisely, if <span class="math inline">\(u_i \sim U(0,1)\)</span>, where _{i=1}^k u_i &gt; 1, what is the expected value of <span class="math inline">\(k\)</span>?</p>
<ol style="list-style-type: decimal">
<li>In this simulation, our input domain is [0,1].</li>
<li>Our input is <span class="math inline">\(u_i \sim U(0,1)\)</span></li>
<li>We generate new <span class="math inline">\(u_i\)</span> until <span class="math inline">\(\sum_{i=1}^k &gt; 1\)</span> and save the value of <span class="math inline">\(k\)</span></li>
<li>We average the result of <span class="math inline">\(N\)</span> such simulations.</li>
</ol>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="simulation.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="co"># It&#39;s easier to think through the code if we write it inefficiently first</span></span>
<span id="cb482-2"><a href="simulation.html#cb482-2" aria-hidden="true" tabindex="-1"></a>sim_fcn <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb482-3"><a href="simulation.html#cb482-3" aria-hidden="true" tabindex="-1"></a>  usum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb482-4"><a href="simulation.html#cb482-4" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb482-5"><a href="simulation.html#cb482-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prevent infinite loops by monitoring the value of k as well</span></span>
<span id="cb482-6"><a href="simulation.html#cb482-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (usum <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> k <span class="sc">&lt;</span> <span class="dv">15</span>) {</span>
<span id="cb482-7"><a href="simulation.html#cb482-7" aria-hidden="true" tabindex="-1"></a>    usum <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">+</span> usum</span>
<span id="cb482-8"><a href="simulation.html#cb482-8" aria-hidden="true" tabindex="-1"></a>    k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb482-9"><a href="simulation.html#cb482-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb482-10"><a href="simulation.html#cb482-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(k)</span>
<span id="cb482-11"><a href="simulation.html#cb482-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb482-12"><a href="simulation.html#cb482-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-13"><a href="simulation.html#cb482-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">302497852</span>)</span>
<span id="cb482-14"><a href="simulation.html#cb482-14" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">k =</span> <span class="fu">replicate</span>(<span class="dv">1000</span>, <span class="fu">sim_fcn</span>(), <span class="at">simplify =</span> T))</span>
<span id="cb482-15"><a href="simulation.html#cb482-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-16"><a href="simulation.html#cb482-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(res<span class="sc">$</span>k)</span>
<span id="cb482-17"><a href="simulation.html#cb482-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">2.717</span></span></code></pre></div>
<p>If we want to see whether the result converges to something, we can increase the number of trials we run:</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="simulation.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20417023</span>)</span>
<span id="cb483-2"><a href="simulation.html#cb483-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-3"><a href="simulation.html#cb483-3" aria-hidden="true" tabindex="-1"></a>sim_res <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">samp =</span> <span class="fu">replicate</span>(<span class="dv">250000</span>, <span class="fu">sim_fcn</span>(), <span class="at">simplify =</span> T)) </span>
<span id="cb483-4"><a href="simulation.html#cb483-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-5"><a href="simulation.html#cb483-5" aria-hidden="true" tabindex="-1"></a>sim_res <span class="ot">&lt;-</span> sim_res <span class="sc">%&gt;%</span></span>
<span id="cb483-6"><a href="simulation.html#cb483-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">running_avg_est =</span> <span class="fu">cummean</span>(samp),</span>
<span id="cb483-7"><a href="simulation.html#cb483-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">N =</span> <span class="fu">row_number</span>())</span>
<span id="cb483-8"><a href="simulation.html#cb483-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-9"><a href="simulation.html#cb483-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> N, <span class="at">y =</span> running_avg_est), <span class="at">data =</span> sim_res) <span class="sc">+</span> </span>
<span id="cb483-10"><a href="simulation.html#cb483-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">exp</span>(<span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb483-11"><a href="simulation.html#cb483-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="image/unnamed-chunk-27-1.png" width="2100" /></p>
<p>The expected number of uniform RV draws required to sum to 1 is <span class="math inline">\(e\)</span>!</p>
<a href="https://www.jstor.org/stable/2685243">Explanation of why this works</a>
</details>
<p>Monte Carlo methods are often used to approximate the value of integrals which do not have a closed-form (in particular, these integrals tend to pop up frequently in Bayesian methods). Suppose you want to integrate <span class="math display">\[\int_0^1 e^{-x^3}dx\]</span></p>
<p>You could set up Riemann integration and evaluate the integral using a sum over <span class="math inline">\(K\)</span> points, but that approach only converges for smooth functions (and besides, that’s boring calc 2 stuff, right?).</p>
<p>Instead, let’s observe that this is equivalent to <span class="math inline">\(\int_0^1 e^{-x^3}\cdot 1 dx\)</span>, where <span class="math inline">\(p(x) = 1\)</span> for a uniform random variable. That is, this integral can be written as the expected value of the function over the interval <span class="math inline">\([0,1]\)</span>. What if we just generate a bunch of uniform(0,1) variables, evaluate the value of the function at that point, and average the result?</p>
<details>
<summary>
Implementation
</summary>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="simulation.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20491720</span>)</span>
<span id="cb484-2"><a href="simulation.html#cb484-2" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb484-3"><a href="simulation.html#cb484-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb484-4"><a href="simulation.html#cb484-4" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">100000</span>),</span>
<span id="cb484-5"><a href="simulation.html#cb484-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="fu">fn</span>(x))</span>
<span id="cb484-6"><a href="simulation.html#cb484-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(sim_data<span class="sc">$</span>y)</span>
<span id="cb484-7"><a href="simulation.html#cb484-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.8076082</span></span></code></pre></div>
<pre class="sashtml"><code>

6          DATA tmp;
7          CALL streaminit(20283492);
8            DO i = 1 to 100000;
9              x = RAND(&quot;Uniform&quot;, 0, 1);
10             y = EXP(-x**3);
11             OUTPUT;
12           END;
13         RUN;

NOTE: The data set WORK.TMP has 0 observations and 3 variables.
WARNING: Data set WORK.TMP was not replaced because this step was stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

14         
15         PROC MEANS data=tmp;
16           VAR y;
ERROR: Variable Y not found.
17         RUN;

NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE MEANS used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
18         


ERROR: Errors printed on pages 4,5,7,11,12,13,16,17,18,19,24,25,27,28,29,
                               30,33,34,35,36,37,38,43.</code></pre>
You can use the law of large numbers to prove that this approach will converge.
<a href="http://faculty.washington.edu/yenchic/17Sp_403/Lec2_MonteCarlo.pdf">Example stolen from this set of lecture notes</a>
</details>
<div id="try-it-out-32" class="section level3 unnumbered tryitout">
<h3>Try it out</h3>
<p>Buffon’s needle is a mathematical problem which can be boiled down to a simple physical simulation. Read <a href="https://www.sciencefriday.com/articles/estimate-pi-by-dropping-sticks/">this science friday description of the problem</a> and develop a monte carlo simulation method which estimates <span class="math inline">\(\pi\)</span> using the Buffon’s needle method. Your method should be a function which</p>
<ul>
<li>allows the user to specify how many sticks are dropped</li>
<li>plots the result of the physical simulation</li>
<li>prints out a numerical estimate of pi.</li>
</ul>
<details>
<summary>
Solution
</summary>
<p>Let’s start out with horizontal lines at 0 and 1, and set our stick length to 1. We need to randomly generate a position (of one end of the stick) and an angle. The position in <span class="math inline">\(x\)</span> doesn’t actually make much of a difference (since what we care about is the <span class="math inline">\(y\)</span> coordinates), but we can draw a picture if we generate <span class="math inline">\(x\)</span> as well.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="simulation.html#cb486-1" aria-hidden="true" tabindex="-1"></a>needle_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">sticks =</span> <span class="dv">100</span>) {</span>
<span id="cb486-2"><a href="simulation.html#cb486-2" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">xstart =</span> <span class="fu">runif</span>(sticks, <span class="dv">0</span>, <span class="dv">10</span>), </span>
<span id="cb486-3"><a href="simulation.html#cb486-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ystart =</span> <span class="fu">runif</span>(sticks, <span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb486-4"><a href="simulation.html#cb486-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">angle =</span> <span class="fu">runif</span>(sticks, <span class="dv">0</span>, <span class="dv">360</span>),</span>
<span id="cb486-5"><a href="simulation.html#cb486-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">xend =</span> xstart <span class="sc">+</span> <span class="fu">cos</span>(angle<span class="sc">/</span><span class="dv">180</span><span class="sc">*</span>pi), </span>
<span id="cb486-6"><a href="simulation.html#cb486-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">yend =</span> ystart <span class="sc">+</span> <span class="fu">sin</span>(angle<span class="sc">/</span><span class="dv">180</span><span class="sc">*</span>pi)</span>
<span id="cb486-7"><a href="simulation.html#cb486-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb486-8"><a href="simulation.html#cb486-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We can see if a stick crosses a line if the floor() function of ystart is </span></span>
<span id="cb486-9"><a href="simulation.html#cb486-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># different than floor(yend). Note this only works for integer line values...</span></span>
<span id="cb486-10"><a href="simulation.html#cb486-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">crosses_line =</span> <span class="fu">floor</span>(ystart) <span class="sc">!=</span> <span class="fu">floor</span>(yend)) </span>
<span id="cb486-11"><a href="simulation.html#cb486-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb486-12"><a href="simulation.html#cb486-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb486-13"><a href="simulation.html#cb486-13" aria-hidden="true" tabindex="-1"></a>  gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb486-14"><a href="simulation.html#cb486-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb486-15"><a href="simulation.html#cb486-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> xstart, <span class="at">y =</span> ystart, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend,</span>
<span id="cb486-16"><a href="simulation.html#cb486-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> crosses_line), <span class="at">data =</span> df) <span class="sc">+</span> </span>
<span id="cb486-17"><a href="simulation.html#cb486-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span>
<span id="cb486-18"><a href="simulation.html#cb486-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb486-19"><a href="simulation.html#cb486-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">est =</span> <span class="dv">2</span> <span class="sc">*</span> sticks<span class="sc">/</span> <span class="fu">sum</span>(df<span class="sc">$</span>crosses_line), <span class="at">plot =</span> gg))</span>
<span id="cb486-20"><a href="simulation.html#cb486-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb486-21"><a href="simulation.html#cb486-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-22"><a href="simulation.html#cb486-22" aria-hidden="true" tabindex="-1"></a><span class="fu">needle_sim</span>(<span class="dv">10</span>)</span>
<span id="cb486-23"><a href="simulation.html#cb486-23" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>est</span>
<span id="cb486-24"><a href="simulation.html#cb486-24" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">2.8571429</span></span>
<span id="cb486-25"><a href="simulation.html#cb486-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-26"><a href="simulation.html#cb486-26" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>plot</span></code></pre></div>
<p><img src="image/unnamed-chunk-29-1.png" width="2100" /></p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="simulation.html#cb487-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-2"><a href="simulation.html#cb487-2" aria-hidden="true" tabindex="-1"></a><span class="fu">needle_sim</span>(<span class="dv">100</span>)</span>
<span id="cb487-3"><a href="simulation.html#cb487-3" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>est</span>
<span id="cb487-4"><a href="simulation.html#cb487-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">2.8985507</span></span>
<span id="cb487-5"><a href="simulation.html#cb487-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-6"><a href="simulation.html#cb487-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>plot</span></code></pre></div>
<p><img src="image/unnamed-chunk-29-2.png" width="2100" /></p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="simulation.html#cb488-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-2"><a href="simulation.html#cb488-2" aria-hidden="true" tabindex="-1"></a><span class="fu">needle_sim</span>(<span class="dv">1000</span>)</span>
<span id="cb488-3"><a href="simulation.html#cb488-3" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>est</span>
<span id="cb488-4"><a href="simulation.html#cb488-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">3.1298905</span></span>
<span id="cb488-5"><a href="simulation.html#cb488-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-6"><a href="simulation.html#cb488-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>plot</span></code></pre></div>
<p><img src="image/unnamed-chunk-29-3.png" width="2100" /></p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="simulation.html#cb489-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-2"><a href="simulation.html#cb489-2" aria-hidden="true" tabindex="-1"></a><span class="fu">needle_sim</span>(<span class="dv">10000</span>)</span>
<span id="cb489-3"><a href="simulation.html#cb489-3" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>est</span>
<span id="cb489-4"><a href="simulation.html#cb489-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">3.1235358</span></span>
<span id="cb489-5"><a href="simulation.html#cb489-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-6"><a href="simulation.html#cb489-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>plot</span></code></pre></div>
<p><img src="image/unnamed-chunk-29-4.png" width="2100" /></p>
<a href="https://blogs.sas.com/content/iml/2012/01/04/simulation-of-buffons-needle-in-sas-2.html">This blog post contains code for a SAS implementation</a>
</details>
</div>
</div>
<div id="references-5" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> References</h2>
<ul>
<li><p><a href="https://bookdown.org/rdpeng/rprogdatascience/simulation.html">Simulation</a> (R programming for Data Science chapter)</p></li>
<li><p><a href="http://rstudio-pubs-static.s3.amazonaws.com/302783_75485bd9eb4646698f534a4833a026e5.html#_simulation_">Simulation</a> - R Studio lesson</p></li>
<li><p><a href="http://www.columbia.edu/~cjd11/charles_dimaggio/DIRE/resources/R/simRreg.pdf">Simulation, focusing on statistical modeling</a> (R)</p></li>
<li><p><a href="https://support.sas.com/content/dam/SAS/support/en/books/simulating-data-with-sas/65378_excerpt.pdf">Simulating Data with SAS</a> (Excerpt)</p></li>
<li><p><a href="https://blogs.sas.com/content/iml/2015/08/12/2d-drunkards-walk.html">Simulating a Drunkard’s Walk in 2D in SAS</a></p></li>
<li><p><a href="https://blogs.sas.com/content/iml/2015/07/22/sim-triangular-distrib.html">Simulation from a triangle distribution (SAS)</a></p></li>
<li><p><a href="https://blogs.sas.com/content/iml/2015/04/01/monty-hall.html">Simulating the Monty Hall problem (SAS)</a></p></li>
<li><p><a href="https://education.rstudio.com/blog/2020/07/teaching-the-tidyverse-in-2020-part-4-when-to-purrr/">When to use <code>purrr</code></a> (part of the ‘teaching the tidyverse’ series) - essentially, purrr is a great intro to functional programming, but there are other ways to solve iterative problems in R as well, and some of them are easier than purrr (but purrr is a general approach that is very powerful).</p></li>
</ul>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="35">
<li id="fn35"><p>I once helped a friend fit a model for their masters thesis using Simulated Annealing (which relies on random seeds). We got brilliant results, but couldn’t ever reproduce them, because I hadn’t set the seed first and we never could figure out what the original seed was. Learn from my mistakes.<a href="simulation.html#fnref35" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-vis-intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="docs-reports.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
