<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 7 Transforming Data | Stat 850: Computing Tools for Statisticians</title>
  <meta name="description" content="Introductions to statistical computing packages and document preparation software. Topics include: graphical techniques, data management, Monte Carlo simulation, dynamic document preparation, presentation software." />
  <meta name="generator" content="bookdown 0.22.3 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 7 Transforming Data | Stat 850: Computing Tools for Statisticians" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://srvanderplas.github.io/unl-stat850/" />
  <meta property="og:image" content="https://srvanderplas.github.io/unl-stat850//images/cover.png" />
  <meta property="og:description" content="Introductions to statistical computing packages and document preparation software. Topics include: graphical techniques, data management, Monte Carlo simulation, dynamic document preparation, presentation software." />
  <meta name="github-repo" content="srvanderplas/unl-stat850" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 7 Transforming Data | Stat 850: Computing Tools for Statisticians" />
  
  <meta name="twitter:description" content="Introductions to statistical computing packages and document preparation software. Topics include: graphical techniques, data management, Monte Carlo simulation, dynamic document preparation, presentation software." />
  <meta name="twitter:image" content="https://srvanderplas.github.io/unl-stat850//images/cover.png" />

<meta name="author" content="Susan Vanderplas" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="manipulating-data.html"/>
<link rel="next" href="debugging.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script>

(function() {
  var codes = document.querySelectorAll('pre:not([class])');
  var code, i, d, s, p;
  for (i = 0; i < codes.length; i++) {
    code = codes[i];
    p = code.parentNode;
    d = document.createElement('details');
    s = document.createElement('summary');
    s.innerText = 'Answers';
    // <details><summary>Answers</summary></details>
      d.appendChild(s);
    // move the code into <details>
      p.replaceChild(d, code);
    d.appendChild(code);
  }
})();
</script>
<script>
function unrolltab(evt, tabName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="fontawesome-free-5.15.3-web/css/all.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to Statistical Computing</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#forward"><i class="fa fa-check"></i>Forward</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-description"><i class="fa fa-check"></i>Course Description</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-goals"><i class="fa fa-check"></i>Course Goals</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-objectives"><i class="fa fa-check"></i>Course Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-this-book"><i class="fa fa-check"></i>How to Use This Book</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#header-buttonslinks"><i class="fa fa-check"></i>Header Buttons/Links</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#special-sections"><i class="fa fa-check"></i>Special Sections</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Fundamentals</b></span></li>
<li class="chapter" data-level="1" data-path="tools.html"><a href="tools.html"><i class="fa fa-check"></i><b>1</b> Tools for Statistical Computing</a>
<ul>
<li class="chapter" data-level="" data-path="tools.html"><a href="tools.html#module-1-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="1.1" data-path="tools.html"><a href="tools.html#setting-up-software"><i class="fa fa-check"></i><b>1.1</b> Setting Up Software</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="tools.html"><a href="tools.html#setting-up-sas"><i class="fa fa-check"></i><b>1.1.1</b> SAS</a></li>
<li class="chapter" data-level="1.1.2" data-path="tools.html"><a href="tools.html#setting-up-R"><i class="fa fa-check"></i><b>1.1.2</b> R</a></li>
<li class="chapter" data-level="1.1.3" data-path="tools.html"><a href="tools.html#setting-up-rstudio"><i class="fa fa-check"></i><b>1.1.3</b> RStudio</a></li>
<li class="chapter" data-level="1.1.4" data-path="tools.html"><a href="tools.html#setting-up-git"><i class="fa fa-check"></i><b>1.1.4</b> git</a></li>
<li class="chapter" data-level="1.1.5" data-path="tools.html"><a href="tools.html#setting-up-latex"><i class="fa fa-check"></i><b>1.1.5</b> LaTeX</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="tools.html"><a href="tools.html#looking-around-your-environment"><i class="fa fa-check"></i><b>1.2</b> Looking Around Your Environment</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="tools.html"><a href="tools.html#looking-around-Rstudio"><i class="fa fa-check"></i><b>1.2.1</b> R and RStudio</a></li>
<li class="chapter" data-level="" data-path="tools.html"><a href="tools.html#try-it-out"><i class="fa fa-check"></i>Try It Out</a></li>
<li class="chapter" data-level="1.2.2" data-path="tools.html"><a href="tools.html#looking-around-sas"><i class="fa fa-check"></i><b>1.2.2</b> SAS</a></li>
<li class="chapter" data-level="1.2.3" data-path="tools.html"><a href="tools.html#version-control-with-git"><i class="fa fa-check"></i><b>1.2.3</b> Version Control with Git</a></li>
<li class="chapter" data-level="1.2.4" data-path="tools.html"><a href="tools.html#looking-around-latex"><i class="fa fa-check"></i><b>1.2.4</b> LaTeX</a></li>
<li class="chapter" data-level="1.2.5" data-path="tools.html"><a href="tools.html#markdown"><i class="fa fa-check"></i><b>1.2.5</b> Markdown</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="tools.html"><a href="tools.html#some-computer-basics"><i class="fa fa-check"></i><b>1.3</b> Some Computer Basics</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="tools.html"><a href="tools.html#file-systems"><i class="fa fa-check"></i><b>1.3.1</b> File Systems</a></li>
<li class="chapter" data-level="1.3.2" data-path="tools.html"><a href="tools.html#system-paths"><i class="fa fa-check"></i><b>1.3.2</b> System Paths</a></li>
<li class="chapter" data-level="1.3.3" data-path="tools.html"><a href="tools.html#working-directories"><i class="fa fa-check"></i><b>1.3.3</b> Working Directories</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="tools.html"><a href="tools.html#using-version-control-with-rstudio"><i class="fa fa-check"></i><b>1.4</b> Using Version Control (with RStudio)</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="tools.html"><a href="tools.html#create-a-repository"><i class="fa fa-check"></i><b>1.4.1</b> Create a Repository</a></li>
<li class="chapter" data-level="1.4.2" data-path="tools.html"><a href="tools.html#adding-files"><i class="fa fa-check"></i><b>1.4.2</b> Adding files</a></li>
<li class="chapter" data-level="1.4.3" data-path="tools.html"><a href="tools.html#staging-your-changes"><i class="fa fa-check"></i><b>1.4.3</b> Staging your changes</a></li>
<li class="chapter" data-level="1.4.4" data-path="tools.html"><a href="tools.html#committing-your-changes"><i class="fa fa-check"></i><b>1.4.4</b> Committing your changes</a></li>
<li class="chapter" data-level="1.4.5" data-path="tools.html"><a href="tools.html#pushing-and-pulling"><i class="fa fa-check"></i><b>1.4.5</b> Pushing and Pulling</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="tools.html"><a href="tools.html#topic-sequencing"><i class="fa fa-check"></i><b>1.5</b> Topic Sequencing</a></li>
<li class="chapter" data-level="1.6" data-path="tools.html"><a href="tools.html#refs-module-1"><i class="fa fa-check"></i><b>1.6</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro-prog.html"><a href="intro-prog.html"><i class="fa fa-check"></i><b>2</b> Introduction to Statistical Programming</a>
<ul>
<li class="chapter" data-level="" data-path="intro-prog.html"><a href="intro-prog.html#module-2-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="" data-path="intro-prog.html"><a href="intro-prog.html#definitions"><i class="fa fa-check"></i>Definitions</a></li>
<li class="chapter" data-level="" data-path="intro-prog.html"><a href="intro-prog.html#statistical-programming-languages"><i class="fa fa-check"></i>Statistical Programming Languages</a></li>
<li class="chapter" data-level="2.1" data-path="intro-prog.html"><a href="intro-prog.html#breaking-problems-down"><i class="fa fa-check"></i><b>2.1</b> Breaking Problems Down</a>
<ul>
<li class="chapter" data-level="" data-path="intro-prog.html"><a href="intro-prog.html#try-it-out-1"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro-prog.html"><a href="intro-prog.html#variable-types"><i class="fa fa-check"></i><b>2.2</b> Variable types</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="intro-prog.html"><a href="intro-prog.html#r"><i class="fa fa-check"></i><b>2.2.1</b> R</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro-prog.html"><a href="intro-prog.html#sas"><i class="fa fa-check"></i><b>2.2.2</b> SAS</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro-prog.html"><a href="intro-prog.html#data-structures"><i class="fa fa-check"></i><b>2.3</b> Data structures</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="intro-prog.html"><a href="intro-prog.html#homogeneous-data-structures-r-and-sas"><i class="fa fa-check"></i><b>2.3.1</b> Homogeneous data structures (R and SAS)</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro-prog.html"><a href="intro-prog.html#heterogeneous-data-structures"><i class="fa fa-check"></i><b>2.3.2</b> Heterogeneous data structures</a></li>
<li class="chapter" data-level="2.3.3" data-path="intro-prog.html"><a href="intro-prog.html#indexing"><i class="fa fa-check"></i><b>2.3.3</b> Indexing</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro-prog.html"><a href="intro-prog.html#control-structures"><i class="fa fa-check"></i><b>2.4</b> Control structures</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="intro-prog.html"><a href="intro-prog.html#if-statements"><i class="fa fa-check"></i><b>2.4.1</b> If statements</a></li>
<li class="chapter" data-level="2.4.2" data-path="intro-prog.html"><a href="intro-prog.html#loops"><i class="fa fa-check"></i><b>2.4.2</b> Loops</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro-prog.html"><a href="intro-prog.html#overgrown-calculators"><i class="fa fa-check"></i><b>2.5</b> Overgrown Calculators</a></li>
<li class="chapter" data-level="" data-path="intro-prog.html"><a href="intro-prog.html#references-and-links"><i class="fa fa-check"></i>References and Links</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="intro-prog.html"><a href="intro-prog.html#cheat-sheets-and-reference-cards"><i class="fa fa-check"></i><b>2.5.1</b> Cheat Sheets and Reference Cards</a></li>
<li class="chapter" data-level="2.5.2" data-path="intro-prog.html"><a href="intro-prog.html#sas-as-taught-in-other-places"><i class="fa fa-check"></i><b>2.5.2</b> SAS (as taught in other places)</a></li>
<li class="chapter" data-level="2.5.3" data-path="intro-prog.html"><a href="intro-prog.html#r-courses-as-taught-elsewhere-and-textbooks"><i class="fa fa-check"></i><b>2.5.3</b> R courses (as taught elsewhere) and Textbooks</a></li>
<li class="chapter" data-level="2.5.4" data-path="intro-prog.html"><a href="intro-prog.html#combination-of-r-and-sas-courses"><i class="fa fa-check"></i><b>2.5.4</b> Combination of R and SAS courses</a></li>
<li class="chapter" data-level="2.5.5" data-path="intro-prog.html"><a href="intro-prog.html#non-exhaustive-list-of-sources-used-to-aggregate-core-programming-concepts"><i class="fa fa-check"></i><b>2.5.5</b> Non-Exhaustive List of Sources used to aggregate “core programming concepts”:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="organization.html"><a href="organization.html"><i class="fa fa-check"></i><b>3</b> Organization: Packages, Functions, Scripts, and Documents</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#module-3-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="3.1" data-path="organization.html"><a href="organization.html#reproducibility-and-markdown"><i class="fa fa-check"></i><b>3.1</b> Reproducibility and Markdown</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#reproducibility-references-and-reading"><i class="fa fa-check"></i>Reproducibility References and Reading</a></li>
<li class="chapter" data-level="3.1.1" data-path="organization.html"><a href="organization.html#rmarkdown"><i class="fa fa-check"></i><b>3.1.1</b> Markdown and R</a></li>
<li class="chapter" data-level="3.1.2" data-path="organization.html"><a href="organization.html#rmarkdown-with-sas"><i class="fa fa-check"></i><b>3.1.2</b> Rmarkdown with… SAS?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="organization.html"><a href="organization.html#functions-and-modules"><i class="fa fa-check"></i><b>3.2</b> Functions and Modules</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#try-it-out-9"><i class="fa fa-check"></i>Try it out</a></li>
<li class="chapter" data-level="3.2.1" data-path="organization.html"><a href="organization.html#scope"><i class="fa fa-check"></i><b>3.2.1</b> Scope</a></li>
<li class="chapter" data-level="3.2.2" data-path="organization.html"><a href="organization.html#the-pipe"><i class="fa fa-check"></i><b>3.2.2</b> The Pipe</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="organization.html"><a href="organization.html#procs-and-data-steps"><i class="fa fa-check"></i><b>3.3</b> Procs and Data steps</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#try-it-out-11"><i class="fa fa-check"></i>Try It Out</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="organization.html"><a href="organization.html#scripts"><i class="fa fa-check"></i><b>3.4</b> Scripts</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#try-it-out-12"><i class="fa fa-check"></i>Try it out</a></li>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#try-it-out-sas"><i class="fa fa-check"></i>Try it out (SAS)</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="organization.html"><a href="organization.html#packages"><i class="fa fa-check"></i><b>3.5</b> Packages</a>
<ul>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#try-it-out-13"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="organization.html"><a href="organization.html#references-and-links-1"><i class="fa fa-check"></i>References and Links</a></li>
</ul></li>
<li class="part"><span><b>II Data Programming</b></span></li>
<li class="chapter" data-level="4" data-path="data-programming-basics.html"><a href="data-programming-basics.html"><i class="fa fa-check"></i><b>4</b> Basics</a>
<ul>
<li class="chapter" data-level="" data-path="data-programming-basics.html"><a href="data-programming-basics.html#module4-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="4.1" data-path="data-programming-basics.html"><a href="data-programming-basics.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="data-programming-basics.html"><a href="data-programming-basics.html#example-1-art"><i class="fa fa-check"></i><b>4.2</b> Example 1: Art</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="reading-data.html"><a href="reading-data.html"><i class="fa fa-check"></i><b>5</b> External Data</a>
<ul>
<li class="chapter" data-level="" data-path="reading-data.html"><a href="reading-data.html#module5-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="5.1" data-path="reading-data.html"><a href="reading-data.html#external-data-formats"><i class="fa fa-check"></i><b>5.1</b> External Data Formats</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="reading-data.html"><a href="reading-data.html#text-files"><i class="fa fa-check"></i><b>5.1.1</b> Text Files</a></li>
<li class="chapter" data-level="5.1.2" data-path="reading-data.html"><a href="reading-data.html#spreadsheets"><i class="fa fa-check"></i><b>5.1.2</b> Spreadsheets</a></li>
<li class="chapter" data-level="5.1.3" data-path="reading-data.html"><a href="reading-data.html#binary-files"><i class="fa fa-check"></i><b>5.1.3</b> Binary Files</a></li>
<li class="chapter" data-level="5.1.4" data-path="reading-data.html"><a href="reading-data.html#databases"><i class="fa fa-check"></i><b>5.1.4</b> Databases</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="reading-data.html"><a href="reading-data.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>5.2</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="reading-data.html"><a href="reading-data.html#comparison-between-r-and-sas"><i class="fa fa-check"></i>Comparison between R and SAS</a></li>
<li class="chapter" data-level="5.2.1" data-path="reading-data.html"><a href="reading-data.html#sas-1"><i class="fa fa-check"></i><b>5.2.1</b> SAS</a></li>
<li class="chapter" data-level="5.2.2" data-path="reading-data.html"><a href="reading-data.html#r-1"><i class="fa fa-check"></i><b>5.2.2</b> R</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reading-data.html"><a href="reading-data.html#references-and-links-2"><i class="fa fa-check"></i>References and Links</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="manipulating-data.html"><a href="manipulating-data.html"><i class="fa fa-check"></i><b>6</b> Manipulating Data</a>
<ul>
<li class="chapter" data-level="" data-path="manipulating-data.html"><a href="manipulating-data.html#module6-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="6.1" data-path="manipulating-data.html"><a href="manipulating-data.html#tidy-data"><i class="fa fa-check"></i><b>6.1</b> Tidy Data</a></li>
<li class="chapter" data-level="6.2" data-path="manipulating-data.html"><a href="manipulating-data.html#filter-pick-cases-rows-based-on-their-values"><i class="fa fa-check"></i><b>6.2</b> Filter: Pick cases (rows) based on their values</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="manipulating-data.html"><a href="manipulating-data.html#common-filter-tasks"><i class="fa fa-check"></i><b>6.2.1</b> Common Filter() Tasks</a></li>
<li class="chapter" data-level="" data-path="manipulating-data.html"><a href="manipulating-data.html#try-it-out-17"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="manipulating-data.html"><a href="manipulating-data.html#select-pick-columns"><i class="fa fa-check"></i><b>6.3</b> Select: Pick columns</a></li>
<li class="chapter" data-level="6.4" data-path="manipulating-data.html"><a href="manipulating-data.html#mutate-add-and-transform-variables"><i class="fa fa-check"></i><b>6.4</b> Mutate: Add and transform variables</a></li>
<li class="chapter" data-level="6.5" data-path="manipulating-data.html"><a href="manipulating-data.html#summarize"><i class="fa fa-check"></i><b>6.5</b> Summarize</a></li>
<li class="chapter" data-level="6.6" data-path="manipulating-data.html"><a href="manipulating-data.html#group-by-power"><i class="fa fa-check"></i><b>6.6</b> Group By + (?) = Power!</a></li>
<li class="chapter" data-level="6.7" data-path="manipulating-data.html"><a href="manipulating-data.html#other-dplyr-functions-across-relocate"><i class="fa fa-check"></i><b>6.7</b> Other <code>dplyr</code> functions: across, relocate</a></li>
<li class="chapter" data-level="" data-path="manipulating-data.html"><a href="manipulating-data.html#try-it-out-18"><i class="fa fa-check"></i>Try it out</a></li>
<li class="chapter" data-level="" data-path="manipulating-data.html"><a href="manipulating-data.html#references"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="transforming-data.html"><a href="transforming-data.html"><i class="fa fa-check"></i><b>7</b> Transforming Data</a>
<ul>
<li class="chapter" data-level="" data-path="transforming-data.html"><a href="transforming-data.html#module7-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="7.1" data-path="transforming-data.html"><a href="transforming-data.html#identifying-the-problem-messy-data"><i class="fa fa-check"></i><b>7.1</b> Identifying the problem: Messy data</a>
<ul>
<li class="chapter" data-level="" data-path="transforming-data.html"><a href="transforming-data.html#try-it-out-19"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="transforming-data.html"><a href="transforming-data.html#string-operations-creating-new-variables-and-separating-multi-variable-columns"><i class="fa fa-check"></i><b>7.2</b> String operations: Creating new variables and separating multi-variable columns</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="transforming-data.html"><a href="transforming-data.html#basic-string-operations"><i class="fa fa-check"></i><b>7.2.1</b> Basic String Operations</a></li>
<li class="chapter" data-level="7.2.2" data-path="transforming-data.html"><a href="transforming-data.html#regular-expressions"><i class="fa fa-check"></i><b>7.2.2</b> Regular Expressions</a></li>
<li class="chapter" data-level="7.2.3" data-path="transforming-data.html"><a href="transforming-data.html#joining-and-splitting-variables"><i class="fa fa-check"></i><b>7.2.3</b> Joining and Splitting Variables</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="transforming-data.html"><a href="transforming-data.html#pivot-operations"><i class="fa fa-check"></i><b>7.3</b> Pivot operations</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="transforming-data.html"><a href="transforming-data.html#longer"><i class="fa fa-check"></i><b>7.3.1</b> Longer</a></li>
<li class="chapter" data-level="7.3.2" data-path="transforming-data.html"><a href="transforming-data.html#wider"><i class="fa fa-check"></i><b>7.3.2</b> Wider</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="transforming-data.html"><a href="transforming-data.html#relational-data-and-joining-tables"><i class="fa fa-check"></i><b>7.4</b> Relational Data and Joining Tables</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="transforming-data.html"><a href="transforming-data.html#demonstration-dataset-setup"><i class="fa fa-check"></i><b>7.4.1</b> Demonstration dataset setup</a></li>
<li class="chapter" data-level="7.4.2" data-path="transforming-data.html"><a href="transforming-data.html#mutating-joins"><i class="fa fa-check"></i><b>7.4.2</b> Mutating joins</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="transforming-data.html"><a href="transforming-data.html#example-gas-prices-data"><i class="fa fa-check"></i><b>7.5</b> Example: Gas Prices Data</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="transforming-data.html"><a href="transforming-data.html#option-1-manual-formatting-in-excel"><i class="fa fa-check"></i><b>7.5.1</b> Option 1: Manual formatting in Excel</a></li>
<li class="chapter" data-level="7.5.2" data-path="transforming-data.html"><a href="transforming-data.html#option-2-r"><i class="fa fa-check"></i><b>7.5.2</b> Option 2: R</a></li>
<li class="chapter" data-level="7.5.3" data-path="transforming-data.html"><a href="transforming-data.html#option-3-sas"><i class="fa fa-check"></i><b>7.5.3</b> Option 3: SAS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="transforming-data.html"><a href="transforming-data.html#references-1"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>8</b> Principles of Debugging</a>
<ul>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#module8-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="8.1" data-path="debugging.html"><a href="debugging.html#step-1-check-your-spelling."><i class="fa fa-check"></i><b>8.1</b> Step 1: Check your spelling.</a></li>
<li class="chapter" data-level="8.2" data-path="debugging.html"><a href="debugging.html#defensive-programming"><i class="fa fa-check"></i><b>8.2</b> Defensive Programming</a></li>
<li class="chapter" data-level="8.3" data-path="debugging.html"><a href="debugging.html#general-debugging-strategies"><i class="fa fa-check"></i><b>8.3</b> General Debugging Strategies</a></li>
<li class="chapter" data-level="8.4" data-path="debugging.html"><a href="debugging.html#debugging-tools-in-r"><i class="fa fa-check"></i><b>8.4</b> Debugging Tools in R</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="debugging.html"><a href="debugging.html#low-tech-debugging-with-print-and-other-tools"><i class="fa fa-check"></i><b>8.4.1</b> Low tech debugging with print() and other tools</a></li>
<li class="chapter" data-level="8.4.2" data-path="debugging.html"><a href="debugging.html#after-an-error-has-occurred---traceback"><i class="fa fa-check"></i><b>8.4.2</b> After an error has occurred - <code>traceback()</code></a></li>
<li class="chapter" data-level="8.4.3" data-path="debugging.html"><a href="debugging.html#browser---debugging-your-own-code-interactively"><i class="fa fa-check"></i><b>8.4.3</b> <code>browser()</code> - debugging your own code, interactively</a></li>
<li class="chapter" data-level="8.4.4" data-path="debugging.html"><a href="debugging.html#debug---the-general-debugging-workhorse"><i class="fa fa-check"></i><b>8.4.4</b> <code>debug()</code> - the general debugging workhorse</a></li>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#try-it-out-25"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="debugging.html"><a href="debugging.html#debugging-tools-in-sas"><i class="fa fa-check"></i><b>8.5</b> Debugging Tools in SAS</a></li>
<li class="chapter" data-level="8.6" data-path="debugging.html"><a href="debugging.html#minimal-working-examples"><i class="fa fa-check"></i><b>8.6</b> Minimal Working Examples</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="debugging.html"><a href="debugging.html#example-mwes"><i class="fa fa-check"></i><b>8.6.1</b> Example: MWEs</a></li>
<li class="chapter" data-level="8.6.2" data-path="debugging.html"><a href="debugging.html#try-it-out-26"><i class="fa fa-check"></i><b>8.6.2</b> Try It Out</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#references-2"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="part"><span><b>III Applications</b></span></li>
<li class="chapter" data-level="9" data-path="data-vis-intro.html"><a href="data-vis-intro.html"><i class="fa fa-check"></i><b>9</b> Introduction to Data Visualization</a>
<ul>
<li class="chapter" data-level="" data-path="data-vis-intro.html"><a href="data-vis-intro.html#module9-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="9.1" data-path="data-vis-intro.html"><a href="data-vis-intro.html#why-do-we-create-graphics"><i class="fa fa-check"></i><b>9.1</b> Why do we create graphics?</a></li>
<li class="chapter" data-level="9.2" data-path="data-vis-intro.html"><a href="data-vis-intro.html#general-approaches-to-creating-graphics"><i class="fa fa-check"></i><b>9.2</b> General approaches to creating graphics</a></li>
<li class="chapter" data-level="9.3" data-path="data-vis-intro.html"><a href="data-vis-intro.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>9.3</b> The Grammar of Graphics</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="data-vis-intro.html"><a href="data-vis-intro.html#demonstration-aesthetic-mappings-and-basic-plots"><i class="fa fa-check"></i><b>9.3.1</b> Demonstration: Aesthetic Mappings and Basic Plots</a></li>
<li class="chapter" data-level="9.3.2" data-path="data-vis-intro.html"><a href="data-vis-intro.html#syntax-and-general-structure-layers"><i class="fa fa-check"></i><b>9.3.2</b> Syntax and General Structure: Layers</a></li>
<li class="chapter" data-level="9.3.3" data-path="data-vis-intro.html"><a href="data-vis-intro.html#statistics-and-different-types-of-plots"><i class="fa fa-check"></i><b>9.3.3</b> Statistics and Different Types of Plots</a></li>
<li class="chapter" data-level="9.3.4" data-path="data-vis-intro.html"><a href="data-vis-intro.html#small-multiples"><i class="fa fa-check"></i><b>9.3.4</b> Small Multiples</a></li>
<li class="chapter" data-level="" data-path="data-vis-intro.html"><a href="data-vis-intro.html#try-it-out-30"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="data-vis-intro.html"><a href="data-vis-intro.html#good-charts"><i class="fa fa-check"></i><b>9.4</b> Good charts</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="data-vis-intro.html"><a href="data-vis-intro.html#perceptual-and-cognitive-factors"><i class="fa fa-check"></i><b>9.4.1</b> Perceptual and Cognitive Factors</a></li>
<li class="chapter" data-level="9.4.2" data-path="data-vis-intro.html"><a href="data-vis-intro.html#general-guidelines-for-accuracy"><i class="fa fa-check"></i><b>9.4.2</b> General guidelines for accuracy</a></li>
<li class="chapter" data-level="9.4.3" data-path="data-vis-intro.html"><a href="data-vis-intro.html#how-do-we-know"><i class="fa fa-check"></i><b>9.4.3</b> How do we know?</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="data-vis-intro.html"><a href="data-vis-intro.html#other-things-worth-exploring-and-future-expansions-for-this-chapter"><i class="fa fa-check"></i><b>9.5</b> Other things worth exploring (and future expansions for this chapter)</a></li>
<li class="chapter" data-level="" data-path="data-vis-intro.html"><a href="data-vis-intro.html#references-3"><i class="fa fa-check"></i>References</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="data-vis-intro.html"><a href="data-vis-intro.html#motivation"><i class="fa fa-check"></i><b>9.5.1</b> Motivation</a></li>
<li class="chapter" data-level="9.5.2" data-path="data-vis-intro.html"><a href="data-vis-intro.html#r-graphics"><i class="fa fa-check"></i><b>9.5.2</b> R graphics</a></li>
<li class="chapter" data-level="9.5.3" data-path="data-vis-intro.html"><a href="data-vis-intro.html#sas-graphics"><i class="fa fa-check"></i><b>9.5.3</b> SAS graphics</a></li>
<li class="chapter" data-level="9.5.4" data-path="data-vis-intro.html"><a href="data-vis-intro.html#types-of-charts-and-chart-styling"><i class="fa fa-check"></i><b>9.5.4</b> Types of Charts and Chart Styling</a></li>
<li class="chapter" data-level="9.5.5" data-path="data-vis-intro.html"><a href="data-vis-intro.html#other-graphics-packages"><i class="fa fa-check"></i><b>9.5.5</b> Other Graphics packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>10</b> Simulation and Reproducibility</a>
<ul>
<li class="chapter" data-level="" data-path="simulation.html"><a href="simulation.html#module10-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="10.1" data-path="simulation.html"><a href="simulation.html#pseudorandom-number-generation"><i class="fa fa-check"></i><b>10.1</b> Pseudorandom Number Generation</a></li>
<li class="chapter" data-level="10.2" data-path="simulation.html"><a href="simulation.html#built-in-simulations-from-distributions"><i class="fa fa-check"></i><b>10.2</b> Built-in simulations from distributions</a>
<ul>
<li class="chapter" data-level="" data-path="simulation.html"><a href="simulation.html#try-it-out-32"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="simulation.html"><a href="simulation.html#simulation-to-test-model-assumptions"><i class="fa fa-check"></i><b>10.3</b> Simulation to test model assumptions</a>
<ul>
<li class="chapter" data-level="" data-path="simulation.html"><a href="simulation.html#try-it-out-33"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="simulation.html"><a href="simulation.html#monte-carlo-methods"><i class="fa fa-check"></i><b>10.4</b> Monte Carlo methods</a>
<ul>
<li class="chapter" data-level="" data-path="simulation.html"><a href="simulation.html#try-it-out-34"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="simulation.html"><a href="simulation.html#references-4"><i class="fa fa-check"></i><b>10.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="docs-reports.html"><a href="docs-reports.html"><i class="fa fa-check"></i><b>11</b> Documents and Reports</a>
<ul>
<li class="chapter" data-level="" data-path="docs-reports.html"><a href="docs-reports.html#module11-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="11.1" data-path="docs-reports.html"><a href="docs-reports.html#literate-programming-knitr-and-rmarkdown"><i class="fa fa-check"></i><b>11.1</b> Literate Programming, <code>knitr</code>, and <code>rmarkdown</code></a></li>
<li class="chapter" data-level="11.2" data-path="docs-reports.html"><a href="docs-reports.html#a-very-brief-introduction-to-latex"><i class="fa fa-check"></i><b>11.2</b> A Very Brief Introduction to LaTeX</a>
<ul>
<li class="chapter" data-level="" data-path="docs-reports.html"><a href="docs-reports.html#try-it-out-35"><i class="fa fa-check"></i>Try it out</a></li>
<li class="chapter" data-level="11.2.1" data-path="docs-reports.html"><a href="docs-reports.html#knitr"><i class="fa fa-check"></i><b>11.2.1</b> Knitr</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="docs-reports.html"><a href="docs-reports.html#slides"><i class="fa fa-check"></i><b>11.3</b> Slides</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="docs-reports.html"><a href="docs-reports.html#beamer-latex-and-knitr"><i class="fa fa-check"></i><b>11.3.1</b> Beamer (LaTeX) and knitr</a></li>
<li class="chapter" data-level="11.3.2" data-path="docs-reports.html"><a href="docs-reports.html#html-slides"><i class="fa fa-check"></i><b>11.3.2</b> HTML slides</a></li>
<li class="chapter" data-level="" data-path="docs-reports.html"><a href="docs-reports.html#try-it-out-37"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="docs-reports.html"><a href="docs-reports.html#posters"><i class="fa fa-check"></i><b>11.4</b> Posters</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="docs-reports.html"><a href="docs-reports.html#latex"><i class="fa fa-check"></i><b>11.4.1</b> LaTeX</a></li>
<li class="chapter" data-level="11.4.2" data-path="docs-reports.html"><a href="docs-reports.html#posterdown"><i class="fa fa-check"></i><b>11.4.2</b> Posterdown</a></li>
<li class="chapter" data-level="11.4.3" data-path="docs-reports.html"><a href="docs-reports.html#pagedown"><i class="fa fa-check"></i><b>11.4.3</b> Pagedown</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="docs-reports.html"><a href="docs-reports.html#resumecv"><i class="fa fa-check"></i><b>11.5</b> Resume/CV</a></li>
<li class="chapter" data-level="11.6" data-path="docs-reports.html"><a href="docs-reports.html#using-github-pages"><i class="fa fa-check"></i><b>11.6</b> Using Github Pages</a></li>
<li class="chapter" data-level="11.7" data-path="docs-reports.html"><a href="docs-reports.html#references-5"><i class="fa fa-check"></i><b>11.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html"><i class="fa fa-check"></i><b>12</b> Animated and Interactive Graphics</a>
<ul>
<li class="chapter" data-level="" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#module12-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="12.1" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#plotly"><i class="fa fa-check"></i><b>12.1</b> Plotly</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#ggplotly-ggplot2-to-plotly-conversions"><i class="fa fa-check"></i><b>12.1.1</b> <code>ggplotly</code>: ggplot2 to plotly conversions</a></li>
<li class="chapter" data-level="12.1.2" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#plot_ly-like-base-plotting-but-interactive"><i class="fa fa-check"></i><b>12.1.2</b> <code>plot_ly</code>: Like base plotting, but interactive!</a></li>
<li class="chapter" data-level="12.1.3" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#animation"><i class="fa fa-check"></i><b>12.1.3</b> Animation</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#leaflet-maps"><i class="fa fa-check"></i><b>12.2</b> Leaflet maps</a>
<ul>
<li class="chapter" data-level="" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#try-it-out-41"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#shiny"><i class="fa fa-check"></i><b>12.3</b> Shiny</a></li>
<li class="chapter" data-level="12.4" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#general-references"><i class="fa fa-check"></i><b>12.4</b> General References</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#other-interactive-tools"><i class="fa fa-check"></i><b>12.4.1</b> Other interactive tools</a></li>
<li class="chapter" data-level="12.4.2" data-path="animated-and-interactive-graphics.html"><a href="animated-and-interactive-graphics.html#debugging-1"><i class="fa fa-check"></i><b>12.4.2</b> Debugging</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html"><i class="fa fa-check"></i><b>13</b> Lists, Nested Lists, and Functional Programming</a>
<ul>
<li class="chapter" data-level="" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#module13-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="13.1" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#review-lists-and-vectors"><i class="fa fa-check"></i><b>13.1</b> Review: Lists and Vectors</a></li>
<li class="chapter" data-level="13.2" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#introduction-to-map"><i class="fa fa-check"></i><b>13.2</b> Introduction to <code>map</code></a></li>
<li class="chapter" data-level="13.3" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#creating-and-using-list-columns"><i class="fa fa-check"></i><b>13.3</b> Creating (and Using) List-columns</a></li>
<li class="chapter" data-level="13.4" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#ways-to-use-map"><i class="fa fa-check"></i><b>13.4</b> Ways to use <code>map</code></a>
<ul>
<li class="chapter" data-level="" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#try-it-out-42"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#beyond-map-functions-with-multiple-inputs"><i class="fa fa-check"></i><b>13.5</b> Beyond <code>map</code>: Functions with multiple inputs</a>
<ul>
<li class="chapter" data-level="" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#try-it-out-43"><i class="fa fa-check"></i>Try it out</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lists-nested-lists-and-functional-programming.html"><a href="lists-nested-lists-and-functional-programming.html#purrr-references"><i class="fa fa-check"></i>Purrr References</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="high-performance-computing.html"><a href="high-performance-computing.html"><i class="fa fa-check"></i><b>14</b> High Performance Computing</a>
<ul>
<li class="chapter" data-level="" data-path="high-performance-computing.html"><a href="high-performance-computing.html#module14-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="" data-path="high-performance-computing.html"><a href="high-performance-computing.html#resources"><i class="fa fa-check"></i>Resources</a></li>
<li class="chapter" data-level="" data-path="high-performance-computing.html"><a href="high-performance-computing.html#hpc-references"><i class="fa fa-check"></i>HPC References</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="spatial-packages.html"><a href="spatial-packages.html"><i class="fa fa-check"></i><b>15</b> Spatial packages</a>
<ul>
<li class="chapter" data-level="" data-path="spatial-packages.html"><a href="spatial-packages.html#module15-objectives"><i class="fa fa-check"></i>Module Objectives</a></li>
<li class="chapter" data-level="" data-path="spatial-packages.html"><a href="spatial-packages.html#references-6"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="common-problems-and-general-computing-topics.html"><a href="common-problems-and-general-computing-topics.html"><i class="fa fa-check"></i><b>A</b> Common Problems and General Computing Topics</a>
<ul>
<li class="chapter" data-level="A.1" data-path="common-problems-and-general-computing-topics.html"><a href="common-problems-and-general-computing-topics.html#file-paths-working-directories-and-reproducibility"><i class="fa fa-check"></i><b>A.1</b> File Paths, Working Directories, and Reproducibility</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="common-problems-and-general-computing-topics.html"><a href="common-problems-and-general-computing-topics.html#file-paths"><i class="fa fa-check"></i><b>A.1.1</b> File paths</a></li>
<li class="chapter" data-level="A.1.2" data-path="common-problems-and-general-computing-topics.html"><a href="common-problems-and-general-computing-topics.html#working-directory"><i class="fa fa-check"></i><b>A.1.2</b> Working Directory</a></li>
<li class="chapter" data-level="A.1.3" data-path="common-problems-and-general-computing-topics.html"><a href="common-problems-and-general-computing-topics.html#reproducibility"><i class="fa fa-check"></i><b>A.1.3</b> Reproducibility</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="other-resources-articles-and-food-for-thought.html"><a href="other-resources-articles-and-food-for-thought.html"><i class="fa fa-check"></i><b>B</b> Other Resources, Articles, and Food for Thought</a>
<ul>
<li class="chapter" data-level="B.1" data-path="other-resources-articles-and-food-for-thought.html"><a href="other-resources-articles-and-food-for-thought.html#comparing-languages"><i class="fa fa-check"></i><b>B.1</b> Comparing Languages</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-7.html"><a href="references-7.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stat 850: Computing Tools for Statisticians</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="transforming-data" class="section level1" number="7">
<h1><span class="header-section-number">Module 7</span> Transforming Data</h1>
<div id="module7-objectives" class="section level2 unnumbered">
<h2>Module Objectives</h2>
<ul>
<li>Implement variable and dataset transformations to support visualization and data analysis.</li>
</ul>
<blockquote>
<p>Happy families are all alike; every unhappy family is unhappy in its own way. - Leo Tolstoy</p>
</blockquote>
<blockquote>
<p>Tidy datasets are all alike, but every messy dataset is messy in its own way. - Hadley Wickham</p>
</blockquote>
<p>Most of the time, data does not come in a format suitable for analysis. Spreadsheets are generally optimized for data <em>viewing</em>, rather than for statistical analysis - they may be laid out so that there are multiple observations in a single row (e.g., commonly a year’s worth of data, with monthly observations in each column).</p>
<p>Unfortunately, this type of data structure is not usually useful to us when we analyze or visualize the data.</p>
<div class="note">
<p>This section is going to seem like it drags on forever. It covers a lot of material, and a few different concepts. I highly recommend separating it out into 3-4 different “sessions” - Tidy data, Strings, Pivot operations, and Table Joins.</p>
<p>For now, you need to know this material well enough to 1) identify what operation needs to happen, and 2) know where to find the sample code for that operation. It will get easier to remember the specific syntax with practice.</p>
</div>
<details>
<summary>
Load initial packages
</summary>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="transforming-data.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># Data wrangling</span></span>
<span id="cb252-2"><a href="transforming-data.html#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) <span class="co"># Data rearranging</span></span>
<span id="cb252-3"><a href="transforming-data.html#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble) <span class="co"># data table</span></span></code></pre></div>
</details>
</div>
<div id="identifying-the-problem-messy-data" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Identifying the problem: Messy data</h2>
<p>These datasets all display the same data: TB cases documented by the WHO in Afghanistan, Brazil, and China, between 1999 and 2000. There are 4 variables: country, year, cases, and population, but each table has a different layout.</p>
<table>
<caption><span id="tab:tidy1">Table 7.1: </span>Table 1</caption>
<thead>
<tr class="header">
<th align="left">country</th>
<th align="right">year</th>
<th align="right">cases</th>
<th align="right">population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">1999</td>
<td align="right">745</td>
<td align="right">19987071</td>
</tr>
<tr class="even">
<td align="left">Afghanistan</td>
<td align="right">2000</td>
<td align="right">2666</td>
<td align="right">20595360</td>
</tr>
<tr class="odd">
<td align="left">Brazil</td>
<td align="right">1999</td>
<td align="right">37737</td>
<td align="right">172006362</td>
</tr>
<tr class="even">
<td align="left">Brazil</td>
<td align="right">2000</td>
<td align="right">80488</td>
<td align="right">174504898</td>
</tr>
<tr class="odd">
<td align="left">China</td>
<td align="right">1999</td>
<td align="right">212258</td>
<td align="right">1272915272</td>
</tr>
<tr class="even">
<td align="left">China</td>
<td align="right">2000</td>
<td align="right">213766</td>
<td align="right">1280428583</td>
</tr>
</tbody>
</table>
<p>Here, each observation is a single row, each variable is a column, and everything is nicely arranged for e.g. regression or statistical analysis. We can easily compute another measure, such as cases per 100,000 population, by taking cases/population * 100000 (this would define a new column).</p>
<table>
<caption><span id="tab:tidy2">Table 7.2: </span>Table 2</caption>
<thead>
<tr class="header">
<th align="left">country</th>
<th align="right">year</th>
<th align="left">type</th>
<th align="right">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">1999</td>
<td align="left">cases</td>
<td align="right">745</td>
</tr>
<tr class="even">
<td align="left">Afghanistan</td>
<td align="right">1999</td>
<td align="left">population</td>
<td align="right">19987071</td>
</tr>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">2000</td>
<td align="left">cases</td>
<td align="right">2666</td>
</tr>
<tr class="even">
<td align="left">Afghanistan</td>
<td align="right">2000</td>
<td align="left">population</td>
<td align="right">20595360</td>
</tr>
<tr class="odd">
<td align="left">Brazil</td>
<td align="right">1999</td>
<td align="left">cases</td>
<td align="right">37737</td>
</tr>
<tr class="even">
<td align="left">Brazil</td>
<td align="right">1999</td>
<td align="left">population</td>
<td align="right">172006362</td>
</tr>
<tr class="odd">
<td align="left">Brazil</td>
<td align="right">2000</td>
<td align="left">cases</td>
<td align="right">80488</td>
</tr>
<tr class="even">
<td align="left">Brazil</td>
<td align="right">2000</td>
<td align="left">population</td>
<td align="right">174504898</td>
</tr>
<tr class="odd">
<td align="left">China</td>
<td align="right">1999</td>
<td align="left">cases</td>
<td align="right">212258</td>
</tr>
<tr class="even">
<td align="left">China</td>
<td align="right">1999</td>
<td align="left">population</td>
<td align="right">1272915272</td>
</tr>
<tr class="odd">
<td align="left">China</td>
<td align="right">2000</td>
<td align="left">cases</td>
<td align="right">213766</td>
</tr>
<tr class="even">
<td align="left">China</td>
<td align="right">2000</td>
<td align="left">population</td>
<td align="right">1280428583</td>
</tr>
</tbody>
</table>
<p>Here, we have 4 columns again, but we now have 12 rows: one of the columns is an indicator of which of two numerical observations is recorded in that row; a second column stores the value. This form of the data is more easily plotted in e.g. ggplot2, if we want to show lines for both cases and population, but computing per capita cases would be much more difficult in this form than in the arrangement in table 1.</p>
<table>
<caption><span id="tab:tidy3">Table 7.3: </span>Table 3</caption>
<thead>
<tr class="header">
<th align="left">country</th>
<th align="right">year</th>
<th align="left">rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">1999</td>
<td align="left">745/19987071</td>
</tr>
<tr class="even">
<td align="left">Afghanistan</td>
<td align="right">2000</td>
<td align="left">2666/20595360</td>
</tr>
<tr class="odd">
<td align="left">Brazil</td>
<td align="right">1999</td>
<td align="left">37737/172006362</td>
</tr>
<tr class="even">
<td align="left">Brazil</td>
<td align="right">2000</td>
<td align="left">80488/174504898</td>
</tr>
<tr class="odd">
<td align="left">China</td>
<td align="right">1999</td>
<td align="left">212258/1272915272</td>
</tr>
<tr class="even">
<td align="left">China</td>
<td align="right">2000</td>
<td align="left">213766/1280428583</td>
</tr>
</tbody>
</table>
<p>This form has only 3 columns, because the rate variable (which is a character) stores both the case count and the population. We can’t do <em>anything</em> with this format as it stands, because we can’t do math on data stored as characters. However, this form might be easier to read and record for a human being.</p>
<table>
<caption><span id="tab:tidy4">Table 7.4: </span>Table 4a</caption>
<thead>
<tr class="header">
<th align="left">country</th>
<th align="right">1999</th>
<th align="right">2000</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">745</td>
<td align="right">2666</td>
</tr>
<tr class="even">
<td align="left">Brazil</td>
<td align="right">37737</td>
<td align="right">80488</td>
</tr>
<tr class="odd">
<td align="left">China</td>
<td align="right">212258</td>
<td align="right">213766</td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:tidy4">Table 7.4: </span>Table 4b</caption>
<thead>
<tr class="header">
<th align="left">country</th>
<th align="right">1999</th>
<th align="right">2000</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">19987071</td>
<td align="right">20595360</td>
</tr>
<tr class="even">
<td align="left">Brazil</td>
<td align="right">172006362</td>
<td align="right">174504898</td>
</tr>
<tr class="odd">
<td align="left">China</td>
<td align="right">1272915272</td>
<td align="right">1280428583</td>
</tr>
</tbody>
</table>
<p>In this form, we have two tables - one for population, and one for cases. Each year’s observations are in a separate column. This format is often found in separate sheets of an excel workbook. To work with this data, we’ll need to transform each table so that there is a column indicating which year an observation is from, and then merge the two tables together by country and year.</p>
<table>
<caption><span id="tab:tidy5">Table 7.5: </span>Table 5</caption>
<thead>
<tr class="header">
<th align="left">country</th>
<th align="left">century</th>
<th align="left">year</th>
<th align="left">rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="left">19</td>
<td align="left">99</td>
<td align="left">745/19987071</td>
</tr>
<tr class="even">
<td align="left">Afghanistan</td>
<td align="left">20</td>
<td align="left">00</td>
<td align="left">2666/20595360</td>
</tr>
<tr class="odd">
<td align="left">Brazil</td>
<td align="left">19</td>
<td align="left">99</td>
<td align="left">37737/172006362</td>
</tr>
<tr class="even">
<td align="left">Brazil</td>
<td align="left">20</td>
<td align="left">00</td>
<td align="left">80488/174504898</td>
</tr>
<tr class="odd">
<td align="left">China</td>
<td align="left">19</td>
<td align="left">99</td>
<td align="left">212258/1272915272</td>
</tr>
<tr class="even">
<td align="left">China</td>
<td align="left">20</td>
<td align="left">00</td>
<td align="left">213766/1280428583</td>
</tr>
</tbody>
</table>
<p>Table 5 is very similar to table 3, but the year has been separated into two columns - century, and year. This is more common with year, month, and day in separate columns (or date and time in separate columns), often to deal with the fact that spreadsheets don’t always handle dates the way you’d hope they would.</p>
<p>These variations highlight the principles which can be said to define a tidy dataset:
1. Each variable must have its own column
2. Each observation must have its own row
3. Each value must have its own cell</p>
<div id="try-it-out-19" class="section level3 unnumbered tryitout">
<h3>Try it out</h3>
Go back through the 5 tables and determine whether each table is tidy, and if it is not, which rule or rules it violates. Figure out what you would have to do in order to compute a standardized TB infection rate per 100,000 people.
<details>
<summary>
Solution
</summary>
<ol style="list-style-type: decimal">
<li><p>table1 - this is tidy data. Computing a standardized infection rate is as simple as creating the variable rate = cases/population*100,000.</p></li>
<li><p>table2 - each variable does not have its own column (so a single year’s observation of one country actually has 2 rows). Computing a standardized infection rate requires moving cases and population so that each variable has its own column, and then you can proceed using the process in 1.</p></li>
<li><p>table3 - each value does not have its own cell (and each variable does not have its own column). In Table 3, you’d have to separate the numerator and denominator of each cell, convert each to a numeric variable, and then you could proceed as in 1.</p></li>
<li><p>table4a and table 4b - there are multiple observations in each row because there is not a column for year. To compute the rate, you’d need to “stack” the two columns in each table into a single column, add a year column that is 1999, 1999, 1999, 2000, 2000, 2000, and then merge the two tables. Then you could proceed as in 1.</p></li>
<li><p>table 5 - each variable does not have its own column (there are two columns for year, in addition to the issues noted in table3). Computing the rate would be similar to table 3; the year issues aren’t actually a huge deal unless you plot them, at which point 99 will seem to be bigger than 00 (so you’d need to combine the two year columns together first).</p></li>
</ol>
</details>
</div>
<p>It is actually impossible to have a table that violates only one of the rules of tidy data - you have to violate at least two. So a simpler way to state the rules might be:</p>
<ol style="list-style-type: decimal">
<li>Each dataset goes into its own table (or tibble, if you are using R)</li>
<li>Each variable gets its own column</li>
</ol>
<p>By the end of this module, you should have the skills to “tidy” each of these tables.</p>
</div>
<div id="string-operations-creating-new-variables-and-separating-multi-variable-columns" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> String operations: Creating new variables and separating multi-variable columns</h2>
<p>Nearly always, when multiple variables are stored in a single column, they are stored as character variables. There are many different “levels” of working with strings in programming, from simple find-and-replaced of fixed (constant) strings to regular expressions, which are extremely powerful (and extremely complicated).</p>
<blockquote>
<p>Some people, when confronted with a problem, think “I know, I’ll use regular expressions.” Now they have two problems. - Jamie Zawinski</p>
</blockquote>
<div class="figure">
<img src="https://imgs.xkcd.com/comics/perl_problems.png" alt="" />
<p class="caption">Alternately, the xkcd version of the above quote</p>
</div>
<p>The tidyverse package to deal with strings is <a href="https://stringr.tidyverse.org/"><code>stringr</code></a>. The functions in stringr take the form of <code>str_XXX</code> where XXX is a verb. So <code>str_split()</code>, <code>str_replace()</code>, <code>str_remove()</code>, <code>str_to_lower()</code> all should make some sense.</p>
<p>For this example, we’ll use a subset of the US Department of Education College Scorecard data. <a href="https://collegescorecard.ed.gov/data/documentation/">Documentation</a>, <a href="https://collegescorecard.ed.gov/data/">Data</a>. I’ve selected a few columns from the institution-level data available on the College Scorecard site.</p>
<details>
<summary>
Let’s take a look (Read in the data)
</summary>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="transforming-data.html#cb253-1" aria-hidden="true" tabindex="-1"></a>college <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/College_Data_Abbrev.csv&quot;</span>, <span class="at">guess_max =</span> <span class="dv">5000</span>, <span class="at">na =</span> <span class="st">&#39;.&#39;</span>)</span>
<span id="cb253-2"><a href="transforming-data.html#cb253-2" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/College_Data_Abbrev.csv&quot;</span>, <span class="at">guess_max =</span> <span class="dv">5000</span>, <span class="at">na =</span> <span class="st">&quot;.&quot;</span>)<span class="sc">:</span> could not find <span class="cf">function</span> <span class="st">&quot;read_csv&quot;</span></span>
<span id="cb253-3"><a href="transforming-data.html#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(college)</span>
<span id="cb253-4"><a href="transforming-data.html#cb253-4" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">str</span>(college)<span class="sc">:</span> object <span class="st">&#39;college&#39;</span> not found</span></code></pre></div>
<pre class="sashtml"><code>libname classdat &quot;sas/&quot;;

filename fileloc &#39;data/College_Data_Abbrev.csv&#39;;
PROC IMPORT  datafile = fileloc out=classdat.college REPLACE
DBMS = csv; /* comma delimited file */
GUESSINGROWS=500;
GETNAMES = YES;
RUN;

PROC PRINT DATA = classdat.college (obs = 5);
RUN;</code></pre>
<div class="branch">
<a name="IDX"></a>
<div>
<div align="center">
<!--BEGINTABLE-->
<table class="table" style=" border-left-width: 0px; border-right-width: 0px;" cellspacing="0" cellpadding="7" rules="groups" frame="hsides" bordercolor="#C1C1C1" summary="Procedure Print: Data Set CLASSDAT.COLLEGE">
<colgroup>
<col>
</colgroup>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="r header" scope="col">
Obs
</th>
<th class="r header" scope="col">
UNITID
</th>
<th class="l header" scope="col">
INSTNM
</th>
<th class="l header" scope="col">
CITY
</th>
<th class="l header" scope="col">
STABBR
</th>
<th class="l header" scope="col">
ZIP
</th>
<th class="l header" scope="col">
ACCREDAGENCY
</th>
<th class="l header" scope="col">
INSTURL
</th>
<th class="l header" scope="col">
PREDDEG
</th>
<th class="l header" scope="col">
MAIN
</th>
<th class="r header" scope="col">
NUMBRANCH
</th>
<th class="l header" scope="col">
HIGHDEG
</th>
<th class="l header" scope="col">
CONTROL
</th>
<th class="r header" scope="col">
ST_FIPS
</th>
<th class="r header" scope="col">
LOCALE
</th>
<th class="r header" scope="col">
LATITUDE
</th>
<th class="r header" scope="col">
LONGITUDE
</th>
<th class="l header" scope="col">
State
</th>
</tr>
</thead>
<tbody>
<tr>
<th class="r rowheader" scope="row">
1
</th>
<td class="r data">
100654
</td>
<td class="l data">
Alabama A &amp; M University
</td>
<td class="l data">
Normal
</td>
<td class="l data">
AL
</td>
<td class="l data">
35762
</td>
<td class="l data">
Southern Association of Colleges and Schools Commission on Colleges
</td>
<td class="l data">
www.aamu.edu/
</td>
<td class="l data">
Predominantly bachelor's-degree granting
</td>
<td class="l data">
main campus
</td>
<td class="r data">
1
</td>
<td class="l data">
Graduate
</td>
<td class="l data">
Public
</td>
<td class="r data">
1
</td>
<td class="r data">
12
</td>
<td class="r data">
34.783368
</td>
<td class="r data" nowrap>
-86.568502
</td>
<td class="l data">
Alabama
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
2
</th>
<td class="r data">
100663
</td>
<td class="l data">
University of Alabama at Birmingham
</td>
<td class="l data">
Birmingham
</td>
<td class="l data">
AL
</td>
<td class="l data">
35294-0110
</td>
<td class="l data">
Southern Association of Colleges and Schools Commission on Colleges
</td>
<td class="l data">
<a href="https://www.uab.edu" class="uri">https://www.uab.edu</a>
</td>
<td class="l data">
Predominantly bachelor's-degree granting
</td>
<td class="l data">
main campus
</td>
<td class="r data">
1
</td>
<td class="l data">
Graduate
</td>
<td class="l data">
Public
</td>
<td class="r data">
1
</td>
<td class="r data">
12
</td>
<td class="r data">
33.505697
</td>
<td class="r data" nowrap>
-86.799345
</td>
<td class="l data">
Alabama
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
3
</th>
<td class="r data">
100690
</td>
<td class="l data">
Amridge University
</td>
<td class="l data">
Montgomery
</td>
<td class="l data">
AL
</td>
<td class="l data">
36117-3553
</td>
<td class="l data">
Southern Association of Colleges and Schools Commission on Colleges
</td>
<td class="l data">
www.amridgeuniversity.edu
</td>
<td class="l data">
Predominantly bachelor's-degree granting
</td>
<td class="l data">
main campus
</td>
<td class="r data">
1
</td>
<td class="l data">
Graduate
</td>
<td class="l data">
Private Non Profit
</td>
<td class="r data">
1
</td>
<td class="r data">
12
</td>
<td class="r data">
32.362609
</td>
<td class="r data" nowrap>
-86.17401
</td>
<td class="l data">
Alabama
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
4
</th>
<td class="r data">
100706
</td>
<td class="l data">
University of Alabama in Huntsville
</td>
<td class="l data">
Huntsville
</td>
<td class="l data">
AL
</td>
<td class="l data">
35899
</td>
<td class="l data">
Southern Association of Colleges and Schools Commission on Colleges
</td>
<td class="l data">
www.uah.edu
</td>
<td class="l data">
Predominantly bachelor's-degree granting
</td>
<td class="l data">
main campus
</td>
<td class="r data">
1
</td>
<td class="l data">
Graduate
</td>
<td class="l data">
Public
</td>
<td class="r data">
1
</td>
<td class="r data">
12
</td>
<td class="r data">
34.724557
</td>
<td class="r data" nowrap>
-86.640449
</td>
<td class="l data">
Alabama
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
5
</th>
<td class="r data">
100724
</td>
<td class="l data">
Alabama State University
</td>
<td class="l data">
Montgomery
</td>
<td class="l data">
AL
</td>
<td class="l data">
36104-0271
</td>
<td class="l data">
Southern Association of Colleges and Schools Commission on Colleges
</td>
<td class="l data">
www.alasu.edu
</td>
<td class="l data">
Predominantly bachelor's-degree granting
</td>
<td class="l data">
main campus
</td>
<td class="r data">
1
</td>
<td class="l data">
Graduate
</td>
<td class="l data">
Public
</td>
<td class="r data">
1
</td>
<td class="r data">
12
</td>
<td class="r data">
32.364317
</td>
<td class="r data" nowrap>
-86.295677
</td>
<td class="l data">
Alabama
</td>
</tr>
</tbody>
</table>
<!--ENDTABLE-->
</div>
</div>
<br>
</div>
</details>
<div id="basic-string-operations" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Basic String Operations</h3>
<details>
<summary>
What proportion of the schools operating in each state have the state’s name in the school name?
</summary>
<p>We’ll use <code>str_detect()</code> to look for the state name in the college name.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="transforming-data.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr) <span class="co"># string processing</span></span>
<span id="cb255-2"><a href="transforming-data.html#cb255-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-3"><a href="transforming-data.html#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Outside the pipe</span></span>
<span id="cb255-4"><a href="transforming-data.html#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(college<span class="sc">$</span>INSTNM, <span class="at">pattern =</span> college<span class="sc">$</span>State)</span>
<span id="cb255-5"><a href="transforming-data.html#cb255-5" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">type</span>(pattern)<span class="sc">:</span> object <span class="st">&#39;college&#39;</span> not found</span>
<span id="cb255-6"><a href="transforming-data.html#cb255-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-7"><a href="transforming-data.html#cb255-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the pipe and mutate:</span></span>
<span id="cb255-8"><a href="transforming-data.html#cb255-8" aria-hidden="true" tabindex="-1"></a>college <span class="ot">&lt;-</span> college <span class="sc">%&gt;%</span></span>
<span id="cb255-9"><a href="transforming-data.html#cb255-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uses_st_name =</span> <span class="fu">str_detect</span>(INSTNM, State))</span>
<span id="cb255-10"><a href="transforming-data.html#cb255-10" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">mutate</span>(., <span class="at">uses_st_name =</span> <span class="fu">str_detect</span>(INSTNM, State))<span class="sc">:</span> object <span class="st">&#39;college&#39;</span> not found</span>
<span id="cb255-11"><a href="transforming-data.html#cb255-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-12"><a href="transforming-data.html#cb255-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># graphs and charts</span></span>
<span id="cb255-13"><a href="transforming-data.html#cb255-13" aria-hidden="true" tabindex="-1"></a><span class="co"># By state - percentage of institution names</span></span>
<span id="cb255-14"><a href="transforming-data.html#cb255-14" aria-hidden="true" tabindex="-1"></a>college <span class="sc">%&gt;%</span></span>
<span id="cb255-15"><a href="transforming-data.html#cb255-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">%&gt;%</span></span>
<span id="cb255-16"><a href="transforming-data.html#cb255-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pct_uses_st_name =</span> <span class="fu">mean</span>(uses_st_name), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb255-17"><a href="transforming-data.html#cb255-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="co"># only states/territories with at least 5 schools</span></span>
<span id="cb255-18"><a href="transforming-data.html#cb255-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reorder state factor level by percentage that uses state name</span></span>
<span id="cb255-19"><a href="transforming-data.html#cb255-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="fu">reorder</span>(State, <span class="sc">-</span>pct_uses_st_name)) <span class="sc">%&gt;%</span></span>
<span id="cb255-20"><a href="transforming-data.html#cb255-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> ., <span class="fu">aes</span>(<span class="at">x =</span> State, <span class="at">y =</span> pct_uses_st_name)) <span class="sc">+</span> </span>
<span id="cb255-21"><a href="transforming-data.html#cb255-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb255-22"><a href="transforming-data.html#cb255-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&quot;Total Schools:&quot;</span>, n)), <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb255-23"><a href="transforming-data.html#cb255-23" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">group_by</span>(., State)<span class="sc">:</span> object <span class="st">&#39;college&#39;</span> not found</span></code></pre></div>
<p>In SAS, we use <code>find(x, pattern, 't')</code> to find the location of the pattern, which is 0 if the pattern is not found. To get something equivalent to <code>str_detect</code>, we just test whether this quantity is greater than 0. (The R equivalent of <code>find</code> is <code>str_locate()</code>).</p>
<p>Note that SAS pads character fields with spaces so that they are all the same length. So if we want to test for “Alabama” we could omit the ‘t’ option in the command, but since we usually don’t want that, we need to tell SAS to trim the fields before searching for the pattern.</p>
<pre class="sashtml"><code>libname classdat &quot;sas/&quot;;

DATA collegetmp;
set classdat.college;
uses_st_name = find(INSTNM, State, &#39;t&#39;) GT 0;
RUN;


PROC PRINT DATA = collegetmp (obs = 5);
RUN;</code></pre>
<div class="branch">
<a name="IDX1"></a>
<div>
<div align="center">
<!--BEGINTABLE-->
<table class="table" style=" border-left-width: 0px; border-right-width: 0px;" cellspacing="0" cellpadding="7" rules="groups" frame="hsides" bordercolor="#C1C1C1" summary="Procedure Print: Data Set WORK.COLLEGETMP">
<colgroup>
<col>
</colgroup>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="r header" scope="col">
Obs
</th>
<th class="r header" scope="col">
UNITID
</th>
<th class="l header" scope="col">
INSTNM
</th>
<th class="l header" scope="col">
CITY
</th>
<th class="l header" scope="col">
STABBR
</th>
<th class="l header" scope="col">
ZIP
</th>
<th class="l header" scope="col">
ACCREDAGENCY
</th>
<th class="l header" scope="col">
INSTURL
</th>
<th class="l header" scope="col">
PREDDEG
</th>
<th class="l header" scope="col">
MAIN
</th>
<th class="r header" scope="col">
NUMBRANCH
</th>
<th class="l header" scope="col">
HIGHDEG
</th>
<th class="l header" scope="col">
CONTROL
</th>
<th class="r header" scope="col">
ST_FIPS
</th>
<th class="r header" scope="col">
LOCALE
</th>
<th class="r header" scope="col">
LATITUDE
</th>
<th class="r header" scope="col">
LONGITUDE
</th>
<th class="l header" scope="col">
State
</th>
<th class="r header" scope="col">
uses_st_name
</th>
</tr>
</thead>
<tbody>
<tr>
<th class="r rowheader" scope="row">
1
</th>
<td class="r data">
100654
</td>
<td class="l data">
Alabama A &amp; M University
</td>
<td class="l data">
Normal
</td>
<td class="l data">
AL
</td>
<td class="l data">
35762
</td>
<td class="l data">
Southern Association of Colleges and Schools Commission on Colleges
</td>
<td class="l data">
www.aamu.edu/
</td>
<td class="l data">
Predominantly bachelor's-degree granting
</td>
<td class="l data">
main campus
</td>
<td class="r data">
1
</td>
<td class="l data">
Graduate
</td>
<td class="l data">
Public
</td>
<td class="r data">
1
</td>
<td class="r data">
12
</td>
<td class="r data">
34.783368
</td>
<td class="r data" nowrap>
-86.568502
</td>
<td class="l data">
Alabama
</td>
<td class="r data">
1
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
2
</th>
<td class="r data">
100663
</td>
<td class="l data">
University of Alabama at Birmingham
</td>
<td class="l data">
Birmingham
</td>
<td class="l data">
AL
</td>
<td class="l data">
35294-0110
</td>
<td class="l data">
Southern Association of Colleges and Schools Commission on Colleges
</td>
<td class="l data">
<a href="https://www.uab.edu" class="uri">https://www.uab.edu</a>
</td>
<td class="l data">
Predominantly bachelor's-degree granting
</td>
<td class="l data">
main campus
</td>
<td class="r data">
1
</td>
<td class="l data">
Graduate
</td>
<td class="l data">
Public
</td>
<td class="r data">
1
</td>
<td class="r data">
12
</td>
<td class="r data">
33.505697
</td>
<td class="r data" nowrap>
-86.799345
</td>
<td class="l data">
Alabama
</td>
<td class="r data">
1
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
3
</th>
<td class="r data">
100690
</td>
<td class="l data">
Amridge University
</td>
<td class="l data">
Montgomery
</td>
<td class="l data">
AL
</td>
<td class="l data">
36117-3553
</td>
<td class="l data">
Southern Association of Colleges and Schools Commission on Colleges
</td>
<td class="l data">
www.amridgeuniversity.edu
</td>
<td class="l data">
Predominantly bachelor's-degree granting
</td>
<td class="l data">
main campus
</td>
<td class="r data">
1
</td>
<td class="l data">
Graduate
</td>
<td class="l data">
Private Non Profit
</td>
<td class="r data">
1
</td>
<td class="r data">
12
</td>
<td class="r data">
32.362609
</td>
<td class="r data" nowrap>
-86.17401
</td>
<td class="l data">
Alabama
</td>
<td class="r data">
0
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
4
</th>
<td class="r data">
100706
</td>
<td class="l data">
University of Alabama in Huntsville
</td>
<td class="l data">
Huntsville
</td>
<td class="l data">
AL
</td>
<td class="l data">
35899
</td>
<td class="l data">
Southern Association of Colleges and Schools Commission on Colleges
</td>
<td class="l data">
www.uah.edu
</td>
<td class="l data">
Predominantly bachelor's-degree granting
</td>
<td class="l data">
main campus
</td>
<td class="r data">
1
</td>
<td class="l data">
Graduate
</td>
<td class="l data">
Public
</td>
<td class="r data">
1
</td>
<td class="r data">
12
</td>
<td class="r data">
34.724557
</td>
<td class="r data" nowrap>
-86.640449
</td>
<td class="l data">
Alabama
</td>
<td class="r data">
1
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
5
</th>
<td class="r data">
100724
</td>
<td class="l data">
Alabama State University
</td>
<td class="l data">
Montgomery
</td>
<td class="l data">
AL
</td>
<td class="l data">
36104-0271
</td>
<td class="l data">
Southern Association of Colleges and Schools Commission on Colleges
</td>
<td class="l data">
www.alasu.edu
</td>
<td class="l data">
Predominantly bachelor's-degree granting
</td>
<td class="l data">
main campus
</td>
<td class="r data">
1
</td>
<td class="l data">
Graduate
</td>
<td class="l data">
Public
</td>
<td class="r data">
1
</td>
<td class="r data">
12
</td>
<td class="r data">
32.364317
</td>
<td class="r data" nowrap>
-86.295677
</td>
<td class="l data">
Alabama
</td>
<td class="r data">
1
</td>
</tr>
</tbody>
</table>
<!--ENDTABLE-->
</div>
</div>
<br>
</div>
</details>
<details>
<summary>
What are some common substrings in a set of text?
</summary>
<p>For this, we’ll start with working with the single column <code>INSTNM</code>.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="transforming-data.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(college<span class="sc">$</span>INSTNM) <span class="sc">%&gt;%</span> <span class="fu">str_split</span>(., <span class="st">&quot; &quot;</span>) <span class="co"># Split on every space</span></span>
<span id="cb257-2"><a href="transforming-data.html#cb257-2" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">head</span>(college<span class="sc">$</span>INSTNM)<span class="sc">:</span> object <span class="st">&#39;college&#39;</span> not found</span>
<span id="cb257-3"><a href="transforming-data.html#cb257-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-4"><a href="transforming-data.html#cb257-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We may need to fix certain things that should stay together</span></span>
<span id="cb257-5"><a href="transforming-data.html#cb257-5" aria-hidden="true" tabindex="-1"></a><span class="co"># But doing too much of that gets tedious...</span></span>
<span id="cb257-6"><a href="transforming-data.html#cb257-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(college<span class="sc">$</span>INSTNM, <span class="st">&quot;A &amp; M&quot;</span>, <span class="st">&quot;A&amp;M&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb257-7"><a href="transforming-data.html#cb257-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb257-8"><a href="transforming-data.html#cb257-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_split</span>(., <span class="st">&quot;[ -]&quot;</span>) <span class="co"># This pattern says &quot;either &#39; &#39; or &#39;-&#39;&quot; </span></span>
<span id="cb257-9"><a href="transforming-data.html#cb257-9" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">stri_replace_first_regex</span>(string, pattern, <span class="fu">fix_replacement</span>(replacement), <span class="sc">:</span> object <span class="st">&#39;college&#39;</span> not found</span>
<span id="cb257-10"><a href="transforming-data.html#cb257-10" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># (but the - has to be at the start or the end)</span></span></code></pre></div>
<p>So we could take the time to clean up everything, making sure that e.g. San Diego is treated as a single word, but that’s a pain in the rear. Instead, let’s just see what happens if we brute-force it.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="transforming-data.html#cb258-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> college <span class="sc">%&gt;%</span></span>
<span id="cb258-2"><a href="transforming-data.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(INSTNM, State) <span class="sc">%&gt;%</span> </span>
<span id="cb258-3"><a href="transforming-data.html#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name_words =</span> <span class="fu">str_split</span>(INSTNM, <span class="st">&#39;[ -]&#39;</span>)) <span class="co"># This is a list-column</span></span>
<span id="cb258-4"><a href="transforming-data.html#cb258-4" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">select</span>(., INSTNM, State)<span class="sc">:</span> object <span class="st">&#39;college&#39;</span> not found</span>
<span id="cb258-5"><a href="transforming-data.html#cb258-5" aria-hidden="true" tabindex="-1"></a>tmp</span>
<span id="cb258-6"><a href="transforming-data.html#cb258-6" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">eval</span>(expr, envir, enclos)<span class="sc">:</span> object <span class="st">&#39;tmp&#39;</span> not found</span>
<span id="cb258-7"><a href="transforming-data.html#cb258-7" aria-hidden="true" tabindex="-1"></a><span class="fu">unnest</span>(tmp) <span class="co"># Unnest duplicates rows so that the expanded data frame has the </span></span>
<span id="cb258-8"><a href="transforming-data.html#cb258-8" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">unnest</span>(tmp)<span class="sc">:</span> object <span class="st">&#39;tmp&#39;</span> not found</span>
<span id="cb258-9"><a href="transforming-data.html#cb258-9" aria-hidden="true" tabindex="-1"></a>            <span class="co"># same structure as the original data</span></span></code></pre></div>
<p>List columns are one way to maintain tidy data. They allow you to have several “sub-observations” for each observation and are useful for precisely cases like this, where there are uneven numbers of words in each university’s name. We’re not going to focus on list columns, but if you’re interested, check out <code>purrr</code> and this <a href="https://jennybc.github.io/purrr-tutorial/">excellent tutorial</a>.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="transforming-data.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr) <span class="co"># List columns</span></span>
<span id="cb259-2"><a href="transforming-data.html#cb259-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-3"><a href="transforming-data.html#cb259-3" aria-hidden="true" tabindex="-1"></a>Attaching package<span class="sc">:</span> <span class="st">&#39;purrr&#39;</span></span>
<span id="cb259-4"><a href="transforming-data.html#cb259-4" aria-hidden="true" tabindex="-1"></a>The following object is masked from <span class="st">&#39;package:magrittr&#39;</span><span class="sc">:</span></span>
<span id="cb259-5"><a href="transforming-data.html#cb259-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-6"><a href="transforming-data.html#cb259-6" aria-hidden="true" tabindex="-1"></a>    set_names</span>
<span id="cb259-7"><a href="transforming-data.html#cb259-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-8"><a href="transforming-data.html#cb259-8" aria-hidden="true" tabindex="-1"></a><span class="fu">unnest</span>(tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb259-9"><a href="transforming-data.html#cb259-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(name_words) <span class="sc">%&gt;%</span> <span class="co"># this pulls out a single column</span></span>
<span id="cb259-10"><a href="transforming-data.html#cb259-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb259-11"><a href="transforming-data.html#cb259-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb259-12"><a href="transforming-data.html#cb259-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">50</span>)</span>
<span id="cb259-13"><a href="transforming-data.html#cb259-13" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">unnest</span>(tmp)<span class="sc">:</span> object <span class="st">&#39;tmp&#39;</span> not found</span></code></pre></div>
<p>In SAS, this is a bit more tricky. Most people I know that use both SAS and R will do the data cleaning in R once things get complicated, and then read the clean data in to SAS. That’s a valid approach, but it’s worth seeing what has to be done in SAS this once. As we get further into this class, I’ll probably be more willing to say “we’re just going to use R for this” for two reasons - 1. I know R better, and 2. R is generally better at handling the weird stuff; SAS is built to quickly handle things that are already formatted in a reasonable way. SAS seems to be highly preferred for e.g. fitting mixed/linear models, but it isn’t the easiest tool to use for data cleaning.</p>
<p>But, in this particular case, there is <a href="https://blogs.sas.com/content/iml/2016/07/11/break-sentence-into-words-sas.html">documentation about how to break a sentence into words</a> in SAS.</p>
<pre class="sashtml"><code>libname classdat &quot;sas/&quot;;
DATA collegename;
SET classdat.college;
numWords = countw(INSTNM, &quot; &quot;);
DO i = 1 TO numWords;
  word = scan(INSTNM, i, &quot; &quot;);
  OUTPUT;
END;
KEEP word numWords;
;

PROC PRINT DATA=collegename (obs = 30);
run;

PROC FREQ DATA=collegename ORDER=FREQ;
TABLES word / MAXLEVELS=30;
RUN;</code></pre>
<div class="branch">
<a name="IDX2"></a>
<div>
<div align="center">
<!--BEGINTABLE-->
<table class="table" style=" border-left-width: 0px; border-right-width: 0px;" cellspacing="0" cellpadding="7" rules="groups" frame="hsides" bordercolor="#C1C1C1" summary="Procedure Print: Data Set WORK.COLLEGENAME">
<colgroup>
<col>
</colgroup>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="r header" scope="col">
Obs
</th>
<th class="r header" scope="col">
numWords
</th>
<th class="l header" scope="col">
word
</th>
</tr>
</thead>
<tbody>
<tr>
<th class="r rowheader" scope="row">
1
</th>
<td class="r data">
5
</td>
<td class="l data">
Alabama
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
2
</th>
<td class="r data">
5
</td>
<td class="l data">
A
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
3
</th>
<td class="r data">
5
</td>
<td class="l data">
&amp;
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
4
</th>
<td class="r data">
5
</td>
<td class="l data">
M
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
5
</th>
<td class="r data">
5
</td>
<td class="l data">
University
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
6
</th>
<td class="r data">
5
</td>
<td class="l data">
University
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
7
</th>
<td class="r data">
5
</td>
<td class="l data">
of
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
8
</th>
<td class="r data">
5
</td>
<td class="l data">
Alabama
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
9
</th>
<td class="r data">
5
</td>
<td class="l data">
at
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
10
</th>
<td class="r data">
5
</td>
<td class="l data">
Birmingham
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
11
</th>
<td class="r data">
2
</td>
<td class="l data">
Amridge
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
12
</th>
<td class="r data">
2
</td>
<td class="l data">
University
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
13
</th>
<td class="r data">
5
</td>
<td class="l data">
University
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
14
</th>
<td class="r data">
5
</td>
<td class="l data">
of
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
15
</th>
<td class="r data">
5
</td>
<td class="l data">
Alabama
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
16
</th>
<td class="r data">
5
</td>
<td class="l data">
in
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
17
</th>
<td class="r data">
5
</td>
<td class="l data">
Huntsville
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
18
</th>
<td class="r data">
3
</td>
<td class="l data">
Alabama
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
19
</th>
<td class="r data">
3
</td>
<td class="l data">
State
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
20
</th>
<td class="r data">
3
</td>
<td class="l data">
University
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
21
</th>
<td class="r data">
4
</td>
<td class="l data">
The
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
22
</th>
<td class="r data">
4
</td>
<td class="l data">
University
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
23
</th>
<td class="r data">
4
</td>
<td class="l data">
of
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
24
</th>
<td class="r data">
4
</td>
<td class="l data">
Alabama
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
25
</th>
<td class="r data">
4
</td>
<td class="l data">
Central
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
26
</th>
<td class="r data">
4
</td>
<td class="l data">
Alabama
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
27
</th>
<td class="r data">
4
</td>
<td class="l data">
Community
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
28
</th>
<td class="r data">
4
</td>
<td class="l data">
College
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
29
</th>
<td class="r data">
3
</td>
<td class="l data">
Athens
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
30
</th>
<td class="r data">
3
</td>
<td class="l data">
State
</td>
</tr>
</tbody>
</table>
<!--ENDTABLE-->
</div>
</div>
<br>
</div>
<div class="branch">
<p style="page-break-after: always;">
<br/>
</p>
<hr size="3"/>
<a name="IDX3"></a>
<div>
<div align="center">
<!--BEGINTABLE-->
<table class="table" style=" border-left-width: 0px; border-right-width: 0px;" cellspacing="0" cellpadding="7" rules="groups" frame="hsides" bordercolor="#C1C1C1" summary="Procedure Freq: One-Way Frequencies">
<colgroup>
<col>
</colgroup>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="l b header" scope="col">
word
</th>
<th class="r b header" scope="col">
Frequency
</th>
<th class="r b header" scope="col">
Percent
</th>
<th class="r b header" scope="col">
Cumulative<br/> Frequency
</th>
<th class="r b header" scope="col">
Cumulative<br/> Percent
</th>
</tr>
</thead>
<tbody>
<tr>
<th class="l rowheader" scope="row">
College
</th>
<td class="r data">
2324
</td>
<td class="r data">
8.86
</td>
<td class="r data">
2324
</td>
<td class="r data">
8.86
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
of
</th>
<td class="r data">
1731
</td>
<td class="r data">
6.60
</td>
<td class="r data">
4055
</td>
<td class="r data">
15.47
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
University
</th>
<td class="r data">
1314
</td>
<td class="r data">
5.01
</td>
<td class="r data">
5369
</td>
<td class="r data">
20.48
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
School
</th>
<td class="r data">
604
</td>
<td class="r data">
2.30
</td>
<td class="r data">
5973
</td>
<td class="r data">
22.78
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Community
</th>
<td class="r data">
553
</td>
<td class="r data">
2.11
</td>
<td class="r data">
6526
</td>
<td class="r data">
24.89
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Institute
</th>
<td class="r data">
506
</td>
<td class="r data">
1.93
</td>
<td class="r data">
7032
</td>
<td class="r data">
26.82
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Beauty
</th>
<td class="r data">
433
</td>
<td class="r data">
1.65
</td>
<td class="r data">
7465
</td>
<td class="r data">
28.47
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
State
</th>
<td class="r data">
381
</td>
<td class="r data">
1.45
</td>
<td class="r data">
7846
</td>
<td class="r data">
29.92
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Technical
</th>
<td class="r data">
359
</td>
<td class="r data">
1.37
</td>
<td class="r data">
8205
</td>
<td class="r data">
31.29
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Academy
</th>
<td class="r data">
311
</td>
<td class="r data">
1.19
</td>
<td class="r data">
8516
</td>
<td class="r data">
32.48
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
and
</th>
<td class="r data">
293
</td>
<td class="r data">
1.12
</td>
<td class="r data">
8809
</td>
<td class="r data">
33.60
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Career
</th>
<td class="r data">
219
</td>
<td class="r data">
0.84
</td>
<td class="r data">
9028
</td>
<td class="r data">
34.43
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
-
</th>
<td class="r data">
211
</td>
<td class="r data">
0.80
</td>
<td class="r data">
9239
</td>
<td class="r data">
35.24
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Campus
</th>
<td class="r data">
206
</td>
<td class="r data">
0.79
</td>
<td class="r data">
9445
</td>
<td class="r data">
36.02
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Center
</th>
<td class="r data">
198
</td>
<td class="r data">
0.76
</td>
<td class="r data">
9643
</td>
<td class="r data">
36.78
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
&amp;
</th>
<td class="r data">
186
</td>
<td class="r data">
0.71
</td>
<td class="r data">
9829
</td>
<td class="r data">
37.49
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Technology
</th>
<td class="r data">
175
</td>
<td class="r data">
0.67
</td>
<td class="r data">
10004
</td>
<td class="r data">
38.15
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Cosmetology
</th>
<td class="r data">
162
</td>
<td class="r data">
0.62
</td>
<td class="r data">
10166
</td>
<td class="r data">
38.77
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
the
</th>
<td class="r data">
159
</td>
<td class="r data">
0.61
</td>
<td class="r data">
10325
</td>
<td class="r data">
39.38
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
The
</th>
<td class="r data">
139
</td>
<td class="r data">
0.53
</td>
<td class="r data">
10464
</td>
<td class="r data">
39.91
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Hair
</th>
<td class="r data">
132
</td>
<td class="r data">
0.50
</td>
<td class="r data">
10596
</td>
<td class="r data">
40.41
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Medical
</th>
<td class="r data">
132
</td>
<td class="r data">
0.50
</td>
<td class="r data">
10728
</td>
<td class="r data">
40.92
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
County
</th>
<td class="r data">
130
</td>
<td class="r data">
0.50
</td>
<td class="r data">
10858
</td>
<td class="r data">
41.41
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Nursing
</th>
<td class="r data">
121
</td>
<td class="r data">
0.46
</td>
<td class="r data">
10979
</td>
<td class="r data">
41.87
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Seminary
</th>
<td class="r data">
117
</td>
<td class="r data">
0.45
</td>
<td class="r data">
11096
</td>
<td class="r data">
42.32
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Health
</th>
<td class="r data">
112
</td>
<td class="r data">
0.43
</td>
<td class="r data">
11208
</td>
<td class="r data">
42.75
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
New
</th>
<td class="r data">
112
</td>
<td class="r data">
0.43
</td>
<td class="r data">
11320
</td>
<td class="r data">
43.17
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Education
</th>
<td class="r data">
109
</td>
<td class="r data">
0.42
</td>
<td class="r data">
11429
</td>
<td class="r data">
43.59
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
American
</th>
<td class="r data">
108
</td>
<td class="r data">
0.41
</td>
<td class="r data">
11537
</td>
<td class="r data">
44.00
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Paul
</th>
<td class="r data">
104
</td>
<td class="r data">
0.40
</td>
<td class="r data">
11641
</td>
<td class="r data">
44.40
</td>
</tr>
</tbody>
<tfoot>
<tr>
<th class="c b footer" colspan="5">
The first 30 levels are displayed.
</th>
</tr>
</tfoot>
</table>
<!--ENDTABLE-->
</div>
</div>
<br>
</div>
</details>
</div>
<div id="regular-expressions" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Regular Expressions</h3>
<p>Matching exact strings is easy - it’s just like using find and replace.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="transforming-data.html#cb261-1" aria-hidden="true" tabindex="-1"></a>human_talk <span class="ot">&lt;-</span> <span class="st">&quot;blah, blah, blah. Do you want to go for a walk?&quot;</span></span>
<span id="cb261-2"><a href="transforming-data.html#cb261-2" aria-hidden="true" tabindex="-1"></a>dog_hears <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(human_talk, <span class="st">&quot;walk&quot;</span>)</span>
<span id="cb261-3"><a href="transforming-data.html#cb261-3" aria-hidden="true" tabindex="-1"></a>dog_hears</span>
<span id="cb261-4"><a href="transforming-data.html#cb261-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;walk&quot;</span></span></code></pre></div>
<p>But, if you can master even a small amount of regular expression notation, you’ll have exponentially more power to do good (or evil) when working with strings. You can get by without regular expressions if you’re creative, but often they’re much simpler.</p>
<p>You may find it helpful to follow along with this section using this <a href="https://spannbaueradam.shinyapps.io/r_regex_tester/">web app</a> built to test R regular expressions for R. A similar application for Perl compatible regular expressions (used by SAS) can be found <a href="https://regex101.com/">here</a>. The subset of regular expression syntax we’re going to cover here is fairly limited (and common to both SAS and R, with a few adjustments), but <a href="https://stackoverflow.com/questions/tagged/regex?tab=Votes">you can find regular expressions to do just about anything string-related</a>. As with any tool, there are situations where it’s useful, and situations where you should not use a regular expression, no matter how much you want to.</p>
<details>
<summary>
Short Regular Expression Primer (with R examples)
</summary>
<ul>
<li><code>[]</code> enclose sets of characters<br />
Ex: <code>[abc]</code> will match any single character <code>a</code>, <code>b</code>, <code>c</code>
<ul>
<li><code>-</code> specifies a range of characters (<code>A-z</code> matches all upper and lower case letters)</li>
<li>to match <code>-</code> exactly, precede with a backslash (outside of <code>[]</code>) or put the <code>-</code> last (inside <code>[]</code>)</li>
</ul></li>
<li><code>.</code> matches any character (except a newline)</li>
<li>To match special characters, escape them using <code>\</code> (in most languages) or <code>\\</code> (in R). So <code>\\.</code> will match a literal <code>.</code>, <code>\\$</code> will match a literal <code>$</code>.</li>
</ul>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="transforming-data.html#cb262-1" aria-hidden="true" tabindex="-1"></a>num_string <span class="ot">&lt;-</span> <span class="st">&quot;phone: 123-456-7890, nuid: 12345678, ssn: 123-45-6789&quot;</span></span>
<span id="cb262-2"><a href="transforming-data.html#cb262-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-3"><a href="transforming-data.html#cb262-3" aria-hidden="true" tabindex="-1"></a>ssn <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(num_string, <span class="st">&quot;[0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9][0-9][0-9]&quot;</span>)</span>
<span id="cb262-4"><a href="transforming-data.html#cb262-4" aria-hidden="true" tabindex="-1"></a>ssn</span>
<span id="cb262-5"><a href="transforming-data.html#cb262-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;123-45-6789&quot;</span></span></code></pre></div>
<p>Listing out all of those numbers can get repetitive, though. How do we specify repetition?</p>
<ul>
<li><code>*</code> means repeat between 0 and inf times</li>
<li><code>+</code> means 1 or more times</li>
<li><code>?</code> means 0 or 1 times – most useful when you’re looking for something optional</li>
<li><code>{a, b}</code> means repeat between <code>a</code> and <code>b</code> times, where <code>a</code> and <code>b</code> are integers. <code>b</code> can be blank. So <code>[abc]{3,}</code> will match <code>abc</code>, <code>aaaa</code>, <code>cbbaa</code>, but not <code>ab</code>, <code>bb</code>, or <code>a</code>. For a single number of repeated characters, you can use <code>{a}</code>. So <code>{3, }</code> means “3 or more times” and <code>{3}</code> means “exactly 3 times”</li>
</ul>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="transforming-data.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(<span class="st">&quot;banana&quot;</span>, <span class="st">&quot;[a-z]{1,}&quot;</span>) <span class="co"># match any sequence of lowercase characters</span></span>
<span id="cb263-2"><a href="transforming-data.html#cb263-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;banana&quot;</span></span>
<span id="cb263-3"><a href="transforming-data.html#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(<span class="st">&quot;banana&quot;</span>, <span class="st">&quot;[ab]{1,}&quot;</span>) <span class="co"># Match any sequence of a and b characters</span></span>
<span id="cb263-4"><a href="transforming-data.html#cb263-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;ba&quot;</span></span>
<span id="cb263-5"><a href="transforming-data.html#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract_all</span>(<span class="st">&quot;banana&quot;</span>, <span class="st">&quot;(..)&quot;</span>) <span class="co"># Match any two characters</span></span>
<span id="cb263-6"><a href="transforming-data.html#cb263-6" aria-hidden="true" tabindex="-1"></a>[[<span class="dv">1</span>]]</span>
<span id="cb263-7"><a href="transforming-data.html#cb263-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;ba&quot;</span> <span class="st">&quot;na&quot;</span> <span class="st">&quot;na&quot;</span></span>
<span id="cb263-8"><a href="transforming-data.html#cb263-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(<span class="st">&quot;banana&quot;</span>, <span class="st">&quot;(..)</span><span class="sc">\\</span><span class="st">1&quot;</span>) <span class="co"># Match a repeated thing</span></span>
<span id="cb263-9"><a href="transforming-data.html#cb263-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;anan&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="transforming-data.html#cb264-1" aria-hidden="true" tabindex="-1"></a>num_string <span class="ot">&lt;-</span> <span class="st">&quot;phone: 123-456-7890, nuid: 12345678, ssn: 123-45-6789, bank account balance: $50,000,000.23&quot;</span></span>
<span id="cb264-2"><a href="transforming-data.html#cb264-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-3"><a href="transforming-data.html#cb264-3" aria-hidden="true" tabindex="-1"></a>ssn <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(num_string, <span class="st">&quot;[0-9]{3}-[0-9]{2}-[0-9]{4}&quot;</span>)</span>
<span id="cb264-4"><a href="transforming-data.html#cb264-4" aria-hidden="true" tabindex="-1"></a>ssn</span>
<span id="cb264-5"><a href="transforming-data.html#cb264-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;123-45-6789&quot;</span></span>
<span id="cb264-6"><a href="transforming-data.html#cb264-6" aria-hidden="true" tabindex="-1"></a>phone <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(num_string, <span class="st">&quot;[0-9]{3}.[0-9]{3}.[0-9]{4}&quot;</span>)</span>
<span id="cb264-7"><a href="transforming-data.html#cb264-7" aria-hidden="true" tabindex="-1"></a>phone</span>
<span id="cb264-8"><a href="transforming-data.html#cb264-8" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;123-456-7890&quot;</span></span>
<span id="cb264-9"><a href="transforming-data.html#cb264-9" aria-hidden="true" tabindex="-1"></a>nuid <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(num_string, <span class="st">&quot;[0-9]{8}&quot;</span>)</span>
<span id="cb264-10"><a href="transforming-data.html#cb264-10" aria-hidden="true" tabindex="-1"></a>nuid</span>
<span id="cb264-11"><a href="transforming-data.html#cb264-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;12345678&quot;</span></span>
<span id="cb264-12"><a href="transforming-data.html#cb264-12" aria-hidden="true" tabindex="-1"></a>bank_balance <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(num_string, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">$[0-9,]+</span><span class="sc">\\</span><span class="st">.[0-9]{2}&quot;</span>)</span>
<span id="cb264-13"><a href="transforming-data.html#cb264-13" aria-hidden="true" tabindex="-1"></a>bank_balance</span>
<span id="cb264-14"><a href="transforming-data.html#cb264-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;$50,000,000.23&quot;</span></span></code></pre></div>
<p>There are also ways to “anchor” a pattern to a part of the string (e.g. the beginning or the end)</p>
<ul>
<li><code>^</code> has multiple meanings:
<ul>
<li>if it’s the first character in a pattern, <code>^</code> matches the beginning of a string</li>
<li>if it follows <code>[</code>, e.g. <code>[^abc]</code>, <code>^</code> means “not” - for instance, “the collection of all characters that aren’t a, b, or c.”</li>
</ul></li>
<li><code>$</code> means the end of a string</li>
</ul>
<p>Combined with pre and post-processing, these let you make sense out of semi-structured string data, such as addresses</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="transforming-data.html#cb265-1" aria-hidden="true" tabindex="-1"></a>address <span class="ot">&lt;-</span> <span class="st">&quot;1600 Pennsylvania Ave NW, Washington D.C., 20500&quot;</span></span>
<span id="cb265-2"><a href="transforming-data.html#cb265-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-3"><a href="transforming-data.html#cb265-3" aria-hidden="true" tabindex="-1"></a>house_num <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(address, <span class="st">&quot;^[0-9]{1,}&quot;</span>)</span>
<span id="cb265-4"><a href="transforming-data.html#cb265-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-5"><a href="transforming-data.html#cb265-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># Match everything alphanumeric up to the comma</span></span>
<span id="cb265-6"><a href="transforming-data.html#cb265-6" aria-hidden="true" tabindex="-1"></a>street <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(address, <span class="st">&quot;[A-z0-9 ]{1,}&quot;</span>)</span>
<span id="cb265-7"><a href="transforming-data.html#cb265-7" aria-hidden="true" tabindex="-1"></a>street <span class="ot">&lt;-</span> <span class="fu">str_remove</span>(street, house_num) <span class="sc">%&gt;%</span> <span class="fu">str_trim</span>() <span class="co"># remove house number</span></span>
<span id="cb265-8"><a href="transforming-data.html#cb265-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-9"><a href="transforming-data.html#cb265-9" aria-hidden="true" tabindex="-1"></a>city <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(address, <span class="st">&quot;,.*,&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove_all</span>(<span class="st">&quot;,&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_trim</span>()</span>
<span id="cb265-10"><a href="transforming-data.html#cb265-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-11"><a href="transforming-data.html#cb265-11" aria-hidden="true" tabindex="-1"></a>zip <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(address, <span class="st">&quot;[0-9-]{5,10}$&quot;</span>) <span class="co"># match 5 and 9 digit zip codes</span></span></code></pre></div>
<ul>
<li><code>()</code> are used to capture information. So <code>([0-9]{4})</code> captures any 4-digit number</li>
<li><code>a|b</code> will select a or b.</li>
</ul>
<p>If you’ve captured information using (), you can reference that information using backreferences. In most languages, those look like this: <code>\1</code> for the first reference, <code>\9</code> for the ninth. In R, though, the <code>\</code> character is special, so you have to escape it. So in R, <code>\\1</code> is the first reference, and <code>\\2</code> is the second, and so on.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="transforming-data.html#cb266-1" aria-hidden="true" tabindex="-1"></a>phone_num_variants <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;(123) 456-7980&quot;</span>, <span class="st">&quot;123.456.7890&quot;</span>, <span class="st">&quot;+1 123-456-7890&quot;</span>)</span>
<span id="cb266-2"><a href="transforming-data.html#cb266-2" aria-hidden="true" tabindex="-1"></a>phone_regex <span class="ot">&lt;-</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">(?([0-9]{3})?</span><span class="sc">\\</span><span class="st">)?.?([0-9]{3}).?([0-9]{4})&quot;</span></span>
<span id="cb266-3"><a href="transforming-data.html#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="co"># \\( and \\) match literal parentheses if they exist</span></span>
<span id="cb266-4"><a href="transforming-data.html#cb266-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ([0-9]{3})? captures the area code, if it exists</span></span>
<span id="cb266-5"><a href="transforming-data.html#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="co"># .? matches any character</span></span>
<span id="cb266-6"><a href="transforming-data.html#cb266-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ([0-9]{3}) captures the exchange code</span></span>
<span id="cb266-7"><a href="transforming-data.html#cb266-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ([0-9]{4}) captures the 4-digit individual code</span></span>
<span id="cb266-8"><a href="transforming-data.html#cb266-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-9"><a href="transforming-data.html#cb266-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(phone_num_variants, phone_regex)</span>
<span id="cb266-10"><a href="transforming-data.html#cb266-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;(123) 456-7980&quot;</span> <span class="st">&quot;123.456.7890&quot;</span>   <span class="st">&quot;123-456-7890&quot;</span>  </span>
<span id="cb266-11"><a href="transforming-data.html#cb266-11" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(phone_num_variants, phone_regex, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1</span><span class="sc">\\</span><span class="st">2</span><span class="sc">\\</span><span class="st">3&quot;</span>)</span>
<span id="cb266-12"><a href="transforming-data.html#cb266-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;1234567980&quot;</span>    <span class="st">&quot;1234567890&quot;</span>    <span class="st">&quot;+1 1234567890&quot;</span></span>
<span id="cb266-13"><a href="transforming-data.html#cb266-13" aria-hidden="true" tabindex="-1"></a><span class="co"># We didn&#39;t capture the country code, so it remained in the string</span></span>
<span id="cb266-14"><a href="transforming-data.html#cb266-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-15"><a href="transforming-data.html#cb266-15" aria-hidden="true" tabindex="-1"></a>human_talk <span class="ot">&lt;-</span> <span class="st">&quot;blah, blah, blah. Do you want to go for a walk? I think I&#39;m going to treat myself to some ice cream for working so hard. &quot;</span></span>
<span id="cb266-16"><a href="transforming-data.html#cb266-16" aria-hidden="true" tabindex="-1"></a>dog_hears <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(human_talk, <span class="st">&quot;walk|treat&quot;</span>)</span>
<span id="cb266-17"><a href="transforming-data.html#cb266-17" aria-hidden="true" tabindex="-1"></a>dog_hears</span>
<span id="cb266-18"><a href="transforming-data.html#cb266-18" aria-hidden="true" tabindex="-1"></a>[[<span class="dv">1</span>]]</span>
<span id="cb266-19"><a href="transforming-data.html#cb266-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;walk&quot;</span>  <span class="st">&quot;treat&quot;</span></span></code></pre></div>
</details>
<p>In SAS, much the same information is true, though you do not have to double-escape special characters. SAS uses PERL-compatible regular expressions (PCRE for short) (these can also be enabled in base-R string functions).</p>
<p>In PCRE regular expressions, ‘/’ are used as delimiters. SAS assigns each sequential regular expression a number (so that you can reference them if necessary).</p>
<details>
<summary>
PRXMATCH returns the first position of a string where a match is found (0 otherwise)
</summary>
<p>In this example, however, lets just test to see whether PRXMATCH finds a match or not</p>
<pre class="sashtml"><code>DATA strings;
  INFILE DATALINES DSD; /* This allows quoted strings */
  INPUT string ~ $150.; /* ~ says deal with quoted strings */
  DATALINES;
&quot;abcdefghijklmnopqrstuvwxyzABAB&quot;
&quot;banana orange strawberry apple&quot;
&quot;ana went to montana to eat a banana&quot;
&quot;call me at 432-394-2873. Do you want to go for a walk? I&#39;m going to treat myself to some ice cream for working so hard.&quot;
&quot;phone: (123) 456-7890, nuid: 12345678, bank account balance: $50,000,000.23&quot;
&quot;1600 Pennsylvania Ave NW, Washington D.C., 20500&quot;
RUN;

DATA info;
set strings;
  IF PRXMATCH(&quot;/\(?([0-9]{3})?\)?.?([0-9]{3}).([0-9]{4})/&quot;, string) GT 0 THEN phone = 1;
    ELSE phone = 0;
  IF PRXMATCH(&quot;/(walk|treat)/&quot;, string) GT 0 THEN dog = 1;
    ELSE dog = 0;
  IF PRXMATCH(&quot;/([0-9]*) ([A-z0-9 ]{3,}), ([A-z\. ]{3,}), ([0-9]{5})/&quot;, string) GT 0 THEN addr = 1;
    ELSE addr = 0; /* Changed to require at least 3 characters in street and city names */
  IF PRXMATCH(&quot;/(..)\1/&quot;, string) GT 0 THEN abab = 1;
    ELSE abab = 0;
;

PROC PRINT DATA=info;
RUN;</code></pre>
<div class="branch">
<a name="IDX4"></a>
<div>
<div align="center">
<!--BEGINTABLE-->
<table class="table" style=" border-left-width: 0px; border-right-width: 0px;" cellspacing="0" cellpadding="7" rules="groups" frame="hsides" bordercolor="#C1C1C1" summary="Procedure Print: Data Set WORK.INFO">
<colgroup>
<col>
</colgroup>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="r header" scope="col">
Obs
</th>
<th class="l header" scope="col">
string
</th>
<th class="r header" scope="col">
phone
</th>
<th class="r header" scope="col">
dog
</th>
<th class="r header" scope="col">
addr
</th>
<th class="r header" scope="col">
abab
</th>
</tr>
</thead>
<tbody>
<tr>
<th class="r rowheader" scope="row">
1
</th>
<td class="l data">
“abcdefghijklmnopqrstuvwxyzABAB”
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
<td class="r data">
1
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
2
</th>
<td class="l data">
“banana orange strawberry apple”
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
<td class="r data">
1
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
3
</th>
<td class="l data">
“ana went to montana to eat a banana”
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
<td class="r data">
1
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
4
</th>
<td class="l data">
“call me at 432-394-2873. Do you want to go for a walk? I'm going to treat myself to some ice cream for working so hard.”
</td>
<td class="r data">
1
</td>
<td class="r data">
1
</td>
<td class="r data">
0
</td>
<td class="r data">
1
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
5
</th>
<td class="l data">
“phone: (123) 456-7890, nuid: 12345678, bank account balance: $50,000,000.23”
</td>
<td class="r data">
1
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
<td class="r data">
1
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
6
</th>
<td class="l data">
“1600 Pennsylvania Ave NW, Washington D.C., 20500”
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
<td class="r data">
1
</td>
<td class="r data">
1
</td>
</tr>
</tbody>
</table>
<!--ENDTABLE-->
</div>
</div>
<br>
</div>
<p>Note that the equivalent syntax in R would be:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="transforming-data.html#cb268-1" aria-hidden="true" tabindex="-1"></a>strings <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;abcdefghijklmnopqrstuvwxyzABAB&quot;</span>,</span>
<span id="cb268-2"><a href="transforming-data.html#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;banana orange strawberry apple&quot;</span>,</span>
<span id="cb268-3"><a href="transforming-data.html#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;ana went to montana to eat a banana&quot;</span>,</span>
<span id="cb268-4"><a href="transforming-data.html#cb268-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;call me at 432-394-2873. Do you want to go for a walk? I&#39;m going to treat myself to some ice cream for working so hard.&quot;</span>,</span>
<span id="cb268-5"><a href="transforming-data.html#cb268-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;phone: (123) 456-7890, nuid: 12345678, bank account balance: $50,000,000.23&quot;</span>,</span>
<span id="cb268-6"><a href="transforming-data.html#cb268-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;1600 Pennsylvania Ave NW, Washington D.C., 20500&quot;</span>)</span>
<span id="cb268-7"><a href="transforming-data.html#cb268-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-8"><a href="transforming-data.html#cb268-8" aria-hidden="true" tabindex="-1"></a>phone_regex <span class="ot">&lt;-</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">(?([0-9]{3})?</span><span class="sc">\\</span><span class="st">)?.?([0-9]{3}).([0-9]{4})&quot;</span></span>
<span id="cb268-9"><a href="transforming-data.html#cb268-9" aria-hidden="true" tabindex="-1"></a>dog_regex <span class="ot">&lt;-</span> <span class="st">&quot;(walk|treat)&quot;</span></span>
<span id="cb268-10"><a href="transforming-data.html#cb268-10" aria-hidden="true" tabindex="-1"></a>addr_regex <span class="ot">&lt;-</span> <span class="st">&quot;([0-9]*) ([A-z0-9 ]{3,}), ([A-z</span><span class="sc">\\</span><span class="st">. ]{3,}), ([0-9]{5})&quot;</span></span>
<span id="cb268-11"><a href="transforming-data.html#cb268-11" aria-hidden="true" tabindex="-1"></a>abab_regex <span class="ot">&lt;-</span> <span class="st">&quot;(..)</span><span class="sc">\\</span><span class="st">1&quot;</span></span>
<span id="cb268-12"><a href="transforming-data.html#cb268-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-13"><a href="transforming-data.html#cb268-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb268-14"><a href="transforming-data.html#cb268-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> strings,</span>
<span id="cb268-15"><a href="transforming-data.html#cb268-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">phone =</span> <span class="fu">str_detect</span>(strings, phone_regex),</span>
<span id="cb268-16"><a href="transforming-data.html#cb268-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">dog =</span> <span class="fu">str_detect</span>(strings, dog_regex),</span>
<span id="cb268-17"><a href="transforming-data.html#cb268-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">addr =</span> <span class="fu">str_detect</span>(strings, addr_regex),</span>
<span id="cb268-18"><a href="transforming-data.html#cb268-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">abab =</span> <span class="fu">str_detect</span>(strings, abab_regex))</span>
<span id="cb268-19"><a href="transforming-data.html#cb268-19" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 5</span></span>
<span id="cb268-20"><a href="transforming-data.html#cb268-20" aria-hidden="true" tabindex="-1"></a>  text                                                   phone dog   addr  abab </span>
<span id="cb268-21"><a href="transforming-data.html#cb268-21" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                                                  <span class="er">&lt;</span>lgl<span class="sc">&gt;</span> <span class="er">&lt;</span>lgl<span class="sc">&gt;</span> <span class="er">&lt;</span>lgl<span class="sc">&gt;</span> <span class="er">&lt;</span>lgl<span class="sc">&gt;</span></span>
<span id="cb268-22"><a href="transforming-data.html#cb268-22" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> abcdefghijklmnopqrstuvwxyzABAB                         <span class="cn">FALSE</span> <span class="cn">FALSE</span> <span class="cn">FALSE</span> <span class="cn">TRUE</span> </span>
<span id="cb268-23"><a href="transforming-data.html#cb268-23" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> banana orange strawberry apple                         <span class="cn">FALSE</span> <span class="cn">FALSE</span> <span class="cn">FALSE</span> <span class="cn">TRUE</span> </span>
<span id="cb268-24"><a href="transforming-data.html#cb268-24" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> ana went to montana to eat a banana                    <span class="cn">FALSE</span> <span class="cn">FALSE</span> <span class="cn">FALSE</span> <span class="cn">TRUE</span> </span>
<span id="cb268-25"><a href="transforming-data.html#cb268-25" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> call me at <span class="dv">432-394</span><span class="fl">-2873.</span> Do you want to go <span class="cf">for</span> a walk… <span class="cn">TRUE</span>  <span class="cn">TRUE</span>  <span class="cn">FALSE</span> <span class="cn">FALSE</span></span>
<span id="cb268-26"><a href="transforming-data.html#cb268-26" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> phone<span class="sc">:</span> (<span class="dv">123</span>) <span class="dv">456-7890</span>, nuid<span class="sc">:</span> <span class="dv">12345678</span>, bank account b… <span class="cn">TRUE</span>  <span class="cn">FALSE</span> <span class="cn">FALSE</span> <span class="cn">FALSE</span></span>
<span id="cb268-27"><a href="transforming-data.html#cb268-27" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1600</span> Pennsylvania Ave NW, Washington D.C., <span class="dv">20500</span>       <span class="cn">FALSE</span> <span class="cn">FALSE</span> <span class="cn">TRUE</span>  <span class="cn">FALSE</span></span></code></pre></div>
</details>
<p>When doing various operations with regular expressions, it can be useful to save the regular expression for later use.</p>
<ul>
<li>PRXPARSE saves a regex for use later</li>
<li>PRXSUBSTR saves the starting location and length of a string match</li>
<li>SUBSTR extracts the string given the starting location and length</li>
</ul>
<details>
<summary>
PRXPARSE, PRXSUBSTR, SUBSTR
</summary>
<pre class="sashtml"><code>DATA strings;
  INFILE DATALINES DSD; /* This allows quoted strings */
  INPUT string ~ $150.; /* ~ says deal with quoted strings */
  DATALINES;
&quot;abcdefghijklmnopqrstuvwxyzABAB&quot;
&quot;banana orange strawberry apple&quot;
&quot;ana went to montana to eat a banana&quot;
&quot;call me at 432-394-2873. Do you want to go for a walk? I&#39;m going to treat myself to some ice cream for working so hard.&quot;
&quot;phone: (123) 456-7890, nuid: 12345678, bank account balance: $50,000,000.23&quot;
&quot;1600 Pennsylvania Ave NW, Washington D.C., 20500&quot;
RUN;

DATA info;
  SET strings;
  /* This says use these variables for all rows */
  RETAIN REphone REdog REaddr REabab; 
  
  /* This block defined our variables */
  IF _N_ = 1 THEN DO;
    REphone = PRXPARSE(&quot;/\(?([0-9]{3})?\)?.?([0-9]{3}).([0-9]{4})/&quot;);
    REdog = PRXPARSE(&quot;/(walk|treat)/&quot;);
    REaddr = PRXPARSE(&quot;/([0-9]*) ([A-z0-9 ]{3,}), ([A-z\. ]{3,}), ([0-9]{5})/&quot;);
    REabab = PRXPARSE(&quot;/(..)\1/&quot;);
  END;
  
  /* This block identifies string start and length for matches */
  /* Note that phonestart, phonelength, dogstart, doglength, ... 
     are all defined implicitly in this block */
  CALL PRXSUBSTR(REphone, string, phonestart, phonelength);
  CALL PRXSUBSTR(REdog, string, dogstart, doglength);
  CALL PRXSUBSTR(REaddr, string, addrstart, addrlength);
  CALL PRXSUBSTR(REabab, string, ababstart, abablength);

  /* This block extracts all of the matches */
  IF phonestart GT 0 THEN DO;
    phonenumber = SUBSTR(string, phonestart, phonelength);
  END;
  IF dogstart GT 0 THEN DO;
    dogword = SUBSTR(string, dogstart, doglength);
  END;
  IF addrstart GT 0 THEN DO;
    addr = SUBSTR(string, addrstart, addrlength);
  END;
  IF ababstart GT 0 THEN DO;
    abab = SUBSTR(string, ababstart, abablength);
  END;


  /* This block keeps only rows with a phone number, dog keyword, or address */
  IF (phonestart GT 0) OR (dogstart GT 0) OR (addrstart GT 0) OR (ababstart GT 0) THEN DO;
    OUTPUT;
  END;

  /* This keeps only the variables we care about */
  KEEP string phonenumber dogword addr abab;
;

PROC PRINT DATA=info;
RUN;</code></pre>
<div class="branch">
<a name="IDX5"></a>
<div>
<div align="center">
<!--BEGINTABLE-->
<table class="table" style=" border-left-width: 0px; border-right-width: 0px;" cellspacing="0" cellpadding="7" rules="groups" frame="hsides" bordercolor="#C1C1C1" summary="Procedure Print: Data Set WORK.INFO">
<colgroup>
<col>
</colgroup>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="r header" scope="col">
Obs
</th>
<th class="l header" scope="col">
string
</th>
<th class="l header" scope="col">
phonenumber
</th>
<th class="l header" scope="col">
dogword
</th>
<th class="l header" scope="col">
addr
</th>
<th class="l header" scope="col">
abab
</th>
</tr>
</thead>
<tbody>
<tr>
<th class="r rowheader" scope="row">
1
</th>
<td class="l data">
“abcdefghijklmnopqrstuvwxyzABAB”
</td>
<td class="l data">
</td>
<td class="l data">
</td>
<td class="l data">
</td>
<td class="l data">
ABAB
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
2
</th>
<td class="l data">
“banana orange strawberry apple”
</td>
<td class="l data">
</td>
<td class="l data">
</td>
<td class="l data">
</td>
<td class="l data">
anan
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
3
</th>
<td class="l data">
“ana went to montana to eat a banana”
</td>
<td class="l data">
</td>
<td class="l data">
</td>
<td class="l data">
</td>
<td class="l data">
anan
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
4
</th>
<td class="l data">
“call me at 432-394-2873. Do you want to go for a walk? I'm going to treat myself to some ice cream for working so hard.”
</td>
<td class="l data" nowrap>
432-394-2873
</td>
<td class="l data">
walk
</td>
<td class="l data">
</td>
<td class="l data">
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
5
</th>
<td class="l data">
“phone: (123) 456-7890, nuid: 12345678, bank account balance: $50,000,000.23”
</td>
<td class="l data" nowrap>
<ol start="123" style="list-style-type: decimal">
<li>456-7890
</td>
<td class="l data">
</td>
<td class="l data">
</td>
<td class="l data">
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
6
</th>
<td class="l data">
“1600 Pennsylvania Ave NW, Washington D.C., 20500”
</td>
<td class="l data">
</td>
<td class="l data">
</td>
<td class="l data">
1600 Pennsylvania Ave NW, Washington D.C., 20500
</td>
<td class="l data">
</td>
</tr>
</tbody>
</table>
<!--ENDTABLE-->
</div>
</div>
<br>
</div></li>
</ol>
<p>Note that the equivalent syntax in R would be:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="transforming-data.html#cb270-1" aria-hidden="true" tabindex="-1"></a>strings <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;abcdefghijklmnopqrstuvwxyzABAB&quot;</span>,</span>
<span id="cb270-2"><a href="transforming-data.html#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;banana orange strawberry apple&quot;</span>,</span>
<span id="cb270-3"><a href="transforming-data.html#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;ana went to montana to eat a banana&quot;</span>,</span>
<span id="cb270-4"><a href="transforming-data.html#cb270-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;call me at 432-394-2873. Do you want to go for a walk? I&#39;m going to treat myself to some ice cream for working so hard.&quot;</span>,</span>
<span id="cb270-5"><a href="transforming-data.html#cb270-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;phone: (123) 456-7890, nuid: 12345678, bank account balance: $50,000,000.23&quot;</span>,</span>
<span id="cb270-6"><a href="transforming-data.html#cb270-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;1600 Pennsylvania Ave NW, Washington D.C., 20500&quot;</span>)</span>
<span id="cb270-7"><a href="transforming-data.html#cb270-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-8"><a href="transforming-data.html#cb270-8" aria-hidden="true" tabindex="-1"></a>phone_regex <span class="ot">&lt;-</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">(?([0-9]{3})?</span><span class="sc">\\</span><span class="st">)?.?([0-9]{3}).([0-9]{4})&quot;</span></span>
<span id="cb270-9"><a href="transforming-data.html#cb270-9" aria-hidden="true" tabindex="-1"></a>dog_regex <span class="ot">&lt;-</span> <span class="st">&quot;(walk|treat)&quot;</span></span>
<span id="cb270-10"><a href="transforming-data.html#cb270-10" aria-hidden="true" tabindex="-1"></a>addr_regex <span class="ot">&lt;-</span> <span class="st">&quot;([0-9]*) ([A-z0-9 ]{3,}), ([A-z</span><span class="sc">\\</span><span class="st">. ]{3,}), ([0-9]{5})&quot;</span></span>
<span id="cb270-11"><a href="transforming-data.html#cb270-11" aria-hidden="true" tabindex="-1"></a>abab_regex <span class="ot">&lt;-</span> <span class="st">&quot;(..)</span><span class="sc">\\</span><span class="st">1&quot;</span></span>
<span id="cb270-12"><a href="transforming-data.html#cb270-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-13"><a href="transforming-data.html#cb270-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb270-14"><a href="transforming-data.html#cb270-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> strings,</span>
<span id="cb270-15"><a href="transforming-data.html#cb270-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">phone =</span> <span class="fu">str_extract</span>(strings, phone_regex),</span>
<span id="cb270-16"><a href="transforming-data.html#cb270-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">dog =</span> <span class="fu">str_extract</span>(strings, dog_regex),</span>
<span id="cb270-17"><a href="transforming-data.html#cb270-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">addr =</span> <span class="fu">str_extract</span>(strings, addr_regex),</span>
<span id="cb270-18"><a href="transforming-data.html#cb270-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">abab =</span> <span class="fu">str_extract</span>(strings, abab_regex))</span>
<span id="cb270-19"><a href="transforming-data.html#cb270-19" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 5</span></span>
<span id="cb270-20"><a href="transforming-data.html#cb270-20" aria-hidden="true" tabindex="-1"></a>  text                               phone     dog   addr                  abab </span>
<span id="cb270-21"><a href="transforming-data.html#cb270-21" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                              <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>                 <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb270-22"><a href="transforming-data.html#cb270-22" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> abcdefghijklmnopqrstuvwxyzABAB     <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>      <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>                  ABAB </span>
<span id="cb270-23"><a href="transforming-data.html#cb270-23" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> banana orange strawberry apple     <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>      <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>                  anan </span>
<span id="cb270-24"><a href="transforming-data.html#cb270-24" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> ana went to montana to eat a bana… <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>      <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>                  anan </span>
<span id="cb270-25"><a href="transforming-data.html#cb270-25" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> call me at <span class="dv">432-394</span><span class="fl">-2873.</span> Do you w… <span class="dv">432-394</span><span class="sc">-</span>… walk  <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>                  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb270-26"><a href="transforming-data.html#cb270-26" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> phone<span class="sc">:</span> (<span class="dv">123</span>) <span class="dv">456-7890</span>, nuid<span class="sc">:</span> 1234… (<span class="dv">123</span>) 45… <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>                  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb270-27"><a href="transforming-data.html#cb270-27" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1600</span> Pennsylvania Ave NW, Washing… <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>      <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">1600</span> Pennsylvania Av… <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span></code></pre></div>
</details>
<details>
<summary>
Find and Replace with PRXCHANGE
</summary>
<p>The next major task is find and replace, where we get to see another feature of perl-style regular expressions. ‘s/xxx/yyy/’ is the general form of a find-and-replace regular expression. Think “substitue yyy for xxx.”</p>
<pre class="sashtml"><code>DATA ducks;
INFILE DATALINES DSD;
INPUT line ~ $50.;
DATALINES;
&quot;Five little ducks went out one day,&quot;
&quot;Over the hills and far away.&quot;
&quot;Mother duck said, quack quack quack quack,&quot;
&quot;But only four little ducks came back.&quot;
RUN;

DATA cats;
SET ducks;
/* define lengths of output strings */
LENGTH new_text $ 50 new_text2 $ 50;

IF _N_ = 1 THEN DO;
  REanimal = PRXPARSE(&quot;s/duck/cat/&quot;);
  REnoise = PRXPARSE(&quot;s/quack/meow/&quot;);
END;
RETAIN REanimal REnoise;

/* First, replace duck with cat */
CALL PRXCHANGE(REanimal, -1, line, new_text, r_length, trunc, n_of_changes);

/* Then, fix noises */
CALL PRXCHANGE(REnoise, -1, new_text, new_text2, r_length2, trunc2, n_of_changes2);

/* Warnings if anything was truncated */
IF trunc THEN PUT &quot;Note: new_text was truncated&quot;;
IF trunc2 THEN PUT &quot;Note: new_text2 was truncated&quot;;
RUN;

PROC PRINT DATA=cats;
RUN;</code></pre>
<div class="branch">
<a name="IDX6"></a>
<div>
<div align="center">
<!--BEGINTABLE-->
<table class="table" style=" border-left-width: 0px; border-right-width: 0px;" cellspacing="0" cellpadding="7" rules="groups" frame="hsides" bordercolor="#C1C1C1" summary="Procedure Print: Data Set WORK.CATS">
<colgroup>
<col>
</colgroup>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="r header" scope="col">
Obs
</th>
<th class="l header" scope="col">
line
</th>
<th class="l header" scope="col">
new_text
</th>
<th class="l header" scope="col">
new_text2
</th>
<th class="r header" scope="col">
REanimal
</th>
<th class="r header" scope="col">
REnoise
</th>
<th class="r header" scope="col">
r_length
</th>
<th class="r header" scope="col">
trunc
</th>
<th class="r header" scope="col">
n_of_changes
</th>
<th class="r header" scope="col">
r_length2
</th>
<th class="r header" scope="col">
trunc2
</th>
<th class="r header" scope="col">
n_of_changes2
</th>
</tr>
</thead>
<tbody>
<tr>
<th class="r rowheader" scope="row">
1
</th>
<td class="l data">
“Five little ducks went out one day,”
</td>
<td class="l data">
“Five little cats went out one day,”
</td>
<td class="l data">
“Five little cats went out one day,”
</td>
<td class="r data">
1
</td>
<td class="r data">
2
</td>
<td class="r data">
49
</td>
<td class="r data">
0
</td>
<td class="r data">
1
</td>
<td class="r data">
50
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
2
</th>
<td class="l data">
“Over the hills and far away.”
</td>
<td class="l data">
“Over the hills and far away.”
</td>
<td class="l data">
“Over the hills and far away.”
</td>
<td class="r data">
1
</td>
<td class="r data">
2
</td>
<td class="r data">
50
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
<td class="r data">
50
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
3
</th>
<td class="l data">
“Mother duck said, quack quack quack quack,”
</td>
<td class="l data">
“Mother cat said, quack quack quack quack,”
</td>
<td class="l data">
“Mother cat said, meow meow meow meow,”
</td>
<td class="r data">
1
</td>
<td class="r data">
2
</td>
<td class="r data">
49
</td>
<td class="r data">
0
</td>
<td class="r data">
1
</td>
<td class="r data">
46
</td>
<td class="r data">
0
</td>
<td class="r data">
4
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
4
</th>
<td class="l data">
“But only four little ducks came back.”
</td>
<td class="l data">
“But only four little cats came back.”
</td>
<td class="l data">
“But only four little cats came back.”
</td>
<td class="r data">
1
</td>
<td class="r data">
2
</td>
<td class="r data">
49
</td>
<td class="r data">
0
</td>
<td class="r data">
1
</td>
<td class="r data">
50
</td>
<td class="r data">
0
</td>
<td class="r data">
0
</td>
</tr>
</tbody>
</table>
<!--ENDTABLE-->
</div>
</div>
<br>
</div>
<p>The equivalent R code:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="transforming-data.html#cb272-1" aria-hidden="true" tabindex="-1"></a>line <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb272-2"><a href="transforming-data.html#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Five little ducks went out one day,&quot;</span>,</span>
<span id="cb272-3"><a href="transforming-data.html#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Over the hills and far away.&quot;</span>,</span>
<span id="cb272-4"><a href="transforming-data.html#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Mother duck said, quack quack quack quack,&quot;</span>,</span>
<span id="cb272-5"><a href="transforming-data.html#cb272-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;But only four little ducks came back.&quot;</span></span>
<span id="cb272-6"><a href="transforming-data.html#cb272-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb272-7"><a href="transforming-data.html#cb272-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-8"><a href="transforming-data.html#cb272-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(line, <span class="st">&quot;duck&quot;</span>, <span class="st">&quot;cat&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb272-9"><a href="transforming-data.html#cb272-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">&quot;quack&quot;</span>, <span class="st">&quot;meow&quot;</span>)</span>
<span id="cb272-10"><a href="transforming-data.html#cb272-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Five little cats went out one day,&quot;</span>   </span>
<span id="cb272-11"><a href="transforming-data.html#cb272-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>] <span class="st">&quot;Over the hills and far away.&quot;</span>         </span>
<span id="cb272-12"><a href="transforming-data.html#cb272-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span>] <span class="st">&quot;Mother cat said, meow meow meow meow,&quot;</span></span>
<span id="cb272-13"><a href="transforming-data.html#cb272-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">4</span>] <span class="st">&quot;But only four little cats came back.&quot;</span> </span>
<span id="cb272-14"><a href="transforming-data.html#cb272-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-15"><a href="transforming-data.html#cb272-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Or, in one line... </span></span>
<span id="cb272-16"><a href="transforming-data.html#cb272-16" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(line, <span class="fu">c</span>(<span class="st">&quot;duck&quot;</span> <span class="ot">=</span> <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;quack&quot;</span> <span class="ot">=</span> <span class="st">&quot;meow&quot;</span>))</span>
<span id="cb272-17"><a href="transforming-data.html#cb272-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Five little cats went out one day,&quot;</span>   </span>
<span id="cb272-18"><a href="transforming-data.html#cb272-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>] <span class="st">&quot;Over the hills and far away.&quot;</span>         </span>
<span id="cb272-19"><a href="transforming-data.html#cb272-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span>] <span class="st">&quot;Mother cat said, meow meow meow meow,&quot;</span></span>
<span id="cb272-20"><a href="transforming-data.html#cb272-20" aria-hidden="true" tabindex="-1"></a>[<span class="dv">4</span>] <span class="st">&quot;But only four little cats came back.&quot;</span> </span></code></pre></div>
In PCRE, a backreference in the same expression would be <code>\1</code>, <code>\2</code>, etc., but if you are in the replace block of the regex, you would use <code>$1</code>, <code>$2</code>, ….
</details>
<div class="note">
<p>Don’t expect too much out of yourself as far as regular expressions go. I used them for almost a decade before I (mostly) quit googling “regex for …” to find somewhere to start.</p>
<p>Another thing to realize - regular expressions are 100% a language you write, but don’t ever expect to read. So leave yourself lots of comments.</p>
</div>
<div id="try-it-out---squirrel-census" class="section level4 unnumbered tryitout">
<h4>Try it out - Squirrel Census</h4>
<p>The Squirrel Census (<a href="https://www.thesquirrelcensus.com/" class="uri">https://www.thesquirrelcensus.com/</a>) is a multimedia science, design, and storytelling project focusing on the Eastern gray (Sciurus carolinensis) in NYC’s Central Park. They count squirrels and present their findings to the public. This table contains squirrel data for each of the 3,023 sightings, including location coordinates, age, primary and secondary fur color, elevation, activities, communications, and interactions between squirrels and with humans.</p>
<details>
<summary>
Task 1: Fix the date!
</summary>
<p>In both SAS and R, read in the data (<a href="data/2018_Central_Park_Squirrel_Census_-_Squirrel_Data.csv">link</a>) and format the date correctly. You can do this by carefully specifying how the date is read in (?read_csv in R, <a href="https://documentation.sas.com/?docsetId=etsug&amp;docsetTarget=etsug_intervals_sect009.htm&amp;docsetVersion=15.1&amp;locale=en">informat</a> in SAS)</p>
<details>
<summary>
R solution
</summary>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="transforming-data.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb273-2"><a href="transforming-data.html#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb273-3"><a href="transforming-data.html#cb273-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-4"><a href="transforming-data.html#cb273-4" aria-hidden="true" tabindex="-1"></a>Attaching package<span class="sc">:</span> <span class="st">&#39;lubridate&#39;</span></span>
<span id="cb273-5"><a href="transforming-data.html#cb273-5" aria-hidden="true" tabindex="-1"></a>The following objects are masked from <span class="st">&#39;package:base&#39;</span><span class="sc">:</span></span>
<span id="cb273-6"><a href="transforming-data.html#cb273-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-7"><a href="transforming-data.html#cb273-7" aria-hidden="true" tabindex="-1"></a>    date, intersect, setdiff, union</span>
<span id="cb273-8"><a href="transforming-data.html#cb273-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-9"><a href="transforming-data.html#cb273-9" aria-hidden="true" tabindex="-1"></a>squirrels <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/2018_Central_Park_Squirrel_Census_-_Squirrel_Data.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb273-10"><a href="transforming-data.html#cb273-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.character</span>(Date) <span class="sc">%&gt;%</span> <span class="fu">mdy</span>())</span>
<span id="cb273-11"><a href="transforming-data.html#cb273-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-12"><a href="transforming-data.html#cb273-12" aria-hidden="true" tabindex="-1"></a>── Column specification ────────────────────────────────────────────────────────</span>
<span id="cb273-13"><a href="transforming-data.html#cb273-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cols</span>(</span>
<span id="cb273-14"><a href="transforming-data.html#cb273-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="fu">col_character</span>(),</span>
<span id="cb273-15"><a href="transforming-data.html#cb273-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="fu">col_double</span>(),</span>
<span id="cb273-16"><a href="transforming-data.html#cb273-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> <span class="fu">col_double</span>(),</span>
<span id="cb273-17"><a href="transforming-data.html#cb273-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date =</span> <span class="fu">col_double</span>(),</span>
<span id="cb273-18"><a href="transforming-data.html#cb273-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Hectare Squirrel Number</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_double</span>(),</span>
<span id="cb273-19"><a href="transforming-data.html#cb273-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Running =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-20"><a href="transforming-data.html#cb273-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Chasing =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-21"><a href="transforming-data.html#cb273-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Climbing =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-22"><a href="transforming-data.html#cb273-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">Eating =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-23"><a href="transforming-data.html#cb273-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Foraging =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-24"><a href="transforming-data.html#cb273-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kuks =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-25"><a href="transforming-data.html#cb273-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">Quaas =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-26"><a href="transforming-data.html#cb273-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">Moans =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-27"><a href="transforming-data.html#cb273-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Tail flags</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-28"><a href="transforming-data.html#cb273-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Tail twitches</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-29"><a href="transforming-data.html#cb273-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Approaches =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-30"><a href="transforming-data.html#cb273-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">Indifferent =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-31"><a href="transforming-data.html#cb273-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Runs from</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_logical</span>(),</span>
<span id="cb273-32"><a href="transforming-data.html#cb273-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Zip Codes</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_double</span>(),</span>
<span id="cb273-33"><a href="transforming-data.html#cb273-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Community Districts</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_double</span>(),</span>
<span id="cb273-34"><a href="transforming-data.html#cb273-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Borough Boundaries</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_double</span>()</span>
<span id="cb273-35"><a href="transforming-data.html#cb273-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ... with 2 more columns</span></span>
<span id="cb273-36"><a href="transforming-data.html#cb273-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb273-37"><a href="transforming-data.html#cb273-37" aria-hidden="true" tabindex="-1"></a>ℹ Use <span class="st">`</span><span class="at">spec()</span><span class="st">`</span> <span class="cf">for</span> the full column specifications.</span></code></pre></div>
</details>
<details>
<summary>
SAS solution
</summary>
<pre class="sashtml"><code>6          libname classdat &quot;sas/&quot;;
NOTE: Libref CLASSDAT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: 
      /home/susan/Projects/Class/unl-stat850/stat850-textbook/sas
7          
8          filename fileloc
8        ! &#39;data/2018_Central_Park_Squirrel_Census_-_Squirrel_Data.csv&#39;;
9          PROC IMPORT  datafile = fileloc out=classdat.squirrel REPLACE
10         DBMS = csv;
10       !             /* comma delimited file */
11         GUESSINGROWS=500;
12         GETNAMES = YES;
13         RUN;

Name Combination of Primary and Highlight Color truncated to 
Combination_of_Primary_and_Highl.
Problems were detected with provided names.  See LOG. 
14          /**************************************************************
14       ! ********
15          *   PRODUCT:   SAS
16          *   VERSION:   9.4
17          *   CREATOR:   External File Interface
18          *   DATE:      06MAY21
19          *   DESC:      Generated SAS Datastep Code
20          *   TEMPLATE SOURCE:  (None Specified.)
21          ***************************************************************
21       ! ********/
22             data CLASSDAT.SQUIRREL    ;
23             %let _EFIERR_ = 0; /* set the ERROR detection macro variable
23       !  */
24             infile FILELOC delimiter = &#39;,&#39; MISSOVER DSD  firstobs=2 ;
25                informat X best32. ;
26                informat Y best32. ;
27                informat Unique_Squirrel_ID $14. ;
28                informat Hectare $3. ;
29                informat Shift $2. ;
30                informat Date best32. ;
31                informat Hectare_Squirrel_Number best32. ;
32                informat Age $8. ;
33                informat Primary_Fur_Color $8. ;
34                informat Highlight_Fur_Color $24. ;
35                informat Combination_of_Primary_and_Highl $29. ;
36                informat Color_notes $110. ;
37                informat Location $12. ;
38                informat Above_Ground_Sighter_Measurement $5. ;
39                informat Specific_Location $58. ;
40                informat Running $5. ;
41                informat Chasing $5. ;
42                informat Climbing $5. ;
43                informat Eating $5. ;
44                informat Foraging $5. ;
45                informat Other_Activities $134. ;
46                informat Kuks $5. ;
47                informat Quaas $5. ;
48                informat Moans $5. ;
49                informat Tail_flags $5. ;
50                informat Tail_twitches $5. ;
51                informat Approaches $5. ;
52                informat Indifferent $5. ;
53                informat Runs_from $5. ;
54                informat Other_Interactions $70. ;
55                informat Lat_Long $45. ;
56                informat Zip_Codes $1. ;
57                informat Community_Districts best32. ;
58                informat Borough_Boundaries best32. ;
59                informat City_Council_Districts best32. ;
60                informat Police_Precincts best32. ;
61                format X best12. ;
62                format Y best12. ;
63                format Unique_Squirrel_ID $14. ;
64                format Hectare $3. ;
65                format Shift $2. ;
66                format Date best12. ;
67                format Hectare_Squirrel_Number best12. ;
68                format Age $8. ;
69                format Primary_Fur_Color $8. ;
70                format Highlight_Fur_Color $24. ;
71                format Combination_of_Primary_and_Highl $29. ;
72                format Color_notes $110. ;
73                format Location $12. ;
74                format Above_Ground_Sighter_Measurement $5. ;
75                format Specific_Location $58. ;
76                format Running $5. ;
77                format Chasing $5. ;
78                format Climbing $5. ;
79                format Eating $5. ;
80                format Foraging $5. ;
81                format Other_Activities $134. ;
82                format Kuks $5. ;
83                format Quaas $5. ;
84                format Moans $5. ;
85                format Tail_flags $5. ;
86                format Tail_twitches $5. ;
87                format Approaches $5. ;
88                format Indifferent $5. ;
89                format Runs_from $5. ;
90                format Other_Interactions $70. ;
91                format Lat_Long $45. ;
92                format Zip_Codes $1. ;
93                format Community_Districts best12. ;
94                format Borough_Boundaries best12. ;
95                format City_Council_Districts best12. ;
96                format Police_Precincts best12. ;
97             input
98                         X
99                         Y
100                        Unique_Squirrel_ID  $
101                        Hectare  $
102                        Shift  $
103                        Date
104                        Hectare_Squirrel_Number
105                        Age  $
106                        Primary_Fur_Color  $
107                        Highlight_Fur_Color  $
108                        Combination_of_Primary_and_Highl  $
109                        Color_notes  $
110                        Location  $
111                        Above_Ground_Sighter_Measurement  $
112                        Specific_Location  $
113                        Running  $
114                        Chasing  $
115                        Climbing  $
116                        Eating  $
117                        Foraging  $
118                        Other_Activities  $
119                        Kuks  $
120                        Quaas  $
121                        Moans  $
122                        Tail_flags  $
123                        Tail_twitches  $
124                        Approaches  $
125                        Indifferent  $
126                        Runs_from  $
127                        Other_Interactions  $
128                        Lat_Long  $
129                        Zip_Codes  $
130                        Community_Districts
131                        Borough_Boundaries
132                        City_Council_Districts
133                        Police_Precincts
134            ;
135            if _ERROR_ then call symputx(&#39;_EFIERR_&#39;,1);  /* set ERROR
135      ! detection macro variable */
136            run;

NOTE: The infile FILELOC is:
      
      Filename=/home/susan/Projects/Class/unl-stat850/stat850-textbook/data
      /2018_Central_Park_Squirrel_Census_-_Squirrel_Data.csv,
      Owner Name=susan,Group Name=susan,
      Access Permission=-rw-rw-r--,
      Last Modified=23Jun2020:09:12:28,
      File Size (bytes)=784170

NOTE: 3023 records were read from the infile FILELOC.
      The minimum record length was 210.
      The maximum record length was 433.
NOTE: The data set CLASSDAT.SQUIRREL has 3023 observations and 36 
      variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.02 seconds
      

3023 rows created in CLASSDAT.SQUIRREL from FILELOC.
  
  
  
NOTE: CLASSDAT.SQUIRREL data set was successfully created.
NOTE: The data set CLASSDAT.SQUIRREL has 3023 observations and 36 
      variables.
NOTE: PROCEDURE IMPORT used (Total process time):
      real time           0.28 seconds
      cpu time            0.29 seconds
      

137        
138        PROC CONTENTS DATA=classdat.squirrel;
139        RUN;

NOTE: PROCEDURE CONTENTS used (Total process time):
      real time           0.01 seconds
      cpu time            0.02 seconds
      

140        
141        DATA classdat.cleanSquirrel;
142        SET classdat.squirrel;
143        month = FLOOR(date/1000000);
144        day = MOD(FLOOR(date/10000), 100);
145        year = MOD(date, 10000);
146        date = MDY(month, day, year);
147        format date MMDDYY10.;
148        RUN;

NOTE: Data file CLASSDAT.CLEANSQUIRREL.DATA is in a format that is native 
      to another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
ERROR: Some character data was lost during transcoding in the dataset 
       CLASSDAT.CLEANSQUIRREL. Either the data contains characters that 
       are not representable in the new encoding or truncation occurred 
       during transcoding.
NOTE: The DATA step has been abnormally terminated.
NOTE: The SAS System stopped processing this step because of errors.
NOTE: Due to ERROR(s) above, SAS set option OBS=0, enabling syntax check 
      mode. 
      This prevents execution of subsequent data modification statements.
NOTE: There were 1180 observations read from the data set 
      CLASSDAT.SQUIRREL.
WARNING: The data set CLASSDAT.CLEANSQUIRREL may be incomplete.  When this 
         step was stopped there were 1179 observations and 39 variables.
WARNING: Data set CLASSDAT.CLEANSQUIRREL was not replaced because this 
         step was stopped.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

ERROR: Errors printed on page 6.</code></pre>
<div class="branch">
<a name="IDX7"></a>
<div>
<div align="center">
<!--BEGINTABLE-->
<table class="table" style=" border-left-width: 0px; border-right-width: 0px;" cellspacing="0" cellpadding="7" rules="groups" frame="hsides" bordercolor="#C1C1C1" summary="Procedure Contents: Attributes">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<th class="l rowheader" scope="row">
Data Set Name
</th>
<td class="l data">
CLASSDAT.SQUIRREL
</td>
<th class="l rowheader" scope="row">
Observations
</th>
<td class="l data">
3023
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Member Type
</th>
<td class="l data">
DATA
</td>
<th class="l rowheader" scope="row">
Variables
</th>
<td class="l data">
36
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Engine
</th>
<td class="l data">
V9
</td>
<th class="l rowheader" scope="row">
Indexes
</th>
<td class="l data">
0
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Created
</th>
<td class="l data">
05/06/2021 12:25:59
</td>
<th class="l rowheader" scope="row">
Observation Length
</th>
<td class="l data">
656
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Last Modified
</th>
<td class="l data">
05/06/2021 12:25:59
</td>
<th class="l rowheader" scope="row">
Deleted Observations
</th>
<td class="l data">
0
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Protection
</th>
<td class="l data">
</td>
<th class="l rowheader" scope="row">
Compressed
</th>
<td class="l data">
NO
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Data Set Type
</th>
<td class="l data">
</td>
<th class="l rowheader" scope="row">
Sorted
</th>
<td class="l data">
NO
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Label
</th>
<td class="l data">
</td>
<th class="l rowheader" scope="row">
</th>
<td class="l data">
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Data Representation
</th>
<td class="l data">
SOLARIS_X86_64, LINUX_X86_64, ALPHA_TRU64, LINUX_IA64
</td>
<th class="l rowheader" scope="row">
</th>
<td class="l data">
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Encoding
</th>
<td class="l data">
utf-8 Unicode (UTF-8)
</td>
<th class="l rowheader" scope="row">
</th>
<td class="l data">
</td>
</tr>
</tbody>
</table>
<!--ENDTABLE-->
</div>
</div>
<br>
<a name="IDX8"></a>
<div>
<div align="center">
<!--BEGINTABLE-->
<table class="table" style=" border-left-width: 0px; border-right-width: 0px;" cellspacing="0" cellpadding="7" rules="groups" frame="hsides" bordercolor="#C1C1C1" summary="Procedure Contents: Engine/Host Information">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="c b header" colspan="2" scope="colgroup">
Engine/Host Dependent Information
</th>
</tr>
</thead>
<tbody>
<tr>
<th class="l rowheader" scope="row">
Data Set Page Size
</th>
<td class="l data">
65536
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Number of Data Set Pages
</th>
<td class="l data">
31
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
First Data Page
</th>
<td class="l data">
1
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Max Obs per Page
</th>
<td class="l data">
99
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Obs in First Data Page
</th>
<td class="l data">
89
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Number of Data Set Repairs
</th>
<td class="l data">
0
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Filename
</th>
<td class="l data">
/home/susan/Projects/Class/unl-stat850/stat850-textbook/sas/squirrel.sas7bdat
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Release Created
</th>
<td class="l data">
9.0401M6
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Host Created
</th>
<td class="l data">
Linux
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Inode Number
</th>
<td class="l data">
39064960
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Access Permission
</th>
<td class="l data">
rw-rw-r–
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
Owner Name
</th>
<td class="l data">
susan
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
File Size
</th>
<td class="l data">
2MB
</td>
</tr>
<tr>
<th class="l rowheader" scope="row">
File Size (bytes)
</th>
<td class="l data">
2097152
</td>
</tr>
</tbody>
</table>
<!--ENDTABLE-->
</div>
</div>
<br>
<a name="IDX9"></a>
<div>
<div align="center">
<!--BEGINTABLE-->
<table class="table" style=" border-left-width: 0px; border-right-width: 0px;" cellspacing="0" cellpadding="7" rules="groups" frame="hsides" bordercolor="#C1C1C1" summary="Procedure Contents: Variables">
<colgroup>
<col>
</colgroup>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="c b header" colspan="6" scope="colgroup">
Alphabetic List of Variables and Attributes
</th>
</tr>
<tr>
<th class="r b header" scope="col">
#
</th>
<th class="l b header" scope="col">
Variable
</th>
<th class="l b header" scope="col">
Type
</th>
<th class="r b header" scope="col">
Len
</th>
<th class="l b header" scope="col">
Format
</th>
<th class="l b header" scope="col">
Informat
</th>
</tr>
</thead>
<tbody>
<tr>
<th class="r rowheader" scope="row">
14
</th>
<td class="l data">
Above_Ground_Sighter_Measurement
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
8
</th>
<td class="l data">
Age
</td>
<td class="l data">
Char
</td>
<td class="r data">
8
</td>
<td class="l data">
$8.
</td>
<td class="l data">
$8.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
27
</th>
<td class="l data">
Approaches
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
34
</th>
<td class="l data">
Borough_Boundaries
</td>
<td class="l data">
Num
</td>
<td class="r data">
8
</td>
<td class="l data">
BEST12.
</td>
<td class="l data">
BEST32.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
17
</th>
<td class="l data">
Chasing
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
35
</th>
<td class="l data">
City_Council_Districts
</td>
<td class="l data">
Num
</td>
<td class="r data">
8
</td>
<td class="l data">
BEST12.
</td>
<td class="l data">
BEST32.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
18
</th>
<td class="l data">
Climbing
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
12
</th>
<td class="l data">
Color_notes
</td>
<td class="l data">
Char
</td>
<td class="r data">
110
</td>
<td class="l data">
$110.
</td>
<td class="l data">
$110.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
11
</th>
<td class="l data">
Combination_of_Primary_and_Highl
</td>
<td class="l data">
Char
</td>
<td class="r data">
29
</td>
<td class="l data">
$29.
</td>
<td class="l data">
$29.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
33
</th>
<td class="l data">
Community_Districts
</td>
<td class="l data">
Num
</td>
<td class="r data">
8
</td>
<td class="l data">
BEST12.
</td>
<td class="l data">
BEST32.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
6
</th>
<td class="l data">
Date
</td>
<td class="l data">
Num
</td>
<td class="r data">
8
</td>
<td class="l data">
BEST12.
</td>
<td class="l data">
BEST32.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
19
</th>
<td class="l data">
Eating
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
20
</th>
<td class="l data">
Foraging
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
4
</th>
<td class="l data">
Hectare
</td>
<td class="l data">
Char
</td>
<td class="r data">
3
</td>
<td class="l data">
$3.
</td>
<td class="l data">
$3.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
7
</th>
<td class="l data">
Hectare_Squirrel_Number
</td>
<td class="l data">
Num
</td>
<td class="r data">
8
</td>
<td class="l data">
BEST12.
</td>
<td class="l data">
BEST32.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
10
</th>
<td class="l data">
Highlight_Fur_Color
</td>
<td class="l data">
Char
</td>
<td class="r data">
24
</td>
<td class="l data">
$24.
</td>
<td class="l data">
$24.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
28
</th>
<td class="l data">
Indifferent
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
22
</th>
<td class="l data">
Kuks
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
31
</th>
<td class="l data">
Lat_Long
</td>
<td class="l data">
Char
</td>
<td class="r data">
45
</td>
<td class="l data">
$45.
</td>
<td class="l data">
$45.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
13
</th>
<td class="l data">
Location
</td>
<td class="l data">
Char
</td>
<td class="r data">
12
</td>
<td class="l data">
$12.
</td>
<td class="l data">
$12.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
24
</th>
<td class="l data">
Moans
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
21
</th>
<td class="l data">
Other_Activities
</td>
<td class="l data">
Char
</td>
<td class="r data">
134
</td>
<td class="l data">
$134.
</td>
<td class="l data">
$134.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
30
</th>
<td class="l data">
Other_Interactions
</td>
<td class="l data">
Char
</td>
<td class="r data">
70
</td>
<td class="l data">
$70.
</td>
<td class="l data">
$70.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
36
</th>
<td class="l data">
Police_Precincts
</td>
<td class="l data">
Num
</td>
<td class="r data">
8
</td>
<td class="l data">
BEST12.
</td>
<td class="l data">
BEST32.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
9
</th>
<td class="l data">
Primary_Fur_Color
</td>
<td class="l data">
Char
</td>
<td class="r data">
8
</td>
<td class="l data">
$8.
</td>
<td class="l data">
$8.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
23
</th>
<td class="l data">
Quaas
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
16
</th>
<td class="l data">
Running
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
29
</th>
<td class="l data">
Runs_from
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
5
</th>
<td class="l data">
Shift
</td>
<td class="l data">
Char
</td>
<td class="r data">
2
</td>
<td class="l data">
$2.
</td>
<td class="l data">
$2.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
15
</th>
<td class="l data">
Specific_Location
</td>
<td class="l data">
Char
</td>
<td class="r data">
58
</td>
<td class="l data">
$58.
</td>
<td class="l data">
$58.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
25
</th>
<td class="l data">
Tail_flags
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
26
</th>
<td class="l data">
Tail_twitches
</td>
<td class="l data">
Char
</td>
<td class="r data">
5
</td>
<td class="l data">
$5.
</td>
<td class="l data">
$5.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
3
</th>
<td class="l data">
Unique_Squirrel_ID
</td>
<td class="l data">
Char
</td>
<td class="r data">
14
</td>
<td class="l data">
$14.
</td>
<td class="l data">
$14.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
1
</th>
<td class="l data">
X
</td>
<td class="l data">
Num
</td>
<td class="r data">
8
</td>
<td class="l data">
BEST12.
</td>
<td class="l data">
BEST32.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
2
</th>
<td class="l data">
Y
</td>
<td class="l data">
Num
</td>
<td class="r data">
8
</td>
<td class="l data">
BEST12.
</td>
<td class="l data">
BEST32.
</td>
</tr>
<tr>
<th class="r rowheader" scope="row">
32
</th>
<td class="l data">
Zip_Codes
</td>
<td class="l data">
Char
</td>
<td class="r data">
1
</td>
<td class="l data">
$1.
</td>
<td class="l data">
$1.
</td>
</tr>
</tbody>
</table>
<!--ENDTABLE-->
</div>
</div>
<br>
</div>
</details>
</details>
<details>
<summary>
Task 2: Clean up the Combination of primary and highlight fur color column
</summary>
<p>A. Get rid of leading and trailing <code>+</code> characters
B. Where two highlight colors exist, add the primary color to both of them (so <code>Gray+Cinnamon, White</code> becomes <code>Gray+Cinnamon, Gray+White</code>)</p>
<p>You can do this by working with the original values or the combination values; whatever is easiest.</p>
<details>
<summary>
R solution
</summary>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="transforming-data.html#cb275-1" aria-hidden="true" tabindex="-1"></a>squirrels_colorfix <span class="ot">&lt;-</span> squirrels <span class="sc">%&gt;%</span></span>
<span id="cb275-2"><a href="transforming-data.html#cb275-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make it easier to join things back together...</span></span>
<span id="cb275-3"><a href="transforming-data.html#cb275-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb275-4"><a href="transforming-data.html#cb275-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep the stuff we need for this</span></span>
<span id="cb275-5"><a href="transforming-data.html#cb275-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, </span>
<span id="cb275-6"><a href="transforming-data.html#cb275-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">primary =</span> <span class="st">`</span><span class="at">Primary Fur Color</span><span class="st">`</span>, </span>
<span id="cb275-7"><a href="transforming-data.html#cb275-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">highlight =</span> <span class="st">`</span><span class="at">Highlight Fur Color</span><span class="st">`</span>, </span>
<span id="cb275-8"><a href="transforming-data.html#cb275-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">combo =</span> <span class="st">`</span><span class="at">Combination of Primary and Highlight Color</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb275-9"><a href="transforming-data.html#cb275-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-10"><a href="transforming-data.html#cb275-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove all single character strings. </span></span>
<span id="cb275-11"><a href="transforming-data.html#cb275-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ^ means &quot;front of string&quot;, $ means &quot;end of string&quot;, and . is a wildcard</span></span>
<span id="cb275-12"><a href="transforming-data.html#cb275-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">combo =</span> <span class="fu">str_remove</span>(combo, <span class="st">&quot;^.$&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb275-13"><a href="transforming-data.html#cb275-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-14"><a href="transforming-data.html#cb275-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove trailing + signs</span></span>
<span id="cb275-15"><a href="transforming-data.html#cb275-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">combo =</span> <span class="fu">str_remove</span>(combo, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">+$&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb275-16"><a href="transforming-data.html#cb275-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-17"><a href="transforming-data.html#cb275-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This allows only two highlight colors</span></span>
<span id="cb275-18"><a href="transforming-data.html#cb275-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">combo =</span> <span class="fu">str_replace</span>(</span>
<span id="cb275-19"><a href="transforming-data.html#cb275-19" aria-hidden="true" tabindex="-1"></a>    combo, </span>
<span id="cb275-20"><a href="transforming-data.html#cb275-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;^(Black|Cinnamon|Gray)</span><span class="sc">\\</span><span class="st">+(Black|Cinnamon|Gray|White), (Black|Cinnamon|Gray|White)$&quot;</span>, </span>
<span id="cb275-21"><a href="transforming-data.html#cb275-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1+</span><span class="sc">\\</span><span class="st">2, </span><span class="sc">\\</span><span class="st">1+</span><span class="sc">\\</span><span class="st">3&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb275-22"><a href="transforming-data.html#cb275-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-23"><a href="transforming-data.html#cb275-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This allows three highlight colors</span></span>
<span id="cb275-24"><a href="transforming-data.html#cb275-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">combo =</span> <span class="fu">str_replace</span>(</span>
<span id="cb275-25"><a href="transforming-data.html#cb275-25" aria-hidden="true" tabindex="-1"></a>    combo, </span>
<span id="cb275-26"><a href="transforming-data.html#cb275-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;^(Black|Cinnamon|Gray)</span><span class="sc">\\</span><span class="st">+(Black|Cinnamon|Gray|White), (Black|Cinnamon|Gray|White), (Black|Cinnamon|Gray|White)$&quot;</span>, </span>
<span id="cb275-27"><a href="transforming-data.html#cb275-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1+</span><span class="sc">\\</span><span class="st">2, </span><span class="sc">\\</span><span class="st">1+</span><span class="sc">\\</span><span class="st">3, </span><span class="sc">\\</span><span class="st">1+</span><span class="sc">\\</span><span class="st">4&quot;</span>))</span>
<span id="cb275-28"><a href="transforming-data.html#cb275-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-29"><a href="transforming-data.html#cb275-29" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(squirrels_colorfix<span class="sc">$</span>combo)</span>
<span id="cb275-30"><a href="transforming-data.html#cb275-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-31"><a href="transforming-data.html#cb275-31" aria-hidden="true" tabindex="-1"></a>                                                                      Black </span>
<span id="cb275-32"><a href="transforming-data.html#cb275-32" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">55</span>                                    <span class="dv">74</span> </span>
<span id="cb275-33"><a href="transforming-data.html#cb275-33" aria-hidden="true" tabindex="-1"></a>                       Black<span class="sc">+</span>Cinnamon           Black<span class="sc">+</span>Cinnamon, Black<span class="sc">+</span>White </span>
<span id="cb275-34"><a href="transforming-data.html#cb275-34" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">15</span>                                     <span class="dv">3</span> </span>
<span id="cb275-35"><a href="transforming-data.html#cb275-35" aria-hidden="true" tabindex="-1"></a>                           Black<span class="sc">+</span>Gray               Black<span class="sc">+</span>Gray, Black<span class="sc">+</span>White </span>
<span id="cb275-36"><a href="transforming-data.html#cb275-36" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">8</span>                                     <span class="dv">1</span> </span>
<span id="cb275-37"><a href="transforming-data.html#cb275-37" aria-hidden="true" tabindex="-1"></a>                          Black<span class="sc">+</span>White                              Cinnamon </span>
<span id="cb275-38"><a href="transforming-data.html#cb275-38" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">2</span>                                    <span class="dv">62</span> </span>
<span id="cb275-39"><a href="transforming-data.html#cb275-39" aria-hidden="true" tabindex="-1"></a>                       Cinnamon<span class="sc">+</span>Black        Cinnamon<span class="sc">+</span>Black, Cinnamon<span class="sc">+</span>White </span>
<span id="cb275-40"><a href="transforming-data.html#cb275-40" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">10</span>                                     <span class="dv">3</span> </span>
<span id="cb275-41"><a href="transforming-data.html#cb275-41" aria-hidden="true" tabindex="-1"></a>                        Cinnamon<span class="sc">+</span>Gray         Cinnamon<span class="sc">+</span>Gray, Cinnamon<span class="sc">+</span>Black </span>
<span id="cb275-42"><a href="transforming-data.html#cb275-42" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">162</span>                                     <span class="dv">3</span> </span>
<span id="cb275-43"><a href="transforming-data.html#cb275-43" aria-hidden="true" tabindex="-1"></a>        Cinnamon<span class="sc">+</span>Gray, Cinnamon<span class="sc">+</span>White                        Cinnamon<span class="sc">+</span>White </span>
<span id="cb275-44"><a href="transforming-data.html#cb275-44" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">58</span>                                    <span class="dv">94</span> </span>
<span id="cb275-45"><a href="transforming-data.html#cb275-45" aria-hidden="true" tabindex="-1"></a>                                 Gray                            Gray<span class="sc">+</span>Black </span>
<span id="cb275-46"><a href="transforming-data.html#cb275-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">895</span>                                    <span class="dv">24</span> </span>
<span id="cb275-47"><a href="transforming-data.html#cb275-47" aria-hidden="true" tabindex="-1"></a>            Gray<span class="sc">+</span>Black, Gray<span class="sc">+</span>Cinnamon Gray<span class="sc">+</span>Black, Gray<span class="sc">+</span>Cinnamon, Gray<span class="sc">+</span>White </span>
<span id="cb275-48"><a href="transforming-data.html#cb275-48" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">9</span>                                    <span class="dv">32</span> </span>
<span id="cb275-49"><a href="transforming-data.html#cb275-49" aria-hidden="true" tabindex="-1"></a>               Gray<span class="sc">+</span>Black, Gray<span class="sc">+</span>White                         Gray<span class="sc">+</span>Cinnamon </span>
<span id="cb275-50"><a href="transforming-data.html#cb275-50" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">7</span>                                   <span class="dv">752</span> </span>
<span id="cb275-51"><a href="transforming-data.html#cb275-51" aria-hidden="true" tabindex="-1"></a>            Gray<span class="sc">+</span>Cinnamon, Gray<span class="sc">+</span>White                            Gray<span class="sc">+</span>White </span>
<span id="cb275-52"><a href="transforming-data.html#cb275-52" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">265</span>                                   <span class="dv">489</span> </span></code></pre></div>
</details>
<details>
<summary>
SAS solution
</summary>
<pre class="sashtml"><code>6          libname classdat &quot;sas/&quot;;
NOTE: Libref CLASSDAT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: 
      /home/susan/Projects/Class/unl-stat850/stat850-textbook/sas
7          
8          DATA squirrelcolor;
9          SET classdat.cleanSquirrel;
NOTE: Data file CLASSDAT.CLEANSQUIRREL.DATA is in a format that is native 
      to another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
10         
11         LENGTH orig  $50 new_text1 $ 50 new_text2 $ 50 new_text3 $ 50;
12         orig = Combination_of_Primary_and_Highl;
13         
14         IF _N_ = 1 THEN DO;
15           REthree =
15       ! PRXPARSE(&quot;s/^(Gray|Cinnamon|Black)\+(Black|Cinnamon|Gray|White),
15       !  (Black|Cinnamon|Gray|White),
15       ! (Black|Cinnamon|Gray|White)$/$1+$2, $1+$3, $1+$4/&quot;);
16           REtwo =
16       ! PRXPARSE(&quot;s/^(Gray|Cinnamon|Black)\+(Black|Cinnamon|Gray|White),
16       !  (Black|Cinnamon|Gray|White)$/$1+$2, $1+$3/&quot;);
17           REplus = PRXPARSE(&quot;s/[^A-z]$//&quot;);
18         END;
19         RETAIN REplus REtwo REthree;
20         
21         CALL PRXCHANGE(REplus, -1, trim(orig), new_text1);
22         CALL PRXCHANGE(REthree, -1, trim(new_text1), new_text2);
23         CALL PRXCHANGE(REtwo, -1, trim(new_text2), new_text3);
24         
25         keep orig new_text1 new_text2 new_text3;
26         RUN;

NOTE: The data set WORK.SQUIRRELCOLOR has 0 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

27         
28         /* print all combinations that occur w/ new value */
29         PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
30         SELECT DISTINCT orig, new_text3 FROM squirrelcolor;
NOTE: Statement not executed due to NOEXEC option.
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on page 9.</code></pre>
</details>
</details>
</div>
</div>
<div id="joining-and-splitting-variables" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Joining and Splitting Variables</h3>
There’s another string-related task that is fairly commonly encountered: separating variables into two different columns (as in Table 3 above).
<div class="figure"><span style="display:block;" id="fig:tidy-separate-pic"></span>
<img src="image/tidyr_separate.png" alt="A visual representation of what separating variables means for data set operations." width="50%" />
<p class="caption">
Figure 7.1: A visual representation of what separating variables means for data set operations.
</p>
</div>
<details>
<summary>
Separating Variables
</summary>
<p>We can use <code>str_extract()</code> if we want, but it’s actually faster to use <code>separate()</code>, which is part of the <code>tidyr</code> package. There is also <code>extract()</code>, which is another <code>tidyr</code> function that uses regular expressions and capture groups to split variables up.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="transforming-data.html#cb277-1" aria-hidden="true" tabindex="-1"></a>table3 <span class="sc">%&gt;%</span></span>
<span id="cb277-2"><a href="transforming-data.html#cb277-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>, <span class="at">remove =</span> F)</span>
<span id="cb277-3"><a href="transforming-data.html#cb277-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 5</span></span>
<span id="cb277-4"><a href="transforming-data.html#cb277-4" aria-hidden="true" tabindex="-1"></a>  country      year rate              cases  population</span>
<span id="cb277-5"><a href="transforming-data.html#cb277-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>             <span class="er">&lt;</span>chr<span class="sc">&gt;</span>  <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     </span>
<span id="cb277-6"><a href="transforming-data.html#cb277-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Afghanistan  <span class="dv">1999</span> <span class="dv">745</span><span class="sc">/</span><span class="dv">19987071</span>      <span class="dv">745</span>    <span class="dv">19987071</span>  </span>
<span id="cb277-7"><a href="transforming-data.html#cb277-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Afghanistan  <span class="dv">2000</span> <span class="dv">2666</span><span class="sc">/</span><span class="dv">20595360</span>     <span class="dv">2666</span>   <span class="dv">20595360</span>  </span>
<span id="cb277-8"><a href="transforming-data.html#cb277-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Brazil       <span class="dv">1999</span> <span class="dv">37737</span><span class="sc">/</span><span class="dv">172006362</span>   <span class="dv">37737</span>  <span class="dv">172006362</span> </span>
<span id="cb277-9"><a href="transforming-data.html#cb277-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> Brazil       <span class="dv">2000</span> <span class="dv">80488</span><span class="sc">/</span><span class="dv">174504898</span>   <span class="dv">80488</span>  <span class="dv">174504898</span> </span>
<span id="cb277-10"><a href="transforming-data.html#cb277-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> China        <span class="dv">1999</span> <span class="dv">212258</span><span class="sc">/</span><span class="dv">1272915272</span> <span class="dv">212258</span> <span class="dv">1272915272</span></span>
<span id="cb277-11"><a href="transforming-data.html#cb277-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> China        <span class="dv">2000</span> <span class="dv">213766</span><span class="sc">/</span><span class="dv">1280428583</span> <span class="dv">213766</span> <span class="dv">1280428583</span></span></code></pre></div>
<p>I’ve left the rate column in the original data frame just to make it easy to compare and verify that yes, it worked.</p>
<p><code>separate()</code> will also take a full on regular expression if you want to capture only parts of a string to put into new columns.</p>
<p><a href="https://communities.sas.com/t5/SAS-Procedures/Splitting-a-delimited-column-into-multiple-columns/td-p/351130">The <code>scan()</code> function in SAS can be used similarly</a>, though it doesn’t have quite the simplicity and convenience of <code>separate</code>.</p>
<pre class="sashtml"><code>NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


6          data table3;
7          length country $12 rate $20;
8          input country $ year rate $;
9          datalines;

NOTE: The data set WORK.TABLE3 has 0 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

16         ;
17         data table3split;
18         set table3;
19         length var1-var2 $10.;
20         array var(2) $;
NOTE: The array var has the same name as a SAS-supplied or user-defined 
      function.  Parentheses following this name are treated as array 
      references and not function references.
21         do i = 1 to dim(var);
22           var[i]=scan(rate, i, &#39;/&#39;, &#39;M&#39;);
23         end;
24         count = var1;
25         population = var2;
26         run;

NOTE: The data set WORK.TABLE3SPLIT has 0 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on page 9.</code></pre>
</details>
And, of course, there is a complementary operation, which is when it’s necessary to join two columns to get a useable data value.
<div class="figure"><span style="display:block;" id="fig:tidyr-unite-pic"></span>
<img src="image/tidyr_unite.png" alt="A visual representation of what uniting variables means for data set operations." width="50%" />
<p class="caption">
Figure 7.2: A visual representation of what uniting variables means for data set operations.
</p>
</div>
<details>
<summary>
Joining Variables
</summary>
<p><code>separate()</code> has a complement, <code>unite()</code>, which is useful for handling situations like in table5:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="transforming-data.html#cb279-1" aria-hidden="true" tabindex="-1"></a>table5 <span class="sc">%&gt;%</span></span>
<span id="cb279-2"><a href="transforming-data.html#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">&quot;year&quot;</span>, century<span class="sc">:</span>year, <span class="at">sep =</span> <span class="st">&#39;&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb279-3"><a href="transforming-data.html#cb279-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb279-4"><a href="transforming-data.html#cb279-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 4</span></span>
<span id="cb279-5"><a href="transforming-data.html#cb279-5" aria-hidden="true" tabindex="-1"></a>  country     year  cases  population</span>
<span id="cb279-6"><a href="transforming-data.html#cb279-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>  <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     </span>
<span id="cb279-7"><a href="transforming-data.html#cb279-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Afghanistan <span class="dv">1999</span>  <span class="dv">745</span>    <span class="dv">19987071</span>  </span>
<span id="cb279-8"><a href="transforming-data.html#cb279-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Afghanistan <span class="dv">2000</span>  <span class="dv">2666</span>   <span class="dv">20595360</span>  </span>
<span id="cb279-9"><a href="transforming-data.html#cb279-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Brazil      <span class="dv">1999</span>  <span class="dv">37737</span>  <span class="dv">172006362</span> </span>
<span id="cb279-10"><a href="transforming-data.html#cb279-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> Brazil      <span class="dv">2000</span>  <span class="dv">80488</span>  <span class="dv">174504898</span> </span>
<span id="cb279-11"><a href="transforming-data.html#cb279-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> China       <span class="dv">1999</span>  <span class="dv">212258</span> <span class="dv">1272915272</span></span>
<span id="cb279-12"><a href="transforming-data.html#cb279-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> China       <span class="dv">2000</span>  <span class="dv">213766</span> <span class="dv">1280428583</span></span></code></pre></div>
<p>Note that separate and unite both work with character variables - it’s not necessarily true that you’ll always be working with character formats when you need to do these operations. For instance, it’s relatively common to need to separate dates into year, month, and day as separate columns (or to join them together).</p>
<p>Of course, it’s much easier just to do a similar two-step operation (we have to convert to numeric variables to do math)</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="transforming-data.html#cb280-1" aria-hidden="true" tabindex="-1"></a>table5 <span class="sc">%&gt;%</span></span>
<span id="cb280-2"><a href="transforming-data.html#cb280-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(century)<span class="sc">*</span><span class="dv">100</span> <span class="sc">+</span> <span class="fu">as.numeric</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb280-3"><a href="transforming-data.html#cb280-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>century)</span>
<span id="cb280-4"><a href="transforming-data.html#cb280-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 3</span></span>
<span id="cb280-5"><a href="transforming-data.html#cb280-5" aria-hidden="true" tabindex="-1"></a>  country      year rate             </span>
<span id="cb280-6"><a href="transforming-data.html#cb280-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>            </span>
<span id="cb280-7"><a href="transforming-data.html#cb280-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Afghanistan  <span class="dv">1999</span> <span class="dv">745</span><span class="sc">/</span><span class="dv">19987071</span>     </span>
<span id="cb280-8"><a href="transforming-data.html#cb280-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Afghanistan  <span class="dv">2000</span> <span class="dv">2666</span><span class="sc">/</span><span class="dv">20595360</span>    </span>
<span id="cb280-9"><a href="transforming-data.html#cb280-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Brazil       <span class="dv">1999</span> <span class="dv">37737</span><span class="sc">/</span><span class="dv">172006362</span>  </span>
<span id="cb280-10"><a href="transforming-data.html#cb280-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> Brazil       <span class="dv">2000</span> <span class="dv">80488</span><span class="sc">/</span><span class="dv">174504898</span>  </span>
<span id="cb280-11"><a href="transforming-data.html#cb280-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> China        <span class="dv">1999</span> <span class="dv">212258</span><span class="sc">/</span><span class="dv">1272915272</span></span>
<span id="cb280-12"><a href="transforming-data.html#cb280-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> China        <span class="dv">2000</span> <span class="dv">213766</span><span class="sc">/</span><span class="dv">1280428583</span></span></code></pre></div>
<p>(Handy shortcut functions in <code>dplyr</code> don’t completely remove the need to think).</p>
<p>Similarly, it is possible to do this operation in SAS as well (by string concatenation or using the numeric approach), as shown below:</p>
<pre class="sashtml"><code>6          /* read in the data */
7          DATA table5;
8          LENGTH country $12 century year rate $20;
9          INPUT country $ century year rate $;
10         DATALINES;

NOTE: The data set WORK.TABLE5 has 0 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

17         ;
18         
19         /* Format the data */
20         DATA table5split;
21           SET table5;
22           LENGTH v1-v2 $10. yyc $3. centc $3. yyyyc $4.;
23           ARRAY v(2) $;
24           DO i = 1 TO dim(v);
25             v[i]=scan(rate, i, &#39;/&#39;, &#39;M&#39;);
26           END;
27           count = v1;
28           population = v2;
29           /* Numeric version */
30           year = century*100 + year;
31           /* Character version */
32           yyc = PUT(year, 2.); /* convert to character */
33           centc = PUT(century, 2.); /* convert to character */
34           yyyyc = CATT(&#39;&#39;, centc, yearc); /* catt is truncate, then
34       ! concatenate */
35         RUN;

NOTE: Character values have been converted to numeric 
      values at the places given by: (Line):(Column).
      30:10   30:24   
NOTE: Numeric values have been converted to character 
      values at the places given by: (Line):(Column).
      30:22   
NOTE: The data set WORK.TABLE5SPLIT has 0 observations and 13 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

36         
37         /* Print the data */
38         PROC PRINT DATA=table5split;
39           VAR country year yyyyc count population rate centc century yyc
39       ! ;
40         RUN;

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on page 9.</code></pre>
</details>
</div>
</div>
<div id="pivot-operations" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Pivot operations</h2>
<p>It’s fairly common for data to come in forms which are convenient for either human viewing or data entry. Unfortunately, these forms aren’t necessarily the most friendly for analysis.</p>
<p><img src="https://raw.githubusercontent.com/kelseygonzalez/tidyexplain/master/images/static/png/original-dfs-tidy.png" /></p>
<p>The two operations we’ll learn here are wide -&gt; long and long -&gt; wide.</p>
<p><img src="https://raw.githubusercontent.com/kelseygonzalez/tidyexplain/wider_longer/images/tidyr-pivot_wider_longer.gif" /></p>
<p>This animation uses the R functions pivot_wider() and pivot_longer() <a href="https://github.com/kelseygonzalez/tidyexplain/tree/wider_longer">Animation source</a>, but the concept is the same in both R and SAS.</p>
<div id="longer" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Longer</h3>
<p>In many cases, the data come in what we might call “wide” form - some of the column names are not names of variables, but instead, are themselves values of another variable.</p>
<p>Tables 4a and 4b are good examples of data which is in “wide” form and should be in long(er) form: the years, which are variables, are column names, and the values are cases and population respectively.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="transforming-data.html#cb282-1" aria-hidden="true" tabindex="-1"></a>table4a</span>
<span id="cb282-2"><a href="transforming-data.html#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 3 x 3</span></span>
<span id="cb282-3"><a href="transforming-data.html#cb282-3" aria-hidden="true" tabindex="-1"></a>  country     <span class="st">`</span><span class="at">1999</span><span class="st">`</span> <span class="st">`</span><span class="at">2000</span><span class="st">`</span></span>
<span id="cb282-4"><a href="transforming-data.html#cb282-4" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>        <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb282-5"><a href="transforming-data.html#cb282-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Afghanistan    <span class="dv">745</span>   <span class="dv">2666</span></span>
<span id="cb282-6"><a href="transforming-data.html#cb282-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Brazil       <span class="dv">37737</span>  <span class="dv">80488</span></span>
<span id="cb282-7"><a href="transforming-data.html#cb282-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> China       <span class="dv">212258</span> <span class="dv">213766</span></span>
<span id="cb282-8"><a href="transforming-data.html#cb282-8" aria-hidden="true" tabindex="-1"></a>table4b</span>
<span id="cb282-9"><a href="transforming-data.html#cb282-9" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 3 x 3</span></span>
<span id="cb282-10"><a href="transforming-data.html#cb282-10" aria-hidden="true" tabindex="-1"></a>  country         <span class="st">`</span><span class="at">1999</span><span class="st">`</span>     <span class="st">`</span><span class="at">2000</span><span class="st">`</span></span>
<span id="cb282-11"><a href="transforming-data.html#cb282-11" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>            <span class="er">&lt;</span>int<span class="sc">&gt;</span>      <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb282-12"><a href="transforming-data.html#cb282-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Afghanistan   <span class="dv">19987071</span>   <span class="dv">20595360</span></span>
<span id="cb282-13"><a href="transforming-data.html#cb282-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Brazil       <span class="dv">172006362</span>  <span class="dv">174504898</span></span>
<span id="cb282-14"><a href="transforming-data.html#cb282-14" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> China       <span class="dv">1272915272</span> <span class="dv">1280428583</span></span></code></pre></div>
<p>The solution to this is to rearrange the data into “long form”: to take the columns which contain values and “stack” them, adding a variable to indicate which column each value came from. To do this, we have to duplicate the values in any column which isn’t being stacked (e.g. country, in both the example above and the image below).</p>
<div class="figure"><span style="display:block;" id="fig:tidyr-pivot-longer-pic"></span>
<img src="image/tidyr_pivot_longer.png" alt="A visual representation of what the pivot_longer operation looks like in practice." width="50%" />
<p class="caption">
Figure 7.3: A visual representation of what the pivot_longer operation looks like in practice.
</p>
</div>
<p>Once our data are in long form, we can (if necessary) separate values that once served as column labels into actual variables, and we’ll have tidy(er) data.</p>
<details>
<summary>
In R, wide-to-long conversions are performed using <code>pivot_longer()</code>
</summary>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="transforming-data.html#cb283-1" aria-hidden="true" tabindex="-1"></a>tba <span class="ot">&lt;-</span> table4a <span class="sc">%&gt;%</span> </span>
<span id="cb283-2"><a href="transforming-data.html#cb283-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>country, <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;cases&quot;</span>)</span>
<span id="cb283-3"><a href="transforming-data.html#cb283-3" aria-hidden="true" tabindex="-1"></a>tbb <span class="ot">&lt;-</span> table4b <span class="sc">%&gt;%</span> </span>
<span id="cb283-4"><a href="transforming-data.html#cb283-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>country, <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;population&quot;</span>)</span>
<span id="cb283-5"><a href="transforming-data.html#cb283-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-6"><a href="transforming-data.html#cb283-6" aria-hidden="true" tabindex="-1"></a><span class="co"># To get the tidy data, we join the two together (see Table joins below)</span></span>
<span id="cb283-7"><a href="transforming-data.html#cb283-7" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(tba, tbb, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb283-8"><a href="transforming-data.html#cb283-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make year numeric b/c it&#39;s dumb not to</span></span>
<span id="cb283-9"><a href="transforming-data.html#cb283-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb283-10"><a href="transforming-data.html#cb283-10" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 4</span></span>
<span id="cb283-11"><a href="transforming-data.html#cb283-11" aria-hidden="true" tabindex="-1"></a>  country      year  cases population</span>
<span id="cb283-12"><a href="transforming-data.html#cb283-12" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>int<span class="sc">&gt;</span>      <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb283-13"><a href="transforming-data.html#cb283-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Afghanistan  <span class="dv">1999</span>    <span class="dv">745</span>   <span class="dv">19987071</span></span>
<span id="cb283-14"><a href="transforming-data.html#cb283-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Afghanistan  <span class="dv">2000</span>   <span class="dv">2666</span>   <span class="dv">20595360</span></span>
<span id="cb283-15"><a href="transforming-data.html#cb283-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Brazil       <span class="dv">1999</span>  <span class="dv">37737</span>  <span class="dv">172006362</span></span>
<span id="cb283-16"><a href="transforming-data.html#cb283-16" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> Brazil       <span class="dv">2000</span>  <span class="dv">80488</span>  <span class="dv">174504898</span></span>
<span id="cb283-17"><a href="transforming-data.html#cb283-17" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> China        <span class="dv">1999</span> <span class="dv">212258</span> <span class="dv">1272915272</span></span>
<span id="cb283-18"><a href="transforming-data.html#cb283-18" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> China        <span class="dv">2000</span> <span class="dv">213766</span> <span class="dv">1280428583</span></span></code></pre></div>
<p>The columns are moved to a variable with the name passed to the argument “names_to” (hopefully, that is easy to remember), and the values are moved to a variable with the name passed to the argument “values_to” (again, hopefully easy to remember).</p>
<p>We identify ID variables (variables which we don’t want to pivot) by not including them in the pivot statement. We can do this in one of two ways:</p>
<ul>
<li>select only variables we want to pivot: <code>pivot_longer(table4a, cols =</code>1999<code>:</code>2000<code>, names_to = "year", values_to = "cases")</code></li>
<li>select variables we don’t want to pivot, using <code>-</code> to remove them. (see above, where <code>-country</code> excludes country from the pivot operation)</li>
</ul>
<p>Which option is easier depends how many things you’re pivoting (and how the columns are structured).</p>
<p>If we wanted to avoid the table join, we could do this process another way: first, we would add a column to each tibble called id with values “cases” and “population” respectively. Then, we could bind the two tables together by row (so stack them on top of each other). We could then do a wide-to-long pivot, followed by a long-to-wide pivot to get our data into tidy form.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="transforming-data.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create ID columns</span></span>
<span id="cb284-2"><a href="transforming-data.html#cb284-2" aria-hidden="true" tabindex="-1"></a>table4a.x <span class="ot">&lt;-</span> table4a <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="st">&quot;cases&quot;</span>)</span>
<span id="cb284-3"><a href="transforming-data.html#cb284-3" aria-hidden="true" tabindex="-1"></a>table4b.x <span class="ot">&lt;-</span> table4b <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="st">&quot;population&quot;</span>)</span>
<span id="cb284-4"><a href="transforming-data.html#cb284-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create one table</span></span>
<span id="cb284-5"><a href="transforming-data.html#cb284-5" aria-hidden="true" tabindex="-1"></a>table4 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(table4a.x, table4b.x)</span>
<span id="cb284-6"><a href="transforming-data.html#cb284-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-7"><a href="transforming-data.html#cb284-7" aria-hidden="true" tabindex="-1"></a>table4_long <span class="ot">&lt;-</span> table4 <span class="sc">%&gt;%</span></span>
<span id="cb284-8"><a href="transforming-data.html#cb284-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rearrange columns</span></span>
<span id="cb284-9"><a href="transforming-data.html#cb284-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, id, <span class="st">`</span><span class="at">1999</span><span class="st">`</span>, <span class="st">`</span><span class="at">2000</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb284-10"><a href="transforming-data.html#cb284-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Don&#39;t pivot country or id</span></span>
<span id="cb284-11"><a href="transforming-data.html#cb284-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(country<span class="sc">:</span>id), <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;count&quot;</span>)</span>
<span id="cb284-12"><a href="transforming-data.html#cb284-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-13"><a href="transforming-data.html#cb284-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Intermediate fully-long form</span></span>
<span id="cb284-14"><a href="transforming-data.html#cb284-14" aria-hidden="true" tabindex="-1"></a>table4_long</span>
<span id="cb284-15"><a href="transforming-data.html#cb284-15" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 12 x 4</span></span>
<span id="cb284-16"><a href="transforming-data.html#cb284-16" aria-hidden="true" tabindex="-1"></a>   country     id         year       count</span>
<span id="cb284-17"><a href="transforming-data.html#cb284-17" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>chr<span class="sc">&gt;</span>      <span class="er">&lt;</span>chr<span class="sc">&gt;</span>      <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb284-18"><a href="transforming-data.html#cb284-18" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> Afghanistan cases      <span class="dv">1999</span>         <span class="dv">745</span></span>
<span id="cb284-19"><a href="transforming-data.html#cb284-19" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> Afghanistan cases      <span class="dv">2000</span>        <span class="dv">2666</span></span>
<span id="cb284-20"><a href="transforming-data.html#cb284-20" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> Brazil      cases      <span class="dv">1999</span>       <span class="dv">37737</span></span>
<span id="cb284-21"><a href="transforming-data.html#cb284-21" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> Brazil      cases      <span class="dv">2000</span>       <span class="dv">80488</span></span>
<span id="cb284-22"><a href="transforming-data.html#cb284-22" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> China       cases      <span class="dv">1999</span>      <span class="dv">212258</span></span>
<span id="cb284-23"><a href="transforming-data.html#cb284-23" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> China       cases      <span class="dv">2000</span>      <span class="dv">213766</span></span>
<span id="cb284-24"><a href="transforming-data.html#cb284-24" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> Afghanistan population <span class="dv">1999</span>    <span class="dv">19987071</span></span>
<span id="cb284-25"><a href="transforming-data.html#cb284-25" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> Afghanistan population <span class="dv">2000</span>    <span class="dv">20595360</span></span>
<span id="cb284-26"><a href="transforming-data.html#cb284-26" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> Brazil      population <span class="dv">1999</span>   <span class="dv">172006362</span></span>
<span id="cb284-27"><a href="transforming-data.html#cb284-27" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> Brazil      population <span class="dv">2000</span>   <span class="dv">174504898</span></span>
<span id="cb284-28"><a href="transforming-data.html#cb284-28" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span> China       population <span class="dv">1999</span>  <span class="dv">1272915272</span></span>
<span id="cb284-29"><a href="transforming-data.html#cb284-29" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span> China       population <span class="dv">2000</span>  <span class="dv">1280428583</span></span>
<span id="cb284-30"><a href="transforming-data.html#cb284-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-31"><a href="transforming-data.html#cb284-31" aria-hidden="true" tabindex="-1"></a><span class="co"># make wider, with case and population columns</span></span>
<span id="cb284-32"><a href="transforming-data.html#cb284-32" aria-hidden="true" tabindex="-1"></a>table4_tidy <span class="ot">&lt;-</span> table4_long <span class="sc">%&gt;%</span></span>
<span id="cb284-33"><a href="transforming-data.html#cb284-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> id, <span class="at">values_from =</span> count)</span>
<span id="cb284-34"><a href="transforming-data.html#cb284-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-35"><a href="transforming-data.html#cb284-35" aria-hidden="true" tabindex="-1"></a>table4_tidy</span>
<span id="cb284-36"><a href="transforming-data.html#cb284-36" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 4</span></span>
<span id="cb284-37"><a href="transforming-data.html#cb284-37" aria-hidden="true" tabindex="-1"></a>  country     year   cases population</span>
<span id="cb284-38"><a href="transforming-data.html#cb284-38" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>chr<span class="sc">&gt;</span>  <span class="er">&lt;</span>int<span class="sc">&gt;</span>      <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb284-39"><a href="transforming-data.html#cb284-39" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Afghanistan <span class="dv">1999</span>     <span class="dv">745</span>   <span class="dv">19987071</span></span>
<span id="cb284-40"><a href="transforming-data.html#cb284-40" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Afghanistan <span class="dv">2000</span>    <span class="dv">2666</span>   <span class="dv">20595360</span></span>
<span id="cb284-41"><a href="transforming-data.html#cb284-41" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Brazil      <span class="dv">1999</span>   <span class="dv">37737</span>  <span class="dv">172006362</span></span>
<span id="cb284-42"><a href="transforming-data.html#cb284-42" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> Brazil      <span class="dv">2000</span>   <span class="dv">80488</span>  <span class="dv">174504898</span></span>
<span id="cb284-43"><a href="transforming-data.html#cb284-43" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> China       <span class="dv">1999</span>  <span class="dv">212258</span> <span class="dv">1272915272</span></span>
<span id="cb284-44"><a href="transforming-data.html#cb284-44" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> China       <span class="dv">2000</span>  <span class="dv">213766</span> <span class="dv">1280428583</span></span></code></pre></div>
</details>
<div class="note">
<p>SAS will let you do a single transpose operation, where tidyr requires two separate pivots – this is because tidyr is trying to make the steps readable, even though it means writing more code.</p>
</div>
<details>
<summary>
In SAS, we use PROC TRANSPOSE to perform wide-to-long pivot operations
</summary>
<p><span class="learn-more"><a href="https://libguides.library.kent.edu/SAS/TransposeData">Friendly guide to PROC TRANSPOSE</a></span></p>
<pre class="sashtml"><code>6          DATA table4a;
7          input country $12. _1999 _2000;
8          datalines;

NOTE: The data set WORK.TABLE4A has 0 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

12         ;
13         
14         PROC TRANSPOSE DATA=table4a out=table4atmp
15           (rename=(COL1 = cases)) /* rename output variable
15       ! (&#39;values_to&#39;) */
16           NAME = year /* where column names go (&#39;names_to&#39;) */
17         ;
18         BY country;  /* The combination of BY variables defines a row */
19         VAR _1999 _2000; /* Specify variables to pivot */
20         RUN;

WARNING: The variable COL1 in the DROP, KEEP, or RENAME list has never 
         been referenced.
NOTE: There were 0 observations read from the data set WORK.TABLE4A.
NOTE: The data set WORK.TABLE4ATMP has 2 observations and 2 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

21         
22         DATA table4b;
23         input country $12. _1999 _2000;
24         datalines;

NOTE: The data set WORK.TABLE4B has 0 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

28         ;
29         
30         PROC TRANSPOSE DATA=table4b out=table4btmp
31           (rename=(COL1 = population)) /* rename output variable
31       ! (&#39;values_to&#39;) */
32           NAME = year /* where the column names go (&#39;names_to&#39;) */
33         ;
34         BY country;  /* The combination of BY variables defines a row */
35         VAR _1999 _2000; /* Specify variables to pivot */
36         RUN;

WARNING: The variable COL1 in the DROP, KEEP, or RENAME list has never 
         been referenced.
NOTE: There were 0 observations read from the data set WORK.TABLE4B.
NOTE: The data set WORK.TABLE4BTMP has 2 observations and 2 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

37         
38         DATA table4clean;
39         /* merge the two tables together */
40         /* (country and year selected automatically as merge vars) */
41         MERGE table4atmp table4btmp;
42         /* Remove the first character of year, which is _ */
43         /* Then convert to a numeric variable */
44         year = input(SUBSTR(year, 2, 5), 4.);
45         RUN;

NOTE: Numeric values have been converted to character 
      values at the places given by: (Line):(Column).
      44:8   
NOTE: The data set WORK.TABLE4CLEAN has 0 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

46         
47         PROC PRINT DATA=table4clean;
48         RUN;

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on page 9.</code></pre>
<p>In the above code, we let SAS name our output variable COL1, and then renamed it at the end by modifying the output statement. Another option would be to create an ID variable when inputting each data set, and use the ID statement to indicate that variable.</p>
<pre class="sashtml"><code>6          DATA table4a;
7          input country $12. _1999 _2000;
8          id = &quot;cases&quot;;
9          datalines;

NOTE: The data set WORK.TABLE4A has 0 observations and 4 variables.
WARNING: Data set WORK.TABLE4A was not replaced because this step was 
         stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

13         ;
14         
15         PROC TRANSPOSE DATA=table4a out=table4atmp
16           NAME = year /* where column names go (&#39;names_to&#39;) */
17         ;
18         BY country;  /* The combination of BY variables defines a row */
19         VAR _1999 _2000; /* Specify variables to pivot */
20         ID id; /* This variable holds the output variable name
20       ! (&#39;values_to&#39;) */
ERROR: Variable ID not found.
21         RUN;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set WORK.TABLE4ATMP may be incomplete.  When this step 
         was stopped there were 0 observations and 0 variables.
WARNING: Data set WORK.TABLE4ATMP was not replaced because this step was 
         stopped.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
22         


23         DATA table4b;
24         input country $12. _1999 _2000;
25         id = &quot;population&quot;;
26         datalines;

NOTE: The data set WORK.TABLE4B has 0 observations and 4 variables.
WARNING: Data set WORK.TABLE4B was not replaced because this step was 
         stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

30         ;
31         
32         PROC TRANSPOSE DATA=table4b out=table4btmp
33           NAME = year /* where the column names go (&#39;names_to&#39;) */
34         ;
35         BY country;  /* The combination of BY variables defines a row */
36         VAR _1999 _2000; /* Specify variables to pivot */
37         ID id; /* This variable holds the output variable name
37       ! (&#39;values_to&#39;) */
ERROR: Variable ID not found.
38         RUN;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set WORK.TABLE4BTMP may be incomplete.  When this step 
         was stopped there were 0 observations and 0 variables.
WARNING: Data set WORK.TABLE4BTMP was not replaced because this step was 
         stopped.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
39         


40         DATA table4clean;
41         /* merge the two tables together */
42         /* (country and year selected automatically as merge vars) */
43         MERGE table4atmp table4btmp;
44         /* Remove the first character of year, which is _ */
45         /* Then convert to a numeric variable */
46         year = input(SUBSTR(year, 2, 5), 4.);
47         RUN;

NOTE: Numeric values have been converted to character 
      values at the places given by: (Line):(Column).
      46:8   
NOTE: The data set WORK.TABLE4CLEAN has 0 observations and 2 variables.
WARNING: Data set WORK.TABLE4CLEAN was not replaced because this step was 
         stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

48         
49         PROC PRINT DATA=table4clean;
50         RUN;

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11.</code></pre>
<p>This seems a bit odd, as we’re defining constant variables, but it works – and provides some insight into how the reverse operation (long to wide) might work (e.g. nonconstant variables).
Imagine instead of transposing each dataset and then merging them, we just stack the two wide-format datasets on top of each other. Then we can do the same transpose operation, but we’ll end up with two columns: cases, and population.</p>
<pre class="sashtml"><code>6          DATA table4a;
7          input country $12. _1999 _2000;
8          id = &quot;cases&quot;;
9          datalines;

NOTE: The data set WORK.TABLE4A has 0 observations and 4 variables.
WARNING: Data set WORK.TABLE4A was not replaced because this step was 
         stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

13         ;
14         
15         DATA table4b;
16         input country $12. _1999 _2000;
17         id = &quot;population&quot;;
18         datalines;

NOTE: The data set WORK.TABLE4B has 0 observations and 4 variables.
WARNING: Data set WORK.TABLE4B was not replaced because this step was 
         stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

22         ;
23         
24         DATA table4;
25         /* stack the two datasets on top of each other */
26           SET table4b table4a;
27         /* sort by country */
28           BY country;
29         RUN;

NOTE: The data set WORK.TABLE4 has 0 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

30         
31         PROC TRANSPOSE DATA=table4 out=table4tmp NAME = year;
32         BY country;
33         VAR _1999 _2000;
34         ID id; /* This variable holds the output variable names
34       ! (&#39;values_to&#39;) */
ERROR: Variable ID not found.
35         RUN;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set WORK.TABLE4TMP may be incomplete.  When this step 
         was stopped there were 0 observations and 0 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
36         


37         DATA table4tmp;
38           SET table4tmp;
39         /* Remove the first character of year, which is _ */
40         /* Then convert to a numeric variable */
41         year = input(SUBSTR(year, 2, 5), 4.);
42         RUN;

NOTE: Numeric values have been converted to character 
      values at the places given by: (Line):(Column).
      41:21   
NOTE: The data set WORK.TABLE4TMP has 0 observations and 1 variables.
WARNING: Data set WORK.TABLE4TMP was not replaced because this step was 
         stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

43         
44         PROC PRINT DATA=table4tmp;
45         RUN;

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12.</code></pre>
</details>
<p>It’s not too complicated – and it definitely beats doing that operation by hand, even for short, simple tables. You can imagine how messy the cut/copy/paste job would be in Excel.</p>
<p>It takes some getting used to, but once you get a feel for how to do these transpose operations, you’ll be able to handle messy data reproducibly - instead of describing how you did XYZ operations in Excel, you can provide a script that will take the original data as input and spit out clean, analysis-ready data as output.</p>
<div class="warning">
<p>Because wide-to-long transformations end up combining values from several columns into a single column, you can run into issues with type conversions that happen implicitly. If you try to <code>pivot_longer()</code> using a character column mixed in with numeric columns, your “value” column will be converted to a character automatically.</p>
</div>
Now, let’s look at a “real data” example using HIV case data from the World Health Organization. (<a href="https://apps.who.int/gho/data/view.main.22500A?lang=en">download page here</a>).
<details>
<summary>
WHO HIV data set up
</summary>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="transforming-data.html#cb288-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://apps.who.int/gho/athena/data/xmart.csv?target=GHO/HIV_0000000026,SDGHIV&amp;profile=crosstable&amp;filter=COUNTRY:*;REGION:*;AGEGROUP:-&amp;x-sideaxis=COUNTRY&amp;x-topaxis=GHO;YEAR;SEX&amp;x-collapse=true&quot;</span></span>
<span id="cb288-2"><a href="transforming-data.html#cb288-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-3"><a href="transforming-data.html#cb288-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create colnames in shorter form</span></span>
<span id="cb288-4"><a href="transforming-data.html#cb288-4" aria-hidden="true" tabindex="-1"></a>hiv <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(url, <span class="at">na =</span> <span class="st">&quot;No data&quot;</span>, ) <span class="sc">%&gt;%</span></span>
<span id="cb288-5"><a href="transforming-data.html#cb288-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="dv">2</span>) <span class="co"># get rid of only column that has raw totals</span></span>
<span id="cb288-6"><a href="transforming-data.html#cb288-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-7"><a href="transforming-data.html#cb288-7" aria-hidden="true" tabindex="-1"></a>── Column specification ────────────────────────────────────────────────────────</span>
<span id="cb288-8"><a href="transforming-data.html#cb288-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cols</span>(</span>
<span id="cb288-9"><a href="transforming-data.html#cb288-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="fu">col_character</span>()</span>
<span id="cb288-10"><a href="transforming-data.html#cb288-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb288-11"><a href="transforming-data.html#cb288-11" aria-hidden="true" tabindex="-1"></a>ℹ Use <span class="st">`</span><span class="at">spec()</span><span class="st">`</span> <span class="cf">for</span> the full column specifications.</span>
<span id="cb288-12"><a href="transforming-data.html#cb288-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-13"><a href="transforming-data.html#cb288-13" aria-hidden="true" tabindex="-1"></a><span class="co"># work with the names to make them shorter and more readable</span></span>
<span id="cb288-14"><a href="transforming-data.html#cb288-14" aria-hidden="true" tabindex="-1"></a><span class="co"># otherwise, they&#39;re too long for SAS</span></span>
<span id="cb288-15"><a href="transforming-data.html#cb288-15" aria-hidden="true" tabindex="-1"></a>newnames <span class="ot">&lt;-</span> <span class="fu">names</span>(hiv)  <span class="sc">%&gt;%</span></span>
<span id="cb288-16"><a href="transforming-data.html#cb288-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove</span>(<span class="st">&quot;New HIV infections </span><span class="sc">\\</span><span class="st">(per 1000 uninfected population</span><span class="sc">\\</span><span class="st">); &quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb288-17"><a href="transforming-data.html#cb288-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">&quot;(</span><span class="sc">\\</span><span class="st">d{4}); (Male|Female|Both)( sexes)?&quot;</span>, <span class="st">&quot;Rate_</span><span class="sc">\\</span><span class="st">1_</span><span class="sc">\\</span><span class="st">2&quot;</span>)</span>
<span id="cb288-18"><a href="transforming-data.html#cb288-18" aria-hidden="true" tabindex="-1"></a>hiv <span class="ot">&lt;-</span> <span class="fu">set_names</span>(hiv, newnames) <span class="sc">%&gt;%</span></span>
<span id="cb288-19"><a href="transforming-data.html#cb288-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transliterate - get rid of non-ascii characters, replace w/ closest equiv</span></span>
<span id="cb288-20"><a href="transforming-data.html#cb288-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Country =</span> <span class="fu">iconv</span>(Country, <span class="at">to=</span><span class="st">&quot;ASCII//TRANSLIT&quot;</span>))</span>
<span id="cb288-21"><a href="transforming-data.html#cb288-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-22"><a href="transforming-data.html#cb288-22" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(hiv, <span class="at">path =</span> <span class="st">&quot;data/who_hiv.csv&quot;</span>, <span class="at">na =</span> <span class="st">&#39;.&#39;</span>) <span class="co"># make it easy for SAS</span></span>
<span id="cb288-23"><a href="transforming-data.html#cb288-23" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> The <span class="st">`</span><span class="at">path</span><span class="st">`</span> argument of <span class="st">`</span><span class="at">write_csv()</span><span class="st">`</span> is deprecated as of readr <span class="dv">1</span>.<span class="dv">4</span>.<span class="fl">0.</span></span>
<span id="cb288-24"><a href="transforming-data.html#cb288-24" aria-hidden="true" tabindex="-1"></a>Please use the <span class="st">`</span><span class="at">file</span><span class="st">`</span> argument instead.</span></code></pre></div>
<p>Since I’ve cheated a bit to make this easier to read in using SAS… hopefully that will be uneventful.</p>
<pre class="sashtml"><code>6          libname classdat &quot;sas/&quot;;
NOTE: Libref CLASSDAT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: 
      /home/susan/Projects/Class/unl-stat850/stat850-textbook/sas
7          
8          filename fileloc &#39;data/who_hiv.csv&#39;;
NOTE: PROCEDURE IMPORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
NOTE: The SAS System stopped processing this step because of errors.
9          PROC IMPORT  datafile = fileloc out=classdat.hiv REPLACE
10         DBMS = csv; /* comma delimited file */
11         GUESSINGROWS=500;
12         GETNAMES = YES;
13         RUN;
14         


ERROR: Errors printed on pages 9,11,12,13.</code></pre>
</details>
<details>
<summary>
Original Data Structure (WHO HIV data)
</summary>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="transforming-data.html#cb290-1" aria-hidden="true" tabindex="-1"></a>hiv <span class="sc">%&gt;%</span></span>
<span id="cb290-2"><a href="transforming-data.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only look at 1st 6 cols, because there are too many</span></span>
<span id="cb290-3"><a href="transforming-data.html#cb290-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb290-4"><a href="transforming-data.html#cb290-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb290-5"><a href="transforming-data.html#cb290-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 6</span></span>
<span id="cb290-6"><a href="transforming-data.html#cb290-6" aria-hidden="true" tabindex="-1"></a>  Country  <span class="st">`</span><span class="at">Number of new H… </span><span class="st">`</span>Number of new H… <span class="st">`</span><span class="at">Number of new … </span><span class="st">`</span>Number of new …</span>
<span id="cb290-7"><a href="transforming-data.html#cb290-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>    <span class="er">&lt;</span>chr<span class="sc">&gt;</span>             <span class="er">&lt;</span>chr<span class="sc">&gt;</span>             <span class="er">&lt;</span>chr<span class="sc">&gt;</span>            <span class="er">&lt;</span>chr<span class="sc">&gt;</span>           </span>
<span id="cb290-8"><a href="transforming-data.html#cb290-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Afghani… <span class="dv">1400</span> [<span class="sc">&amp;</span>lt;500–51… <span class="dv">1300</span> [<span class="sc">&amp;</span>lt;500–48… <span class="dv">1200</span> [<span class="sc">&amp;</span>lt;500–4… <span class="dv">1100</span> [<span class="sc">&amp;</span>lt;500–3…</span>
<span id="cb290-9"><a href="transforming-data.html#cb290-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Albania  <span class="sc">&amp;</span>lt;<span class="dv">100</span> [<span class="sc">&amp;</span>lt;100… <span class="sc">&amp;</span>lt;<span class="dv">100</span> [<span class="sc">&amp;</span>lt;100… <span class="sc">&amp;</span>lt;<span class="dv">200</span> [<span class="sc">&amp;</span>lt;10… <span class="sc">&amp;</span>lt;<span class="dv">200</span> [<span class="sc">&amp;</span>lt;10…</span>
<span id="cb290-10"><a href="transforming-data.html#cb290-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Algeria  <span class="dv">2000</span> [<span class="sc">&amp;</span>lt;500–36… <span class="dv">1900</span> [510–<span class="dv">3300</span>]   <span class="dv">1900</span> [610–<span class="dv">3000</span>]  <span class="dv">1800</span> [780–<span class="dv">2800</span>] </span>
<span id="cb290-11"><a href="transforming-data.html#cb290-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> Angola   <span class="dv">27</span> <span class="dv">000</span> [<span class="dv">20</span> 000–3… <span class="dv">27</span> <span class="dv">000</span> [<span class="dv">21</span> 000–3… <span class="dv">26</span> <span class="dv">000</span> [<span class="dv">20</span> 000–… <span class="dv">26</span> <span class="dv">000</span> [<span class="dv">20</span> 000–…</span>
<span id="cb290-12"><a href="transforming-data.html#cb290-12" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> Argenti… <span class="dv">5700</span> [4100–<span class="dv">8100</span>]  <span class="dv">6100</span> [4400–<span class="dv">8200</span>]  <span class="dv">5900</span> [4400–<span class="dv">8200</span>] <span class="dv">6100</span> [4700–<span class="dv">8300</span>]</span>
<span id="cb290-13"><a href="transforming-data.html#cb290-13" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> Armenia  <span class="sc">&amp;</span>lt;<span class="dv">200</span> [<span class="sc">&amp;</span>lt;200… <span class="sc">&amp;</span>lt;<span class="dv">200</span> [<span class="sc">&amp;</span>lt;200… <span class="sc">&amp;</span>lt;<span class="dv">200</span> [<span class="sc">&amp;</span>lt;20… <span class="sc">&amp;</span>lt;<span class="dv">200</span> [<span class="sc">&amp;</span>lt;20…</span>
<span id="cb290-14"><a href="transforming-data.html#cb290-14" aria-hidden="true" tabindex="-1"></a><span class="co"># … with 1 more variable: Number of new HIV infections; 2014; &lt;chr&gt;</span></span></code></pre></div>
Here, the column names (except for the first column) contain information about both group (Male, Female, total) and year. If we want to plot values over time, we’re not going to have much fun.
</details>
<p>Thinking through the logical steps before writing the code can be helpful - even sketching out what you expect the data to (roughly) look like at each stage.</p>
<p>Current data observations:</p>
<ul>
<li>Our column names contain the year and the group (Both, Male, Female)</li>
<li>Our values contain estimates with a confidence interval - so est (LB, UB)
<ul>
<li>Some intervals have <code>&amp;lt;</code>, which is HTML code for <code>&lt;</code>. We’ll need to get rid of those.</li>
</ul></li>
</ul>
<p>Our final dataset should look like this:</p>
<table>
<thead>
<tr class="header">
<th>Country</th>
<th>group</th>
<th>year</th>
<th>est</th>
<th>lb</th>
<th>ub</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>narnia</td>
<td>both</td>
<td>2020</td>
<td>0.3</td>
<td>0.2</td>
<td>0.4</td>
</tr>
</tbody>
</table>
<p>(give or take column order, capitalization, and/or reality)</p>
<p>From this, our steps are:</p>
<ol style="list-style-type: decimal">
<li>Transpose the data - all columns except Country (our BY variable)</li>
<li>Separate the (what was column names) variable into group and year variables
<ul>
<li>convert year to numeric</li>
</ul></li>
<li>Separate the (what was column values) variable into EST, LB, and UB columns
<ul>
<li>Remove <code>&amp;lt;</code> from the variable so that it’s readable as numeric</li>
<li>Remove <code>[</code>, <code>]</code> and <code>-</code> from the variable so that the values are separated by spaces</li>
<li>Read each value into a separate column that’s numeric</li>
<li>Rename the columns</li>
</ul></li>
<li>Clean up any extra variables hanging around.</li>
</ol>
<p>Now that we have a plan, lets execute that plan</p>
<details>
<summary>
Wide-to-long transformation in R (WHO HIV data)
</summary>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="transforming-data.html#cb291-1" aria-hidden="true" tabindex="-1"></a>hiv_tidier <span class="ot">&lt;-</span> hiv <span class="sc">%&gt;%</span></span>
<span id="cb291-2"><a href="transforming-data.html#cb291-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Country, <span class="at">names_to =</span> <span class="st">&quot;key&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;rate&quot;</span>)</span>
<span id="cb291-3"><a href="transforming-data.html#cb291-3" aria-hidden="true" tabindex="-1"></a>hiv_tidier</span>
<span id="cb291-4"><a href="transforming-data.html#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 18,530 x 3</span></span>
<span id="cb291-5"><a href="transforming-data.html#cb291-5" aria-hidden="true" tabindex="-1"></a>   Country     key                                 rate               </span>
<span id="cb291-6"><a href="transforming-data.html#cb291-6" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>chr<span class="sc">&gt;</span>                               <span class="er">&lt;</span>chr<span class="sc">&gt;</span>              </span>
<span id="cb291-7"><a href="transforming-data.html#cb291-7" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> Afghanistan Number of new HIV infections; <span class="dv">2018</span>; <span class="dv">1400</span> [<span class="sc">&amp;</span>lt;500–<span class="dv">5100</span>]</span>
<span id="cb291-8"><a href="transforming-data.html#cb291-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> Afghanistan Number of new HIV infections; <span class="dv">2017</span>; <span class="dv">1300</span> [<span class="sc">&amp;</span>lt;500–<span class="dv">4800</span>]</span>
<span id="cb291-9"><a href="transforming-data.html#cb291-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> Afghanistan Number of new HIV infections; <span class="dv">2016</span>; <span class="dv">1200</span> [<span class="sc">&amp;</span>lt;500–<span class="dv">4200</span>]</span>
<span id="cb291-10"><a href="transforming-data.html#cb291-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> Afghanistan Number of new HIV infections; <span class="dv">2015</span>; <span class="dv">1100</span> [<span class="sc">&amp;</span>lt;500–<span class="dv">3700</span>]</span>
<span id="cb291-11"><a href="transforming-data.html#cb291-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> Afghanistan Number of new HIV infections; <span class="dv">2014</span>; <span class="dv">1000</span> [<span class="sc">&amp;</span>lt;500–<span class="dv">3200</span>]</span>
<span id="cb291-12"><a href="transforming-data.html#cb291-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> Afghanistan Number of new HIV infections; <span class="dv">2013</span>; <span class="dv">920</span> [<span class="sc">&amp;</span>lt;500–<span class="dv">2700</span>] </span>
<span id="cb291-13"><a href="transforming-data.html#cb291-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> Afghanistan Number of new HIV infections; <span class="dv">2012</span>; <span class="dv">840</span> [<span class="sc">&amp;</span>lt;500–<span class="dv">2300</span>] </span>
<span id="cb291-14"><a href="transforming-data.html#cb291-14" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> Afghanistan Number of new HIV infections; <span class="dv">2011</span>; <span class="dv">760</span> [<span class="sc">&amp;</span>lt;500–<span class="dv">2000</span>] </span>
<span id="cb291-15"><a href="transforming-data.html#cb291-15" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> Afghanistan Number of new HIV infections; <span class="dv">2010</span>; <span class="dv">700</span> [<span class="sc">&amp;</span>lt;500–<span class="dv">1800</span>] </span>
<span id="cb291-16"><a href="transforming-data.html#cb291-16" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> Afghanistan Number of new HIV infections; <span class="dv">2009</span>; <span class="dv">640</span> [<span class="sc">&amp;</span>lt;500–<span class="dv">1600</span>] </span>
<span id="cb291-17"><a href="transforming-data.html#cb291-17" aria-hidden="true" tabindex="-1"></a><span class="co"># … with 18,520 more rows</span></span></code></pre></div>
<p>From this point, it’s pretty easy to use things we’ve used in the past (regular expressions, separate, extract)</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="transforming-data.html#cb292-1" aria-hidden="true" tabindex="-1"></a> hiv_tidy <span class="ot">&lt;-</span> hiv_tidier <span class="sc">%&gt;%</span></span>
<span id="cb292-2"><a href="transforming-data.html#cb292-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Split the key into Rate (don&#39;t keep), year, and group (F, M, Both)</span></span>
<span id="cb292-3"><a href="transforming-data.html#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(key, <span class="at">into =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;group&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="at">convert =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb292-4"><a href="transforming-data.html#cb292-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fix the HTML sign for less than - we could remove it as well</span></span>
<span id="cb292-5"><a href="transforming-data.html#cb292-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate =</span> <span class="fu">str_replace_all</span>(rate, <span class="st">&quot;&amp;lt;&quot;</span>, <span class="st">&quot;&lt;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb292-6"><a href="transforming-data.html#cb292-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Split the rate into estimate, lower bound, and upper bound</span></span>
<span id="cb292-7"><a href="transforming-data.html#cb292-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract</span>(rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;est&quot;</span>, <span class="st">&quot;lb&quot;</span>, <span class="st">&quot;ub&quot;</span>), <span class="at">regex =</span> <span class="st">&quot;([</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">.]{1,}) .([&lt;</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">.]{1,}) - ([&lt;</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">.]{1,}).&quot;</span>, <span class="at">remove =</span> T)</span>
<span id="cb292-8"><a href="transforming-data.html#cb292-8" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Expected <span class="dv">3</span> pieces. Missing pieces filled with <span class="st">`</span><span class="at">NA</span><span class="st">`</span> <span class="cf">in</span> <span class="dv">3230</span> rows [<span class="dv">1</span>, <span class="dv">2</span>,</span>
<span id="cb292-9"><a href="transforming-data.html#cb292-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">110</span>, ...].</span>
<span id="cb292-10"><a href="transforming-data.html#cb292-10" aria-hidden="true" tabindex="-1"></a>hiv_tidy</span>
<span id="cb292-11"><a href="transforming-data.html#cb292-11" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 18,530 x 6</span></span>
<span id="cb292-12"><a href="transforming-data.html#cb292-12" aria-hidden="true" tabindex="-1"></a>   Country      year group est   lb    ub   </span>
<span id="cb292-13"><a href="transforming-data.html#cb292-13" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb292-14"><a href="transforming-data.html#cb292-14" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb292-15"><a href="transforming-data.html#cb292-15" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb292-16"><a href="transforming-data.html#cb292-16" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb292-17"><a href="transforming-data.html#cb292-17" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb292-18"><a href="transforming-data.html#cb292-18" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb292-19"><a href="transforming-data.html#cb292-19" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb292-20"><a href="transforming-data.html#cb292-20" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb292-21"><a href="transforming-data.html#cb292-21" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb292-22"><a href="transforming-data.html#cb292-22" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb292-23"><a href="transforming-data.html#cb292-23" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb292-24"><a href="transforming-data.html#cb292-24" aria-hidden="true" tabindex="-1"></a><span class="co"># … with 18,520 more rows</span></span></code></pre></div>
</details>
<details>
<summary>
Wide-to-long transformation in SAS (WHO HIV data)
</summary>
<p>I’ve thoroughly commented the code below to hopefully make the logical steps clear.</p>
<pre class="sashtml"><code>6          libname classdat &quot;sas/&quot;;
NOTE: Libref CLASSDAT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: 
      /home/susan/Projects/Class/unl-stat850/stat850-textbook/sas
7          


8          PROC TRANSPOSE DATA=classdat.hiv OUT = classdat.hivtidy
NOTE: Data file CLASSDAT.HIV.DATA is in a format that is native to another 
      host, or the file encoding does not match the session encoding. 
      Cross Environment Data Access will be used, which might require 
      additional CPU resources and might reduce performance.
9          (rename=(col1=rate)) /* &quot;values_to&quot; in tidyr speak */
10         NAME = key;          /* &quot;names_to&quot; in tidyr speak */
NOTE: Data file CLASSDAT.HIVTIDY.DATA is in a format that is native to 
      another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
11         /* specify notsorted unless you know your data are sorted */
12           BY Country NOTSORTED;
13         /* variables to transpose - just list start and end, with -- in
13       ! between  */
14           VAR Rate_2018_Both--Rate_1990_Female;
15         RUN;

WARNING: The variable col1 in the DROP, KEEP, or RENAME list has never 
         been referenced.
NOTE: There were 0 observations read from the data set CLASSDAT.HIV.
NOTE: The data set CLASSDAT.HIVTIDY has 87 observations and 2 variables.
WARNING: Data set CLASSDAT.HIVTIDY was not replaced because of NOREPLACE 
         option.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

16         
17         title &#39;Intermediate result&#39;;
18         PROC PRINT DATA=classdat.hivtidy(obs=5); RUN;
NOTE: Data file CLASSDAT.HIVTIDY.DATA is in a format that is native to 
      another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

19         
20         /* Data step to clean up */
21         DATA classdat.hivtidy;
22           SET classdat.hivtidy ;
NOTE: Data file CLASSDAT.HIVTIDY.DATA is in a format that is native to 
      another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
23         /* Create group and year variables from key */
24           group = scan(key,3,&quot;_&quot;);
25           year = input(scan(key, 2, &quot;_&quot;), 4.);
26         
27         /* just get rid of the less than sign */
28           rate = PRXCHANGE(&quot;s/&amp;lt;//&quot;, -1, rate);
WARNING: Apparent symbolic reference LT not resolved.
29           rate = PRXCHANGE(&quot;s/[\[\]-]//&quot;, -1, rate);
30         
31         /* Create 3 columns for the 3 values - est, lb, ub */
32           length v1-v3 4.2; /* define format */
33           array v(3) $; /* create a 3 column array to store values in */
34           do i = 1 to dim(v);
35             v[i]=scan(rate, i, &#39; &#39;); /* get values from each row of rate
35       !  */
36           end;
37         
38           rename v1 = est v2 = lb v3 = ub; /* rename things to be pretty
38       !  */
39         
40         /* get rid of extra vars */
41           drop _name_ i key rate;
42         RUN;

NOTE: Numeric values have been converted to character 
      values at the places given by: (Line):(Column).
      24:16   25:21   28:36   29:39   35:15   
NOTE: Character values have been converted to numeric 
      values at the places given by: (Line):(Column).
      28:10   29:10   35:5    
NOTE: Data file CLASSDAT.HIVTIDY.DATA is in a format that is native to 
      another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
WARNING: Variable v1 cannot be renamed to est because est already exists.
WARNING: Variable v2 cannot be renamed to lb because lb already exists.
WARNING: Variable v3 cannot be renamed to ub because ub already exists.
WARNING: The variable _name_ in the DROP, KEEP, or RENAME list has never 
         been referenced.
NOTE: The data set CLASSDAT.HIVTIDY has 0 observations and 9 variables.
WARNING: Data set CLASSDAT.HIVTIDY was not replaced because this step was 
         stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

43         
44         title &#39;Final result&#39;;
45         PROC PRINT DATA=classdat.hivtidy(obs=5); RUN;
NOTE: Data file CLASSDAT.HIVTIDY.DATA is in a format that is native to 
      another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

46         

ERROR: Errors printed on pages 9,11,12,13.</code></pre>
</details>
<div id="try-it-out-20" class="section level4 unnumbered tryitout">
<h4>Try it out</h4>
<p>In the next section, we’ll be using the WHO surveillance of disease incidence data (<a href="https://www.who.int/immunization/monitoring_surveillance/data/en/">link</a> - 3.1, <a href="http://www.who.int/entity/immunization/monitoring_surveillance/data/incidence_series.xls">Excel link</a>)</p>
<p>It will require some preprocessing before it’s suitable for a demonstration. I’ll do some of it, but in this section, you’re going to do the rest :)</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="transforming-data.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb294-2"><a href="transforming-data.html#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr) <span class="co"># This uses the map() function as a replacement for for loops. </span></span>
<span id="cb294-3"><a href="transforming-data.html#cb294-3" aria-hidden="true" tabindex="-1"></a><span class="co"># It&#39;s pretty sweet</span></span>
<span id="cb294-4"><a href="transforming-data.html#cb294-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-5"><a href="transforming-data.html#cb294-5" aria-hidden="true" tabindex="-1"></a>sheets <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(<span class="st">&quot;data/incidence_series.xls&quot;</span>)</span>
<span id="cb294-6"><a href="transforming-data.html#cb294-6" aria-hidden="true" tabindex="-1"></a>sheets <span class="ot">&lt;-</span> sheets[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">length</span>(sheets))] <span class="co"># get rid of 1st and last sheet name</span></span>
<span id="cb294-7"><a href="transforming-data.html#cb294-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-8"><a href="transforming-data.html#cb294-8" aria-hidden="true" tabindex="-1"></a><span class="co"># This command says &quot;for each sheet, read in the excel file with that sheet name&quot;</span></span>
<span id="cb294-9"><a href="transforming-data.html#cb294-9" aria-hidden="true" tabindex="-1"></a><span class="co"># map_df means paste them all together into a single data frame</span></span>
<span id="cb294-10"><a href="transforming-data.html#cb294-10" aria-hidden="true" tabindex="-1"></a>disease_incidence <span class="ot">&lt;-</span> <span class="fu">map_df</span>(sheets, <span class="sc">~</span><span class="fu">read_xls</span>(<span class="at">path =</span><span class="st">&quot;data/incidence_series.xls&quot;</span>, <span class="at">sheet =</span> .))</span>
<span id="cb294-11"><a href="transforming-data.html#cb294-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-12"><a href="transforming-data.html#cb294-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternately, we could write a loop:</span></span>
<span id="cb294-13"><a href="transforming-data.html#cb294-13" aria-hidden="true" tabindex="-1"></a>disease_incidence2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>() <span class="co"># Blank data frame</span></span>
<span id="cb294-14"><a href="transforming-data.html#cb294-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sheets)) {</span>
<span id="cb294-15"><a href="transforming-data.html#cb294-15" aria-hidden="true" tabindex="-1"></a>  disease_incidence2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb294-16"><a href="transforming-data.html#cb294-16" aria-hidden="true" tabindex="-1"></a>    disease_incidence2, </span>
<span id="cb294-17"><a href="transforming-data.html#cb294-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_xls</span>(<span class="at">path =</span> <span class="st">&quot;data/incidence_series.xls&quot;</span>, <span class="at">sheet =</span> sheets[i])</span>
<span id="cb294-18"><a href="transforming-data.html#cb294-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb294-19"><a href="transforming-data.html#cb294-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb294-20"><a href="transforming-data.html#cb294-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-21"><a href="transforming-data.html#cb294-21" aria-hidden="true" tabindex="-1"></a><span class="co"># export for SAS (and R, if you want)</span></span>
<span id="cb294-22"><a href="transforming-data.html#cb294-22" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(disease_incidence, <span class="at">path =</span> <span class="st">&quot;data/who_disease_incidence.csv&quot;</span>, <span class="at">na =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<p>Download the exported data <a href="data/who_disease_incidence.csv">here</a> and import it into SAS and R. Transform it into long format, so that there is a year column. You should end up with a table that has dimensions of approximately 6 columns and 83,000 rows (or something close to that).</p>
<p>Can you make a line plot of cases of measles in Bangladesh over time?</p>
<details>
<summary>
R solution
</summary>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="transforming-data.html#cb295-1" aria-hidden="true" tabindex="-1"></a>who_disease <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/who_disease_incidence.csv&quot;</span>, <span class="at">na =</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb295-2"><a href="transforming-data.html#cb295-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-3"><a href="transforming-data.html#cb295-3" aria-hidden="true" tabindex="-1"></a>── Column specification ────────────────────────────────────────────────────────</span>
<span id="cb295-4"><a href="transforming-data.html#cb295-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cols</span>(</span>
<span id="cb295-5"><a href="transforming-data.html#cb295-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="fu">col_double</span>(),</span>
<span id="cb295-6"><a href="transforming-data.html#cb295-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">WHO_REGION =</span> <span class="fu">col_character</span>(),</span>
<span id="cb295-7"><a href="transforming-data.html#cb295-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ISO_code =</span> <span class="fu">col_character</span>(),</span>
<span id="cb295-8"><a href="transforming-data.html#cb295-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cname =</span> <span class="fu">col_character</span>(),</span>
<span id="cb295-9"><a href="transforming-data.html#cb295-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Disease =</span> <span class="fu">col_character</span>()</span>
<span id="cb295-10"><a href="transforming-data.html#cb295-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb295-11"><a href="transforming-data.html#cb295-11" aria-hidden="true" tabindex="-1"></a>ℹ Use <span class="st">`</span><span class="at">spec()</span><span class="st">`</span> <span class="cf">for</span> the full column specifications.</span>
<span id="cb295-12"><a href="transforming-data.html#cb295-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-13"><a href="transforming-data.html#cb295-13" aria-hidden="true" tabindex="-1"></a>who_disease_long <span class="ot">&lt;-</span> who_disease <span class="sc">%&gt;%</span></span>
<span id="cb295-14"><a href="transforming-data.html#cb295-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">matches</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">d{4}&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;cases&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb295-15"><a href="transforming-data.html#cb295-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Country =</span> Cname) <span class="sc">%&gt;%</span></span>
<span id="cb295-16"><a href="transforming-data.html#cb295-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Disease =</span> <span class="fu">str_replace</span>(Disease, <span class="st">&quot;CRS&quot;</span>, <span class="st">&quot;Congenital Rubella&quot;</span>),</span>
<span id="cb295-17"><a href="transforming-data.html#cb295-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb295-18"><a href="transforming-data.html#cb295-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-19"><a href="transforming-data.html#cb295-19" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(who_disease_long, Country <span class="sc">==</span> <span class="st">&quot;Bangladesh&quot;</span>, Disease <span class="sc">==</span> <span class="st">&quot;measles&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb295-20"><a href="transforming-data.html#cb295-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> cases)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<img src="image/tryitout-surveillance-cleaning-1.png" width="2100" />
</details>
<details>
<summary>
SAS solution
</summary>
<pre class="sashtml"><code>6          libname classdat &quot;sas/&quot;;
NOTE: Libref CLASSDAT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: 
      /home/susan/Projects/Class/unl-stat850/stat850-textbook/sas
7          
8          filename fileloc &#39;data/who_disease_incidence.csv&#39;;
NOTE: PROCEDURE IMPORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
NOTE: The SAS System stopped processing this step because of errors.
9          PROC IMPORT  datafile = fileloc out=classdat.who_disease REPLACE
10         DBMS = csv; /* comma delimited file */
11         GUESSINGROWS=500;
12         GETNAMES = YES;
13         RUN;
14         
15         /* Sort your data by the variables you want as the ID variables
15       ! */


16         PROC SORT DATA=classdat.who_disease OUT=who_dis_tmp;
NOTE: Data file CLASSDAT.WHO_DISEASE.DATA is in a format that is native to 
      another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
17         BY Disease Cname;
18         RUN;

NOTE: The data set WORK.WHO_DIS_TMP has 0 observations and 0 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

19         
20         PROC TRANSPOSE DATA = who_dis_tmp OUT = classdat.disease_long;
NOTE: Data file CLASSDAT.DISEASE_LONG.DATA is in a format that is native 
      to another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
21         BY Disease Cname; /* Same variable order as used to sort */
ERROR: Variable DISEASE not found.
ERROR: Variable CNAME not found.
22         VAR _2018--_1980; /* variables to transpose */
ERROR: Variable _2018 not found.
23         RUN;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set CLASSDAT.DISEASE_LONG may be incomplete.  When this 
         step was stopped there were 0 observations and 0 variables.
WARNING: Data set CLASSDAT.DISEASE_LONG was not replaced because this step 
         was stopped.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
24         
25         title &#39;Intermediate result 1&#39;;


26         PROC PRINT DATA=classdat.disease_long(obs=5); RUN;
NOTE: Data file CLASSDAT.DISEASE_LONG.DATA is in a format that is native 
      to another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

27         
28         /* Data step to clean up */
29         DATA classdat.disease_long;
30         SET classdat.disease_long (rename=col1=cases);
NOTE: Data file CLASSDAT.DISEASE_LONG.DATA is in a format that is native 
      to another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
ERROR: Variable col1 is not on file CLASSDAT.DISEASE_LONG.
ERROR: Invalid DROP, KEEP, or RENAME option on file CLASSDAT.DISEASE_LONG.
31         year = input(scan(_name_,1,&quot;_&quot;), 4.);
32         drop _name_;
33         RUN;

NOTE: Numeric values have been converted to character 
      values at the places given by: (Line):(Column).
      31:19   
NOTE: Data file CLASSDAT.DISEASE_LONG.DATA is in a format that is native 
      to another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set CLASSDAT.DISEASE_LONG may be incomplete.  When this 
         step was stopped there were 0 observations and 1 variables.
WARNING: Data set CLASSDAT.DISEASE_LONG was not replaced because this step 
         was stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

34         
35         title &#39;Final result&#39;;
36         PROC PRINT DATA=classdat.disease_long(obs=5); RUN;
NOTE: Data file CLASSDAT.DISEASE_LONG.DATA is in a format that is native 
      to another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

37         
38         PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
39         CREATE TABLE bangladesh AS
40         SELECT * FROM classdat.disease_long WHERE (Cname = &quot;Bangladesh&quot;)
40       !  &amp; (Disease = &quot;measles&quot;);
NOTE: Statement not executed due to NOEXEC option.
41         
42         title &#39;Measles in Bangladesh&#39;;
43         ODS GRAPHICS ON;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


44         PROC SGPLOT DATA=bangladesh;
ERROR: File WORK.BANGLADESH.DATA does not exist.
45         SERIES X = year Y = cases;
ERROR: No data set open to look up variables.
ERROR: No data set open to look up variables.
46         RUN;

NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SGPLOT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
47         ODS GRAPHICS OFF;

ERROR: Errors printed on pages 9,11,12,13,15.</code></pre>
</details>
</div>
</div>
<div id="wider" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Wider</h3>
<p>While it’s very common to need to transform data into a longer format, it’s not that uncommon to need to do the reverse operation. When an observation is scattered across multiple rows, your data is too long and needs to be made wider again.</p>
<p>Table 2 is an example of a table that is in long format but needs to be converted to a wider layout to be “tidy” - there are separate rows for cases and population, which means that a single observation (one year, one country) has two rows.</p>
<div class="figure"><span style="display:block;" id="fig:pivot-wider-pic"></span>
<img src="image/tidyr_pivot_wider.png" alt="A visual representation of what the pivot_wider operation looks like in practice." width="50%" />
<p class="caption">
Figure 7.4: A visual representation of what the pivot_wider operation looks like in practice.
</p>
</div>
<details>
<summary>
In R, long-to-wide conversion operations are performed using <code>pivot_wider()</code>
</summary>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="transforming-data.html#cb297-1" aria-hidden="true" tabindex="-1"></a>table2 <span class="sc">%&gt;%</span></span>
<span id="cb297-2"><a href="transforming-data.html#cb297-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> type, <span class="at">values_from =</span> count)</span>
<span id="cb297-3"><a href="transforming-data.html#cb297-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 4</span></span>
<span id="cb297-4"><a href="transforming-data.html#cb297-4" aria-hidden="true" tabindex="-1"></a>  country      year  cases population</span>
<span id="cb297-5"><a href="transforming-data.html#cb297-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>int<span class="sc">&gt;</span>      <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb297-6"><a href="transforming-data.html#cb297-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Afghanistan  <span class="dv">1999</span>    <span class="dv">745</span>   <span class="dv">19987071</span></span>
<span id="cb297-7"><a href="transforming-data.html#cb297-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Afghanistan  <span class="dv">2000</span>   <span class="dv">2666</span>   <span class="dv">20595360</span></span>
<span id="cb297-8"><a href="transforming-data.html#cb297-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Brazil       <span class="dv">1999</span>  <span class="dv">37737</span>  <span class="dv">172006362</span></span>
<span id="cb297-9"><a href="transforming-data.html#cb297-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> Brazil       <span class="dv">2000</span>  <span class="dv">80488</span>  <span class="dv">174504898</span></span>
<span id="cb297-10"><a href="transforming-data.html#cb297-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> China        <span class="dv">1999</span> <span class="dv">212258</span> <span class="dv">1272915272</span></span>
<span id="cb297-11"><a href="transforming-data.html#cb297-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> China        <span class="dv">2000</span> <span class="dv">213766</span> <span class="dv">1280428583</span></span></code></pre></div>
</details>
<details>
<summary>
In SAS, we use PROC TRANSPOSE again
</summary>
<pre class="sashtml"><code>

6          DATA table2;
7          input country $12. year  type$12. count 12.;
8          datalines;

NOTE: The data set WORK.TABLE2 has 0 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

21         ;
22         
23         PROC TRANSPOSE DATA=table2 out=table2tmp;
24         ID type; /* Equivalent to names_from */
25         BY country year;  /* The combination of BY variables defines a
25       ! row */
26         VAR count; /* Equivalent to values_from */
27         RUN;

NOTE: There were 0 observations read from the data set WORK.TABLE2.
NOTE: The data set WORK.TABLE2TMP has 1 observations and 3 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

28         
29         PROC PRINT DATA=table2tmp;
30         RUN;

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16.</code></pre>
</summary>
<div class="warning">
<p>If you don’t sort your data properly before PROC TRANSPOSE in SAS, you may get a result that has an unexpected shape. SAS works rowwise (compared to R’s column-wise operations) so the row order actually matters in SAS (it generally doesn’t matter much in R).</p>
</div>
<p>Returning to our WHO HIV example, we might want our data to look like this:</p>
<table>
<thead>
<tr class="header">
<th>Country</th>
<th>year</th>
<th>measurement</th>
<th>Both</th>
<th>Male</th>
<th>Female</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Afghanistan</td>
<td>2018</td>
<td>est</td>
<td>.02</td>
<td>.03</td>
<td>.01</td>
</tr>
<tr class="even">
<td>2018</td>
<td>lb</td>
<td>.01</td>
<td>.02</td>
<td>.01</td>
<td></td>
</tr>
<tr class="odd">
<td>2018</td>
<td>ub</td>
<td>.04</td>
<td>.06</td>
<td>.03</td>
<td></td>
</tr>
</tbody>
</table>
<p>As a reminder, the data currently looks like this:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="transforming-data.html#cb299-1" aria-hidden="true" tabindex="-1"></a>hiv_tidy</span>
<span id="cb299-2"><a href="transforming-data.html#cb299-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 18,530 x 6</span></span>
<span id="cb299-3"><a href="transforming-data.html#cb299-3" aria-hidden="true" tabindex="-1"></a>   Country      year group est   lb    ub   </span>
<span id="cb299-4"><a href="transforming-data.html#cb299-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb299-5"><a href="transforming-data.html#cb299-5" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb299-6"><a href="transforming-data.html#cb299-6" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb299-7"><a href="transforming-data.html#cb299-7" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb299-8"><a href="transforming-data.html#cb299-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb299-9"><a href="transforming-data.html#cb299-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb299-10"><a href="transforming-data.html#cb299-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb299-11"><a href="transforming-data.html#cb299-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb299-12"><a href="transforming-data.html#cb299-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb299-13"><a href="transforming-data.html#cb299-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb299-14"><a href="transforming-data.html#cb299-14" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> Afghanistan    <span class="cn">NA</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="er">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb299-15"><a href="transforming-data.html#cb299-15" aria-hidden="true" tabindex="-1"></a><span class="co"># … with 18,520 more rows</span></span></code></pre></div>
<div class="tryitout">
<p>Think through the steps you’d need to take to get the data into this form. Sketch out any intermediate state your data will need to go through.</p>
</div>
<details>
<summary>
WHO HIV Data: long-to-wide steps
</summary>
<ol style="list-style-type: decimal">
<li>We need est, lb, and ub in long form first, so we need to use a wide-to-long (pivot_longer) transpose operation.
<ul>
<li>names_to = “measure”</li>
<li>values_to = “value”</li>
<li>BY variables: Country, year, group</li>
<li>pivot variables (VAR in SAS): est, lb, ub</li>
</ul></li>
<li>We need group to be 3 columns: Both, Male, and Female. So we need to use a long-to-wide (pivot_wider) transpose operation.
<ul>
<li>By variables: Country, year, measure (so we’ll need to sort in SAS)</li>
<li>ID variable: group</li>
<li>VAR variable: value</li>
</ul></li>
</ol>
<p>The intermediate form of the data will look like this:</p>
<table>
<thead>
<tr class="header">
<th>Country</th>
<th>year</th>
<th>group</th>
<th>measure</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Afghanistan</td>
<td>2018</td>
<td>Both</td>
<td>est</td>
<td>0.02</td>
</tr>
<tr class="even">
<td>Afghanistan</td>
<td>2018</td>
<td>Both</td>
<td>lb</td>
<td>0.01</td>
</tr>
<tr class="odd">
<td>Afghanistan</td>
<td>2018</td>
<td>Both</td>
<td>ub</td>
<td>0.04</td>
</tr>
<tr class="even">
<td>Afghanistan</td>
<td>2018</td>
<td>Male</td>
<td>est</td>
<td>0.03</td>
</tr>
</tbody>
</table>
</details>
<details>
<summary>
WHO HIV Data: long-to-wide in R
</summary>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="transforming-data.html#cb300-1" aria-hidden="true" tabindex="-1"></a>hiv_tidy <span class="sc">%&gt;%</span></span>
<span id="cb300-2"><a href="transforming-data.html#cb300-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(est<span class="sc">:</span>ub, <span class="at">names_to =</span> <span class="st">&quot;measure&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb300-3"><a href="transforming-data.html#cb300-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Take the opportunity to transform everything to numeric at once...</span></span>
<span id="cb300-4"><a href="transforming-data.html#cb300-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">parse_number</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb300-5"><a href="transforming-data.html#cb300-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group, <span class="at">values_from =</span> value)</span>
<span id="cb300-6"><a href="transforming-data.html#cb300-6" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Values are not uniquely identified; output will contain list<span class="sc">-</span>cols.</span>
<span id="cb300-7"><a href="transforming-data.html#cb300-7" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Use <span class="st">`</span><span class="at">values_fn = list</span><span class="st">`</span> to suppress this warning.</span>
<span id="cb300-8"><a href="transforming-data.html#cb300-8" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Use <span class="st">`</span><span class="at">values_fn = length</span><span class="st">`</span> to identify where the duplicates arise</span>
<span id="cb300-9"><a href="transforming-data.html#cb300-9" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Use <span class="st">`</span><span class="at">values_fn = {summary_fun}</span><span class="st">`</span> to summarise duplicates</span>
<span id="cb300-10"><a href="transforming-data.html#cb300-10" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 15,810 x 7</span></span>
<span id="cb300-11"><a href="transforming-data.html#cb300-11" aria-hidden="true" tabindex="-1"></a>   Country      year measure <span class="st">`</span><span class="at">NA</span><span class="st">`</span>       Both      Male      Female   </span>
<span id="cb300-12"><a href="transforming-data.html#cb300-12" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>list<span class="sc">&gt;</span>     <span class="er">&lt;</span>list<span class="sc">&gt;</span>    <span class="er">&lt;</span>list<span class="sc">&gt;</span>    <span class="er">&lt;</span>list<span class="sc">&gt;</span>   </span>
<span id="cb300-13"><a href="transforming-data.html#cb300-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> Afghanistan    <span class="cn">NA</span> est     <span class="sc">&lt;</span>dbl [<span class="dv">19</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>    <span class="er">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>    <span class="er">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>   </span>
<span id="cb300-14"><a href="transforming-data.html#cb300-14" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> Afghanistan    <span class="cn">NA</span> lb      <span class="sc">&lt;</span>dbl [<span class="dv">19</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>    <span class="er">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>    <span class="er">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>   </span>
<span id="cb300-15"><a href="transforming-data.html#cb300-15" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> Afghanistan    <span class="cn">NA</span> ub      <span class="sc">&lt;</span>dbl [<span class="dv">19</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>    <span class="er">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>    <span class="er">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>   </span>
<span id="cb300-16"><a href="transforming-data.html#cb300-16" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> Afghanistan  <span class="dv">2019</span> est     <span class="sc">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span></span>
<span id="cb300-17"><a href="transforming-data.html#cb300-17" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> Afghanistan  <span class="dv">2019</span> lb      <span class="sc">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span></span>
<span id="cb300-18"><a href="transforming-data.html#cb300-18" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> Afghanistan  <span class="dv">2019</span> ub      <span class="sc">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span></span>
<span id="cb300-19"><a href="transforming-data.html#cb300-19" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> Afghanistan  <span class="dv">2018</span> est     <span class="sc">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span></span>
<span id="cb300-20"><a href="transforming-data.html#cb300-20" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> Afghanistan  <span class="dv">2018</span> lb      <span class="sc">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span></span>
<span id="cb300-21"><a href="transforming-data.html#cb300-21" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> Afghanistan  <span class="dv">2018</span> ub      <span class="sc">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span></span>
<span id="cb300-22"><a href="transforming-data.html#cb300-22" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> Afghanistan  <span class="dv">2017</span> est     <span class="sc">&lt;</span><span class="cn">NULL</span><span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl [<span class="dv">1</span>]<span class="sc">&gt;</span></span>
<span id="cb300-23"><a href="transforming-data.html#cb300-23" aria-hidden="true" tabindex="-1"></a><span class="co"># … with 15,800 more rows</span></span></code></pre></div>
</details>
<details>
<summary>
WHO HIV Data: long-to-wide in SAS
</summary>
<p>In SAS, we can do the pivot operations in one step, but we have to sort everything first.</p>
<pre class="sashtml"><code>6          libname classdat &quot;sas/&quot;;
NOTE: Libref CLASSDAT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: 
      /home/susan/Projects/Class/unl-stat850/stat850-textbook/sas
7          
8          PROC SORT DATA = classdat.hivtidy;
NOTE: Data file CLASSDAT.HIVTIDY.DATA is in a format that is native to 
      another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
9          BY Country year group;
10         RUN;

NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

11         
12         PROC TRANSPOSE DATA = classdat.hivtidy OUT = hivtmp name =
12       ! measure;
NOTE: Data file CLASSDAT.HIVTIDY.DATA is in a format that is native to 
      another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
13         BY Country year;
14         VAR est lb ub;
15         ID group;
16         RUN;

NOTE: There were 0 observations read from the data set CLASSDAT.HIVTIDY.
NOTE: The data set WORK.HIVTMP has 3 observations and 3 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

17         
18         PROC PRINT data=hivtmp(obs=5);
19         RUN;

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16.</code></pre>
</details>
<div id="try-it-out-21" class="section level4 unnumbered tryitout">
<h4>Try it out</h4>
<p>Use the long-format data you have from the previous Try It Out section (WHO Disease Incidence). Reshape this data into a “wide” format such that each disease is shown in a separate column.</p>
<p>Before you start:
- Which variable(s) will uniquely identify a row in your output data?
- Which variable(s) will be used to create column names?</p>
<p>Can you create a plot of polio cases over time for your 3 favorite countries?</p>
<details>
<summary>
R solution
</summary>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="transforming-data.html#cb302-1" aria-hidden="true" tabindex="-1"></a>who_disease_wide <span class="ot">&lt;-</span> who_disease_long <span class="sc">%&gt;%</span></span>
<span id="cb302-2"><a href="transforming-data.html#cb302-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(Country, year), <span class="at">names_from =</span> Disease, <span class="at">values_from =</span> cases)</span>
<span id="cb302-3"><a href="transforming-data.html#cb302-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-4"><a href="transforming-data.html#cb302-4" aria-hidden="true" tabindex="-1"></a>who_disease_wide <span class="sc">%&gt;%</span></span>
<span id="cb302-5"><a href="transforming-data.html#cb302-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Guatemala&quot;</span>, <span class="st">&quot;Central African Republic (the)&quot;</span>, <span class="st">&quot;Pakistan&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb302-6"><a href="transforming-data.html#cb302-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Country, year, polio) <span class="sc">%&gt;%</span></span>
<span id="cb302-7"><a href="transforming-data.html#cb302-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> polio, <span class="at">color =</span> Country)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<img src="image/tryitout-disease-wide-R-1.png" width="2100" />
</details>
<details>
<summary>
SAS solution
</summary>
<pre class="sashtml"><code>6          libname classdat &quot;sas/&quot;;
NOTE: Libref CLASSDAT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: 
      /home/susan/Projects/Class/unl-stat850/stat850-textbook/sas
7          
8          PROC SORT DATA = classdat.disease_long OUT = dis_long;
NOTE: Data file CLASSDAT.DISEASE_LONG.DATA is in a format that is native 
      to another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
9          BY Cname year; /* Variables we want to define rows of data */
10         RUN;

NOTE: The data set WORK.DIS_LONG has 0 observations and 0 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

11         
12         PROC TRANSPOSE DATA = dis_long OUT = classdat.disease_wide;
NOTE: Data file CLASSDAT.DISEASE_WIDE.DATA is in a format that is native 
      to another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
13         ID Disease; /* Variable we want to name columns of data */
ERROR: Variable DISEASE not found.
14         VAR cases; /* Variable we want to be the values in each column
14       ! */
ERROR: Variable CASES not found.
15         BY Cname year; /* These define a single row */
ERROR: Variable CNAME not found.
ERROR: Variable YEAR not found.
16         RUN;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set CLASSDAT.DISEASE_WIDE may be incomplete.  When this 
         step was stopped there were 0 observations and 0 variables.
WARNING: Data set CLASSDAT.DISEASE_WIDE was not replaced because this step 
         was stopped.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      
17         
18         title &#39;Polio incidence&#39;;


19         PROC SGPLOT DATA=classdat.disease_wide
20         /* We can use a where clause in the DATA statement, if we want
20       ! */
21           (WHERE=(Cname in (&quot;Mexico&quot;, &quot;Guatemala&quot;, &quot;Pakistan&quot;)));
NOTE: Data file CLASSDAT.DISEASE_WIDE.DATA is in a format that is native 
      to another host, or the file encoding does not match the session 
      encoding. Cross Environment Data Access will be used, which might 
      require additional CPU resources and might reduce performance.
22         /* Specify the colors to use for lines */
23         styleattrs datacontrastcolors= (green orange purple);
24         /* Map variables to axes */
25         SERIES X = year Y = polio /
26           /* Color lines by Country */
27           GROUP = Cname
28           /* Give the color mapping a name so you can modify its legend
28       ! */
29           name = &quot;a&quot;
30           /* Make lines thicker so they are visible */
31           lineattrs=(thickness = 3);
32         /* Change the legend title and what it is showing (line color)
32       ! */
33         KEYLEGEND &quot;a&quot; / title = &quot;Country&quot; type = linecolor;
34         RUN;

NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SGPLOT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16,18.</code></pre>
</details>
<p>Congratulations! You now know how to reshape your data into all sorts of different formats. Use this knowledge wisely.</p>
</div>
</div>
</div>
<div id="relational-data-and-joining-tables" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Relational Data and Joining Tables</h2>
<p>We now know how to work extensively on one table at a time, but data doesn’t always come organized in one table at a time. Instead, some data may be organized relationally - that is, certain aspects of the data apply to a group of data points, and certain aspects apply to individual data points, and there are relationships between individuals that have to be documented.</p>
<details>
<summary>
Example: Primary School Organization
</summary>
<p>Each individual has certain characteristics:
- full_name
- gender
- birth date
- ID number</p>
<p>Each student has specific characteristics:
- ID number
- parent name
- parent phone number
- medical information
- Class ID</p>
<p>Teachers may also have additional information:
- ID number
- Class ID
- employment start date
- education level
- compensation level</p>
<p>There are also fields like grades, which occur for each student in each class, but multiple times a year.
- ID number
- Student ID
- Class ID
- year
- term number
- subject
- grade
- comment</p>
<p>And for teachers, there are employment records on a yearly basis
- ID number
- Employee ID
- year
- rating
- comment</p>
<p>But each class also has characteristics that describe the whole class as a unit:
- location ID
- class ID
- meeting time
- grade level</p>
<p>Each location might also have some logistical information attached:
- location ID
- room number
- building
- number of seats
- AV equipment</p>
<p><img src="image/PrimarySchoolExample.png" alt="Primary School Database Schema" />
<!-- <a href="https://dbdiagram.io/embed/5ef387179ea313663b3b048e">Link to diagram of the database</a> --></p>
<p>We could go on, but you can see that this data is hierarchical, but also relational:
- each class has both a teacher and a set of students
- each class is held in a specific location that has certain equipment</p>
<p>It would be silly to store this information in a single table (though it probably can be done) because all of the teacher information would be duplicated for each student in each class; all of the student’s individual info would be duplicated for each grade. There would be a lot of wasted storage space and the tables would be much more confusing as well.</p>
<p>But, relational data also means we have to put in some work when we have a question that requires information from multiple tables. Suppose we want a list of all of the birthdays in a certain class. We would need to take the following steps:</p>
<ul>
<li>get the Class ID</li>
<li>get any teachers that are assigned that Class ID - specifically, get their ID number</li>
<li>get any students that are assigned that Class ID - specifically, get their ID number</li>
<li>append the results from teachers and students so that there is a list of all individuals in the class</li>
<li>look through the “individual data” table to find any individuals with matching ID numbers, and keep those individuals’ birth days.</li>
</ul>
</details>
<p>Table joins allow us to combine information stored in different tables, keeping certain information (the stuff we need) while discarding extraneous information.</p>
<p>There are 3 main types of table joins:</p>
<ul>
<li><p>Filtering joins, which remove rows from a table based on whether or not there is a matching row in another table (but the columns in the original table don’t change)<br />
Ex: finding all teachers or students who have class ClassID</p></li>
<li><p>Set operations, which treat observations as set elements (e.g. union, intersection, etc.)<br />
Ex: taking the union of all student and teacher IDs to get a list of individual IDs</p></li>
<li><p>Mutating joins, which add columns from one table to matching rows in another table<br />
Ex: adding birthday to the table of all individuals in a class</p></li>
</ul>
<p><strong>keys</strong> are values that are found in multiple tables that can be used to connect the tables. A key (or set of keys) uniquely identify an observation. A <strong>primary key</strong> identifies an observation in its own table. A <strong>foreign key</strong> identifies an observation in another table.</p>
<p>We’re primarily going to focus on mutating joins, as filtering joins can be accomplished by … filtering … rather than by table joins. Feel free to read through the other types of joins <a href="https://r4ds.had.co.nz/relational-data.html#filtering-joins">here</a></p>
<details>
<summary>
Animating different types of joins
</summary>
<p>Note: all of these animations are stolen from <a href="https://github.com/gadenbuie/tidyexplain" class="uri">https://github.com/gadenbuie/tidyexplain</a>.</p>
<p>If we start with two tables, x and y,</p>
<p><img src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/master/images/static/png/original-dfs.png" /></p>
<p>We can do a filtering <code>inner_join</code> to keep only rows which are in both tables (but we keep all columns)</p>
<p><img src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/master/images/inner-join.gif" /></p>
<p>But what if we want to keep all of the rows in x? We would do a <code>left_join</code></p>
<p><img src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/master/images/left-join.gif" /></p>
<p>If there are multiple matches in the y table, though, we might have to duplicate rows in x. This is still a left join, just a more complicated one.</p>
<p><img src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/master/images/left-join-extra.gif" /></p>
<p>If we wanted to keep all of the rows in y, we would do a <code>right_join</code>:</p>
<p><img src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/master/images/right-join.gif" /></p>
<p>(or, we could do a left join with y and x, but… either way is fine).</p>
<p>And finally, if we want to keep all of the rows, we’d do a <code>full_join</code>:</p>
<p><img src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/master/images/full-join.gif" /></p>
<p>You can find other animations corresponding to filtering joins and set operations <a href="https://raw.githubusercontent.com/gadenbuie/tidyexplain/master/images/full-join.gif">here</a></p>
</details>
<div id="demonstration-dataset-setup" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Demonstration dataset setup</h3>
We’ll use the <code>nycflights13</code> package in R. Unfortunately, the data in this package are too big for me to reasonably store on github (you’ll recall, I had to use a small sample the last time we played with this data…). So before we can work with this data, we have to load the tables into SAS, which means saving them out from R.
<details>
<summary>
Instructions
</summary>
<p>We’ll use a function in the <code>dbplyr</code> package to do that.<a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a></p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="transforming-data.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;nycflights13&quot;</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()) <span class="fu">install.packages</span>(<span class="st">&quot;nycflights13&quot;</span>)</span>
<span id="cb304-2"><a href="transforming-data.html#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;dbplyr&quot;</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()) <span class="fu">install.packages</span>(<span class="st">&quot;dbplyr&quot;</span>)</span>
<span id="cb304-3"><a href="transforming-data.html#cb304-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb304-4"><a href="transforming-data.html#cb304-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbplyr)</span>
<span id="cb304-5"><a href="transforming-data.html#cb304-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-6"><a href="transforming-data.html#cb304-6" aria-hidden="true" tabindex="-1"></a>Attaching package<span class="sc">:</span> <span class="st">&#39;dbplyr&#39;</span></span>
<span id="cb304-7"><a href="transforming-data.html#cb304-7" aria-hidden="true" tabindex="-1"></a>The following objects are masked from <span class="st">&#39;package:dplyr&#39;</span><span class="sc">:</span></span>
<span id="cb304-8"><a href="transforming-data.html#cb304-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-9"><a href="transforming-data.html#cb304-9" aria-hidden="true" tabindex="-1"></a>    ident, sql</span>
<span id="cb304-10"><a href="transforming-data.html#cb304-10" aria-hidden="true" tabindex="-1"></a><span class="fu">nycflights13_sqlite</span>(<span class="at">path =</span> <span class="st">&quot;data/&quot;</span>)</span>
<span id="cb304-11"><a href="transforming-data.html#cb304-11" aria-hidden="true" tabindex="-1"></a>Caching nycflights db at data<span class="sc">/</span><span class="er">/</span>nycflights13.sqlite</span>
<span id="cb304-12"><a href="transforming-data.html#cb304-12" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>SQLiteConnection<span class="sc">&gt;</span></span>
<span id="cb304-13"><a href="transforming-data.html#cb304-13" aria-hidden="true" tabindex="-1"></a>  Path<span class="sc">:</span> <span class="er">/</span>home<span class="sc">/</span>susan<span class="sc">/</span>Projects<span class="sc">/</span>Class<span class="sc">/</span>unl<span class="sc">-</span>stat850<span class="sc">/</span>stat850<span class="sc">-</span>textbook<span class="sc">/</span>data<span class="sc">/</span>nycflights13.sqlite</span>
<span id="cb304-14"><a href="transforming-data.html#cb304-14" aria-hidden="true" tabindex="-1"></a>  Extensions<span class="sc">:</span> <span class="cn">TRUE</span></span></code></pre></div>
<p>Then, you’ll have to figure out where on your system database locations (DSNs) are stored. On Unix systems, it’s /etc/odbc.ini (for system-wide access) and ~/.odbc.ini. On windows, you’ll need to use the ODBC Data Source Administrator to set this up.</p>
<pre><code>[nycflight]
Description = NYC flights database
Driver = SQLite3
Database = data/nycflights13.sqlite
</code></pre>
</details>
<div id="try-it-out-22" class="section level4 unnumbered tryitout">
<h4>Try it out</h4>
<p>Sketch a diagram of which fields in each table match fields in other tables.</p>
<p>You can find the solution <a href="https://r4ds.had.co.nz/relational-data.html#nycflights13-relational">here</a> (scroll down a bit).</p>
</div>
</div>
<div id="mutating-joins" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Mutating joins</h3>
<p>A mutating join combines variables in two tables. There are excellent visual representations of the types of mutating joins <a href="https://r4ds.had.co.nz/relational-data.html#mutating-joins">here</a>.</p>
<p>Every join has a “left side” and a “right side” - so in <code>some_join(A, B)</code>, A is the left side, B is the right side.</p>
<p>Joins are differentiated based on how they treat the rows and columns of each side. In mutating joins, the columns from both sides are always kept.</p>
<table>
<tr>
<td>
</td>
<td colspan="2">
Left Side
</td>
<td colspan="2">
Right Side
</td>
</tr>
<th>
<td>
Join Type
</td>
<td>
Rows
</td>
<td>
Cols
</td>
<td>
Rows
</td>
<td>
Cols
</td>
</th>
<tr>
<td>
inner
</td>
<td>
matching
</td>
<td>
all
</td>
<td>
matching
</td>
<td>
all
</td>
</tr>
<tr>
<td>
left
</td>
<td>
all
</td>
<td>
all
</td>
<td>
matching
</td>
<td>
all
</td>
</tr>
<tr>
<td>
right
</td>
<td>
matching
</td>
<td>
all
</td>
<td>
all
</td>
<td>
all
</td>
</tr>
<tr>
<td>
outer
</td>
<td>
all
</td>
<td>
all
</td>
<td>
all
</td>
<td>
all
</td>
</tr>
</table>
<details>
<summary>
Mutating joins in R
</summary>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="transforming-data.html#cb306-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;D&quot;</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb306-2"><a href="transforming-data.html#cb306-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>), <span class="at">z =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>))</span></code></pre></div>
<p>An inner join keeps only rows that exist on both sides, but keeps all columns.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="transforming-data.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(t1, t2)</span>
<span id="cb307-2"><a href="transforming-data.html#cb307-2" aria-hidden="true" tabindex="-1"></a>Joining, by <span class="ot">=</span> <span class="st">&quot;x&quot;</span></span>
<span id="cb307-3"><a href="transforming-data.html#cb307-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 2 x 3</span></span>
<span id="cb307-4"><a href="transforming-data.html#cb307-4" aria-hidden="true" tabindex="-1"></a>  x         y     z</span>
<span id="cb307-5"><a href="transforming-data.html#cb307-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb307-6"><a href="transforming-data.html#cb307-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> B         <span class="dv">2</span>     <span class="dv">2</span></span>
<span id="cb307-7"><a href="transforming-data.html#cb307-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> D         <span class="dv">3</span>     <span class="dv">5</span></span></code></pre></div>
<p>A left join keeps all of the rows in the left side, and adds any columns from the right side that match rows on the left. Rows on the left that don’t match get filled in with NAs.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="transforming-data.html#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(t1, t2)</span>
<span id="cb308-2"><a href="transforming-data.html#cb308-2" aria-hidden="true" tabindex="-1"></a>Joining, by <span class="ot">=</span> <span class="st">&quot;x&quot;</span></span>
<span id="cb308-3"><a href="transforming-data.html#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 3 x 3</span></span>
<span id="cb308-4"><a href="transforming-data.html#cb308-4" aria-hidden="true" tabindex="-1"></a>  x         y     z</span>
<span id="cb308-5"><a href="transforming-data.html#cb308-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb308-6"><a href="transforming-data.html#cb308-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> A         <span class="dv">1</span>    <span class="cn">NA</span></span>
<span id="cb308-7"><a href="transforming-data.html#cb308-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> B         <span class="dv">2</span>     <span class="dv">2</span></span>
<span id="cb308-8"><a href="transforming-data.html#cb308-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> D         <span class="dv">3</span>     <span class="dv">5</span></span>
<span id="cb308-9"><a href="transforming-data.html#cb308-9" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(t2, t1)</span>
<span id="cb308-10"><a href="transforming-data.html#cb308-10" aria-hidden="true" tabindex="-1"></a>Joining, by <span class="ot">=</span> <span class="st">&quot;x&quot;</span></span>
<span id="cb308-11"><a href="transforming-data.html#cb308-11" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 3 x 3</span></span>
<span id="cb308-12"><a href="transforming-data.html#cb308-12" aria-hidden="true" tabindex="-1"></a>  x         z     y</span>
<span id="cb308-13"><a href="transforming-data.html#cb308-13" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb308-14"><a href="transforming-data.html#cb308-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> B         <span class="dv">2</span>     <span class="dv">2</span></span>
<span id="cb308-15"><a href="transforming-data.html#cb308-15" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> C         <span class="dv">4</span>    <span class="cn">NA</span></span>
<span id="cb308-16"><a href="transforming-data.html#cb308-16" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> D         <span class="dv">5</span>     <span class="dv">3</span></span></code></pre></div>
<p>There is a similar construct called a right join that is equivalent to flipping the arguments in a left join. The row and column ordering may be different, but all of the same values will be there</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="transforming-data.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">right_join</span>(t1, t2)</span>
<span id="cb309-2"><a href="transforming-data.html#cb309-2" aria-hidden="true" tabindex="-1"></a>Joining, by <span class="ot">=</span> <span class="st">&quot;x&quot;</span></span>
<span id="cb309-3"><a href="transforming-data.html#cb309-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 3 x 3</span></span>
<span id="cb309-4"><a href="transforming-data.html#cb309-4" aria-hidden="true" tabindex="-1"></a>  x         y     z</span>
<span id="cb309-5"><a href="transforming-data.html#cb309-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb309-6"><a href="transforming-data.html#cb309-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> B         <span class="dv">2</span>     <span class="dv">2</span></span>
<span id="cb309-7"><a href="transforming-data.html#cb309-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> D         <span class="dv">3</span>     <span class="dv">5</span></span>
<span id="cb309-8"><a href="transforming-data.html#cb309-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> C        <span class="cn">NA</span>     <span class="dv">4</span></span>
<span id="cb309-9"><a href="transforming-data.html#cb309-9" aria-hidden="true" tabindex="-1"></a><span class="fu">right_join</span>(t2, t1)</span>
<span id="cb309-10"><a href="transforming-data.html#cb309-10" aria-hidden="true" tabindex="-1"></a>Joining, by <span class="ot">=</span> <span class="st">&quot;x&quot;</span></span>
<span id="cb309-11"><a href="transforming-data.html#cb309-11" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 3 x 3</span></span>
<span id="cb309-12"><a href="transforming-data.html#cb309-12" aria-hidden="true" tabindex="-1"></a>  x         z     y</span>
<span id="cb309-13"><a href="transforming-data.html#cb309-13" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb309-14"><a href="transforming-data.html#cb309-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> B         <span class="dv">2</span>     <span class="dv">2</span></span>
<span id="cb309-15"><a href="transforming-data.html#cb309-15" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> D         <span class="dv">5</span>     <span class="dv">3</span></span>
<span id="cb309-16"><a href="transforming-data.html#cb309-16" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> A        <span class="cn">NA</span>     <span class="dv">1</span></span></code></pre></div>
<p>An outer join keeps everything - all rows, all columns. In dplyr, it’s known as a <code>full_join</code>.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="transforming-data.html#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(t1, t2)</span>
<span id="cb310-2"><a href="transforming-data.html#cb310-2" aria-hidden="true" tabindex="-1"></a>Joining, by <span class="ot">=</span> <span class="st">&quot;x&quot;</span></span>
<span id="cb310-3"><a href="transforming-data.html#cb310-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 4 x 3</span></span>
<span id="cb310-4"><a href="transforming-data.html#cb310-4" aria-hidden="true" tabindex="-1"></a>  x         y     z</span>
<span id="cb310-5"><a href="transforming-data.html#cb310-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb310-6"><a href="transforming-data.html#cb310-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> A         <span class="dv">1</span>    <span class="cn">NA</span></span>
<span id="cb310-7"><a href="transforming-data.html#cb310-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> B         <span class="dv">2</span>     <span class="dv">2</span></span>
<span id="cb310-8"><a href="transforming-data.html#cb310-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> D         <span class="dv">3</span>     <span class="dv">5</span></span>
<span id="cb310-9"><a href="transforming-data.html#cb310-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> C        <span class="cn">NA</span>     <span class="dv">4</span></span></code></pre></div>
</details>
<p>In SAS, you can do joins using a data step or PROC SQL. To do a join with data steps, you have to have your data sorted by columns that overlap. PROC SQL has no such requirement.</p>
<p><a href="https://support.sas.com/resources/papers/proceedings/pdfs/sgf2008/178-2008.pdf">This guide shows the syntax for PROC SQL and DATA step joins side-by-side.</a></p>
<details>
<summary>
PROC SQL Mutating joins
</summary>
<pre class="sashtml"><code>

6          data t1;
7          input x $ y;
8          datalines;

NOTE: The data set WORK.T1 has 0 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

12         ;
13         
14         data t2;
15         input x $ z;
16         datalines;

NOTE: The data set WORK.T2 has 0 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

20         ;
21         
22         title &#39;Inner join&#39;;
23         PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
24         SELECT * FROM t1 as p1
25         INNER JOIN t2 as p2
26         ON p1.x = p2.x;
NOTE: Statement not executed due to NOEXEC option.
27         
28         title &#39;Left join&#39;;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


29         PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
30         SELECT * FROM t1 as p1
31         LEFT JOIN t2 as p2
32         ON p1.x = p2.x;
NOTE: Statement not executed due to NOEXEC option.
33         
34         title &#39;Right join&#39;;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      


35         PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
36         SELECT * FROM t1 as p1
37         RIGHT JOIN t2 as p2
38         ON p1.x = p2.x;
NOTE: Statement not executed due to NOEXEC option.
39         
40         title &#39;Full Outer join&#39;;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


41         PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
42         SELECT * FROM t1 as p1
43         FULL OUTER JOIN t2 as p2
44         ON p1.x = p2.x;
NOTE: Statement not executed due to NOEXEC option.
45         
46         /* Use coalesce to prevent column duplication */
47         
48         title &#39;Inner join&#39;;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


49         PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
50         SELECT COALESCE(p1.x, p2.x) AS x, y, z
51         FROM t1 as p1 INNER JOIN  t2 as p2
52         on p1.x = p2.x;
NOTE: Statement not executed due to NOEXEC option.
53         
54         title &#39;Left join&#39;;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


55         PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
56         SELECT COALESCE(p1.x, p2.x) AS x, y, z
57         FROM t1 as p1 LEFT JOIN t2 as p2
58         ON p1.x = p2.x;
NOTE: Statement not executed due to NOEXEC option.
59         
60         title &#39;Right join&#39;;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


61         PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
62         SELECT COALESCE(p1.x, p2.x) AS x, y, z
63         FROM t1 as p1 RIGHT JOIN t2 as p2
64         ON p1.x = p2.x;
NOTE: Statement not executed due to NOEXEC option.
65         
66         title &#39;Full Outer join&#39;;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


67         PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
68         SELECT COALESCE(p1.x, p2.x) AS x, y, z
69         FROM t1 as p1 FULL OUTER JOIN t2 as p2
70         ON p1.x = p2.x;
NOTE: Statement not executed due to NOEXEC option.
71         
72         title;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16,18,19.</code></pre>
</details>
<details>
<summary>
Data Step Mutating joins
</summary>
<pre class="sashtml"><code>NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.02 seconds
      


6          data t1;
7          input x $ y;
8          datalines;

NOTE: The data set WORK.T1 has 0 observations and 2 variables.
WARNING: Data set WORK.T1 was not replaced because this step was stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

12         ;
13         
14         data t2;
15         input x $ z;
16         datalines;

NOTE: The data set WORK.T2 has 0 observations and 2 variables.
WARNING: Data set WORK.T2 was not replaced because this step was stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

20         ;
21         
22         DATA inner;
23         MERGE t1 (IN = p1) t2 (IN = p2);
24         BY x;
25         IF p1 AND p2;
26         RUN;

NOTE: The data set WORK.INNER has 0 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

27         
28         PROC PRINT DATA=inner;RUN;

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

29         
30         DATA left;
31         MERGE t1 (IN = p1) t2 (IN = p2);
32         BY x;
33         IF p1;
34         RUN;

NOTE: The data set WORK.LEFT has 0 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

35         
36         PROC PRINT DATA=left;RUN;

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

37         
38         DATA right;
39         MERGE t1 (IN = p1) t2 (IN = p2);
40         BY x;
41         IF p2;
42         RUN;

NOTE: The data set WORK.RIGHT has 0 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

43         
44         PROC PRINT DATA=right;RUN;

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

45         
46         DATA outer;
47         MERGE t1 (IN = p1) t2 (IN = p2);
48         BY x;
49         RUN;

NOTE: The data set WORK.OUTER has 0 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

50         
51         PROC PRINT DATA=outer;RUN;

NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


ERROR: Errors printed on pages 9,11,12,13,15,16,18,19.</code></pre>
</details>
<p>As before, these functions may become a bit more interesting once we try them out on real-world data. Using the flights data, let’s determine whether there’s a relationship between the age of a plane and its delays.</p>
<details>
<summary>
In R
</summary>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="transforming-data.html#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb313-2"><a href="transforming-data.html#cb313-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-3"><a href="transforming-data.html#cb313-3" aria-hidden="true" tabindex="-1"></a>plane_age <span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span></span>
<span id="cb313-4"><a href="transforming-data.html#cb313-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="dv">2013</span> <span class="sc">-</span> year) <span class="sc">%&gt;%</span> <span class="co"># This gets us away from having to deal with 2 different year columns</span></span>
<span id="cb313-5"><a href="transforming-data.html#cb313-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tailnum, age, manufacturer)</span>
<span id="cb313-6"><a href="transforming-data.html#cb313-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-7"><a href="transforming-data.html#cb313-7" aria-hidden="true" tabindex="-1"></a>delays_by_plane <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb313-8"><a href="transforming-data.html#cb313-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay, arr_delay, carrier, flight, tailnum)</span>
<span id="cb313-9"><a href="transforming-data.html#cb313-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-10"><a href="transforming-data.html#cb313-10" aria-hidden="true" tabindex="-1"></a><span class="co"># We only need to keep delays that have a plane age, so use inner join</span></span>
<span id="cb313-11"><a href="transforming-data.html#cb313-11" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(delays_by_plane, plane_age, <span class="at">by =</span> <span class="st">&quot;tailnum&quot;</span>)</span>
<span id="cb313-12"><a href="transforming-data.html#cb313-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-13"><a href="transforming-data.html#cb313-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> dep_delay, <span class="at">group =</span> <span class="fu">cut_width</span>(age, <span class="dv">1</span>, <span class="at">center =</span> <span class="dv">0</span>))) <span class="sc">+</span> </span>
<span id="cb313-14"><a href="transforming-data.html#cb313-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb313-15"><a href="transforming-data.html#cb313-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Departure Delay (min)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb313-16"><a href="transforming-data.html#cb313-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Plane age&quot;</span>) <span class="sc">+</span> </span>
<span id="cb313-17"><a href="transforming-data.html#cb313-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">50</span>))</span>
<span id="cb313-18"><a href="transforming-data.html#cb313-18" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">5306</span> rows containing missing <span class="fu">values</span> (stat_boxplot).</span>
<span id="cb313-19"><a href="transforming-data.html#cb313-19" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">4068</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_boxplot).</span></code></pre></div>
<p><img src="image/flights-delay-age-R-1.png" width="45%" /></p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="transforming-data.html#cb314-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-2"><a href="transforming-data.html#cb314-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> arr_delay, <span class="at">group =</span> <span class="fu">cut_width</span>(age, <span class="dv">1</span>, <span class="at">center =</span> <span class="dv">0</span>))) <span class="sc">+</span> </span>
<span id="cb314-3"><a href="transforming-data.html#cb314-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb314-4"><a href="transforming-data.html#cb314-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Arrival Delay (min)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb314-5"><a href="transforming-data.html#cb314-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Plane age&quot;</span>) <span class="sc">+</span> </span>
<span id="cb314-6"><a href="transforming-data.html#cb314-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">60</span>))</span>
<span id="cb314-7"><a href="transforming-data.html#cb314-7" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">5306</span> rows containing missing <span class="fu">values</span> (stat_boxplot).</span>
<span id="cb314-8"><a href="transforming-data.html#cb314-8" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">5011</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_boxplot).</span></code></pre></div>
<img src="image/flights-delay-age-R-2.png" width="45%" />
It doesn’t look like there’s much of a relationship to me. If anything, older planes are more likely to be early, but I suspect there aren’t enough of them to make that conclusion (3.54% are over 25 years old, and 0.28% are over 40 years old).
</details>
<details>
<summary>
In SAS
</summary>
<pre class="sashtml"><code>6          libname nycair odbc complete =
6        ! XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX;
ERROR: CLI error trying to establish connection: [unixODBC][Driver 
       Manager]Can&#39;t open lib &#39;libsqlite3odbc.so&#39; : file not found
ERROR: Error in the LIBNAME statement.
7          
8          PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
9          CREATE TABLE tmp1 AS
10         SELECT 2013 - year AS age, tailnum FROM nycair.planes
11         WHERE ^missing(year);
NOTE: Statement not executed due to NOEXEC option.
12         
13         CREATE TABLE tmp2 AS
14         SELECT tailnum, dep_delay, arr_delay, air_time, distance, hour,
14       ! carrier, origin
15         FROM nycair.flights;
NOTE: Statement not executed due to NOEXEC option.
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16,18,19,22.</code></pre>
<p>Now that the prep work is done, we can get on with answering the question.</p>
<pre class="sashtml"><code>6          
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


7          PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
8          CREATE TABLE agedelay AS
9          SELECT COALESCE(p1.tailnum, p2.tailnum) AS tailnum,
10                 age, dep_delay, arr_delay, air_time, distance, hour,
10       ! carrier, origin
11         FROM tmp1 as p1 INNER JOIN tmp2 as p2
12         ON p1.tailnum = p2.tailnum
13         WHERE age &lt; 25 /* only work with areas where there&#39;s enough data
13       !  */
14         ORDER BY age;
NOTE: Statement not executed due to NOEXEC option.
15         
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


16         PROC MEANS DATA = agedelay NOPRINT;
ERROR: File WORK.AGEDELAY.DATA does not exist.
17         BY age;
ERROR: No data set open to look up variables.
18         VAR dep_delay arr_delay;
ERROR: No data set open to look up variables.
ERROR: No data set open to look up variables.
19         OUTPUT OUT = agemeans;
20         RUN;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set WORK.AGEMEANS may be incomplete.  When this step was 
         stopped there were 0 observations and 0 variables.
NOTE: PROCEDURE MEANS used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
21         


22         PROC TRANSPOSE DATA = agemeans(where = (_STAT_=&quot;MEAN&quot;))
23           OUT = agemeanst(drop= _Label_)
ERROR: Variable _STAT_ is not on file WORK.AGEMEANS.
24           name=VAR;
25         BY age _FREQ_; /* Just to keep _FREQ_ around */
ERROR: No data set open to look up variables.
ERROR: No data set open to look up variables.
26         VAR dep_delay arr_delay;
ERROR: No data set open to look up variables.
ERROR: No data set open to look up variables.
27         ID _STAT_;
ERROR: No data set open to look up variables.
28         RUN;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set WORK.AGEMEANST may be incomplete.  When this step 
         was stopped there were 0 observations and 0 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16,18,19,22.</code></pre>
<p>In theory, we could use some sort of linear model, but lets start with a simple plot of age * average delay and see where that takes us.</p>
<pre class="sashtml"><code>

6          PROC SGPANEL DATA = agemeanst;
7          PANELBY VAR;
ERROR: Variable VAR not found.
8          SCATTER X = age Y = MEAN;
ERROR: Variable AGE not found.
ERROR: Variable MEAN not found.
9          RUN;

NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SGPANEL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16,18,19,22,23.</code></pre>
<p>I started wondering about that pattern - to me, it doesn’t look like there’s any particular trend so much as there’s just low - high - low clusters. So I decided to plot frequency as well, and, lo and behold, the frequency count is similarly distributed. So my current working hypothesis is that there are a lot more observations in the middle group of planes that are 5-15 years old.</p>
<pre class="sashtml"><code>6          


7          PROC SGPLOT DATA = agemeanst;
8          SCATTER X = age Y = _FREQ_;
ERROR: Variable AGE not found.
ERROR: Variable _FREQ_ not found.
9          RUN;

NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SGPLOT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16,18,19,22,23.</code></pre>
It’s also entirely possible that planes between 5-15 years of age have more mechanical issues, but I suspect most delays are due to airport, weather, etc. rather than mechanical malfunctions.
</details>
</div>
</div>
<div id="example-gas-prices-data" class="section level2 tryitout tabset" number="7.5">
<h2><span class="header-section-number">7.5</span> Example: Gas Prices Data</h2>
<p>The US Energy Information Administration tracks gasoline prices, with data available on a weekly level since late 1994. You can go to <a href="https://www.eia.gov/dnav/pet/hist/LeafHandler.ashx?n=pet&amp;s=emm_epm0u_pte_nus_dpg&amp;f=w">this site</a> to see a nice graph of gas prices, along with a corresponding table (or you can look at the screenshot below, as I don’t really trust that the site design will stay the same…)</p>
<div class="figure">
<img src="image/06_gas_prices_screenshot.png" alt="" />
<p class="caption">Gas prices at US EIA site</p>
</div>
<p>The data in the table is structured in a fairly easy to read form: each row is a month; each week in the month is a set of two columns: one for the date, one for the average gas price. While this data is definitely not tidy, it is readable.</p>
<p>But looking at the chart at the top of the page, it’s not clear how we might get that chart from the data in the format it’s presented here: to get a chart like that, we would need a table where each row was a single date, and there were columns for date and price. That would be tidy form data, and so we have to get from the wide, human-readable form into the long, tidier form that we can graph.</p>
<div id="option-1-manual-formatting-in-excel" class="section level3" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Option 1: Manual formatting in Excel</h3>
<p>An excel spreadsheet of the data as downloaded in Sept 2020 is available <a href="data/gas_prices.xlsx">here</a>. Can you manually format the data (or even just the first year or two of data) into a long, skinny format?</p>
<details>
<summary>
What steps are involved?
</summary>
<ol style="list-style-type: decimal">
<li><p>Copy the year-month column, creating one vertical copy for every set of columns</p></li>
<li><p>Move each block of two columns down to the corresponding vertical copy</p></li>
<li><p>Delete empty rows</p></li>
<li><p>Format dates</p></li>
<li><p>Delete empty columns</p></li>
</ol>
<a href="https://youtu.be/n70eAKJmzRo">Here is a video of me doing most of these steps</a>. I skipped out on the data cleaning stage because Excel is miserable for working with dates.
</details>
</div>
<div id="option-2-r" class="section level3" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Option 2: R</h3>
<p>This section shows you how to clean the data up without any sort of database merges, but with 2 pivot operations. The SAS section shows how to clean the data up with database merges and a single pivot operation. You can, of course, use either approach in either language.</p>
<p>If you want to try this for yourself first, there is a skeleton file <a href="code/06_gas_prices_start.R">here</a> that you can fill in. Use the intermediate datasets shown to guide you through the steps, then click on the expandable sections to see the code that was used.</p>
<details>
<summary>
Reading in the data from the web
</summary>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="transforming-data.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest) <span class="co"># scrape data from the web</span></span>
<span id="cb319-2"><a href="transforming-data.html#cb319-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-3"><a href="transforming-data.html#cb319-3" aria-hidden="true" tabindex="-1"></a>Attaching package<span class="sc">:</span> <span class="st">&#39;rvest&#39;</span></span>
<span id="cb319-4"><a href="transforming-data.html#cb319-4" aria-hidden="true" tabindex="-1"></a>The following object is masked from <span class="st">&#39;package:readr&#39;</span><span class="sc">:</span></span>
<span id="cb319-5"><a href="transforming-data.html#cb319-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-6"><a href="transforming-data.html#cb319-6" aria-hidden="true" tabindex="-1"></a>    guess_encoding</span>
<span id="cb319-7"><a href="transforming-data.html#cb319-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2) <span class="co"># parse xml data</span></span>
<span id="cb319-8"><a href="transforming-data.html#cb319-8" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.eia.gov/dnav/pet/hist/LeafHandler.ashx?n=pet&amp;s=emm_epm0u_pte_nus_dpg&amp;f=w&quot;</span></span>
<span id="cb319-9"><a href="transforming-data.html#cb319-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-10"><a href="transforming-data.html#cb319-10" aria-hidden="true" tabindex="-1"></a>htmldoc <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb319-11"><a href="transforming-data.html#cb319-11" aria-hidden="true" tabindex="-1"></a>gas_prices_raw <span class="ot">&lt;-</span> <span class="fu">html_table</span>(htmldoc, <span class="at">fill =</span> T, <span class="at">trim =</span> T) [[<span class="dv">5</span>]]</span></code></pre></div>
</details>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="transforming-data.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gas_prices_raw)</span>
<span id="cb320-2"><a href="transforming-data.html#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 13</span></span>
<span id="cb320-3"><a href="transforming-data.html#cb320-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Year-Month</span><span class="st">`</span> <span class="st">`</span><span class="at">Week 1</span><span class="st">`</span>  <span class="st">`</span><span class="at">Week 1</span><span class="st">`</span> <span class="st">`</span><span class="at">Week 2</span><span class="st">`</span>  <span class="st">`</span><span class="at">Week 2</span><span class="st">`</span> <span class="st">`</span><span class="at">Week 3</span><span class="st">`</span>  <span class="st">`</span><span class="at">Week 3</span><span class="st">`</span> <span class="st">`</span><span class="at">Week 4</span><span class="st">`</span></span>
<span id="cb320-4"><a href="transforming-data.html#cb320-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>        <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>    <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>    <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>    <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   </span>
<span id="cb320-5"><a href="transforming-data.html#cb320-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="st">&quot;Year-Month&quot;</span> <span class="st">&quot;End Dat… &quot;</span>Value<span class="st">&quot;  &quot;</span>End Dat… <span class="st">&quot;Value&quot;</span>  <span class="st">&quot;End Dat… &quot;</span>Value<span class="st">&quot;  &quot;</span>End Da…</span>
<span id="cb320-6"><a href="transforming-data.html#cb320-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="st">&quot;1994-Nov&quot;</span>   <span class="st">&quot;&quot;</span>        <span class="st">&quot;&quot;</span>       <span class="st">&quot;&quot;</span>        <span class="st">&quot;&quot;</span>       <span class="st">&quot;&quot;</span>        <span class="st">&quot;&quot;</span>       <span class="st">&quot;11/28&quot;</span> </span>
<span id="cb320-7"><a href="transforming-data.html#cb320-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="st">&quot;1994-Dec&quot;</span>   <span class="st">&quot;12/05&quot;</span>   <span class="st">&quot;1.143&quot;</span>  <span class="st">&quot;12/12&quot;</span>   <span class="st">&quot;1.118&quot;</span>  <span class="st">&quot;12/19&quot;</span>   <span class="st">&quot;1.099&quot;</span>  <span class="st">&quot;12/26&quot;</span> </span>
<span id="cb320-8"><a href="transforming-data.html#cb320-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="st">&quot;&quot;</span>           <span class="st">&quot;&quot;</span>        <span class="st">&quot;&quot;</span>       <span class="st">&quot;&quot;</span>        <span class="st">&quot;&quot;</span>       <span class="st">&quot;&quot;</span>        <span class="st">&quot;&quot;</span>       <span class="st">&quot;&quot;</span>      </span>
<span id="cb320-9"><a href="transforming-data.html#cb320-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="st">&quot;1995-Jan&quot;</span>   <span class="st">&quot;01/02&quot;</span>   <span class="st">&quot;1.104&quot;</span>  <span class="st">&quot;01/09&quot;</span>   <span class="st">&quot;1.111&quot;</span>  <span class="st">&quot;01/16&quot;</span>   <span class="st">&quot;1.102&quot;</span>  <span class="st">&quot;01/23&quot;</span> </span>
<span id="cb320-10"><a href="transforming-data.html#cb320-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="st">&quot;1995-Feb&quot;</span>   <span class="st">&quot;02/06&quot;</span>   <span class="st">&quot;1.103&quot;</span>  <span class="st">&quot;02/13&quot;</span>   <span class="st">&quot;1.099&quot;</span>  <span class="st">&quot;02/20&quot;</span>   <span class="st">&quot;1.093&quot;</span>  <span class="st">&quot;02/27&quot;</span> </span>
<span id="cb320-11"><a href="transforming-data.html#cb320-11" aria-hidden="true" tabindex="-1"></a><span class="co"># … with 5 more variables: Week 4 &lt;chr&gt;, Week 5 &lt;chr&gt;, Week 5.1 &lt;chr&gt;,  &lt;lgl&gt;,</span></span>
<span id="cb320-12"><a href="transforming-data.html#cb320-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   .1 &lt;lgl&gt;</span></span></code></pre></div>
<details>
<summary>
Initial data cleaning - fix up column names, get rid of empty rows
</summary>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="transforming-data.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb321-2"><a href="transforming-data.html#cb321-2" aria-hidden="true" tabindex="-1"></a>── Attaching packages ─────────────────────────────────────── tidyverse <span class="dv">1</span>.<span class="fl">3.1</span> ──</span>
<span id="cb321-3"><a href="transforming-data.html#cb321-3" aria-hidden="true" tabindex="-1"></a>✓ forcats <span class="dv">0</span>.<span class="fl">5.1</span>     </span>
<span id="cb321-4"><a href="transforming-data.html#cb321-4" aria-hidden="true" tabindex="-1"></a>── Conflicts ────────────────────────────────────────── <span class="fu">tidyverse_conflicts</span>() ──</span>
<span id="cb321-5"><a href="transforming-data.html#cb321-5" aria-hidden="true" tabindex="-1"></a>x lubridate<span class="sc">::</span><span class="fu">as.difftime</span>() masks base<span class="sc">::</span><span class="fu">as.difftime</span>()</span>
<span id="cb321-6"><a href="transforming-data.html#cb321-6" aria-hidden="true" tabindex="-1"></a>x lubridate<span class="sc">::</span><span class="fu">date</span>()        masks base<span class="sc">::</span><span class="fu">date</span>()</span>
<span id="cb321-7"><a href="transforming-data.html#cb321-7" aria-hidden="true" tabindex="-1"></a>x tidyr<span class="sc">::</span><span class="fu">extract</span>()         masks magrittr<span class="sc">::</span><span class="fu">extract</span>()</span>
<span id="cb321-8"><a href="transforming-data.html#cb321-8" aria-hidden="true" tabindex="-1"></a>x dplyr<span class="sc">::</span><span class="fu">filter</span>()          masks stats<span class="sc">::</span><span class="fu">filter</span>()</span>
<span id="cb321-9"><a href="transforming-data.html#cb321-9" aria-hidden="true" tabindex="-1"></a>x rvest<span class="sc">::</span><span class="fu">guess_encoding</span>()  masks readr<span class="sc">::</span><span class="fu">guess_encoding</span>()</span>
<span id="cb321-10"><a href="transforming-data.html#cb321-10" aria-hidden="true" tabindex="-1"></a>x dbplyr<span class="sc">::</span><span class="fu">ident</span>()          masks dplyr<span class="sc">::</span><span class="fu">ident</span>()</span>
<span id="cb321-11"><a href="transforming-data.html#cb321-11" aria-hidden="true" tabindex="-1"></a>x lubridate<span class="sc">::</span><span class="fu">intersect</span>()   masks base<span class="sc">::</span><span class="fu">intersect</span>()</span>
<span id="cb321-12"><a href="transforming-data.html#cb321-12" aria-hidden="true" tabindex="-1"></a>x dplyr<span class="sc">::</span><span class="fu">lag</span>()             masks stats<span class="sc">::</span><span class="fu">lag</span>()</span>
<span id="cb321-13"><a href="transforming-data.html#cb321-13" aria-hidden="true" tabindex="-1"></a>x purrr<span class="sc">::</span><span class="fu">set_names</span>()       masks magrittr<span class="sc">::</span><span class="fu">set_names</span>()</span>
<span id="cb321-14"><a href="transforming-data.html#cb321-14" aria-hidden="true" tabindex="-1"></a>x lubridate<span class="sc">::</span><span class="fu">setdiff</span>()     masks base<span class="sc">::</span><span class="fu">setdiff</span>()</span>
<span id="cb321-15"><a href="transforming-data.html#cb321-15" aria-hidden="true" tabindex="-1"></a>x dbplyr<span class="sc">::</span><span class="fu">sql</span>()            masks dplyr<span class="sc">::</span><span class="fu">sql</span>()</span>
<span id="cb321-16"><a href="transforming-data.html#cb321-16" aria-hidden="true" tabindex="-1"></a>x lubridate<span class="sc">::</span><span class="fu">union</span>()       masks base<span class="sc">::</span><span class="fu">union</span>()</span>
<span id="cb321-17"><a href="transforming-data.html#cb321-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr) <span class="co"># pipe friendly operations</span></span>
<span id="cb321-18"><a href="transforming-data.html#cb321-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to clean up column names</span></span>
<span id="cb321-19"><a href="transforming-data.html#cb321-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Written as an extra function because it makes the code a lot cleaner</span></span>
<span id="cb321-20"><a href="transforming-data.html#cb321-20" aria-hidden="true" tabindex="-1"></a>fix_gas_names <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb321-21"><a href="transforming-data.html#cb321-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add extra header row information</span></span>
<span id="cb321-22"><a href="transforming-data.html#cb321-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(x, <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;Value&quot;</span>), <span class="at">times =</span> <span class="dv">5</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb321-23"><a href="transforming-data.html#cb321-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># trim leading/trailing spaces</span></span>
<span id="cb321-24"><a href="transforming-data.html#cb321-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb321-25"><a href="transforming-data.html#cb321-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># replace characters in names that aren&#39;t ok for variables in R</span></span>
<span id="cb321-26"><a href="transforming-data.html#cb321-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">make.names</span>()</span>
<span id="cb321-27"><a href="transforming-data.html#cb321-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb321-28"><a href="transforming-data.html#cb321-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-29"><a href="transforming-data.html#cb321-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up the table a bit</span></span>
<span id="cb321-30"><a href="transforming-data.html#cb321-30" aria-hidden="true" tabindex="-1"></a>gas_prices_raw <span class="ot">&lt;-</span> gas_prices_raw <span class="sc">%&gt;%</span></span>
<span id="cb321-31"><a href="transforming-data.html#cb321-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">fix_gas_names</span>(<span class="fu">names</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb321-32"><a href="transforming-data.html#cb321-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove first row that is really an extra header row</span></span>
<span id="cb321-33"><a href="transforming-data.html#cb321-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year.Month <span class="sc">!=</span> <span class="st">&quot;Year-Month&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb321-34"><a href="transforming-data.html#cb321-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get rid of empty rows</span></span>
<span id="cb321-35"><a href="transforming-data.html#cb321-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year.Month <span class="sc">!=</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
</details>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="transforming-data.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gas_prices_raw)</span>
<span id="cb322-2"><a href="transforming-data.html#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 13</span></span>
<span id="cb322-3"><a href="transforming-data.html#cb322-3" aria-hidden="true" tabindex="-1"></a>  Year.Month Week.<span class="fl">1.</span>Date Week.<span class="fl">1.</span>Value Week.<span class="fl">2.</span>Date Week.<span class="fl">2.</span>Value Week.<span class="fl">3.</span>Date</span>
<span id="cb322-4"><a href="transforming-data.html#cb322-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>      <span class="er">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>chr<span class="sc">&gt;</span>        <span class="er">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>chr<span class="sc">&gt;</span>        <span class="er">&lt;</span>chr<span class="sc">&gt;</span>      </span>
<span id="cb322-5"><a href="transforming-data.html#cb322-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">1994</span><span class="sc">-</span>Nov   <span class="st">&quot;&quot;</span>          <span class="st">&quot;&quot;</span>           <span class="st">&quot;&quot;</span>          <span class="st">&quot;&quot;</span>           <span class="st">&quot;&quot;</span>         </span>
<span id="cb322-6"><a href="transforming-data.html#cb322-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">1994</span><span class="sc">-</span>Dec   <span class="st">&quot;12/05&quot;</span>     <span class="st">&quot;1.143&quot;</span>      <span class="st">&quot;12/12&quot;</span>     <span class="st">&quot;1.118&quot;</span>      <span class="st">&quot;12/19&quot;</span>    </span>
<span id="cb322-7"><a href="transforming-data.html#cb322-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1995</span><span class="sc">-</span>Jan   <span class="st">&quot;01/02&quot;</span>     <span class="st">&quot;1.104&quot;</span>      <span class="st">&quot;01/09&quot;</span>     <span class="st">&quot;1.111&quot;</span>      <span class="st">&quot;01/16&quot;</span>    </span>
<span id="cb322-8"><a href="transforming-data.html#cb322-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">1995</span><span class="sc">-</span>Feb   <span class="st">&quot;02/06&quot;</span>     <span class="st">&quot;1.103&quot;</span>      <span class="st">&quot;02/13&quot;</span>     <span class="st">&quot;1.099&quot;</span>      <span class="st">&quot;02/20&quot;</span>    </span>
<span id="cb322-9"><a href="transforming-data.html#cb322-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">1995</span><span class="sc">-</span>Mar   <span class="st">&quot;03/06&quot;</span>     <span class="st">&quot;1.103&quot;</span>      <span class="st">&quot;03/13&quot;</span>     <span class="st">&quot;1.096&quot;</span>      <span class="st">&quot;03/20&quot;</span>    </span>
<span id="cb322-10"><a href="transforming-data.html#cb322-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1995</span><span class="sc">-</span>Apr   <span class="st">&quot;04/03&quot;</span>     <span class="st">&quot;1.116&quot;</span>      <span class="st">&quot;04/10&quot;</span>     <span class="st">&quot;1.134&quot;</span>      <span class="st">&quot;04/17&quot;</span>    </span>
<span id="cb322-11"><a href="transforming-data.html#cb322-11" aria-hidden="true" tabindex="-1"></a><span class="co"># … with 7 more variables: Week.3.Value &lt;chr&gt;, Week.4.Date &lt;chr&gt;,</span></span>
<span id="cb322-12"><a href="transforming-data.html#cb322-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   Week.4.Value &lt;chr&gt;, Week.5.Date &lt;chr&gt;, Week.5.Value &lt;chr&gt;, X &lt;lgl&gt;,</span></span>
<span id="cb322-13"><a href="transforming-data.html#cb322-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   Date &lt;lgl&gt;</span></span></code></pre></div>
<details>
<summary>
Separate year and month into different columns
</summary>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="transforming-data.html#cb323-1" aria-hidden="true" tabindex="-1"></a>gas_prices_raw <span class="ot">&lt;-</span> gas_prices_raw <span class="sc">%&gt;%</span></span>
<span id="cb323-2"><a href="transforming-data.html#cb323-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Year.Month, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb323-3"><a href="transforming-data.html#cb323-3" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Expected <span class="dv">2</span> pieces. Additional pieces discarded <span class="cf">in</span> <span class="dv">1</span> rows [<span class="dv">320</span>].</span>
<span id="cb323-4"><a href="transforming-data.html#cb323-4" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Expected <span class="dv">2</span> pieces. Missing pieces filled with <span class="st">`</span><span class="at">NA</span><span class="st">`</span> <span class="cf">in</span> <span class="dv">2</span> rows [<span class="dv">321</span>,</span>
<span id="cb323-5"><a href="transforming-data.html#cb323-5" aria-hidden="true" tabindex="-1"></a><span class="dv">322</span>].</span></code></pre></div>
</details>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="transforming-data.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gas_prices_raw)</span>
<span id="cb324-2"><a href="transforming-data.html#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 14</span></span>
<span id="cb324-3"><a href="transforming-data.html#cb324-3" aria-hidden="true" tabindex="-1"></a>  year  month Week.<span class="fl">1.</span>Date Week.<span class="fl">1.</span>Value Week.<span class="fl">2.</span>Date Week.<span class="fl">2.</span>Value Week.<span class="fl">3.</span>Date</span>
<span id="cb324-4"><a href="transforming-data.html#cb324-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>chr<span class="sc">&gt;</span>        <span class="er">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>chr<span class="sc">&gt;</span>        <span class="er">&lt;</span>chr<span class="sc">&gt;</span>      </span>
<span id="cb324-5"><a href="transforming-data.html#cb324-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">1994</span>  Nov   <span class="st">&quot;&quot;</span>          <span class="st">&quot;&quot;</span>           <span class="st">&quot;&quot;</span>          <span class="st">&quot;&quot;</span>           <span class="st">&quot;&quot;</span>         </span>
<span id="cb324-6"><a href="transforming-data.html#cb324-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">1994</span>  Dec   <span class="st">&quot;12/05&quot;</span>     <span class="st">&quot;1.143&quot;</span>      <span class="st">&quot;12/12&quot;</span>     <span class="st">&quot;1.118&quot;</span>      <span class="st">&quot;12/19&quot;</span>    </span>
<span id="cb324-7"><a href="transforming-data.html#cb324-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1995</span>  Jan   <span class="st">&quot;01/02&quot;</span>     <span class="st">&quot;1.104&quot;</span>      <span class="st">&quot;01/09&quot;</span>     <span class="st">&quot;1.111&quot;</span>      <span class="st">&quot;01/16&quot;</span>    </span>
<span id="cb324-8"><a href="transforming-data.html#cb324-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">1995</span>  Feb   <span class="st">&quot;02/06&quot;</span>     <span class="st">&quot;1.103&quot;</span>      <span class="st">&quot;02/13&quot;</span>     <span class="st">&quot;1.099&quot;</span>      <span class="st">&quot;02/20&quot;</span>    </span>
<span id="cb324-9"><a href="transforming-data.html#cb324-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">1995</span>  Mar   <span class="st">&quot;03/06&quot;</span>     <span class="st">&quot;1.103&quot;</span>      <span class="st">&quot;03/13&quot;</span>     <span class="st">&quot;1.096&quot;</span>      <span class="st">&quot;03/20&quot;</span>    </span>
<span id="cb324-10"><a href="transforming-data.html#cb324-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1995</span>  Apr   <span class="st">&quot;04/03&quot;</span>     <span class="st">&quot;1.116&quot;</span>      <span class="st">&quot;04/10&quot;</span>     <span class="st">&quot;1.134&quot;</span>      <span class="st">&quot;04/17&quot;</span>    </span>
<span id="cb324-11"><a href="transforming-data.html#cb324-11" aria-hidden="true" tabindex="-1"></a><span class="co"># … with 7 more variables: Week.3.Value &lt;chr&gt;, Week.4.Date &lt;chr&gt;,</span></span>
<span id="cb324-12"><a href="transforming-data.html#cb324-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   Week.4.Value &lt;chr&gt;, Week.5.Date &lt;chr&gt;, Week.5.Value &lt;chr&gt;, X &lt;lgl&gt;,</span></span>
<span id="cb324-13"><a href="transforming-data.html#cb324-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   Date &lt;lgl&gt;</span></span></code></pre></div>
<details>
<summary>
Move from wide to long format (part 1: extra-long format)
</summary>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="transforming-data.html#cb325-1" aria-hidden="true" tabindex="-1"></a>gas_prices_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(gas_prices_raw, <span class="sc">-</span><span class="fu">c</span>(year, month),</span>
<span id="cb325-2"><a href="transforming-data.html#cb325-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
</details>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="transforming-data.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gas_prices_long)</span>
<span id="cb326-2"><a href="transforming-data.html#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 4</span></span>
<span id="cb326-3"><a href="transforming-data.html#cb326-3" aria-hidden="true" tabindex="-1"></a>  year  month variable     value</span>
<span id="cb326-4"><a href="transforming-data.html#cb326-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>        <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb326-5"><a href="transforming-data.html#cb326-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">1994</span>  Nov   Week.<span class="fl">1.</span>Date  <span class="st">&quot;&quot;</span>   </span>
<span id="cb326-6"><a href="transforming-data.html#cb326-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">1994</span>  Nov   Week.<span class="fl">1.</span>Value <span class="st">&quot;&quot;</span>   </span>
<span id="cb326-7"><a href="transforming-data.html#cb326-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1994</span>  Nov   Week.<span class="fl">2.</span>Date  <span class="st">&quot;&quot;</span>   </span>
<span id="cb326-8"><a href="transforming-data.html#cb326-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">1994</span>  Nov   Week.<span class="fl">2.</span>Value <span class="st">&quot;&quot;</span>   </span>
<span id="cb326-9"><a href="transforming-data.html#cb326-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">1994</span>  Nov   Week.<span class="fl">3.</span>Date  <span class="st">&quot;&quot;</span>   </span>
<span id="cb326-10"><a href="transforming-data.html#cb326-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1994</span>  Nov   Week.<span class="fl">3.</span>Value <span class="st">&quot;&quot;</span>   </span></code></pre></div>
<details>
<summary>
Move from wide to long format (part 2: data cleaning and pivot long-to-wide)
</summary>
<p>We need to get our variables into two columns: one for what the value contains, and one indicating which week the value is from.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="transforming-data.html#cb327-1" aria-hidden="true" tabindex="-1"></a>gas_prices_long <span class="ot">&lt;-</span> gas_prices_long <span class="sc">%&gt;%</span></span>
<span id="cb327-2"><a href="transforming-data.html#cb327-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First, take &quot;Week.&quot; off of the front</span></span>
<span id="cb327-3"><a href="transforming-data.html#cb327-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">str_remove</span>(variable, <span class="st">&quot;Week</span><span class="sc">\\</span><span class="st">.&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb327-4"><a href="transforming-data.html#cb327-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then separate the two values</span></span>
<span id="cb327-5"><a href="transforming-data.html#cb327-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(variable, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;week&quot;</span>, <span class="st">&quot;variable&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>)</span>
<span id="cb327-6"><a href="transforming-data.html#cb327-6" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Expected <span class="dv">2</span> pieces. Missing pieces filled with <span class="st">`</span><span class="at">NA</span><span class="st">`</span> <span class="cf">in</span> <span class="dv">644</span> rows [<span class="dv">11</span>,</span>
<span id="cb327-7"><a href="transforming-data.html#cb327-7" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span>, <span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">35</span>, <span class="dv">36</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">59</span>, <span class="dv">60</span>, <span class="dv">71</span>, <span class="dv">72</span>, <span class="dv">83</span>, <span class="dv">84</span>, <span class="dv">95</span>, <span class="dv">96</span>, <span class="dv">107</span>, <span class="dv">108</span>, <span class="dv">119</span>,</span>
<span id="cb327-8"><a href="transforming-data.html#cb327-8" aria-hidden="true" tabindex="-1"></a><span class="dv">120</span>, ...].</span></code></pre></div>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="transforming-data.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gas_prices_long)</span>
<span id="cb328-2"><a href="transforming-data.html#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 5</span></span>
<span id="cb328-3"><a href="transforming-data.html#cb328-3" aria-hidden="true" tabindex="-1"></a>  year  month week  variable value</span>
<span id="cb328-4"><a href="transforming-data.html#cb328-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>    <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb328-5"><a href="transforming-data.html#cb328-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">1994</span>  Nov   <span class="dv">1</span>     Date     <span class="st">&quot;&quot;</span>   </span>
<span id="cb328-6"><a href="transforming-data.html#cb328-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">1994</span>  Nov   <span class="dv">1</span>     Value    <span class="st">&quot;&quot;</span>   </span>
<span id="cb328-7"><a href="transforming-data.html#cb328-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1994</span>  Nov   <span class="dv">2</span>     Date     <span class="st">&quot;&quot;</span>   </span>
<span id="cb328-8"><a href="transforming-data.html#cb328-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">1994</span>  Nov   <span class="dv">2</span>     Value    <span class="st">&quot;&quot;</span>   </span>
<span id="cb328-9"><a href="transforming-data.html#cb328-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">1994</span>  Nov   <span class="dv">3</span>     Date     <span class="st">&quot;&quot;</span>   </span>
<span id="cb328-10"><a href="transforming-data.html#cb328-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1994</span>  Nov   <span class="dv">3</span>     Value    <span class="st">&quot;&quot;</span>   </span></code></pre></div>
<p>Now we’re ready to move back into wide-er form</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="transforming-data.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb329-2"><a href="transforming-data.html#cb329-2" aria-hidden="true" tabindex="-1"></a>gas_prices <span class="ot">&lt;-</span> gas_prices_long <span class="sc">%&gt;%</span></span>
<span id="cb329-3"><a href="transforming-data.html#cb329-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter out empty values</span></span>
<span id="cb329-4"><a href="transforming-data.html#cb329-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">!=</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb329-5"><a href="transforming-data.html#cb329-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb329-6"><a href="transforming-data.html#cb329-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> variable,</span>
<span id="cb329-7"><a href="transforming-data.html#cb329-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> value</span>
<span id="cb329-8"><a href="transforming-data.html#cb329-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="transforming-data.html#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gas_prices)</span>
<span id="cb330-2"><a href="transforming-data.html#cb330-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 5</span></span>
<span id="cb330-3"><a href="transforming-data.html#cb330-3" aria-hidden="true" tabindex="-1"></a>  year  month week  Date  Value</span>
<span id="cb330-4"><a href="transforming-data.html#cb330-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb330-5"><a href="transforming-data.html#cb330-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">1994</span>  Nov   <span class="dv">4</span>     <span class="dv">11</span><span class="sc">/</span><span class="dv">28</span> <span class="fl">1.175</span></span>
<span id="cb330-6"><a href="transforming-data.html#cb330-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">1994</span>  Dec   <span class="dv">1</span>     <span class="dv">12</span><span class="sc">/</span><span class="dv">05</span> <span class="fl">1.143</span></span>
<span id="cb330-7"><a href="transforming-data.html#cb330-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1994</span>  Dec   <span class="dv">2</span>     <span class="dv">12</span><span class="sc">/</span><span class="dv">12</span> <span class="fl">1.118</span></span>
<span id="cb330-8"><a href="transforming-data.html#cb330-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">1994</span>  Dec   <span class="dv">3</span>     <span class="dv">12</span><span class="sc">/</span><span class="dv">19</span> <span class="fl">1.099</span></span>
<span id="cb330-9"><a href="transforming-data.html#cb330-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">1994</span>  Dec   <span class="dv">4</span>     <span class="dv">12</span><span class="sc">/</span><span class="dv">26</span> <span class="fl">1.088</span></span>
<span id="cb330-10"><a href="transforming-data.html#cb330-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1995</span>  Jan   <span class="dv">1</span>     <span class="dv">01</span><span class="sc">/</span><span class="dv">02</span> <span class="fl">1.104</span></span></code></pre></div>
<details>
<summary>
Clean up dates and format variables properly
</summary>
<p>We can read the date in as MDY format if we just add the year to the end of the month/day column.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="transforming-data.html#cb331-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-2"><a href="transforming-data.html#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># dates and times</span></span>
<span id="cb331-3"><a href="transforming-data.html#cb331-3" aria-hidden="true" tabindex="-1"></a>gas_prices <span class="ot">&lt;-</span> gas_prices <span class="sc">%&gt;%</span></span>
<span id="cb331-4"><a href="transforming-data.html#cb331-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">paste</span>(Date, year, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb331-5"><a href="transforming-data.html#cb331-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">mdy</span>(Date))</span>
<span id="cb331-6"><a href="transforming-data.html#cb331-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-7"><a href="transforming-data.html#cb331-7" aria-hidden="true" tabindex="-1"></a><span class="co"># And now we can get rid of redundant columns</span></span>
<span id="cb331-8"><a href="transforming-data.html#cb331-8" aria-hidden="true" tabindex="-1"></a>gas_prices <span class="ot">&lt;-</span> gas_prices <span class="sc">%&gt;%</span></span>
<span id="cb331-9"><a href="transforming-data.html#cb331-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Date, Value)</span>
<span id="cb331-10"><a href="transforming-data.html#cb331-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-11"><a href="transforming-data.html#cb331-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, our value variable is a character variable, so lets fix that quick</span></span>
<span id="cb331-12"><a href="transforming-data.html#cb331-12" aria-hidden="true" tabindex="-1"></a>gas_prices <span class="ot">&lt;-</span> gas_prices <span class="sc">%&gt;%</span></span>
<span id="cb331-13"><a href="transforming-data.html#cb331-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Value =</span> <span class="fu">as.numeric</span>(Value))</span></code></pre></div>
</details>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="transforming-data.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gas_prices)</span>
<span id="cb332-2"><a href="transforming-data.html#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 x 2</span></span>
<span id="cb332-3"><a href="transforming-data.html#cb332-3" aria-hidden="true" tabindex="-1"></a>  Date       Value</span>
<span id="cb332-4"><a href="transforming-data.html#cb332-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb332-5"><a href="transforming-data.html#cb332-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">1994-11-28</span>  <span class="fl">1.18</span></span>
<span id="cb332-6"><a href="transforming-data.html#cb332-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">1994-12-05</span>  <span class="fl">1.14</span></span>
<span id="cb332-7"><a href="transforming-data.html#cb332-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1994-12-12</span>  <span class="fl">1.12</span></span>
<span id="cb332-8"><a href="transforming-data.html#cb332-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">1994-12-19</span>  <span class="fl">1.10</span></span>
<span id="cb332-9"><a href="transforming-data.html#cb332-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">1994-12-26</span>  <span class="fl">1.09</span></span>
<span id="cb332-10"><a href="transforming-data.html#cb332-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1995-01-02</span>  <span class="fl">1.10</span></span>
<span id="cb332-11"><a href="transforming-data.html#cb332-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-12"><a href="transforming-data.html#cb332-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets look at our data:</span></span>
<span id="cb332-13"><a href="transforming-data.html#cb332-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gas_prices, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Value)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="image/cleaning-up-dates-view-1.png" width="2100" /></p>
<p>The full code file for this analysis is <a href="code/06_gas_prices.R">here</a>.</p>
</div>
<div id="option-3-sas" class="section level3" number="7.5.3">
<h3><span class="header-section-number">7.5.3</span> Option 3: SAS</h3>
<p>If you want to try this for yourself first, there is a skeleton file <a href="code/06_gas_prices_start.sas">here</a> that you can fill in. Use the intermediate datasets shown to guide you through the steps, then click on the expandable sections to see the code that was used.</p>
<div class="note">
<p>I spent quite a while trying to get collectcode = T to run so that I could put the SAS code in in smaller bites, but couldn’t get it to work. Please forgive the screenshots, but ugh, I’m tired of fooling with SAS at the moment.</p>
</div>
<details>
<summary>
Read in the data
</summary>
<pre class="sashtml"><code>6          /*********************************************************/
7          /* Step 1: Read in the data and drop missing rows/cols   */
8          /*********************************************************/
9          options missing=&#39; &#39;;


10         data gas_raw;
11         infile &#39;data/gas_prices_raw.csv&#39; firstobs=3 delimiter = &#39;,&#39;
11       ! MISSOVER DSD;
12         informat ym $10. ;
13         informat date1 $8. ; informat value1 4.3 ;
14         informat date2 $8. ; informat value2 4.3 ;
15         informat date3 $8. ; informat value3 4.3 ;
16         informat date4 $8. ; informat value4 4.3 ;
17         informat date5 $8. ; informat value5 4.3 ;
18         informat blank $2. ; informat blank $2. ;
19         format ym $10. ;
20         format date1 $8. ; format value1 4.3 ;
21         format date2 $8. ; format value2 4.3 ;
22         format date3 $8. ; format value3 4.3 ;
23         format date4 $8. ; format value4 4.3 ;
24         format date5 $8. ; format value5 4.3 ;
25         format blank $2. ; format blank $2. ;
26         input ym $ date1 $ value1 date2 $ value2 date3 $ value3 date4 $
26       ! value4 date5 $ value5 blank $ blank $;
27         /* drop extra columns */
28         drop blank;
29         
30         /* delete any rows where ym is not there */
31         if missing(ym) then delete;
32         run;

NOTE: The data set WORK.GAS_RAW has 0 observations and 11 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

33         

ERROR: Errors printed on pages 9,11,12,13,15,16,18,19,22,23.</code></pre>
<p>Dates are formated as 8-character strings, values as numbers with 3 decimal places.</p>
The options missing piece allows us to test for whether information is missing or not.
</details>
<div class="figure">
<img src="image/06-transforming-data_insertimage_1.png" alt="" />
<p class="caption">SAS output - gas_raw</p>
</div>
<details>
<summary>
Split up year and month, format month properly
</summary>
<pre class="sashtml"><code>6          
7          proc format;
8          value $ mon &#39;Jan&#39; = 1 &#39;Feb&#39; = 2 &#39;Mar&#39; = 3 &#39;Apr&#39; = 4 &#39;May&#39; = 5
                               _
                               22
                               76
8        ! &#39;Jun&#39; = 6 &#39;Jul&#39; = 7 &#39;Aug&#39; = 8 &#39;Sep&#39; = 9 &#39;Oct&#39; = 10 &#39;Nov&#39; = 11
8        ! &#39;Dec&#39; = 12;
ERROR 22-322: Syntax error, expecting one of the following: 
              a quoted string, a format name.  

ERROR 76-322: Syntax error, statement will be ignored.

9          run;

WARNING: RUN statement ignored due to previous errors. Submit QUIT; to 
         terminate the procedure.
NOTE: PROCEDURE FORMAT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
NOTE: The SAS System stopped processing this step because of errors.
10         


11         data gas_raw;
12            set gas_raw;
13            length var1-var2 $4.;
14            array var(2) $;
NOTE: The array var has the same name as a SAS-supplied or user-defined 
      function.  Parentheses following this name are treated as array 
      references and not function references.
15            do i = 1 to dim(var);
16               var[i]=scan(ym,i,&#39;-&#39;);
17            end;
18         rename var1 = year var2 = month;
19         drop i ym;
20         if date1 = &quot;NA&quot; then delete; /* get rid of NA stuff */
21         run;

NOTE: The data set WORK.GAS_RAW has 0 observations and 12 variables.
WARNING: Data set WORK.GAS_RAW was not replaced because this step was 
         stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

22         
23         /* format month as a number */
24         data gas_raw;
25         set gas_raw;
26         format month $ mon.;
                          ____
                          48
ERROR 48-59: The format $MON was not found or could not be loaded.

27         run;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set WORK.GAS_RAW may be incomplete.  When this step was 
         stopped there were 0 observations and 12 variables.
WARNING: Data set WORK.GAS_RAW was not replaced because this step was 
         stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16,18,19,22,23.</code></pre>
</details>
<div class="figure">
<img src="image/06-transforming-data_insertimage_2.png" alt="" />
<p class="caption">SAS output - gas_raw</p>
</div>
<details>
<summary>
Get long data with just the dates
</summary>
<pre class="sashtml"><code>6          
7          PROC TRANSPOSE DATA = gas_raw OUT = split_long1
8          (rename=(col1=date)) NAME = week;
9          BY year month NOTSORTED;
ERROR: Variable YEAR not found.
ERROR: Variable MONTH not found.
10         VAR date1 date2 date3 date4 date5;
11         RUN;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set WORK.SPLIT_LONG1 may be incomplete.  When this step 
         was stopped there were 0 observations and 0 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
12         


13         data split_long1;
14         set split_long1;
15         IF _N_ = 1 THEN DO;
16             REGEXname = PRXPARSE(&quot;s/date//&quot;);
17         END;
18         RETAIN REGEXname;
19         
20         CALL PRXCHANGE(REGEXname, -1, week, week);
                _________
                716
WARNING 716-185: Argument #4 is a numeric variable, while a character 
                 variable must be passed to the PRXCHANGE subroutine call 
                 in order for the variable to be updated.

21         DROP REGEXname;
22         IF missing(date) THEN delete;
23         RUN;

NOTE: Numeric values have been converted to character 
      values at the places given by: (Line):(Column).
      20:31   20:37   
NOTE: The data set WORK.SPLIT_LONG1 has 0 observations and 2 variables.
WARNING: Data set WORK.SPLIT_LONG1 was not replaced because this step was 
         stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

24         
25         PROC SORT data = split_long1 out = split_long1;
26         BY year month week;
ERROR: Variable YEAR not found.
ERROR: Variable MONTH not found.
ERROR: Variable WEEK not found.
27         RUN;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set WORK.SPLIT_LONG1 may be incomplete.  When this step 
         was stopped there were 0 observations and 0 variables.
WARNING: Data set WORK.SPLIT_LONG1 was not replaced because this step was 
         stopped.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16,18,19,22,23,24.</code></pre>
</details>
<div class="figure">
<img src="image/06-transforming-data_insertimage_3.png" alt="" />
<p class="caption">SAS output - split_long1</p>
</div>
<details>
<summary>
Get long data with just the prices
</summary>
<pre class="sashtml"><code>6          


7          PROC TRANSPOSE DATA=gas_split OUT =split_long2
ERROR: File WORK.GAS_SPLIT.DATA does not exist.
8          (rename=(col1=price)) NAME = week;
9          BY year month NOTSORTED;
ERROR: No data set open to look up variables.
ERROR: No data set open to look up variables.
10         VAR value1 value2 value3 value4 value5;
ERROR: No data set open to look up variables.
ERROR: No data set open to look up variables.
ERROR: No data set open to look up variables.
ERROR: No data set open to look up variables.
ERROR: No data set open to look up variables.
11         RUN;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set WORK.SPLIT_LONG2 may be incomplete.  When this step 
         was stopped there were 0 observations and 0 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
12         


13         data split_long2;
14         set split_long2;
15         IF _N_ = 1 THEN DO;
16             REGEXname = PRXPARSE(&quot;s/value//&quot;);
17         END;
18         RETAIN REGEXname;
19         
20         CALL PRXCHANGE(REGEXname, -1, week, week);
                _________
                716
WARNING 716-185: Argument #4 is a numeric variable, while a character 
                 variable must be passed to the PRXCHANGE subroutine call 
                 in order for the variable to be updated.

21         DROP REGEXname;
22         IF missing(price) THEN delete;
23         RUN;

NOTE: Numeric values have been converted to character 
      values at the places given by: (Line):(Column).
      20:31   20:37   
NOTE: The data set WORK.SPLIT_LONG2 has 0 observations and 2 variables.
WARNING: Data set WORK.SPLIT_LONG2 was not replaced because this step was 
         stopped.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

24         
25         PROC SORT data = split_long2 out = split_long2;
26         BY year month week;
ERROR: Variable YEAR not found.
ERROR: Variable MONTH not found.
ERROR: Variable WEEK not found.
27         RUN;

NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set WORK.SPLIT_LONG2 may be incomplete.  When this step 
         was stopped there were 0 observations and 0 variables.
WARNING: Data set WORK.SPLIT_LONG2 was not replaced because this step was 
         stopped.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
28         


ERROR: Errors printed on pages 9,11,12,13,15,16,18,19,22,23,24,25.</code></pre>
</details>
<div class="figure">
<img src="image/06-transforming-data_insertimage_4.png" alt="" />
<p class="caption">SAS output - split_long2</p>
</div>
<details>
<summary>
Merge the two long datasets together
</summary>
<pre class="sashtml"><code>6          


7          PROC SQL;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of 
      statements.
8          CREATE TABLE gas_prices AS
9          SELECT COALESCE(p1.year, p2.year) AS year,
10                COALESCE(p1.month, p2.month) AS month,
11                COALESCE(p1.week, p2.week) AS week,
12                date, price
13         FROM split_long1 as p1
14         RIGHT JOIN split_long2 as p2
15         ON p1.year = p2.year AND p1.month = p2.month AND p1.week =
15       ! p2.week;
NOTE: Statement not executed due to NOEXEC option.
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16,18,19,22,23,24,25,26.</code></pre>
</details>
<div class="figure">
<img src="image/06-transforming-data_insertimage_5.png" alt="" />
<p class="caption">SAS output - gas prices</p>
</div>
<details>
<summary>
Format dates
</summary>
<pre class="sashtml"><code>6          
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.02 seconds
      


7          DATA split2;
8             SET gas_prices;
ERROR: File WORK.GAS_PRICES.DATA does not exist.
9             length var1-var2 3;
10            array var(2);
NOTE: The array var has the same name as a SAS-supplied or user-defined 
      function.  Parentheses following this name are treated as array 
      references and not function references.
11            do i = 1 to dim(var);
12               var[i]=scan(date,i,&#39;/&#39;);
13            end;
14         RENAME var1 = monthnum var2 = day;
15         DROP i date; /* month is also in numeric form */
16         RUN;

NOTE: Numeric values have been converted to character 
      values at the places given by: (Line):(Column).
      12:19   
NOTE: Character values have been converted to numeric 
      values at the places given by: (Line):(Column).
      12:7   
NOTE: The SAS System stopped processing this step because of errors.
WARNING: The data set WORK.SPLIT2 may be incomplete.  When this step was 
         stopped there were 0 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

17         
18         DATA gas_prices;
19         SET split2;
20         date = MDY(monthnum, day, year);
21         FORMAT date yymmdd10.;
22         KEEP date price;
23         RUN;

WARNING: The variable price in the DROP, KEEP, or RENAME list has never 
         been referenced.
NOTE: The data set WORK.GAS_PRICES has 0 observations and 1 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

24         
25         PROC SORT DATA=gas_prices OUT = gas_prices;
26         BY date;
27         RUN;

NOTE: The data set WORK.GAS_PRICES has 0 observations and 0 variables.
WARNING: Data set WORK.GAS_PRICES was not replaced because new file is 
         incomplete.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16,18,19,22,23,24,25,26.</code></pre>
</details>
<div class="figure">
<img src="image/06-transforming-data_insertimage_6.png" alt="" />
<p class="caption">SAS output - gas prices, final version</p>
</div>
<pre class="sashtml"><code>6          
7          PROC SGPLOT DATA = gas_prices;
8          SERIES X = date Y = price;
ERROR: Variable PRICE not found.
9          TITLE &#39;Gas Prices&#39;;
10         RUN;

NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SGPLOT used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

ERROR: Errors printed on pages 9,11,12,13,15,16,18,19,22,23,24,25,26,27.</code></pre>
<p><img src="image/06_sas_gas_prices_plot.png" /></p>
<p>You can see the full script <a href="code/06_gas_prices.sas">here</a>.</p>
</div>
</div>
<div id="references-1" class="section level2 unnumbered learn-more">
<h2>References</h2>
<p>String manipulation</p>
<ul>
<li><a href="https://r4ds.had.co.nz/strings.html">R4DS chapter - strings</a></li>
<li><a href="https://support.sas.com/resources/papers/proceedings/proceedings/sugi29/265-29.pdf">SAS and Perl regular expressions</a></li>
<li><a href="https://regex101.com/">PCRE tester</a></li>
<li><a href="https://spannbaueradam.shinyapps.io/r_regex_tester/">R regex tester</a> - has a short timeout period and will disconnect you if you’re idle too long. But you can also clone the repo <a href="https://github.com/AdamSpannbauer/r_regex_tester_app">here</a> and run it locally.</li>
<li><a href="https://documentation.sas.com/?docsetId=ds2ref&amp;docsetTarget=p13adatt2vvhcxn1ext6w6eet24p.htm&amp;docsetVersion=9.4&amp;locale=en#p1ub8nub953289n1dpsvh7gm88qs">SAS scan statement</a></li>
</ul>
<p>Tidy data tutorials/references</p>
<ul>
<li><a href="https://psyteachr.github.io/msc-data-skills/tidyr.html">Tidy Data - Data Skills for Reproducible Science</a></li>
<li><a href="http://cinsug.org/uploads/3/6/2/9/36298586/horstman_five_ways_to_flip_flop_your_data_paper.pdf">Five Ways to Flip-Flop Your Data</a></li>
<li><a href="https://documentation.sas.com/?docsetId=proc&amp;docsetVersion=9.4&amp;docsetTarget=n1xno5xgs39b70n0zydov0owajj8.htm&amp;locale=en">PROC TRANSPOSE reference</a></li>
<li><a href="https://tidyr.tidyverse.org/">tidyr reference</a></li>
</ul>
<p>Relational Data &amp; Joins:</p>
<ul>
<li><a href="https://r4ds.had.co.nz/relational-data.html">R4DS chapter - Relational data</a></li>
<li><a href="https://documentation.sas.com/?docsetId=lestmtsref&amp;docsetTarget=n1i8w2bwu1fn5kn1gpxj18xttbb0.htm&amp;docsetVersion=9.4&amp;locale=en">Merge statement in SAS</a></li>
<li><a href="https://www.mwsug.org/proceedings/2014/BB/MWSUG-2014-BB03.pdf">5 little known, but highly valuable and widely useful PROC SQL Programming Techniques</a></li>
</ul>
<p>Other references</p>
<ul>
<li><p><a href="https://documentation.sas.com/?docsetId=lestmtsref&amp;docsetTarget=n0x16kvqkxxdx5n1t04voifvo8wo.htm&amp;docsetVersion=9.4&amp;locale=en">SAS rename statement</a></p></li>
<li><p><a href="https://www.pharmasug.org/proceedings/2016/DG/PharmaSUG-2016-DG04.pdf">SAS graph customization</a></p></li>
<li><p><a href="https://documentation.sas.com/?docsetId=grstatproc&amp;docsetTarget=n0yjdd910dh59zn1toodgupaj4v9.htm&amp;docsetVersion=9.4&amp;locale=en">SAS SGPLOT procedure</a></p></li>
<li><p><a href="https://psyteachr.github.io/msc-data-skills/ggplot.html">Data Visualization with ggplot</a></p></li>
<li><p><a href="https://www.r-graph-gallery.com/">R graph gallery</a></p></li>
<li><p><a href="https://www.youtube.com/playlist?list=PL19ev-r1GBwkuyiwnxoHTRC8TTqP8OEi8">Videos of analysis of new data from Tidy Tuesday</a> - may include use of other packages, but almost definitely includes use of tidyr/dplyr as well.</p></li>
</ul>
<div class="learn-more">
<p>Way back in Module 2, I briefly mentioned list-columns in tibbles. At the time, you didn’t have enough R knowledge to use that information, but now you do!!</p>
<p>You can see a couple of examples <a href="https://jennybc.github.io/purrr-tutorial/ls13_list-columns.html">here</a> (but they assume that you know things that you’ll only learn in a few modules).</p>
</div>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="25">
<li id="fn25"><p>Incidentally, dbplyr is basically dplyr for databases, and is worth checking out, even if we aren’t covering it in this class.<a href="transforming-data.html#fnref25" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="manipulating-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="debugging.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/srvanderplas/unl-stat850/edit/master/07-transforming-data.Rmd",
"text": "Suggest an edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/srvanderplas/unl-stat850/raw/master/07-transforming-data.Rmd"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
